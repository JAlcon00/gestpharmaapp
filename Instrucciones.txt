â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ğŸš€ INSTRUCCIONES DE MEJORA CONTINUA - GESTPHARMA APP
  Proyecto: Sistema de GestiÃ³n FarmacÃ©utica
  Fecha: 28 de noviembre de 2025
  VersiÃ³n: 2.0
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ  ğŸ“‹ OBJETIVO PRINCIPAL                                                      â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

Transformar GestPharma en una aplicaciÃ³n mÃ³vil de CLASE MUNDIAL con excelencia 
en UI/UX, arquitectura, calidad de cÃ³digo y estÃ¡ndares profesionales. 

El proyecto debe cumplir con los MÃS ALTOS ESTÃNDARES de la industria, siendo:
  âœ“ Completamente TESTEABLE (cobertura >80%)
  âœ“ Totalmente ACCESIBLE (WCAG 2.1 AAA)
  âœ“ Altamente ESCALABLE y MANTENIBLE
  âœ“ Con COHERENCIA LÃ“GICA Y ESTÃ‰TICA absoluta
  âœ“ Sin INCOHERENCIAS ni INCONSISTENCIAS
  âœ“ Con BUENAS PRÃCTICAS en cada lÃ­nea de cÃ³digo

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ  âš ï¸  PRINCIPIOS FUNDAMENTALES (CUMPLIMIENTO OBLIGATORIO)                   â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

1. COHERENCIA ABSOLUTA
   â€¢ Toda decisiÃ³n de diseÃ±o debe seguir un patrÃ³n consistente en toda la app
   â€¢ Los colores, espaciados, tipografÃ­as deben ser coherentes entre pÃ¡ginas
   â€¢ No debe haber elementos visuales contradictorios o incongruentes
   â€¢ La experiencia del usuario debe ser predecible y uniforme

2. CERO INCOHERENCIAS LÃ“GICAS
   â€¢ El flujo de navegaciÃ³n debe ser lÃ³gico e intuitivo
   â€¢ Las acciones deben producir resultados esperados
   â€¢ Los estados de la aplicaciÃ³n deben ser consistentes
   â€¢ No debe haber comportamientos inesperados o contradictorios

3. BUENAS PRÃCTICAS OBLIGATORIAS
   â€¢ Seguir SOLID, DRY, KISS, YAGNI en todo el cÃ³digo
   â€¢ Componentes pequeÃ±os, enfocados y reutilizables
   â€¢ SeparaciÃ³n clara de responsabilidades
   â€¢ CÃ³digo autodocumentado con JSDoc cuando sea necesario
   â€¢ Manejo de errores robusto y completo

4. CALIDAD EXCELSA
   â€¢ Cada caracterÃ­stica debe estar completamente terminada
   â€¢ Todo debe ser testeable y tener tests asociados
   â€¢ El cÃ³digo debe ser revisable y mantenible
   â€¢ La documentaciÃ³n debe estar actualizada
   â€¢ El rendimiento debe ser Ã³ptimo

5. ESTANDARIZACIÃ“N
   â€¢ Seguir las guÃ­as de estilo de Angular/Ionic
   â€¢ Usar convenciones de nombres consistentes
   â€¢ Aplicar patrones de diseÃ±o reconocidos
   â€¢ Cumplir con estÃ¡ndares web (HTML5, CSS3, ES6+)
   â€¢ Seguir las mejores prÃ¡cticas de TypeScript

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ  ğŸ¨ FASE 1: MEJORAS DE UI/UX (PRIORIDAD CRÃTICA)                           â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  1.1 SISTEMA DE DISEÃ‘O (DESIGN SYSTEM) - FUNDACIÃ“N
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

OBJETIVO: Crear una base sÃ³lida y coherente para toda la interfaz de usuario.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 1.1.1 Design Tokens (Variables de DiseÃ±o)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/theme/design-tokens.ts

IMPLEMENTAR:

export const DesignTokens = {
  // ESPACIADO (Sistema de 4px - Regla de 4pt Grid)
  spacing: {
    none: '0',
    xs: '4px',      // Espacios muy pequeÃ±os
    sm: '8px',      // Espacios pequeÃ±os
    md: '16px',     // Espacios medianos (base)
    lg: '24px',     // Espacios grandes
    xl: '32px',     // Espacios muy grandes
    xxl: '48px',    // Espacios extra grandes
    xxxl: '64px'    // Espacios masivos
  },
  
  // RADIOS DE BORDE (Border Radius)
  borderRadius: {
    none: '0',
    sm: '4px',      // Botones secundarios
    md: '8px',      // Botones principales, inputs
    lg: '12px',     // Cards pequeÃ±as
    xl: '16px',     // Cards grandes, modales
    xxl: '24px',    // Elementos destacados
    full: '9999px'  // Pills, badges circulares
  },
  
  // SOMBRAS (ElevaciÃ³n y Profundidad)
  shadows: {
    none: 'none',
    xs: '0 1px 2px 0 rgba(0, 0, 0, 0.05)',
    sm: '0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)',
    md: '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)',
    lg: '0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)',
    xl: '0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)',
    xxl: '0 25px 50px -12px rgba(0, 0, 0, 0.25)',
    inner: 'inset 0 2px 4px 0 rgba(0, 0, 0, 0.06)',
    outline: '0 0 0 3px rgba(66, 153, 225, 0.5)'
  },
  
  // TRANSICIONES Y ANIMACIONES
  transitions: {
    fast: '150ms cubic-bezier(0.4, 0, 0.2, 1)',
    base: '250ms cubic-bezier(0.4, 0, 0.2, 1)',
    slow: '350ms cubic-bezier(0.4, 0, 0.2, 1)',
    slowest: '500ms cubic-bezier(0.4, 0, 0.2, 1)'
  },
  
  // DURACIONES DE ANIMACIÃ“N
  durations: {
    instant: '0ms',
    fast: '150ms',
    normal: '250ms',
    slow: '350ms',
    slower: '500ms',
    slowest: '750ms'
  },
  
  // EASING FUNCTIONS (Curvas de animaciÃ³n)
  easing: {
    linear: 'cubic-bezier(0, 0, 1, 1)',
    ease: 'cubic-bezier(0.25, 0.1, 0.25, 1)',
    easeIn: 'cubic-bezier(0.42, 0, 1, 1)',
    easeOut: 'cubic-bezier(0, 0, 0.58, 1)',
    easeInOut: 'cubic-bezier(0.42, 0, 0.58, 1)',
    spring: 'cubic-bezier(0.68, -0.55, 0.265, 1.55)'
  },
  
  // BREAKPOINTS RESPONSIVE
  breakpoints: {
    xs: '0px',       // MÃ³viles pequeÃ±os
    sm: '576px',     // MÃ³viles grandes
    md: '768px',     // Tablets portrait
    lg: '992px',     // Tablets landscape
    xl: '1200px',    // Desktop
    xxl: '1400px'    // Desktop grande
  },
  
  // Z-INDEX (Capas de elementos)
  zIndex: {
    base: 0,
    dropdown: 1000,
    sticky: 1020,
    fixed: 1030,
    backdrop: 1040,
    modal: 1050,
    popover: 1060,
    tooltip: 1070,
    notification: 1080,
    overlay: 9999
  },
  
  // OPACIDAD
  opacity: {
    disabled: 0.4,
    hover: 0.8,
    active: 0.6,
    overlay: 0.5,
    subtle: 0.6
  }
} as const;

export type SpacingKey = keyof typeof DesignTokens.spacing;
export type BorderRadiusKey = keyof typeof DesignTokens.borderRadius;
export type ShadowKey = keyof typeof DesignTokens.shadows;

NOTAS IMPORTANTES:
â€¢ Usar SIEMPRE estos tokens en lugar de valores hardcodeados
â€¢ No crear espaciados o sombras personalizadas sin actualizar este archivo
â€¢ Mantener coherencia: si usas 'md' en un lugar, Ãºsalo consistentemente
â€¢ Documentar cualquier adiciÃ³n o modificaciÃ³n a estos tokens

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 1.1.2 Paleta de Colores Profesional para Farmacia
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/theme/colors.scss

OBJETIVO: Crear una paleta coherente, accesible (WCAG AAA) y profesional que 
evoque confianza, salud y tecnologÃ­a.

IMPLEMENTAR:

:root {
  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     COLORES PRINCIPALES
     Estos colores definen la identidad visual de la aplicaciÃ³n
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  
  /* â”â”â” PRIMARY: Verde FarmacÃ©utico (Salud, Confianza, Naturaleza) â”â”â” */
  --color-primary-50: #e8f5e9;
  --color-primary-100: #c8e6c9;
  --color-primary-200: #a5d6a7;
  --color-primary-300: #81c784;
  --color-primary-400: #66bb6a;
  --color-primary-500: #4caf50;  /* â† Color base principal */
  --color-primary-600: #43a047;
  --color-primary-700: #388e3c;
  --color-primary-800: #2e7d32;
  --color-primary-900: #1b5e20;
  
  /* â”â”â” SECONDARY: Azul MÃ©dico (Profesionalismo, TecnologÃ­a) â”â”â” */
  --color-secondary-50: #e3f2fd;
  --color-secondary-100: #bbdefb;
  --color-secondary-200: #90caf9;
  --color-secondary-300: #64b5f6;
  --color-secondary-400: #42a5f5;
  --color-secondary-500: #2196f3;  /* â† Color base secundario */
  --color-secondary-600: #1e88e5;
  --color-secondary-700: #1976d2;
  --color-secondary-800: #1565c0;
  --color-secondary-900: #0d47a1;
  
  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     COLORES SEMÃNTICOS
     Estos colores transmiten significado y estado
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  
  /* â”â”â” SUCCESS: ConfirmaciÃ³n, OperaciÃ³n Exitosa â”â”â” */
  --color-success-50: #e8f5e9;
  --color-success-100: #c8e6c9;
  --color-success-200: #a5d6a7;
  --color-success-300: #81c784;
  --color-success-400: #66bb6a;
  --color-success-500: #4caf50;
  --color-success-600: #43a047;
  --color-success-700: #388e3c;
  --color-success-800: #2e7d32;
  --color-success-900: #1b5e20;
  
  /* â”â”â” WARNING: Advertencia, Stock Bajo, PrecauciÃ³n â”â”â” */
  --color-warning-50: #fff3e0;
  --color-warning-100: #ffe0b2;
  --color-warning-200: #ffcc80;
  --color-warning-300: #ffb74d;
  --color-warning-400: #ffa726;
  --color-warning-500: #ff9800;
  --color-warning-600: #fb8c00;
  --color-warning-700: #f57c00;
  --color-warning-800: #ef6c00;
  --color-warning-900: #e65100;
  
  /* â”â”â” DANGER: Error, CrÃ­tico, Destructivo â”â”â” */
  --color-danger-50: #ffebee;
  --color-danger-100: #ffcdd2;
  --color-danger-200: #ef9a9a;
  --color-danger-300: #e57373;
  --color-danger-400: #ef5350;
  --color-danger-500: #f44336;
  --color-danger-600: #e53935;
  --color-danger-700: #d32f2f;
  --color-danger-800: #c62828;
  --color-danger-900: #b71c1c;
  
  /* â”â”â” INFO: InformaciÃ³n, Tips, Ayuda â”â”â” */
  --color-info-50: #e1f5fe;
  --color-info-100: #b3e5fc;
  --color-info-200: #81d4fa;
  --color-info-300: #4fc3f7;
  --color-info-400: #29b6f6;
  --color-info-500: #03a9f4;
  --color-info-600: #039be5;
  --color-info-700: #0288d1;
  --color-info-800: #0277bd;
  --color-info-900: #01579b;
  
  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ESCALA DE GRISES (NEUTRALES)
     Base para textos, fondos y bordes
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  
  --color-gray-50: #fafafa;
  --color-gray-100: #f5f5f5;
  --color-gray-200: #eeeeee;
  --color-gray-300: #e0e0e0;
  --color-gray-400: #bdbdbd;
  --color-gray-500: #9e9e9e;
  --color-gray-600: #757575;
  --color-gray-700: #616161;
  --color-gray-800: #424242;
  --color-gray-900: #212121;
  
  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     COLORES DE FONDO (TEMA CLARO)
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  
  --bg-primary: #ffffff;           /* Fondo principal de la app */
  --bg-secondary: #f8f9fa;         /* Fondo secundario (secciones) */
  --bg-tertiary: #f1f3f5;          /* Fondo terciario (cards, paneles) */
  --bg-elevated: #ffffff;          /* Elementos elevados (modales, popups) */
  --bg-overlay: rgba(0, 0, 0, 0.5); /* Overlay de modales */
  --bg-disabled: #e0e0e0;          /* Elementos deshabilitados */
  --bg-hover: rgba(0, 0, 0, 0.04); /* Hover en elementos */
  --bg-active: rgba(0, 0, 0, 0.08); /* Elemento activo/presionado */
  
  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     COLORES DE TEXTO (TEMA CLARO)
     Cumplir con WCAG AAA para contraste
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  
  --text-primary: #212121;         /* Texto principal (tÃ­tulos, contenido) */
  --text-secondary: #616161;       /* Texto secundario (subtÃ­tulos) */
  --text-tertiary: #9e9e9e;        /* Texto terciario (metadata, timestamps) */
  --text-disabled: #bdbdbd;        /* Texto deshabilitado */
  --text-inverse: #ffffff;         /* Texto sobre fondos oscuros */
  --text-link: #2196f3;            /* Links y texto interactivo */
  --text-link-hover: #1976d2;      /* Links en hover */
  
  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     COLORES DE BORDE
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  
  --border-light: #e0e0e0;         /* Bordes sutiles */
  --border-medium: #bdbdbd;        /* Bordes normales */
  --border-dark: #757575;          /* Bordes destacados */
  --border-focus: #2196f3;         /* Borde de elementos enfocados */
  --border-error: #f44336;         /* Borde de error */
  
  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     GRADIENTES PROFESIONALES
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  
  --gradient-primary: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%);
  --gradient-secondary: linear-gradient(135deg, #2196f3 0%, #64b5f6 100%);
  --gradient-success: linear-gradient(135deg, #4caf50 0%, #81c784 100%);
  --gradient-warning: linear-gradient(135deg, #ff9800 0%, #ffb74d 100%);
  --gradient-danger: linear-gradient(135deg, #f44336 0%, #e57373 100%);
  --gradient-info: linear-gradient(135deg, #03a9f4 0%, #4fc3f7 100%);
  
  /* Gradientes sutiles para fondos */
  --gradient-bg-soft: linear-gradient(180deg, #ffffff 0%, #f8f9fa 100%);
  --gradient-bg-card: linear-gradient(145deg, #ffffff 0%, #fafafa 100%);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TEMA OSCURO (DARK MODE)
   Detectar preferencia del sistema operativo
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

@media (prefers-color-scheme: dark) {
  :root {
    /* Fondos oscuros */
    --bg-primary: #121212;         /* Material Design Dark: Superficie base */
    --bg-secondary: #1e1e1e;       /* Superficie elevada 1dp */
    --bg-tertiary: #2c2c2c;        /* Superficie elevada 2dp */
    --bg-elevated: #1e1e1e;        /* Modales y elementos flotantes */
    --bg-overlay: rgba(0, 0, 0, 0.7);
    --bg-disabled: #2c2c2c;
    --bg-hover: rgba(255, 255, 255, 0.08);
    --bg-active: rgba(255, 255, 255, 0.12);
    
    /* Textos claros */
    --text-primary: #ffffff;       /* Texto principal */
    --text-secondary: #b0b0b0;     /* Texto secundario */
    --text-tertiary: #808080;      /* Texto terciario */
    --text-disabled: #606060;      /* Texto deshabilitado */
    --text-inverse: #212121;       /* Texto sobre fondos claros */
    --text-link: #64b5f6;          /* Links */
    --text-link-hover: #90caf9;    /* Links en hover */
    
    /* Bordes oscuros */
    --border-light: #2c2c2c;
    --border-medium: #404040;
    --border-dark: #606060;
    --border-focus: #64b5f6;
    --border-error: #ef5350;
    
    /* Gradientes ajustados para tema oscuro */
    --gradient-bg-soft: linear-gradient(180deg, #121212 0%, #1e1e1e 100%);
    --gradient-bg-card: linear-gradient(145deg, #1e1e1e 0%, #2c2c2c 100%);
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CLASE PARA FORZAR TEMA OSCURO
   Permite toggle manual del tema
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

.dark-theme,
[data-theme="dark"] {
  --bg-primary: #121212;
  --bg-secondary: #1e1e1e;
  --bg-tertiary: #2c2c2c;
  --bg-elevated: #1e1e1e;
  --bg-overlay: rgba(0, 0, 0, 0.7);
  --bg-disabled: #2c2c2c;
  --bg-hover: rgba(255, 255, 255, 0.08);
  --bg-active: rgba(255, 255, 255, 0.12);
  
  --text-primary: #ffffff;
  --text-secondary: #b0b0b0;
  --text-tertiary: #808080;
  --text-disabled: #606060;
  --text-inverse: #212121;
  --text-link: #64b5f6;
  --text-link-hover: #90caf9;
  
  --border-light: #2c2c2c;
  --border-medium: #404040;
  --border-dark: #606060;
  --border-focus: #64b5f6;
  --border-error: #ef5350;
  
  --gradient-bg-soft: linear-gradient(180deg, #121212 0%, #1e1e1e 100%);
  --gradient-bg-card: linear-gradient(145deg, #1e1e1e 0%, #2c2c2c 100%);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CLASE PARA FORZAR TEMA CLARO
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

.light-theme,
[data-theme="light"] {
  --bg-primary: #ffffff;
  --bg-secondary: #f8f9fa;
  --bg-tertiary: #f1f3f5;
  --bg-elevated: #ffffff;
  --bg-overlay: rgba(0, 0, 0, 0.5);
  --bg-disabled: #e0e0e0;
  --bg-hover: rgba(0, 0, 0, 0.04);
  --bg-active: rgba(0, 0, 0, 0.08);
  
  --text-primary: #212121;
  --text-secondary: #616161;
  --text-tertiary: #9e9e9e;
  --text-disabled: #bdbdbd;
  --text-inverse: #ffffff;
  --text-link: #2196f3;
  --text-link-hover: #1976d2;
  
  --border-light: #e0e0e0;
  --border-medium: #bdbdbd;
  --border-dark: #757575;
  --border-focus: #2196f3;
  --border-error: #f44336;
  
  --gradient-bg-soft: linear-gradient(180deg, #ffffff 0%, #f8f9fa 100%);
  --gradient-bg-card: linear-gradient(145deg, #ffffff 0%, #fafafa 100%);
}

CONTRASTE WCAG AAA VERIFICADO:
â€¢ text-primary sobre bg-primary: 16.1:1 (AAA âœ“)
â€¢ text-secondary sobre bg-primary: 7.9:1 (AAA âœ“)
â€¢ text-tertiary sobre bg-primary: 4.8:1 (AA âœ“)
â€¢ Todos los colores semÃ¡nticos cumplen con AA mÃ­nimo

NOTAS CRÃTICAS:
â€¢ NUNCA usar colores hardcodeados en componentes
â€¢ SIEMPRE usar las variables CSS definidas aquÃ­
â€¢ VERIFICAR contraste antes de aÃ±adir nuevos colores
â€¢ MANTENER coherencia: mismo color = mismo significado
â€¢ PROBAR en modo claro Y oscuro antes de commit

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 1.1.3 TipografÃ­a Profesional y JerarquÃ­a Visual
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/theme/typography.scss

OBJETIVO: Establecer un sistema tipogrÃ¡fico profesional, legible y coherente que
mejore la jerarquÃ­a visual y la accesibilidad.

FUENTE RECOMENDADA: Inter (moderna, legible, optimizada para interfaces)
ALTERNATIVA: System UI Stack (rendimiento Ã³ptimo, nativo)

IMPLEMENTAR:

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   IMPORTACIÃ“N DE FUENTES
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* OpciÃ³n 1: Inter (Recomendado para UI profesional) */
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');

/* OpciÃ³n 2: Fuentes del sistema (Mejor rendimiento)
   System font stack: -apple-system, BlinkMacSystemFont, 'Segoe UI', etc. */

:root {
  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     FAMILIAS DE FUENTES
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  
  /* Fuente principal para toda la interfaz */
  --font-family-base: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 
                      'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Helvetica Neue', 
                      sans-serif;
  
  /* Fuente para encabezados (puede ser diferente para mÃ¡s jerarquÃ­a) */
  --font-family-heading: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 
                         sans-serif;
  
  /* Fuente monoespaciada para cÃ³digo, nÃºmeros de lote, cÃ³digos */
  --font-family-mono: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', 
                      'Courier New', monospace;
  
  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ESCALA TIPOGRÃFICA (Escala Modular 1.250 - Major Third)
     Base: 16px (1rem)
     Ratio: 1.250 (perfecta armonÃ­a visual)
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  
  --font-size-xs: 0.64rem;      /* 10.24px - Etiquetas muy pequeÃ±as */
  --font-size-sm: 0.8rem;       /* 12.8px  - Textos auxiliares, captions */
  --font-size-base: 1rem;       /* 16px    - Texto base (cuerpo) */
  --font-size-md: 1.25rem;      /* 20px    - SubtÃ­tulos, leads */
  --font-size-lg: 1.563rem;     /* 25px    - TÃ­tulos de secciÃ³n */
  --font-size-xl: 1.953rem;     /* 31.25px - TÃ­tulos principales */
  --font-size-2xl: 2.441rem;    /* 39.06px - TÃ­tulos destacados */
  --font-size-3xl: 3.052rem;    /* 48.83px - Hero, splash screens */
  
  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PESOS DE FUENTE (Font Weights)
     Inter soporta: 300, 400, 500, 600, 700, 800, 900
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  
  --font-weight-light: 300;      /* Textos decorativos, leads */
  --font-weight-normal: 400;     /* Texto normal de cuerpo */
  --font-weight-medium: 500;     /* Ã‰nfasis sutil, labels */
  --font-weight-semibold: 600;   /* SubtÃ­tulos, botones */
  --font-weight-bold: 700;       /* TÃ­tulos importantes */
  --font-weight-extrabold: 800;  /* TÃ­tulos muy destacados */
  --font-weight-black: 900;      /* Uso especial, hero */
  
  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ALTURA DE LÃNEA (Line Height)
     Para Ã³ptima legibilidad
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  
  --line-height-none: 1;         /* Sin espacio (logos, iconos) */
  --line-height-tight: 1.25;     /* TÃ­tulos grandes */
  --line-height-snug: 1.375;     /* TÃ­tulos medianos */
  --line-height-normal: 1.5;     /* Texto de cuerpo (Ã“PTIMO) */
  --line-height-relaxed: 1.625;  /* Textos largos, pÃ¡rrafos */
  --line-height-loose: 2;        /* Textos muy espaciados */
  
  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ESPACIADO DE LETRAS (Letter Spacing / Tracking)
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  
  --letter-spacing-tighter: -0.05em;  /* TÃ­tulos muy grandes */
  --letter-spacing-tight: -0.02em;    /* TÃ­tulos grandes */
  --letter-spacing-normal: 0;         /* Texto normal */
  --letter-spacing-wide: 0.02em;      /* Texto expandido */
  --letter-spacing-wider: 0.04em;     /* Etiquetas, overlines */
  --letter-spacing-widest: 0.1em;     /* ALL CAPS, botones */
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ESTILOS GLOBALES DE TIPOGRAFÃA
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

* {
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-rendering: optimizeLegibility;
}

body {
  font-family: var(--font-family-base);
  font-size: var(--font-size-base);
  font-weight: var(--font-weight-normal);
  line-height: var(--line-height-normal);
  letter-spacing: var(--letter-spacing-normal);
  color: var(--text-primary);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   JERARQUÃA DE ENCABEZADOS (H1-H6)
   Seguir jerarquÃ­a semÃ¡ntica estricta
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

h1, .h1 {
  font-family: var(--font-family-heading);
  font-size: var(--font-size-3xl);
  font-weight: var(--font-weight-bold);
  line-height: var(--line-height-tight);
  letter-spacing: var(--letter-spacing-tight);
  color: var(--text-primary);
  margin: 0 0 1rem;
}

h2, .h2 {
  font-family: var(--font-family-heading);
  font-size: var(--font-size-2xl);
  font-weight: var(--font-weight-bold);
  line-height: var(--line-height-tight);
  letter-spacing: var(--letter-spacing-tight);
  color: var(--text-primary);
  margin: 0 0 0.875rem;
}

h3, .h3 {
  font-family: var(--font-family-heading);
  font-size: var(--font-size-xl);
  font-weight: var(--font-weight-semibold);
  line-height: var(--line-height-snug);
  letter-spacing: var(--letter-spacing-normal);
  color: var(--text-primary);
  margin: 0 0 0.75rem;
}

h4, .h4 {
  font-family: var(--font-family-heading);
  font-size: var(--font-size-lg);
  font-weight: var(--font-weight-semibold);
  line-height: var(--line-height-normal);
  letter-spacing: var(--letter-spacing-normal);
  color: var(--text-primary);
  margin: 0 0 0.625rem;
}

h5, .h5 {
  font-family: var(--font-family-heading);
  font-size: var(--font-size-md);
  font-weight: var(--font-weight-medium);
  line-height: var(--line-height-normal);
  letter-spacing: var(--letter-spacing-normal);
  color: var(--text-primary);
  margin: 0 0 0.5rem;
}

h6, .h6 {
  font-family: var(--font-family-heading);
  font-size: var(--font-size-base);
  font-weight: var(--font-weight-medium);
  line-height: var(--line-height-normal);
  letter-spacing: var(--letter-spacing-wide);
  text-transform: uppercase;
  color: var(--text-secondary);
  margin: 0 0 0.5rem;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CLASES UTILITARIAS DE TEXTO
   Para uso flexible en componentes
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* â”â”â” TAMAÃ‘OS â”â”â” */
.text-xs { font-size: var(--font-size-xs); }
.text-sm { font-size: var(--font-size-sm); }
.text-base { font-size: var(--font-size-base); }
.text-md { font-size: var(--font-size-md); }
.text-lg { font-size: var(--font-size-lg); }
.text-xl { font-size: var(--font-size-xl); }
.text-2xl { font-size: var(--font-size-2xl); }
.text-3xl { font-size: var(--font-size-3xl); }

/* â”â”â” PESOS â”â”â” */
.font-light { font-weight: var(--font-weight-light); }
.font-normal { font-weight: var(--font-weight-normal); }
.font-medium { font-weight: var(--font-weight-medium); }
.font-semibold { font-weight: var(--font-weight-semibold); }
.font-bold { font-weight: var(--font-weight-bold); }
.font-extrabold { font-weight: var(--font-weight-extrabold); }
.font-black { font-weight: var(--font-weight-black); }

/* â”â”â” COLORES DE TEXTO â”â”â” */
.text-primary { color: var(--text-primary); }
.text-secondary { color: var(--text-secondary); }
.text-tertiary { color: var(--text-tertiary); }
.text-disabled { color: var(--text-disabled); }
.text-inverse { color: var(--text-inverse); }
.text-link { color: var(--text-link); }

.text-success { color: var(--color-success-600); }
.text-warning { color: var(--color-warning-600); }
.text-danger { color: var(--color-danger-600); }
.text-info { color: var(--color-info-600); }

/* â”â”â” ALTURA DE LÃNEA â”â”â” */
.leading-none { line-height: var(--line-height-none); }
.leading-tight { line-height: var(--line-height-tight); }
.leading-snug { line-height: var(--line-height-snug); }
.leading-normal { line-height: var(--line-height-normal); }
.leading-relaxed { line-height: var(--line-height-relaxed); }
.leading-loose { line-height: var(--line-height-loose); }

/* â”â”â” ALINEACIÃ“N â”â”â” */
.text-left { text-align: left; }
.text-center { text-align: center; }
.text-right { text-align: right; }
.text-justify { text-align: justify; }

/* â”â”â” TRANSFORMACIÃ“N â”â”â” */
.uppercase { text-transform: uppercase; }
.lowercase { text-transform: lowercase; }
.capitalize { text-transform: capitalize; }
.normal-case { text-transform: none; }

/* â”â”â” DECORACIÃ“N â”â”â” */
.underline { text-decoration: underline; }
.line-through { text-decoration: line-through; }
.no-underline { text-decoration: none; }

/* â”â”â” TRUNCADO DE TEXTO â”â”â” */
.truncate {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.line-clamp-2 {
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.line-clamp-3 {
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   COMPONENTES DE TEXTO ESPECIALIZADOS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* â”â”â” LEAD: PÃ¡rrafo introductorio destacado â”â”â” */
.lead {
  font-size: var(--font-size-md);
  font-weight: var(--font-weight-light);
  line-height: var(--line-height-relaxed);
  color: var(--text-secondary);
  margin-bottom: 1.5rem;
}

/* â”â”â” CAPTION: Texto auxiliar pequeÃ±o â”â”â” */
.caption {
  font-size: var(--font-size-sm);
  line-height: var(--line-height-normal);
  color: var(--text-tertiary);
  margin: 0;
}

/* â”â”â” OVERLINE: Etiqueta superior â”â”â” */
.overline {
  font-size: var(--font-size-xs);
  font-weight: var(--font-weight-semibold);
  text-transform: uppercase;
  letter-spacing: var(--letter-spacing-wider);
  color: var(--text-tertiary);
  margin: 0 0 0.5rem;
}

/* â”â”â” LABEL: Etiquetas de formulario â”â”â” */
.label {
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-medium);
  line-height: var(--line-height-normal);
  color: var(--text-primary);
  margin-bottom: 0.5rem;
  display: block;
}

/* â”â”â” HELPER TEXT: Texto de ayuda en formularios â”â”â” */
.helper-text {
  font-size: var(--font-size-sm);
  line-height: var(--line-height-normal);
  color: var(--text-tertiary);
  margin-top: 0.25rem;
}

/* â”â”â” ERROR TEXT: Mensajes de error â”â”â” */
.error-text {
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-medium);
  color: var(--color-danger-600);
  margin-top: 0.25rem;
}

/* â”â”â” BADGE TEXT: Texto en badges/chips â”â”â” */
.badge-text {
  font-size: var(--font-size-xs);
  font-weight: var(--font-weight-semibold);
  text-transform: uppercase;
  letter-spacing: var(--letter-spacing-wide);
}

/* â”â”â” CODE: Texto monoespaciado â”â”â” */
code, .code {
  font-family: var(--font-family-mono);
  font-size: 0.875em;
  padding: 0.125rem 0.25rem;
  background-color: var(--bg-tertiary);
  border-radius: 4px;
  color: var(--color-danger-600);
}

pre {
  font-family: var(--font-family-mono);
  font-size: var(--font-size-sm);
  line-height: var(--line-height-relaxed);
  padding: 1rem;
  background-color: var(--bg-tertiary);
  border-radius: 8px;
  overflow-x: auto;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESPONSIVE TYPOGRAPHY
   Ajustar tamaÃ±os para dispositivos mÃ³viles
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

@media (max-width: 768px) {
  :root {
    /* Reducir ligeramente la escala en mÃ³viles */
    --font-size-3xl: 2.441rem;  /* Era 3.052rem */
    --font-size-2xl: 1.953rem;  /* Era 2.441rem */
    --font-size-xl: 1.563rem;   /* Era 1.953rem */
  }
  
  h1, .h1 { font-size: 2rem; }
  h2, .h2 { font-size: 1.5rem; }
  h3, .h3 { font-size: 1.25rem; }
}

MEJORES PRÃCTICAS TIPOGRÃFICAS:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ“ USAR jerarquÃ­a semÃ¡ntica (h1 > h2 > h3)
âœ“ MANTENER mÃ¡ximo 2-3 tamaÃ±os de fuente por vista
âœ“ EVITAR texto menor a 14px (excepto metadata)
âœ“ USAR line-height 1.5 para cuerpo de texto
âœ“ APLICAR letter-spacing negativo en tÃ­tulos grandes
âœ“ LIMITAR longitud de lÃ­nea a 60-80 caracteres
âœ“ CONTRASTAR pesos de fuente para jerarquÃ­a
âœ“ PROBAR legibilidad en dispositivos reales

âŒ NO usar mÃ¡s de 3 familias de fuentes
âŒ NO usar text-transform sin aumentar letter-spacing
âŒ NO usar justificaciÃ³n en textos cortos
âŒ NO aplicar font-weight < 400 en textos pequeÃ±os

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 1.1.4 Sistema de IconografÃ­a Coherente
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

OBJETIVO: Crear un sistema de iconos consistente, semÃ¡ntico y optimizado que
mejore la comprensiÃ³n visual y la identidad de la aplicaciÃ³n.

LIBRERÃA BASE: Ionicons (nativa de Ionic, optimizada)
ESTILO: Outline para iOS, Sharp para Android (adaptativo)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

PASO 1: Crear Servicio de Iconos

UBICACIÃ“N: src/app/shared/services/icon.service.ts

import { Injectable } from '@angular/core';
import { addIcons } from 'ionicons';
import {
  // â”â”â” NAVEGACIÃ“N PRINCIPAL â”â”â”
  homeOutline, homeSharp,
  cartOutline, cartSharp,
  cubeOutline, cubeSharp,
  statsChartOutline, statsChartSharp,
  personOutline, personSharp,
  
  // â”â”â” ACCIONES CRUD â”â”â”
  addOutline, addCircleOutline, addSharp,
  removeOutline, removeCircleOutline, removeSharp,
  trashOutline, trashSharp,
  createOutline, createSharp,
  saveOutline, saveSharp,
  closeOutline, closeCircleOutline, closeSharp,
  checkmarkOutline, checkmarkCircleOutline, checkmarkSharp,
  
  // â”â”â” UI Y NAVEGACIÃ“N â”â”â”
  searchOutline, searchSharp,
  filterOutline, filterSharp,
  refreshOutline, refreshSharp,
  downloadOutline, downloadSharp,
  printOutline, printSharp,
  shareOutline, shareSharp,
  arrowBackOutline, arrowForwardOutline,
  chevronBackOutline, chevronForwardOutline,
  chevronDownOutline, chevronUpOutline,
  
  // â”â”â” ESTADOS Y ALERTAS â”â”â”
  alertCircleOutline, alertCircleSharp,
  warningOutline, warningSharp,
  informationCircleOutline, informationCircleSharp,
  checkmarkCircleSharp,
  closeCircleSharp,
  
  // â”â”â” FARMACIA ESPECÃFICO â”â”â”
  medkitOutline, medkitSharp,           // Medicamentos
  pulseOutline, pulseSharp,             // Salud, urgencia
  calendarOutline, calendarSharp,       // Fechas, caducidad
  timeOutline, timeSharp,               // Horarios
  receiptOutline, receiptSharp,         // Ventas, facturas
  cardOutline, cardSharp,               // Pago con tarjeta
  cashOutline, cashSharp,               // Pago en efectivo
  peopleOutline, peopleSharp,           // Clientes
  businessOutline, businessSharp,       // Proveedores
  barcodeOutline, barcodeSharp,         // CÃ³digo de barras
  
  // â”â”â” MENÃš Y CONFIGURACIÃ“N â”â”â”
  menuOutline, menuSharp,
  ellipsisHorizontalOutline, ellipsisVerticalOutline,
  settingsOutline, settingsSharp,
  logOutOutline, logOutSharp,
  eyeOutline, eyeOffOutline,
  notificationsOutline, notificationsSharp,
  
  // â”â”â” OTROS â”â”â”
  documentTextOutline, documentTextSharp,
  clipboardOutline, clipboardSharp,
  listOutline, listSharp,
  gridOutline, gridSharp,
  layersOutline, layersSharp
} from 'ionicons/icons';

/**
 * Servicio centralizado para gestiÃ³n de iconos
 * 
 * RESPONSABILIDADES:
 * - Registrar todos los iconos necesarios al inicio
 * - Proveer mÃ©todo para obtener icono segÃºn plataforma
 * - Mantener consistencia en el uso de iconos
 * 
 * @example
 * ```typescript
 * constructor(private iconService: IconService) {}
 * 
 * getHomeIcon() {
 *   return this.iconService.getIcon('home');
 * }
 * ```
 */
@Injectable({
  providedIn: 'root'
})
export class IconService {
  
  constructor() {
    this.registerAllIcons();
  }
  
  /**
   * Registra todos los iconos en la aplicaciÃ³n
   * LLAMAR UNA SOLA VEZ al inicio (app.component)
   */
  private registerAllIcons(): void {
    addIcons({
      // NavegaciÃ³n principal
      'home-outline': homeOutline,
      'home-sharp': homeSharp,
      'cart-outline': cartOutline,
      'cart-sharp': cartSharp,
      'cube-outline': cubeOutline,
      'cube-sharp': cubeSharp,
      'stats-chart-outline': statsChartOutline,
      'stats-chart-sharp': statsChartSharp,
      'person-outline': personOutline,
      'person-sharp': personSharp,
      
      // Acciones CRUD
      'add-outline': addOutline,
      'add-circle-outline': addCircleOutline,
      'add-sharp': addSharp,
      'remove-outline': removeOutline,
      'remove-circle-outline': removeCircleOutline,
      'remove-sharp': removeSharp,
      'trash-outline': trashOutline,
      'trash-sharp': trashSharp,
      'create-outline': createOutline,
      'create-sharp': createSharp,
      'save-outline': saveOutline,
      'save-sharp': saveSharp,
      'close-outline': closeOutline,
      'close-circle-outline': closeCircleOutline,
      'close-sharp': closeSharp,
      'checkmark-outline': checkmarkOutline,
      'checkmark-circle-outline': checkmarkCircleOutline,
      'checkmark-sharp': checkmarkSharp,
      
      // UI y navegaciÃ³n
      'search-outline': searchOutline,
      'search-sharp': searchSharp,
      'filter-outline': filterOutline,
      'filter-sharp': filterSharp,
      'refresh-outline': refreshOutline,
      'refresh-sharp': refreshSharp,
      'download-outline': downloadOutline,
      'download-sharp': downloadSharp,
      'print-outline': printOutline,
      'print-sharp': printSharp,
      'share-outline': shareOutline,
      'share-sharp': shareSharp,
      'arrow-back-outline': arrowBackOutline,
      'arrow-forward-outline': arrowForwardOutline,
      'chevron-back-outline': chevronBackOutline,
      'chevron-forward-outline': chevronForwardOutline,
      'chevron-down-outline': chevronDownOutline,
      'chevron-up-outline': chevronUpOutline,
      
      // Estados y alertas
      'alert-circle-outline': alertCircleOutline,
      'alert-circle-sharp': alertCircleSharp,
      'warning-outline': warningOutline,
      'warning-sharp': warningSharp,
      'information-circle-outline': informationCircleOutline,
      'information-circle-sharp': informationCircleSharp,
      'checkmark-circle-sharp': checkmarkCircleSharp,
      'close-circle-sharp': closeCircleSharp,
      
      // Farmacia especÃ­fico
      'medkit-outline': medkitOutline,
      'medkit-sharp': medkitSharp,
      'pulse-outline': pulseOutline,
      'pulse-sharp': pulseSharp,
      'calendar-outline': calendarOutline,
      'calendar-sharp': calendarSharp,
      'time-outline': timeOutline,
      'time-sharp': timeSharp,
      'receipt-outline': receiptOutline,
      'receipt-sharp': receiptSharp,
      'card-outline': cardOutline,
      'card-sharp': cardSharp,
      'cash-outline': cashOutline,
      'cash-sharp': cashSharp,
      'people-outline': peopleOutline,
      'people-sharp': peopleSharp,
      'business-outline': businessOutline,
      'business-sharp': businessSharp,
      'barcode-outline': barcodeOutline,
      'barcode-sharp': barcodeSharp,
      
      // MenÃº y configuraciÃ³n
      'menu-outline': menuOutline,
      'menu-sharp': menuSharp,
      'ellipsis-horizontal-outline': ellipsisHorizontalOutline,
      'ellipsis-vertical-outline': ellipsisVerticalOutline,
      'settings-outline': settingsOutline,
      'settings-sharp': settingsSharp,
      'log-out-outline': logOutOutline,
      'log-out-sharp': logOutSharp,
      'eye-outline': eyeOutline,
      'eye-off-outline': eyeOffOutline,
      'notifications-outline': notificationsOutline,
      'notifications-sharp': notificationsSharp,
      
      // Otros
      'document-text-outline': documentTextOutline,
      'document-text-sharp': documentTextSharp,
      'clipboard-outline': clipboardOutline,
      'clipboard-sharp': clipboardSharp,
      'list-outline': listOutline,
      'list-sharp': listSharp,
      'grid-outline': gridOutline,
      'grid-sharp': gridSharp,
      'layers-outline': layersOutline,
      'layers-sharp': layersSharp
    });
  }
  
  /**
   * Obtiene el nombre completo del icono segÃºn la plataforma
   * iOS: outline | Android: sharp
   * 
   * @param baseName - Nombre base del icono (sin sufijo)
   * @returns Nombre completo con sufijo de plataforma
   * 
   * @example
   * ```typescript
   * this.iconService.getIcon('home') // => 'home-outline' en iOS
   * ```
   */
  getIcon(baseName: string): string {
    const platform = this.getPlatform();
    const suffix = platform === 'ios' ? 'outline' : 'sharp';
    return `${baseName}-${suffix}`;
  }
  
  /**
   * Detecta la plataforma actual
   * @private
   */
  private getPlatform(): 'ios' | 'android' | 'web' {
    const userAgent = window.navigator.userAgent.toLowerCase();
    
    if (/iphone|ipad|ipod/.test(userAgent)) {
      return 'ios';
    } else if (/android/.test(userAgent)) {
      return 'android';
    }
    
    // Por defecto, usar estilo iOS (outline) para web
    return 'ios';
  }
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

PASO 2: Crear Mapeo SemÃ¡ntico de Iconos

UBICACIÃ“N: src/app/shared/constants/icon-mapping.ts

/**
 * Mapeo semÃ¡ntico de iconos por contexto
 * 
 * USO:
 * - Usar SIEMPRE estos nombres en lugar de strings hardcodeados
 * - Permite cambiar iconos globalmente desde un solo lugar
 * - Mejora la semÃ¡ntica y legibilidad del cÃ³digo
 * 
 * @example
 * ```html
 * <ion-icon [name]="ICON_MAP.NAV_HOME"></ion-icon>
 * <ion-icon [name]="ICON_MAP.ACTION_CREATE"></ion-icon>
 * ```
 */
export const ICON_MAP = {
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // NAVEGACIÃ“N PRINCIPAL
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  NAV_HOME: 'home',
  NAV_POS: 'cart',
  NAV_INVENTORY: 'cube',
  NAV_REPORTS: 'stats-chart',
  NAV_PROFILE: 'person',
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ACCIONES CRUD (Create, Read, Update, Delete)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ACTION_CREATE: 'add-circle',
  ACTION_ADD: 'add',
  ACTION_EDIT: 'create',
  ACTION_DELETE: 'trash',
  ACTION_SAVE: 'save',
  ACTION_CANCEL: 'close-circle',
  ACTION_CLOSE: 'close',
  ACTION_CONFIRM: 'checkmark-circle',
  ACTION_CHECK: 'checkmark',
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ACCIONES DE UI
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ACTION_SEARCH: 'search',
  ACTION_FILTER: 'filter',
  ACTION_REFRESH: 'refresh',
  ACTION_DOWNLOAD: 'download',
  ACTION_PRINT: 'print',
  ACTION_SHARE: 'share',
  ACTION_MORE: 'ellipsis-vertical',
  ACTION_MENU: 'menu',
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // NAVEGACIÃ“N DIRECCIONAL
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  NAV_BACK: 'arrow-back',
  NAV_FORWARD: 'arrow-forward',
  NAV_DOWN: 'chevron-down',
  NAV_UP: 'chevron-up',
  NAV_LEFT: 'chevron-back',
  NAV_RIGHT: 'chevron-forward',
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ESTADOS Y ALERTAS
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  STATUS_SUCCESS: 'checkmark-circle',
  STATUS_ERROR: 'close-circle',
  STATUS_WARNING: 'warning',
  STATUS_INFO: 'information-circle',
  STATUS_ALERT: 'alert-circle',
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // CONTEXTO FARMACÃ‰UTICO
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  PRODUCT_MEDICINE: 'medkit',
  PRODUCT_GENERIC: 'pulse',
  PRODUCT_SCAN: 'barcode',
  CLIENT: 'person',
  CLIENTS: 'people',
  SUPPLIER: 'business',
  SALE: 'receipt',
  PAYMENT_CARD: 'card',
  PAYMENT_CASH: 'cash',
  CALENDAR: 'calendar',
  TIME: 'time',
  EXPIRY: 'calendar',
  STOCK: 'cube',
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // VISTAS Y VISUALIZACIÃ“N
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  VIEW_LIST: 'list',
  VIEW_GRID: 'grid',
  VIEW_LAYERS: 'layers',
  VIEW_DOCUMENT: 'document-text',
  VIEW_CLIPBOARD: 'clipboard',
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // AUTENTICACIÃ“N Y SEGURIDAD
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  AUTH_LOGIN: 'log-in',
  AUTH_LOGOUT: 'log-out',
  AUTH_PASSWORD_SHOW: 'eye',
  AUTH_PASSWORD_HIDE: 'eye-off',
  AUTH_LOCK: 'lock-closed',
  AUTH_UNLOCK: 'lock-open',
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // CONFIGURACIÃ“N Y SISTEMA
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  SETTINGS: 'settings',
  NOTIFICATIONS: 'notifications',
  HELP: 'help-circle',
  INFO: 'information-circle'
} as const;

/**
 * Tipo TypeScript para autocompletado
 */
export type IconName = typeof ICON_MAP[keyof typeof ICON_MAP];

/**
 * TamaÃ±os estÃ¡ndar de iconos
 */
export const ICON_SIZES = {
  SMALL: 'small',      // 18px
  MEDIUM: 'medium',    // 24px (default)
  LARGE: 'large'       // 32px
} as const;

/**
 * Colores de iconos segÃºn contexto
 */
export const ICON_COLORS = {
  PRIMARY: 'primary',
  SECONDARY: 'secondary',
  SUCCESS: 'success',
  WARNING: 'warning',
  DANGER: 'danger',
  MEDIUM: 'medium',
  LIGHT: 'light',
  DARK: 'dark'
} as const;

REGLAS DE USO DE ICONOS:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ“ USAR SIEMPRE ICON_MAP en lugar de strings
âœ“ MANTENER tamaÃ±o consistente por contexto
âœ“ ASEGURAR contraste suficiente con fondo
âœ“ INCLUIR aria-label descriptivo
âœ“ USAR outline en iOS, sharp en Android
âœ“ ALINEAR verticalmente con texto adyacente
âœ“ MANTENER Ã¡rea tÃ¡ctil mÃ­nima de 44x44px

âŒ NO usar iconos sin significado claro
âŒ NO mezclar estilos (outline y sharp) arbitrariamente
âŒ NO usar iconos como decoraciÃ³n Ãºnicamente
âŒ NO depender solo de color para transmitir significado
âŒ NO usar iconos muy similares para acciones diferentes

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  1.2 COMPONENTES REUTILIZABLES BASE (DESIGN SYSTEM COMPONENTS)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

OBJETIVO: Crear una biblioteca de componentes standalone, consistentes y 
reutilizables que aceleren el desarrollo y garanticen coherencia visual.

PRINCIPIOS:
â€¢ Componentes STANDALONE (Angular 18+)
â€¢ TOTALMENTE TESTEABLES
â€¢ DOCUMENTADOS con JSDoc
â€¢ ACCESIBLES (WCAG AAA)
â€¢ RESPONSIVE por defecto

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 1.2.1 Button Component (BotÃ³n Reutilizable)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/app/shared/components/button/button.component.ts

import { Component, Input, Output, EventEmitter } from '@angular/core';
import { CommonModule } from '@angular/common';
import { IonButton, IonSpinner, IonIcon } from '@ionic/angular/standalone';

export type ButtonVariant = 'primary' | 'secondary' | 'success' | 'danger' | 
                            'warning' | 'ghost' | 'link';
export type ButtonSize = 'small' | 'medium' | 'large';

/**
 * Componente de botÃ³n reutilizable con mÃºltiples variantes y estados
 * 
 * CARACTERÃSTICAS:
 * - 7 variantes visuales
 * - 3 tamaÃ±os
 * - Estado de carga integrado
 * - Iconos opcionales (start/end)
 * - Totalmente accesible
 * - Deshabilitado automÃ¡tico durante carga
 * 
 * @example
 * ```html
 * <app-button 
 *   variant="primary" 
 *   size="medium"
 *   [loading]="isSubmitting"
 *   [disabled]="!isValid"
 *   iconStart="add-circle-outline"
 *   ariaLabel="Agregar nuevo producto"
 *   (clicked)="handleAddProduct()">
 *   Agregar Producto
 * </app-button>
 * ```
 */
@Component({
  selector: 'app-button',
  standalone: true,
  imports: [CommonModule, IonButton, IonSpinner, IonIcon],
  template: `
    <ion-button
      [color]="getColor()"
      [fill]="getFill()"
      [size]="size"
      [expand]="expand"
      [disabled]="disabled || loading"
      [attr.aria-label]="ariaLabel || null"
      [attr.aria-busy]="loading"
      [attr.aria-disabled]="disabled || loading"
      (click)="handleClick($event)"
      class="app-button app-button--{{variant}} app-button--{{size}}"
      [class.app-button--loading]="loading">
      
      <!-- Spinner de carga -->
      <ion-spinner 
        *ngIf="loading" 
        name="crescent" 
        slot="start"
        class="app-button__spinner">
      </ion-spinner>
      
      <!-- Icono inicial -->
      <ion-icon 
        *ngIf="iconStart && !loading" 
        [name]="iconStart" 
        slot="start"
        class="app-button__icon app-button__icon--start"
        [attr.aria-hidden]="true">
      </ion-icon>
      
      <!-- Contenido del botÃ³n -->
      <span class="app-button__content">
        <ng-content></ng-content>
      </span>
      
      <!-- Icono final -->
      <ion-icon 
        *ngIf="iconEnd && !loading" 
        [name]="iconEnd" 
        slot="end"
        class="app-button__icon app-button__icon--end"
        [attr.aria-hidden]="true">
      </ion-icon>
    </ion-button>
  `,
  styleUrls: ['./button.component.scss']
})
export class ButtonComponent {
  /** Variante visual del botÃ³n */
  @Input() variant: ButtonVariant = 'primary';
  
  /** TamaÃ±o del botÃ³n */
  @Input() size: ButtonSize = 'medium';
  
  /** Expande el botÃ³n al ancho completo */
  @Input() expand?: 'block' | 'full';
  
  /** Deshabilita el botÃ³n */
  @Input() disabled = false;
  
  /** Muestra spinner y deshabilita el botÃ³n */
  @Input() loading = false;
  
  /** Icono al inicio del botÃ³n */
  @Input() iconStart?: string;
  
  /** Icono al final del botÃ³n */
  @Input() iconEnd?: string;
  
  /** Etiqueta ARIA para accesibilidad */
  @Input() ariaLabel?: string;
  
  /** Evento emitido al hacer click */
  @Output() clicked = new EventEmitter<Event>();
  
  /**
   * Mapea variante a color de Ionic
   */
  getColor(): string {
    const colorMap: Record<ButtonVariant, string> = {
      primary: 'primary',
      secondary: 'secondary',
      success: 'success',
      danger: 'danger',
      warning: 'warning',
      ghost: 'medium',
      link: 'primary'
    };
    return colorMap[this.variant];
  }
  
  /**
   * Mapea variante a fill de Ionic
   */
  getFill(): 'solid' | 'outline' | 'clear' {
    if (this.variant === 'ghost') return 'clear';
    if (this.variant === 'link') return 'clear';
    return 'solid';
  }
  
  /**
   * Maneja el evento click
   * Solo emite si no estÃ¡ deshabilitado ni cargando
   */
  handleClick(event: Event): void {
    if (!this.disabled && !this.loading) {
      this.clicked.emit(event);
    }
  }
}

ESTILOS (button.component.scss):
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

@import '../../../theme/design-tokens';

.app-button {
  --border-radius: var(--border-radius-md);
  --padding-start: var(--spacing-md);
  --padding-end: var(--spacing-md);
  --transition: all var(--transition-base);
  font-weight: var(--font-weight-semibold);
  
  /* â”â”â” TAMAÃ‘OS â”â”â” */
  &--small {
    --padding-start: var(--spacing-sm);
    --padding-end: var(--spacing-sm);
    --padding-top: var(--spacing-xs);
    --padding-bottom: var(--spacing-xs);
    font-size: var(--font-size-sm);
    min-height: 32px;
  }
  
  &--medium {
    --padding-start: var(--spacing-md);
    --padding-end: var(--spacing-md);
    --padding-top: var(--spacing-sm);
    --padding-bottom: var(--spacing-sm);
    font-size: var(--font-size-base);
    min-height: 44px; /* Ãrea tÃ¡ctil mÃ­nima */
  }
  
  &--large {
    --padding-start: var(--spacing-lg);
    --padding-end: var(--spacing-lg);
    --padding-top: var(--spacing-md);
    --padding-bottom: var(--spacing-md);
    font-size: var(--font-size-md);
    min-height: 56px;
  }
  
  /* â”â”â” ANIMACIONES â”â”â” */
  &:not([disabled]):active {
    transform: scale(0.98);
    transition: transform 100ms ease-out;
  }
  
  /* â”â”â” ESTADOS DE FOCO (ACCESIBILIDAD) â”â”â” */
  &:focus-visible {
    outline: 3px solid var(--color-primary-300);
    outline-offset: 2px;
    box-shadow: var(--shadow-outline);
  }
  
  /* â”â”â” ESTADO DE CARGA â”â”â” */
  &--loading {
    pointer-events: none;
    opacity: 0.7;
  }
  
  /* â”â”â” ELEMENTOS INTERNOS â”â”â” */
  &__spinner {
    width: 18px;
    height: 18px;
  }
  
  &__icon {
    font-size: 1.2em;
    
    &--start {
      margin-inline-end: var(--spacing-xs);
    }
    
    &--end {
      margin-inline-start: var(--spacing-xs);
    }
  }
  
  &__content {
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-xs);
  }
}

/* â”â”â” VARIANTES ESPECIALES â”â”â” */
.app-button--link {
  text-decoration: underline;
  --padding-start: var(--spacing-xs);
  --padding-end: var(--spacing-xs);
  
  &:hover {
    text-decoration: none;
  }
}

.app-button--ghost {
  &:hover {
    background-color: var(--bg-hover);
  }
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 1.2.2 Card Component (Tarjeta Reutilizable)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/app/shared/components/card/card.component.ts

import { Component, Input, Output, EventEmitter } from '@angular/core';
import { CommonModule } from '@angular/common';
import { IonCard, IonCardHeader, IonCardTitle, IonCardSubtitle, 
         IonCardContent } from '@ionic/angular/standalone';

export type CardVariant = 'elevated' | 'outlined' | 'flat';

/**
 * Componente de tarjeta flexible y reutilizable
 * 
 * CARACTERÃSTICAS:
 * - 3 variantes de estilo
 * - Slots para header, content, footer
 * - Clickable opcional
 * - Animaciones suaves
 * - Responsive
 * 
 * @example
 * ```html
 * <app-card 
 *   variant="elevated"
 *   [clickable]="true"
 *   [loading]="isLoading"
 *   (cardClick)="handleClick()">
 *   
 *   <div slot="header">
 *     <h3>TÃ­tulo del Producto</h3>
 *     <p class="text-secondary">CategorÃ­a: AnalgÃ©sicos</p>
 *   </div>
 *   
 *   <div slot="content">
 *     <p>Precio: $125.00</p>
 *     <p>Stock: 45 unidades</p>
 *   </div>
 *   
 *   <div slot="footer">
 *     <app-button size="small" variant="ghost">Ver Detalles</app-button>
 *     <app-button size="small">Agregar al Carrito</app-button>
 *   </div>
 * </app-card>
 * ```
 */
@Component({
  selector: 'app-card',
  standalone: true,
  imports: [CommonModule, IonCard, IonCardHeader, IonCardTitle, 
            IonCardSubtitle, IonCardContent],
  template: `
    <ion-card 
      [button]="clickable"
      [disabled]="disabled"
      [class.app-card--elevated]="variant === 'elevated'"
      [class.app-card--outlined]="variant === 'outlined'"
      [class.app-card--flat]="variant === 'flat'"
      [class.app-card--clickable]="clickable"
      [class.app-card--loading]="loading"
      [attr.role]="clickable ? 'button' : null"
      [attr.tabindex]="clickable && !disabled ? '0' : null"
      (click)="handleClick()"
      (keydown.enter)="handleClick()"
      (keydown.space)="handleClick()">
      
      <!-- Header -->
      <ion-card-header *ngIf="hasHeader" class="app-card__header">
        <ng-content select="[slot=header]"></ng-content>
      </ion-card-header>
      
      <!-- Content -->
      <ion-card-content class="app-card__content">
        <!-- Skeleton loader -->
        <div *ngIf="loading" class="app-card__skeleton">
          <ion-skeleton-text animated style="width: 80%"></ion-skeleton-text>
          <ion-skeleton-text animated style="width: 60%"></ion-skeleton-text>
          <ion-skeleton-text animated style="width: 40%"></ion-skeleton-text>
        </div>
        
        <!-- Contenido real -->
        <div *ngIf="!loading" class="app-card__body">
          <ng-content select="[slot=content]"></ng-content>
          <ng-content></ng-content>
        </div>
      </ion-card-content>
      
      <!-- Footer -->
      <div *ngIf="hasFooter && !loading" class="app-card__footer">
        <ng-content select="[slot=footer]"></ng-content>
      </div>
    </ion-card>
  `,
  styleUrls: ['./card.component.scss']
})
export class CardComponent {
  /** Variante visual de la tarjeta */
  @Input() variant: CardVariant = 'elevated';
  
  /** Hace la tarjeta clickeable */
  @Input() clickable = false;
  
  /** Deshabilita la tarjeta */
  @Input() disabled = false;
  
  /** Muestra skeleton loader */
  @Input() loading = false;
  
  /** Muestra el header */
  @Input() hasHeader = true;
  
  /** Muestra el footer */
  @Input() hasFooter = false;
  
  /** Evento emitido al hacer click */
  @Output() cardClick = new EventEmitter<void>();
  
  /**
   * Maneja el evento click/keyboard
   */
  handleClick(): void {
    if (this.clickable && !this.disabled && !this.loading) {
      this.cardClick.emit();
    }
  }
}

ESTILOS (card.component.scss):
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

@import '../../../theme/design-tokens';

.app-card {
  margin: var(--spacing-md);
  border-radius: var(--border-radius-lg);
  transition: var(--transition-base);
  overflow: hidden;
  
  /* â”â”â” VARIANTES â”â”â” */
  &--elevated {
    box-shadow: var(--shadow-md);
    border: none;
    
    &:hover:not(.app-card--loading) {
      box-shadow: var(--shadow-lg);
    }
  }
  
  &--outlined {
    border: 2px solid var(--border-light);
    box-shadow: none;
    
    &:hover:not(.app-card--loading) {
      border-color: var(--border-medium);
    }
  }
  
  &--flat {
    box-shadow: none;
    border: none;
    background-color: var(--bg-secondary);
  }
  
  /* â”â”â” CLICKEABLE â”â”â” */
  &--clickable {
    cursor: pointer;
    user-select: none;
    
    &:hover:not(.app-card--loading) {
      transform: translateY(-4px);
    }
    
    &:active:not(.app-card--loading) {
      transform: translateY(-2px);
      transition: transform 100ms ease-out;
    }
    
    &:focus-visible {
      outline: 3px solid var(--color-primary-300);
      outline-offset: 2px;
    }
  }
  
  /* â”â”â” LOADING STATE â”â”â” */
  &--loading {
    pointer-events: none;
    opacity: 0.7;
  }
  
  /* â”â”â” SECCIONES â”â”â” */
  &__header {
    padding: var(--spacing-md);
    border-bottom: 1px solid var(--border-light);
  }
  
  &__content {
    padding: var(--spacing-md);
  }
  
  &__footer {
    padding: var(--spacing-md);
    border-top: 1px solid var(--border-light);
    display: flex;
    justify-content: flex-end;
    align-items: center;
    gap: var(--spacing-sm);
    background-color: var(--bg-secondary);
  }
  
  &__skeleton {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-sm);
  }
  
  &__body {
    animation: fadeIn 300ms ease-in;
  }
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(8px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 1.2.3 Empty State Component (Estado VacÃ­o)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/app/shared/components/empty-state/empty-state.component.ts

import { Component, Input, Output, EventEmitter } from '@angular/core';
import { CommonModule } from '@angular/common';
import { IonIcon } from '@ionic/angular/standalone';
import { ButtonComponent } from '../button/button.component';

/**
 * Componente para estados vacÃ­os (no data)
 * 
 * CUÃNDO USAR:
 * - Lista de productos vacÃ­a
 * - Sin resultados de bÃºsqueda
 * - Sin ventas registradas
 * - Carrito vacÃ­o
 * - Sin notificaciones
 * 
 * @example
 * ```html
 * <app-empty-state
 *   icon="cube-outline"
 *   title="No hay productos"
 *   description="AÃºn no has agregado productos a tu inventario. 
 *                Comienza agregando tu primer producto."
 *   actionLabel="Agregar Primer Producto"
 *   actionIcon="add-circle-outline"
 *   (actionClick)="navigateToAddProduct()">
 * </app-empty-state>
 * ```
 */
@Component({
  selector: 'app-empty-state',
  standalone: true,
  imports: [CommonModule, IonIcon, ButtonComponent],
  template: `
    <div class="empty-state" role="status" [attr.aria-label]="title">
      <!-- Icono ilustrativo -->
      <div class="empty-state__icon">
        <ion-icon 
          [name]="icon" 
          [attr.aria-hidden]="true">
        </ion-icon>
      </div>
      
      <!-- TÃ­tulo -->
      <h3 class="empty-state__title">{{ title }}</h3>
      
      <!-- DescripciÃ³n -->
      <p class="empty-state__description" *ngIf="description">
        {{ description }}
      </p>
      
      <!-- AcciÃ³n principal -->
      <app-button 
        *ngIf="actionLabel"
        [variant]="actionVariant"
        [iconStart]="actionIcon"
        [attr.aria-label]="actionLabel"
        (clicked)="actionClick.emit()">
        {{ actionLabel }}
      </app-button>
      
      <!-- AcciÃ³n secundaria -->
      <app-button 
        *ngIf="secondaryActionLabel"
        variant="ghost"
        [iconStart]="secondaryActionIcon"
        (clicked)="secondaryActionClick.emit()">
        {{ secondaryActionLabel }}
      </app-button>
    </div>
  `,
  styleUrls: ['./empty-state.component.scss']
})
export class EmptyStateComponent {
  /** Icono a mostrar */
  @Input() icon = 'information-circle-outline';
  
  /** TÃ­tulo del estado vacÃ­o */
  @Input() title = 'No hay datos disponibles';
  
  /** DescripciÃ³n opcional */
  @Input() description?: string;
  
  /** Etiqueta del botÃ³n de acciÃ³n principal */
  @Input() actionLabel?: string;
  
  /** Icono del botÃ³n de acciÃ³n */
  @Input() actionIcon?: string;
  
  /** Variante del botÃ³n de acciÃ³n */
  @Input() actionVariant: 'primary' | 'secondary' = 'primary';
  
  /** Etiqueta del botÃ³n secundario */
  @Input() secondaryActionLabel?: string;
  
  /** Icono del botÃ³n secundario */
  @Input() secondaryActionIcon?: string;
  
  /** Evento de acciÃ³n principal */
  @Output() actionClick = new EventEmitter<void>();
  
  /** Evento de acciÃ³n secundaria */
  @Output() secondaryActionClick = new EventEmitter<void>();
}

ESTILOS (empty-state.component.scss):
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

@import '../../../theme/design-tokens';

.empty-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  padding: var(--spacing-xxxl) var(--spacing-lg);
  min-height: 320px;
  animation: fadeInScale 400ms ease-out;
  
  &__icon {
    margin-bottom: var(--spacing-xl);
    color: var(--text-tertiary);
    opacity: 0.6;
    
    ion-icon {
      font-size: 96px;
      animation: float 3s ease-in-out infinite;
    }
  }
  
  &__title {
    font-size: var(--font-size-xl);
    font-weight: var(--font-weight-semibold);
    color: var(--text-primary);
    margin-bottom: var(--spacing-sm);
    max-width: 400px;
  }
  
  &__description {
    font-size: var(--font-size-base);
    line-height: var(--line-height-relaxed);
    color: var(--text-secondary);
    max-width: 480px;
    margin-bottom: var(--spacing-xl);
  }
  
  app-button {
    margin-top: var(--spacing-sm);
  }
}

@keyframes fadeInScale {
  from {
    opacity: 0;
    transform: scale(0.95) translateY(16px);
  }
  to {
    opacity: 1;
    transform: scale(1) translateY(0);
  }
}

@keyframes float {
  0%, 100% {
    transform: translateY(0px);
  }
  50% {
    transform: translateY(-10px);
  }
}

/* Responsive */
@media (max-width: 768px) {
  .empty-state {
    padding: var(--spacing-xl) var(--spacing-md);
    min-height: 280px;
    
    &__icon ion-icon {
      font-size: 72px;
    }
    
    &__title {
      font-size: var(--font-size-lg);
    }
  }
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 1.2.4 Skeleton Loader Component (Carga Placeholder)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/app/shared/components/skeleton/skeleton.component.ts

import { Component, Input } from '@angular/core';
import { CommonModule } from '@angular/common';
import { IonSkeletonText } from '@ionic/angular/standalone';

export type SkeletonType = 'text' | 'avatar' | 'card' | 'list' | 'thumbnail' | 'custom';

/**
 * Componente de skeleton loader para estados de carga
 * 
 * BENEFICIOS:
 * - Mejora la percepciÃ³n de rendimiento
 * - Reduce la ansiedad del usuario
 * - Indica contenido en carga
 * - Mantiene el layout estable
 * 
 * @example
 * ```html
 * <!-- Skeleton de lista de productos -->
 * <app-skeleton 
 *   type="card" 
 *   [count]="3">
 * </app-skeleton>
 * 
 * <!-- Skeleton personalizado -->
 * <app-skeleton type="custom">
 *   <ion-skeleton-text animated style="width: 60%; height: 20px;"></ion-skeleton-text>
 *   <ion-skeleton-text animated style="width: 80%; height: 16px;"></ion-skeleton-text>
 * </app-skeleton>
 * ```
 */
@Component({
  selector: 'app-skeleton',
  standalone: true,
  imports: [CommonModule, IonSkeletonText],
  template: `
    <div class="skeleton-wrapper" [attr.aria-busy]="true" [attr.aria-live]="'polite'">
      <ng-container [ngSwitch]="type">
        
        <!-- TEXT: LÃ­neas de texto -->
        <div *ngSwitchCase="'text'" class="skeleton-text">
          <ion-skeleton-text 
            *ngFor="let i of getArray(count)" 
            [animated]="animated"
            [style.width.%]="getRandomWidth()">
          </ion-skeleton-text>
        </div>
        
        <!-- AVATAR: CÃ­rculo de avatar -->
        <div *ngSwitchCase="'avatar'" class="skeleton-avatar">
          <ion-skeleton-text 
            *ngFor="let i of getArray(count)"
            [animated]="animated"
            class="skeleton-avatar__circle">
          </ion-skeleton-text>
        </div>
        
        <!-- CARD: Tarjeta completa -->
        <div *ngSwitchCase="'card'" class="skeleton-card">
          <div *ngFor="let i of getArray(count)" class="skeleton-card__item">
            <ion-skeleton-text 
              [animated]="animated" 
              class="skeleton-card__image">
            </ion-skeleton-text>
            <div class="skeleton-card__content">
              <ion-skeleton-text [animated]="animated" style="width: 80%; height: 20px;"></ion-skeleton-text>
              <ion-skeleton-text [animated]="animated" style="width: 60%; height: 16px;"></ion-skeleton-text>
              <ion-skeleton-text [animated]="animated" style="width: 40%; height: 16px;"></ion-skeleton-text>
            </div>
          </div>
        </div>
        
        <!-- LIST: Lista con avatar y texto -->
        <div *ngSwitchCase="'list'" class="skeleton-list">
          <div *ngFor="let i of getArray(count)" class="skeleton-list__item">
            <ion-skeleton-text 
              [animated]="animated" 
              class="skeleton-list__avatar">
            </ion-skeleton-text>
            <div class="skeleton-list__content">
              <ion-skeleton-text [animated]="animated" style="width: 70%; height: 18px;"></ion-skeleton-text>
              <ion-skeleton-text [animated]="animated" style="width: 50%; height: 14px;"></ion-skeleton-text>
            </div>
          </div>
        </div>
        
        <!-- THUMBNAIL: Miniaturas cuadradas -->
        <div *ngSwitchCase="'thumbnail'" class="skeleton-thumbnail">
          <ion-skeleton-text 
            *ngFor="let i of getArray(count)"
            [animated]="animated"
            class="skeleton-thumbnail__item">
          </ion-skeleton-text>
        </div>
        
        <!-- CUSTOM: Contenido personalizado -->
        <div *ngSwitchCase="'custom'" class="skeleton-custom">
          <ng-content></ng-content>
        </div>
        
      </ng-container>
    </div>
  `,
  styleUrls: ['./skeleton.component.scss']
})
export class SkeletonComponent {
  /** Tipo de skeleton */
  @Input() type: SkeletonType = 'text';
  
  /** Cantidad de elementos a mostrar */
  @Input() count = 1;
  
  /** Activar animaciÃ³n */
  @Input() animated = true;
  
  /**
   * Genera array de nÃºmeros para ngFor
   */
  getArray(n: number): number[] {
    return Array(n).fill(0).map((_, i) => i);
  }
  
  /**
   * Genera ancho aleatorio entre 50-100%
   */
  getRandomWidth(): number {
    return Math.floor(Math.random() * 51) + 50; // 50-100
  }
}

ESTILOS (skeleton.component.scss):
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

@import '../../../theme/design-tokens';

.skeleton-wrapper {
  width: 100%;
}

/* â”â”â” TEXT â”â”â” */
.skeleton-text {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);
  padding: var(--spacing-md);
  
  ion-skeleton-text {
    height: 16px;
    border-radius: var(--border-radius-sm);
  }
}

/* â”â”â” AVATAR â”â”â” */
.skeleton-avatar {
  display: flex;
  gap: var(--spacing-md);
  padding: var(--spacing-md);
  flex-wrap: wrap;
  
  &__circle {
    width: 64px;
    height: 64px;
    border-radius: 50%;
  }
}

/* â”â”â” CARD â”â”â” */
.skeleton-card {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-md);
  
  &__item {
    border-radius: var(--border-radius-lg);
    overflow: hidden;
    background-color: var(--bg-elevated);
    box-shadow: var(--shadow-sm);
  }
  
  &__image {
    width: 100%;
    height: 180px;
    margin-bottom: 0;
  }
  
  &__content {
    padding: var(--spacing-md);
    display: flex;
    flex-direction: column;
    gap: var(--spacing-sm);
  }
}

/* â”â”â” LIST â”â”â” */
.skeleton-list {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-md);
  
  &__item {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
    padding: var(--spacing-md);
    border-radius: var(--border-radius-md);
    background-color: var(--bg-elevated);
  }
  
  &__avatar {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    flex-shrink: 0;
  }
  
  &__content {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xs);
  }
}

/* â”â”â” THUMBNAIL â”â”â” */
.skeleton-thumbnail {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
  gap: var(--spacing-sm);
  padding: var(--spacing-md);
  
  &__item {
    width: 100%;
    padding-top: 100%; /* Mantener cuadrado */
    border-radius: var(--border-radius-md);
  }
}

/* â”â”â” CUSTOM â”â”â” */
.skeleton-custom {
  padding: var(--spacing-md);
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 1.2.5 Toast/Notification Service
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/app/shared/services/toast.service.ts

import { Injectable } from '@angular/core';
import { ToastController } from '@ionic/angular/standalone';

export type ToastType = 'success' | 'error' | 'warning' | 'info';

export interface ToastOptions {
  message: string;
  type?: ToastType;
  duration?: number;
  position?: 'top' | 'middle' | 'bottom';
  showCloseButton?: boolean;
  action?: {
    text: string;
    handler: () => void;
  };
}

/**
 * Servicio para mostrar notificaciones toast consistentes
 * 
 * CARACTERÃSTICAS:
 * - 4 tipos semÃ¡nticos (success, error, warning, info)
 * - Posicionamiento flexible
 * - BotÃ³n de acciÃ³n opcional
 * - Accesible (screen readers)
 * - DuraciÃ³n configurable
 * 
 * @example
 * ```typescript
 * constructor(private toastService: ToastService) {}
 * 
 * // Toast de Ã©xito
 * this.toastService.success('Producto agregado correctamente');
 * 
 * // Toast de error
 * this.toastService.error('No se pudo guardar el producto');
 * 
 * // Toast con acciÃ³n
 * this.toastService.show({
 *   message: 'Producto eliminado',
 *   type: 'info',
 *   action: {
 *     text: 'Deshacer',
 *     handler: () => this.restoreProduct()
 *   }
 * });
 * ```
 */
@Injectable({
  providedIn: 'root'
})
export class ToastService {
  
  constructor(private toastController: ToastController) {}
  
  /**
   * Muestra un toast de Ã©xito
   */
  async success(message: string, duration = 3000): Promise<void> {
    await this.show({
      message,
      type: 'success',
      duration
    });
  }
  
  /**
   * Muestra un toast de error
   */
  async error(message: string, duration = 4000): Promise<void> {
    await this.show({
      message,
      type: 'error',
      duration
    });
  }
  
  /**
   * Muestra un toast de advertencia
   */
  async warning(message: string, duration = 3500): Promise<void> {
    await this.show({
      message,
      type: 'warning',
      duration
    });
  }
  
  /**
   * Muestra un toast de informaciÃ³n
   */
  async info(message: string, duration = 3000): Promise<void> {
    await this.show({
      message,
      type: 'info',
      duration
    });
  }
  
  /**
   * Muestra un toast personalizado
   */
  async show(options: ToastOptions): Promise<void> {
    const {
      message,
      type = 'info',
      duration = 3000,
      position = 'bottom',
      showCloseButton = true,
      action
    } = options;
    
    const toast = await this.toastController.create({
      message,
      duration,
      position,
      color: this.getColorForType(type),
      icon: this.getIconForType(type),
      buttons: this.getButtons(showCloseButton, action),
      cssClass: `toast-${type}`,
      animated: true,
      swipeGesture: 'vertical',
      // Accesibilidad
      htmlAttributes: {
        role: 'alert',
        'aria-live': type === 'error' ? 'assertive' : 'polite'
      }
    });
    
    await toast.present();
  }
  
  /**
   * Obtiene el color segÃºn el tipo
   */
  private getColorForType(type: ToastType): string {
    const colorMap: Record<ToastType, string> = {
      success: 'success',
      error: 'danger',
      warning: 'warning',
      info: 'primary'
    };
    return colorMap[type];
  }
  
  /**
   * Obtiene el icono segÃºn el tipo
   */
  private getIconForType(type: ToastType): string {
    const iconMap: Record<ToastType, string> = {
      success: 'checkmark-circle',
      error: 'close-circle',
      warning: 'warning',
      info: 'information-circle'
    };
    return iconMap[type];
  }
  
  /**
   * Genera los botones del toast
   */
  private getButtons(
    showCloseButton: boolean,
    action?: ToastOptions['action']
  ): any[] {
    const buttons: any[] = [];
    
    if (action) {
      buttons.push({
        text: action.text,
        handler: action.handler
      });
    }
    
    if (showCloseButton) {
      buttons.push({
        icon: 'close',
        role: 'cancel',
        handler: () => {
          // Toast se cierra automÃ¡ticamente
        }
      });
    }
    
    return buttons;
  }
}

ESTILOS GLOBALES PARA TOASTS:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Agregar a src/global.scss:

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ESTILOS DE TOAST
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

.toast-success,
.toast-error,
.toast-warning,
.toast-info {
  --border-radius: var(--border-radius-lg);
  --box-shadow: var(--shadow-xl);
  --background: var(--bg-elevated);
  
  ion-icon {
    font-size: 24px;
    margin-right: var(--spacing-sm);
  }
  
  .toast-message {
    font-weight: var(--font-weight-medium);
  }
}

/* AnimaciÃ³n de entrada mÃ¡s suave */
@keyframes toastEnter {
  from {
    opacity: 0;
    transform: translateY(100%);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  1.3 ACCESIBILIDAD (A11Y) - WCAG 2.1 NIVEL AAA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

OBJETIVO: Hacer la aplicaciÃ³n completamente accesible para TODOS los usuarios,
incluyendo personas con discapacidades visuales, auditivas, motoras y cognitivas.

ESTÃNDAR: WCAG 2.1 Nivel AAA (mÃ¡s allÃ¡ del requisito legal AA)

PRINCIPIOS FUNDAMENTALES:
1. PERCEPTIBLE: La informaciÃ³n debe ser presentada de forma que todos puedan percibirla
2. OPERABLE: Los componentes de la interfaz deben ser operables por todos
3. COMPRENSIBLE: La informaciÃ³n y operaciÃ³n deben ser comprensibles
4. ROBUSTO: El contenido debe ser interpretable por tecnologÃ­as asistivas

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 1.3.1 Servicio de Accesibilidad
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/app/core/services/accessibility.service.ts

import { Injectable } from '@angular/core';
import { BehaviorSubject, Observable } from 'rxjs';

export interface AccessibilitySettings {
  highContrast: boolean;
  largeText: boolean;
  reducedMotion: boolean;
  screenReaderMode: boolean;
  keyboardNavigation: boolean;
  focusIndicators: boolean;
}

/**
 * Servicio para gestionar configuraciones de accesibilidad
 * 
 * RESPONSABILIDADES:
 * - Detectar preferencias del sistema operativo
 * - Gestionar configuraciones personalizadas
 * - Aplicar ajustes visuales y de comportamiento
 * - Anunciar mensajes a lectores de pantalla
 * - Gestionar navegaciÃ³n por teclado
 * 
 * @example
 * ```typescript
 * constructor(private a11yService: AccessibilityService) {
 *   this.a11yService.settings$.subscribe(settings => {
 *     if (settings.reducedMotion) {
 *       this.disableAnimations();
 *     }
 *   });
 * }
 * 
 * // Anunciar cambio a lector de pantalla
 * this.a11yService.announce('Producto agregado al carrito', 'polite');
 * ```
 */
@Injectable({
  providedIn: 'root'
})
export class AccessibilityService {
  
  private readonly STORAGE_KEY = 'gestpharma-a11y-settings';
  
  private settings$ = new BehaviorSubject<AccessibilitySettings>({
    highContrast: this.prefersHighContrast(),
    largeText: false,
    reducedMotion: this.prefersReducedMotion(),
    screenReaderMode: false,
    keyboardNavigation: true,
    focusIndicators: true
  });
  
  constructor() {
    this.loadSettings();
    this.applySettings();
    this.setupMediaQueryListeners();
    this.setupAriaLiveRegion();
  }
  
  /**
   * Observable de configuraciones de accesibilidad
   */
  getSettings$(): Observable<AccessibilitySettings> {
    return this.settings$.asObservable();
  }
  
  /**
   * Obtiene las configuraciones actuales
   */
  getSettings(): AccessibilitySettings {
    return this.settings$.value;
  }
  
  /**
   * Actualiza una configuraciÃ³n especÃ­fica
   */
  updateSetting<K extends keyof AccessibilitySettings>(
    key: K,
    value: AccessibilitySettings[K]
  ): void {
    const current = this.settings$.value;
    this.settings$.next({
      ...current,
      [key]: value
    });
    this.saveSettings();
    this.applySettings();
  }
  
  /**
   * Actualiza mÃºltiples configuraciones
   */
  updateSettings(settings: Partial<AccessibilitySettings>): void {
    const current = this.settings$.value;
    this.settings$.next({
      ...current,
      ...settings
    });
    this.saveSettings();
    this.applySettings();
  }
  
  /**
   * Detecta si el usuario prefiere alto contraste
   */
  private prefersHighContrast(): boolean {
    return window.matchMedia('(prefers-contrast: high)').matches ||
           window.matchMedia('(prefers-contrast: more)').matches;
  }
  
  /**
   * Detecta si el usuario prefiere movimiento reducido
   */
  private prefersReducedMotion(): boolean {
    return window.matchMedia('(prefers-reduced-motion: reduce)').matches;
  }
  
  /**
   * Detecta si el usuario prefiere tema oscuro
   */
  prefersDarkMode(): boolean {
    return window.matchMedia('(prefers-color-scheme: dark)').matches;
  }
  
  /**
   * Carga configuraciones guardadas del localStorage
   */
  private loadSettings(): void {
    try {
      const saved = localStorage.getItem(this.STORAGE_KEY);
      if (saved) {
        const parsed = JSON.parse(saved);
        this.settings$.next({
          ...this.settings$.value,
          ...parsed
        });
      }
    } catch (error) {
      console.error('Error loading accessibility settings:', error);
    }
  }
  
  /**
   * Guarda configuraciones en localStorage
   */
  private saveSettings(): void {
    try {
      localStorage.setItem(
        this.STORAGE_KEY,
        JSON.stringify(this.settings$.value)
      );
    } catch (error) {
      console.error('Error saving accessibility settings:', error);
    }
  }
  
  /**
   * Aplica configuraciones al documento
   */
  private applySettings(): void {
    const root = document.documentElement;
    const settings = this.settings$.value;
    
    // Alto contraste
    root.classList.toggle('high-contrast', settings.highContrast);
    
    // Texto grande
    root.classList.toggle('large-text', settings.largeText);
    
    // Movimiento reducido
    root.classList.toggle('reduced-motion', settings.reducedMotion);
    
    // Modo lector de pantalla
    root.classList.toggle('screen-reader-mode', settings.screenReaderMode);
    
    // Indicadores de foco
    root.classList.toggle('focus-indicators', settings.focusIndicators);
    
    // NavegaciÃ³n por teclado
    if (settings.keyboardNavigation) {
      this.enableKeyboardNavigation();
    }
  }
  
  /**
   * Configura listeners para cambios en preferencias del sistema
   */
  private setupMediaQueryListeners(): void {
    // Cambio en preferencia de contraste
    const contrastQuery = window.matchMedia('(prefers-contrast: high)');
    contrastQuery.addEventListener('change', (e) => {
      if (e.matches) {
        this.updateSetting('highContrast', true);
      }
    });
    
    // Cambio en preferencia de movimiento
    const motionQuery = window.matchMedia('(prefers-reduced-motion: reduce)');
    motionQuery.addEventListener('change', (e) => {
      this.updateSetting('reducedMotion', e.matches);
    });
  }
  
  /**
   * Crea regiÃ³n ARIA live para anuncios a lectores de pantalla
   */
  private setupAriaLiveRegion(): void {
    // Verificar si ya existe
    if (document.getElementById('aria-live-announcer')) {
      return;
    }
    
    // Crear elementos ARIA live
    const politeRegion = document.createElement('div');
    politeRegion.id = 'aria-live-announcer';
    politeRegion.setAttribute('role', 'status');
    politeRegion.setAttribute('aria-live', 'polite');
    politeRegion.setAttribute('aria-atomic', 'true');
    politeRegion.className = 'sr-only';
    
    const assertiveRegion = document.createElement('div');
    assertiveRegion.id = 'aria-live-announcer-assertive';
    assertiveRegion.setAttribute('role', 'alert');
    assertiveRegion.setAttribute('aria-live', 'assertive');
    assertiveRegion.setAttribute('aria-atomic', 'true');
    assertiveRegion.className = 'sr-only';
    
    document.body.appendChild(politeRegion);
    document.body.appendChild(assertiveRegion);
  }
  
  /**
   * Anuncia un mensaje al lector de pantalla
   * 
   * @param message - Mensaje a anunciar
   * @param priority - 'polite' (default) o 'assertive' para interrumpir
   * 
   * @example
   * ```typescript
   * // Anuncio cortÃ©s (no interrumpe)
   * this.a11yService.announce('Producto agregado');
   * 
   * // Anuncio urgente (interrumpe lectura actual)
   * this.a11yService.announce('Error: No se pudo guardar', 'assertive');
   * ```
   */
  announce(message: string, priority: 'polite' | 'assertive' = 'polite'): void {
    const announcerId = priority === 'assertive' 
      ? 'aria-live-announcer-assertive'
      : 'aria-live-announcer';
    
    const announcer = document.getElementById(announcerId);
    if (announcer) {
      // Limpiar primero para forzar anuncio
      announcer.textContent = '';
      
      // Usar setTimeout para asegurar que el cambio se detecte
      setTimeout(() => {
        announcer.textContent = message;
      }, 100);
      
      // Limpiar despuÃ©s de 5 segundos
      setTimeout(() => {
        announcer.textContent = '';
      }, 5000);
    }
  }
  
  /**
   * Habilita navegaciÃ³n por teclado mejorada
   */
  private enableKeyboardNavigation(): void {
    // Detectar si el usuario estÃ¡ usando teclado
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Tab') {
        document.body.classList.add('using-keyboard');
      }
    });
    
    document.addEventListener('mousedown', () => {
      document.body.classList.remove('using-keyboard');
    });
  }
  
  /**
   * Mueve el foco a un elemento especÃ­fico
   */
  focusElement(selector: string, preventScroll = false): void {
    const element = document.querySelector<HTMLElement>(selector);
    if (element) {
      element.focus({ preventScroll });
      this.announce(`Enfocado en ${element.getAttribute('aria-label') || selector}`);
    }
  }
  
  /**
   * Crea un "skip link" para saltar contenido
   */
  createSkipLink(targetId: string, text: string): HTMLAnchorElement {
    const skipLink = document.createElement('a');
    skipLink.href = `#${targetId}`;
    skipLink.className = 'skip-link';
    skipLink.textContent = text;
    skipLink.addEventListener('click', (e) => {
      e.preventDefault();
      this.focusElement(`#${targetId}`);
    });
    return skipLink;
  }
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 1.3.2 Estilos de Accesibilidad
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/theme/accessibility.scss

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UTILIDAD: SOLO LECTURA DE PANTALLA (SR-ONLY)
   Oculta visualmente pero accesible para lectores de pantalla
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

.sr-only,
.visually-hidden {
  position: absolute !important;
  width: 1px !important;
  height: 1px !important;
  padding: 0 !important;
  margin: -1px !important;
  overflow: hidden !important;
  clip: rect(0, 0, 0, 0) !important;
  white-space: nowrap !important;
  border: 0 !important;
}

/* VersiÃ³n enfocable (Ãºtil para skip links) */
.sr-only-focusable:focus,
.sr-only-focusable:active {
  position: static !important;
  width: auto !important;
  height: auto !important;
  margin: 0 !important;
  overflow: visible !important;
  clip: auto !important;
  white-space: normal !important;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ALTO CONTRASTE (HIGH CONTRAST)
   Cumple WCAG AAA (7:1 ratio mÃ­nimo)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

.high-contrast {
  /* Colores principales con mÃ¡ximo contraste */
  --color-primary-500: #000000;
  --color-secondary-500: #0000ff;
  
  /* Textos */
  --text-primary: #000000;
  --text-secondary: #000000;
  --text-tertiary: #333333;
  --text-inverse: #ffffff;
  
  /* Fondos */
  --bg-primary: #ffffff;
  --bg-secondary: #ffffff;
  --bg-tertiary: #f0f0f0;
  
  /* Bordes mÃ¡s gruesos y oscuros */
  --border-light: #000000;
  --border-medium: #000000;
  --border-dark: #000000;
  
  /* Eliminar sombras y efectos sutiles */
  * {
    text-shadow: none !important;
    box-shadow: none !important;
  }
  
  /* Bordes mÃ¡s definidos en elementos interactivos */
  button,
  a,
  input,
  select,
  textarea {
    border: 2px solid #000000 !important;
  }
  
  /* Links muy visibles */
  a {
    color: #0000ff !important;
    text-decoration: underline !important;
    font-weight: var(--font-weight-bold);
    
    &:visited {
      color: #551a8b !important;
    }
    
    &:hover,
    &:focus {
      color: #ff0000 !important;
      background-color: #ffff00 !important;
    }
  }
  
  /* Iconos con borde */
  ion-icon {
    filter: drop-shadow(0 0 1px #000000);
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TEXTO GRANDE (LARGE TEXT)
   Aumenta tamaÃ±os para mejor legibilidad
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

.large-text {
  /* Aumentar base font-size en 125% */
  font-size: 125% !important;
  
  /* Ajustar todos los tamaÃ±os proporcionalmente */
  h1, .h1 { font-size: calc(var(--font-size-3xl) * 1.25) !important; }
  h2, .h2 { font-size: calc(var(--font-size-2xl) * 1.25) !important; }
  h3, .h3 { font-size: calc(var(--font-size-xl) * 1.25) !important; }
  h4, .h4 { font-size: calc(var(--font-size-lg) * 1.25) !important; }
  h5, .h5 { font-size: calc(var(--font-size-md) * 1.25) !important; }
  h6, .h6 { font-size: calc(var(--font-size-base) * 1.25) !important; }
  
  p, span, div, li {
    font-size: calc(var(--font-size-base) * 1.25) !important;
  }
  
  /* Aumentar line-height para mejor legibilidad */
  p {
    line-height: var(--line-height-loose) !important;
  }
  
  /* Aumentar espaciado entre elementos */
  * + * {
    margin-top: calc(var(--spacing-md) * 1.25);
  }
  
  /* Botones mÃ¡s grandes */
  button,
  .btn,
  ion-button {
    min-height: 56px !important;
    font-size: calc(var(--font-size-base) * 1.25) !important;
    padding: var(--spacing-md) var(--spacing-lg) !important;
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MOVIMIENTO REDUCIDO (REDUCED MOTION)
   Elimina animaciones para usuarios sensibles
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

.reduced-motion,
.reduced-motion *,
@media (prefers-reduced-motion: reduce) {
  /* Reducir duraciÃ³n de animaciones al mÃ­nimo */
  animation-duration: 0.01ms !important;
  animation-iteration-count: 1 !important;
  transition-duration: 0.01ms !important;
  
  /* Desactivar scroll suave */
  scroll-behavior: auto !important;
  
  /* Desactivar transformaciones animadas */
  * {
    transition: none !important;
    animation: none !important;
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INDICADORES DE FOCO (FOCUS INDICATORS)
   Indicadores visibles y prominentes para navegaciÃ³n por teclado
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* Foco visible en todos los elementos interactivos */
.focus-indicators,
.using-keyboard {
  
  *:focus-visible {
    outline: 3px solid var(--color-primary-500) !important;
    outline-offset: 3px !important;
    border-radius: 4px;
    box-shadow: 0 0 0 6px rgba(76, 175, 80, 0.2) !important;
    z-index: 1;
  }
  
  /* Foco en links */
  a:focus-visible {
    background-color: var(--color-primary-50);
    padding: 2px 4px;
    margin: -2px -4px;
  }
  
  /* Foco en botones */
  button:focus-visible,
  ion-button:focus-visible {
    transform: scale(1.05);
  }
  
  /* Foco en inputs */
  input:focus-visible,
  textarea:focus-visible,
  select:focus-visible {
    border-width: 3px !important;
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SKIP LINKS (SALTAR NAVEGACIÃ“N)
   Permiten a usuarios de teclado saltar contenido repetitivo
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

.skip-link {
  position: absolute;
  top: -100px;
  left: 0;
  z-index: 10000;
  padding: var(--spacing-md) var(--spacing-lg);
  background-color: var(--color-primary-500);
  color: var(--text-inverse);
  font-weight: var(--font-weight-bold);
  text-decoration: none;
  border-radius: 0 0 var(--border-radius-md) 0;
  box-shadow: var(--shadow-xl);
  
  &:focus {
    top: 0;
    outline: 3px solid var(--text-inverse);
    outline-offset: -3px;
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ÃREA TÃCTIL MÃNIMA (TOUCH TARGETS)
   44x44px mÃ­nimo segÃºn WCAG 2.1 AAA
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

button,
a,
input[type="button"],
input[type="submit"],
input[type="checkbox"],
input[type="radio"],
.clickable,
.tappable {
  min-width: 44px;
  min-height: 44px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

/* Checkboxes y radios mÃ¡s grandes */
input[type="checkbox"],
input[type="radio"] {
  width: 24px;
  height: 24px;
  padding: 10px; /* Ãrea tÃ¡ctil extendida */
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODO LECTOR DE PANTALLA (SCREEN READER MODE)
   Optimizaciones para usuarios de lectores de pantalla
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

.screen-reader-mode {
  /* Simplificar layout */
  * {
    display: revert !important;
    position: static !important;
  }
  
  /* Eliminar elementos decorativos */
  [aria-hidden="true"] {
    display: none !important;
  }
  
  /* Texto mÃ¡s lineal */
  body {
    max-width: 100%;
    margin: 0;
    padding: var(--spacing-md);
  }
  
  /* Headers mÃ¡s descriptivos */
  h1, h2, h3, h4, h5, h6 {
    font-weight: var(--font-weight-bold);
    margin-top: var(--spacing-xl);
  }
  
  /* Links muy distinguibles */
  a {
    text-decoration: underline;
    font-weight: var(--font-weight-semibold);
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   REGIONES ARIA LIVE (ARIA LIVE REGIONS)
   Ãreas para anuncios dinÃ¡micos
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

#aria-live-announcer,
#aria-live-announcer-assertive {
  @extend .sr-only;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UTILIDADES ADICIONALES
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* Ocultar de lectores de pantalla pero visible */
[aria-hidden="true"] {
  speak: none;
}

/* Texto seleccionable (para copiar) */
.user-select-all {
  user-select: all;
}

/* Prevenir selecciÃ³n (elementos interactivos) */
.user-select-none {
  user-select: none;
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 1.3.3 Directivas de Accesibilidad
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/app/shared/directives/aria.directive.ts

import { Directive, Input, ElementRef, OnInit, OnDestroy } from '@angular/core';

/**
 * Directiva para aÃ±adir atributos ARIA automÃ¡ticamente
 * 
 * CARACTERÃSTICAS:
 * - AÃ±ade aria-label, aria-describedby, aria-live
 * - Gestiona roles ARIA
 * - Actualiza atributos dinÃ¡micamente
 * 
 * @example
 * ```html
 * <button 
 *   appAria
 *   [ariaLabel]="'Cerrar modal de ' + productName"
 *   [ariaDescribedBy]="'modal-description'"
 *   role="button">
 *   <ion-icon name="close"></ion-icon>
 * </button>
 * 
 * <div 
 *   appAria
 *   [ariaLive]="'polite'"
 *   [ariaAtomic]="true">
 *   {{ statusMessage }}
 * </div>
 * ```
 */
@Directive({
  selector: '[appAria]',
  standalone: true
})
export class AriaDirective implements OnInit, OnDestroy {
  
  @Input() ariaLabel?: string;
  @Input() ariaDescribedBy?: string;
  @Input() ariaLabelledBy?: string;
  @Input() ariaLive?: 'off' | 'polite' | 'assertive';
  @Input() ariaAtomic?: boolean;
  @Input() ariaRelevant?: string;
  @Input() ariaBusy?: boolean;
  @Input() ariaDisabled?: boolean;
  @Input() ariaExpanded?: boolean;
  @Input() ariaHasPopup?: boolean | 'false' | 'true' | 'menu' | 'listbox' | 'tree' | 'grid' | 'dialog';
  @Input() ariaHidden?: boolean;
  @Input() ariaPressed?: boolean;
  @Input() ariaSelected?: boolean;
  @Input() role?: string;
  
  constructor(private el: ElementRef<HTMLElement>) {}
  
  ngOnInit(): void {
    this.updateAriaAttributes();
  }
  
  ngOnDestroy(): void {
    // Cleanup si es necesario
  }
  
  /**
   * Actualiza todos los atributos ARIA
   */
  private updateAriaAttributes(): void {
    const element = this.el.nativeElement;
    
    // Atributos de etiquetado
    this.setAttribute('aria-label', this.ariaLabel);
    this.setAttribute('aria-describedby', this.ariaDescribedBy);
    this.setAttribute('aria-labelledby', this.ariaLabelledBy);
    
    // Atributos de live regions
    this.setAttribute('aria-live', this.ariaLive);
    this.setAttribute('aria-atomic', this.ariaAtomic?.toString());
    this.setAttribute('aria-relevant', this.ariaRelevant);
    
    // Atributos de estado
    this.setAttribute('aria-busy', this.ariaBusy?.toString());
    this.setAttribute('aria-disabled', this.ariaDisabled?.toString());
    this.setAttribute('aria-expanded', this.ariaExpanded?.toString());
    this.setAttribute('aria-hidden', this.ariaHidden?.toString());
    this.setAttribute('aria-pressed', this.ariaPressed?.toString());
    this.setAttribute('aria-selected', this.ariaSelected?.toString());
    
    // Atributos de tipo
    this.setAttribute('aria-haspopup', this.ariaHasPopup?.toString());
    
    // Role
    this.setAttribute('role', this.role);
  }
  
  /**
   * Establece un atributo solo si el valor existe
   */
  private setAttribute(name: string, value: string | undefined): void {
    const element = this.el.nativeElement;
    if (value !== undefined && value !== null) {
      element.setAttribute(name, value);
    }
  }
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

CHECKLIST DE ACCESIBILIDAD (CUMPLIMIENTO OBLIGATORIO):
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ“ PERCEPTIBLE
  â˜‘ Contraste de texto: mÃ­nimo 7:1 (AAA)
  â˜‘ Contraste de UI: mÃ­nimo 3:1
  â˜‘ Texto redimensionable hasta 200%
  â˜‘ Sin informaciÃ³n solo por color
  â˜‘ Alt text en todas las imÃ¡genes
  â˜‘ Captions/transcripciones para audio
  
âœ“ OPERABLE
  â˜‘ Navegable completamente por teclado
  â˜‘ Sin trampas de teclado
  â˜‘ Skip links presentes
  â˜‘ Ãrea tÃ¡ctil mÃ­nima: 44x44px
  â˜‘ Tiempo suficiente para interacciones
  â˜‘ Sin contenido parpadeante >3 veces/seg
  
âœ“ COMPRENSIBLE
  â˜‘ Idioma de pÃ¡gina declarado (lang="es")
  â˜‘ Idioma de partes declarado si difiere
  â˜‘ Labels claros en formularios
  â˜‘ Mensajes de error descriptivos
  â˜‘ NavegaciÃ³n consistente
  â˜‘ IdentificaciÃ³n consistente
  
âœ“ ROBUSTO
  â˜‘ HTML vÃ¡lido y semÃ¡ntico
  â˜‘ ARIA usado correctamente
  â˜‘ Name, Role, Value en componentes
  â˜‘ Compatible con tecnologÃ­as asistivas
  â˜‘ Parsing sin errores crÃ­ticos

HERRAMIENTAS DE TESTING RECOMENDADAS:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. axe DevTools (Extension de Chrome/Firefox)
2. WAVE (Web Accessibility Evaluation Tool)
3. Lighthouse (Audit de Chrome DevTools)
4. NVDA / JAWS (Lectores de pantalla)
5. Keyboard Navigation Test (Tab, Enter, Esc, Arrows)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  1.4 SISTEMA RESPONSIVE Y BREAKPOINTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

OBJETIVO: Garantizar que la aplicaciÃ³n funcione perfectamente en TODOS los
dispositivos y tamaÃ±os de pantalla, desde mÃ³viles pequeÃ±os hasta desktop 4K.

FILOSOFÃA: Mobile First + Progressive Enhancement

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 1.4.1 Servicio de Breakpoints
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/app/core/services/breakpoint.service.ts

import { Injectable } from '@angular/core';
import { BehaviorSubject, fromEvent, Observable } from 'rxjs';
import { debounceTime, distinctUntilChanged, map, startWith } from 'rxjs/operators';

export enum Breakpoint {
  XS = 'xs',   // 0-575px    (MÃ³viles pequeÃ±os)
  SM = 'sm',   // 576-767px  (MÃ³viles grandes)
  MD = 'md',   // 768-991px  (Tablets portrait)
  LG = 'lg',   // 992-1199px (Tablets landscape, desktop pequeÃ±o)
  XL = 'xl',   // 1200-1399px (Desktop)
  XXL = 'xxl'  // 1400px+    (Desktop grande, 4K)
}

export const BREAKPOINT_VALUES = {
  [Breakpoint.XS]: 0,
  [Breakpoint.SM]: 576,
  [Breakpoint.MD]: 768,
  [Breakpoint.LG]: 992,
  [Breakpoint.XL]: 1200,
  [Breakpoint.XXL]: 1400
};

export interface BreakpointState {
  current: Breakpoint;
  width: number;
  height: number;
  isMobile: boolean;
  isTablet: boolean;
  isDesktop: boolean;
  orientation: 'portrait' | 'landscape';
}

/**
 * Servicio para gestionar breakpoints responsive
 * 
 * CARACTERÃSTICAS:
 * - DetecciÃ³n reactiva de tamaÃ±o de pantalla
 * - Breakpoints personalizados
 * - OrientaciÃ³n del dispositivo
 * - Helpers para condiciones responsive
 * - Performance optimizado (debounced)
 * 
 * @example
 * ```typescript
 * constructor(private breakpointService: BreakpointService) {
 *   this.breakpointService.state$.subscribe(state => {
 *     if (state.isMobile) {
 *       this.showMobileLayout();
 *     }
 *   });
 * }
 * 
 * // Verificar breakpoint especÃ­fico
 * if (this.breakpointService.isGreaterThanOrEqual(Breakpoint.MD)) {
 *   // Mostrar sidebar
 * }
 * ```
 */
@Injectable({
  providedIn: 'root'
})
export class BreakpointService {
  
  private state$ = new BehaviorSubject<BreakpointState>(
    this.calculateBreakpointState()
  );
  
  /**
   * Observable del estado responsive actual
   */
  getState$(): Observable<BreakpointState> {
    return this.state$.asObservable();
  }
  
  /**
   * Obtiene el estado actual
   */
  getState(): BreakpointState {
    return this.state$.value;
  }
  
  /**
   * Observable del breakpoint actual
   */
  getCurrentBreakpoint$(): Observable<Breakpoint> {
    return this.state$.pipe(
      map(state => state.current),
      distinctUntilChanged()
    );
  }
  
  constructor() {
    this.initResizeListener();
    this.initOrientationListener();
  }
  
  /**
   * Inicializa listener de resize con debounce
   */
  private initResizeListener(): void {
    fromEvent(window, 'resize')
      .pipe(
        debounceTime(150), // Esperar 150ms despuÃ©s del Ãºltimo resize
        map(() => this.calculateBreakpointState()),
        distinctUntilChanged((prev, curr) => 
          prev.current === curr.current && 
          prev.orientation === curr.orientation
        )
      )
      .subscribe(state => {
        this.state$.next(state);
      });
  }
  
  /**
   * Inicializa listener de cambio de orientaciÃ³n
   */
  private initOrientationListener(): void {
    if ('onorientationchange' in window) {
      fromEvent(window, 'orientationchange')
        .pipe(
          debounceTime(200),
          map(() => this.calculateBreakpointState())
        )
        .subscribe(state => {
          this.state$.next(state);
        });
    }
  }
  
  /**
   * Calcula el estado del breakpoint actual
   */
  private calculateBreakpointState(): BreakpointState {
    const width = window.innerWidth;
    const height = window.innerHeight;
    const current = this.getCurrentBreakpoint(width);
    
    return {
      current,
      width,
      height,
      isMobile: current === Breakpoint.XS || current === Breakpoint.SM,
      isTablet: current === Breakpoint.MD || current === Breakpoint.LG,
      isDesktop: current === Breakpoint.XL || current === Breakpoint.XXL,
      orientation: height > width ? 'portrait' : 'landscape'
    };
  }
  
  /**
   * Obtiene el breakpoint segÃºn el ancho
   */
  private getCurrentBreakpoint(width: number): Breakpoint {
    if (width >= BREAKPOINT_VALUES[Breakpoint.XXL]) return Breakpoint.XXL;
    if (width >= BREAKPOINT_VALUES[Breakpoint.XL]) return Breakpoint.XL;
    if (width >= BREAKPOINT_VALUES[Breakpoint.LG]) return Breakpoint.LG;
    if (width >= BREAKPOINT_VALUES[Breakpoint.MD]) return Breakpoint.MD;
    if (width >= BREAKPOINT_VALUES[Breakpoint.SM]) return Breakpoint.SM;
    return Breakpoint.XS;
  }
  
  /**
   * Verifica si el breakpoint actual es mayor o igual al especificado
   */
  isGreaterThanOrEqual(breakpoint: Breakpoint): boolean {
    const current = BREAKPOINT_VALUES[this.state$.value.current];
    const target = BREAKPOINT_VALUES[breakpoint];
    return current >= target;
  }
  
  /**
   * Verifica si el breakpoint actual es menor que el especificado
   */
  isLessThan(breakpoint: Breakpoint): boolean {
    return !this.isGreaterThanOrEqual(breakpoint);
  }
  
  /**
   * Verifica si estamos exactamente en un breakpoint
   */
  is(breakpoint: Breakpoint): boolean {
    return this.state$.value.current === breakpoint;
  }
  
  /**
   * Verifica si estamos en mÃ³vil
   */
  isMobile(): boolean {
    return this.state$.value.isMobile;
  }
  
  /**
   * Verifica si estamos en tablet
   */
  isTablet(): boolean {
    return this.state$.value.isTablet;
  }
  
  /**
   * Verifica si estamos en desktop
   */
  isDesktop(): boolean {
    return this.state$.value.isDesktop;
  }
  
  /**
   * Verifica la orientaciÃ³n
   */
  isPortrait(): boolean {
    return this.state$.value.orientation === 'portrait';
  }
  
  /**
   * Verifica la orientaciÃ³n
   */
  isLandscape(): boolean {
    return this.state$.value.orientation === 'landscape';
  }
  
  /**
   * Obtiene el nÃºmero de columnas recomendado para un grid
   */
  getRecommendedColumns(options?: {
    xs?: number;
    sm?: number;
    md?: number;
    lg?: number;
    xl?: number;
    xxl?: number;
  }): number {
    const defaults = {
      xs: 1,
      sm: 2,
      md: 2,
      lg: 3,
      xl: 4,
      xxl: 5
    };
    
    const config = { ...defaults, ...options };
    const current = this.state$.value.current;
    
    return config[current];
  }
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 1.4.2 Directiva Responsive
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/app/shared/directives/responsive.directive.ts

import { 
  Directive, 
  Input, 
  TemplateRef, 
  ViewContainerRef, 
  OnInit, 
  OnDestroy 
} from '@angular/core';
import { Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import { BreakpointService, Breakpoint } from '@core/services/breakpoint.service';

/**
 * Directiva estructural para renderizado condicional basado en breakpoint
 * 
 * @example
 * ```html
 * <!-- Mostrar solo en mÃ³vil -->
 * <div *appResponsive="'xs'">
 *   MenÃº mÃ³vil
 * </div>
 * 
 * <!-- Mostrar en tablet y superior -->
 * <div *appResponsive="'md'">
 *   Sidebar
 * </div>
 * 
 * <!-- Mostrar solo en breakpoints especÃ­ficos -->
 * <div *appResponsive="['xs', 'sm']">
 *   Vista mÃ³vil optimizada
 * </div>
 * 
 * <!-- Operador "menor que" -->
 * <div *appResponsive="'md'; operator: 'lt'">
 *   Solo mÃ³vil (menor que MD)
 * </div>
 * ```
 */
@Directive({
  selector: '[appResponsive]',
  standalone: true
})
export class ResponsiveDirective implements OnInit, OnDestroy {
  
  @Input() appResponsive!: Breakpoint | Breakpoint[];
  @Input() appResponsiveOperator: 'gte' | 'lt' | 'eq' = 'gte'; // >=, <, ==
  
  private destroy$ = new Subject<void>();
  private hasView = false;
  
  constructor(
    private templateRef: TemplateRef<any>,
    private viewContainer: ViewContainerRef,
    private breakpointService: BreakpointService
  ) {}
  
  ngOnInit(): void {
    this.breakpointService.getCurrentBreakpoint$()
      .pipe(takeUntil(this.destroy$))
      .subscribe(current => {
        this.updateView(current);
      });
  }
  
  ngOnDestroy(): void {
    this.destroy$.next();
    this.destroy$.complete();
  }
  
  /**
   * Actualiza la vista segÃºn el breakpoint
   */
  private updateView(currentBreakpoint: Breakpoint): void {
    const shouldShow = this.shouldShowContent(currentBreakpoint);
    
    if (shouldShow && !this.hasView) {
      this.viewContainer.createEmbeddedView(this.templateRef);
      this.hasView = true;
    } else if (!shouldShow && this.hasView) {
      this.viewContainer.clear();
      this.hasView = false;
    }
  }
  
  /**
   * Determina si el contenido debe mostrarse
   */
  private shouldShowContent(current: Breakpoint): boolean {
    const breakpoints = Array.isArray(this.appResponsive) 
      ? this.appResponsive 
      : [this.appResponsive];
    
    switch (this.appResponsiveOperator) {
      case 'eq': // Igual a
        return breakpoints.includes(current);
      
      case 'lt': // Menor que
        return breakpoints.some(bp => 
          this.breakpointService.isLessThan(bp)
        );
      
      case 'gte': // Mayor o igual (default)
      default:
        return breakpoints.some(bp => 
          this.breakpointService.isGreaterThanOrEqual(bp)
        );
    }
  }
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 1.4.3 Sistema de Grid Responsive
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/theme/responsive.scss

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONTAINER SYSTEM
   Contenedores con max-width responsivo
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

.container {
  width: 100%;
  margin-right: auto;
  margin-left: auto;
  padding-right: var(--spacing-md);
  padding-left: var(--spacing-md);
  
  /* Breakpoint-specific max-widths */
  @media (min-width: 576px) {
    max-width: 540px;
  }
  
  @media (min-width: 768px) {
    max-width: 720px;
    padding-right: var(--spacing-lg);
    padding-left: var(--spacing-lg);
  }
  
  @media (min-width: 992px) {
    max-width: 960px;
  }
  
  @media (min-width: 1200px) {
    max-width: 1140px;
  }
  
  @media (min-width: 1400px) {
    max-width: 1320px;
  }
}

/* Contenedor fluido (sin max-width) */
.container-fluid {
  width: 100%;
  padding-right: var(--spacing-md);
  padding-left: var(--spacing-md);
  
  @media (min-width: 768px) {
    padding-right: var(--spacing-lg);
    padding-left: var(--spacing-lg);
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GRID SYSTEM (CSS Grid)
   Sistema de 12 columnas flexible
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

.grid {
  display: grid;
  grid-template-columns: repeat(12, 1fr);
  gap: var(--spacing-md);
  width: 100%;
  
  @media (min-width: 768px) {
    gap: var(--spacing-lg);
  }
}

/* Grid con auto-fit (responsive automÃ¡tico) */
.grid-auto {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: var(--spacing-md);
  
  @media (min-width: 768px) {
    gap: var(--spacing-lg);
  }
}

/* Grid con auto-fill (llena todo el espacio) */
.grid-auto-fill {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: var(--spacing-md);
  
  @media (min-width: 768px) {
    gap: var(--spacing-lg);
  }
}

/* Clases de columnas */
.col-1 { grid-column: span 1; }
.col-2 { grid-column: span 2; }
.col-3 { grid-column: span 3; }
.col-4 { grid-column: span 4; }
.col-5 { grid-column: span 5; }
.col-6 { grid-column: span 6; }
.col-7 { grid-column: span 7; }
.col-8 { grid-column: span 8; }
.col-9 { grid-column: span 9; }
.col-10 { grid-column: span 10; }
.col-11 { grid-column: span 11; }
.col-12 { grid-column: span 12; }

/* Clases responsive de columnas */
@media (min-width: 576px) {
  .col-sm-1 { grid-column: span 1; }
  .col-sm-2 { grid-column: span 2; }
  .col-sm-3 { grid-column: span 3; }
  .col-sm-4 { grid-column: span 4; }
  .col-sm-6 { grid-column: span 6; }
  .col-sm-12 { grid-column: span 12; }
}

@media (min-width: 768px) {
  .col-md-1 { grid-column: span 1; }
  .col-md-2 { grid-column: span 2; }
  .col-md-3 { grid-column: span 3; }
  .col-md-4 { grid-column: span 4; }
  .col-md-6 { grid-column: span 6; }
  .col-md-8 { grid-column: span 8; }
  .col-md-12 { grid-column: span 12; }
}

@media (min-width: 992px) {
  .col-lg-1 { grid-column: span 1; }
  .col-lg-2 { grid-column: span 2; }
  .col-lg-3 { grid-column: span 3; }
  .col-lg-4 { grid-column: span 4; }
  .col-lg-6 { grid-column: span 6; }
  .col-lg-8 { grid-column: span 8; }
  .col-lg-12 { grid-column: span 12; }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FLEXBOX UTILITIES
   Utilidades flexbox responsive
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

.flex {
  display: flex;
}

.flex-col {
  display: flex;
  flex-direction: column;
}

.flex-wrap {
  flex-wrap: wrap;
}

.flex-nowrap {
  flex-wrap: nowrap;
}

/* Justify Content */
.justify-start { justify-content: flex-start; }
.justify-center { justify-content: center; }
.justify-end { justify-content: flex-end; }
.justify-between { justify-content: space-between; }
.justify-around { justify-content: space-around; }
.justify-evenly { justify-content: space-evenly; }

/* Align Items */
.items-start { align-items: flex-start; }
.items-center { align-items: center; }
.items-end { align-items: flex-end; }
.items-stretch { align-items: stretch; }
.items-baseline { align-items: baseline; }

/* Gap */
.gap-xs { gap: var(--spacing-xs); }
.gap-sm { gap: var(--spacing-sm); }
.gap-md { gap: var(--spacing-md); }
.gap-lg { gap: var(--spacing-lg); }
.gap-xl { gap: var(--spacing-xl); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DISPLAY UTILITIES RESPONSIVE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* Ocultar en mÃ³vil */
@media (max-width: 767px) {
  .hide-mobile { display: none !important; }
}

/* Ocultar en tablet */
@media (min-width: 768px) and (max-width: 991px) {
  .hide-tablet { display: none !important; }
}

/* Ocultar en desktop */
@media (min-width: 992px) {
  .hide-desktop { display: none !important; }
}

/* Mostrar solo en mÃ³vil */
.show-mobile {
  @media (min-width: 768px) {
    display: none !important;
  }
}

/* Mostrar solo en tablet */
.show-tablet {
  display: none !important;
  
  @media (min-width: 768px) and (max-width: 991px) {
    display: block !important;
  }
}

/* Mostrar solo en desktop */
.show-desktop {
  display: none !important;
  
  @media (min-width: 992px) {
    display: block !important;
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SPACING UTILITIES RESPONSIVE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* Margin */
.m-0 { margin: 0; }
.m-auto { margin: auto; }
.mt-sm { margin-top: var(--spacing-sm); }
.mt-md { margin-top: var(--spacing-md); }
.mt-lg { margin-top: var(--spacing-lg); }
.mb-sm { margin-bottom: var(--spacing-sm); }
.mb-md { margin-bottom: var(--spacing-md); }
.mb-lg { margin-bottom: var(--spacing-lg); }
.mx-auto { margin-left: auto; margin-right: auto; }

/* Padding */
.p-0 { padding: 0; }
.p-sm { padding: var(--spacing-sm); }
.p-md { padding: var(--spacing-md); }
.p-lg { padding: var(--spacing-lg); }
.px-md { padding-left: var(--spacing-md); padding-right: var(--spacing-md); }
.py-md { padding-top: var(--spacing-md); padding-bottom: var(--spacing-md); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WIDTH UTILITIES
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

.w-full { width: 100%; }
.w-auto { width: auto; }
.w-screen { width: 100vw; }
.max-w-xs { max-width: 320px; }
.max-w-sm { max-width: 480px; }
.max-w-md { max-width: 640px; }
.max-w-lg { max-width: 768px; }
.max-w-xl { max-width: 1024px; }
.max-w-full { max-width: 100%; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ADAPTACIONES MÃ“VILES ESPECÃFICAS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

@media (max-width: 767px) {
  /* Asegurar que los modales ocupen toda la pantalla */
  ion-modal {
    --width: 100%;
    --height: 100%;
    --border-radius: 0;
  }
  
  /* Cards de ancho completo */
  ion-card {
    margin-left: 0;
    margin-right: 0;
    border-radius: 0;
  }
  
  /* Reducir padding en contenedores */
  ion-content {
    --padding-start: var(--spacing-sm);
    --padding-end: var(--spacing-sm);
  }
  
  /* Botones de ancho completo en mÃ³vil */
  .btn-mobile-full {
    width: 100%;
    margin: var(--spacing-sm) 0;
  }
}

MEJORES PRÃCTICAS RESPONSIVE:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ“ MOBILE FIRST: DiseÃ±ar primero para mÃ³vil, luego escalar
âœ“ TOUCH TARGETS: MÃ­nimo 44x44px en elementos interactivos
âœ“ LEGIBILIDAD: TamaÃ±o de texto mÃ­nimo 16px en mÃ³vil
âœ“ VIEWPORT: Usar unidades relativas (rem, %, vw/vh)
âœ“ IMÃGENES: Usar srcset para imÃ¡genes responsive
âœ“ PERFORMANCE: Cargar recursos segÃºn dispositivo
âœ“ ORIENTACIÃ“N: Considerar portrait y landscape
âœ“ TESTING: Probar en dispositivos reales

âŒ NO usar position: fixed en exceso (problemas en mÃ³vil)
âŒ NO asumir hover disponible (dispositivos tÃ¡ctiles)
âŒ NO usar font-size menor a 14px
âŒ NO crear layouts que requieran scroll horizontal

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ  ğŸ—ï¸  FASE 2: ARQUITECTURA Y BUENAS PRÃCTICAS (PRIORIDAD ALTA)             â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  2.1 ARQUITECTURA DE COMPONENTES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

OBJETIVO: Establecer una arquitectura de componentes clara, escalable y mantenible
que siga los principios SOLID y las mejores prÃ¡cticas de Angular.

PRINCIPIOS FUNDAMENTALES:
â€¢ Single Responsibility Principle (SRP)
â€¢ Don't Repeat Yourself (DRY)
â€¢ Keep It Simple, Stupid (KISS)
â€¢ You Aren't Gonna Need It (YAGNI)
â€¢ Separation of Concerns (SoC)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 2.1.1 PatrÃ³n de Componentes Smart vs Dumb
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

CONCEPTO: Separar componentes en dos categorÃ­as para mejorar reusabilidad y testing.

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SMART COMPONENTS (Container Components)                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ RESPONSABILIDADES:                                                          â”‚
â”‚ â€¢ Gestionar el estado de la aplicaciÃ³n                                     â”‚
â”‚ â€¢ Interactuar con servicios (API, State Management)                        â”‚
â”‚ â€¢ Coordinar mÃºltiples componentes dumb                                     â”‚
â”‚ â€¢ Manejar lÃ³gica de negocio                                                â”‚
â”‚ â€¢ Routing y navegaciÃ³n                                                     â”‚
â”‚                                                                             â”‚
â”‚ CARACTERÃSTICAS:                                                            â”‚
â”‚ â€¢ Pocos @Input/@Output                                                     â”‚
â”‚ â€¢ Inyectan servicios                                                       â”‚
â”‚ â€¢ Contienen lÃ³gica compleja                                                â”‚
â”‚ â€¢ No son reutilizables                                                     â”‚
â”‚                                                                             â”‚
â”‚ UBICACIÃ“N: src/app/modules/[feature]/pages/                                â”‚
â”‚ EJEMPLO: product-list.page.ts, pos.page.ts                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DUMB COMPONENTS (Presentation Components)                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ RESPONSABILIDADES:                                                          â”‚
â”‚ â€¢ Presentar datos (UI pura)                                                â”‚
â”‚ â€¢ Recibir datos vÃ­a @Input                                                 â”‚
â”‚ â€¢ Emitir eventos vÃ­a @Output                                               â”‚
â”‚ â€¢ NO interactuar con servicios                                             â”‚
â”‚ â€¢ NO gestionar estado                                                      â”‚
â”‚                                                                             â”‚
â”‚ CARACTERÃSTICAS:                                                            â”‚
â”‚ â€¢ MÃºltiples @Input/@Output                                                 â”‚
â”‚ â€¢ Sin inyecciÃ³n de servicios                                               â”‚
â”‚ â€¢ LÃ³gica simple (solo presentaciÃ³n)                                        â”‚
â”‚ â€¢ Altamente reutilizables                                                  â”‚
â”‚ â€¢ FÃ¡cilmente testeables                                                    â”‚
â”‚                                                                             â”‚
â”‚ UBICACIÃ“N: src/app/shared/components/                                      â”‚
â”‚ EJEMPLO: product-card.component.ts, button.component.ts                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

EJEMPLO PRÃCTICO:

// â”â”â” SMART COMPONENT (Page) â”â”â”
// src/app/modules/inventory/pages/product-list.page.ts

import { Component, OnInit } from '@angular/core';
import { ProductService } from '@services/product.service';
import { Product } from '@models/product.model';
import { ToastService } from '@services/toast.service';

/**
 * PÃ¡gina de lista de productos (SMART)
 * 
 * RESPONSABILIDADES:
 * - Obtener productos del servicio
 * - Gestionar estado de carga
 * - Manejar errores
 * - Coordinar acciones (editar, eliminar)
 */
@Component({
  selector: 'app-product-list-page',
  template: `
    <ion-header>
      <ion-toolbar>
        <ion-title>Productos</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="addProduct()">
            <ion-icon name="add"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>
    
    <ion-content>
      <!-- Skeleton loader mientras carga -->
      <app-skeleton 
        *ngIf="loading" 
        type="card" 
        [count]="5">
      </app-skeleton>
      
      <!-- Empty state si no hay productos -->
      <app-empty-state
        *ngIf="!loading && products.length === 0"
        icon="cube-outline"
        title="No hay productos"
        description="Comienza agregando tu primer producto al inventario"
        actionLabel="Agregar Producto"
        (actionClick)="addProduct()">
      </app-empty-state>
      
      <!-- Grid de productos (DUMB component) -->
      <div class="grid-auto" *ngIf="!loading && products.length > 0">
        <app-product-card
          *ngFor="let product of products; trackBy: trackById"
          [product]="product"
          (edit)="editProduct($event)"
          (delete)="deleteProduct($event)"
          (addToCart)="addToCart($event)">
        </app-product-card>
      </div>
    </ion-content>
  `,
  standalone: true,
  imports: [
    CommonModule,
    IonHeader, IonToolbar, IonTitle, IonButtons, IonButton,
    IonContent, IonIcon,
    SkeletonComponent,
    EmptyStateComponent,
    ProductCardComponent
  ]
})
export class ProductListPage implements OnInit {
  products: Product[] = [];
  loading = false;
  
  constructor(
    private productService: ProductService,
    private toastService: ToastService,
    private router: Router
  ) {}
  
  ngOnInit(): void {
    this.loadProducts();
  }
  
  /**
   * Carga productos del servicio
   */
  async loadProducts(): Promise<void> {
    this.loading = true;
    
    try {
      this.products = await this.productService.getAll().toPromise();
    } catch (error) {
      this.toastService.error('Error al cargar productos');
      console.error('Error loading products:', error);
    } finally {
      this.loading = false;
    }
  }
  
  /**
   * Navega a pÃ¡gina de agregar producto
   */
  addProduct(): void {
    this.router.navigate(['/inventory/add']);
  }
  
  /**
   * Navega a pÃ¡gina de editar producto
   */
  editProduct(product: Product): void {
    this.router.navigate(['/inventory/edit', product.id]);
  }
  
  /**
   * Elimina un producto con confirmaciÃ³n
   */
  async deleteProduct(product: Product): Promise<void> {
    const confirmed = await this.confirmDelete(product.nombre);
    
    if (confirmed) {
      try {
        await this.productService.delete(product.id).toPromise();
        this.products = this.products.filter(p => p.id !== product.id);
        this.toastService.success('Producto eliminado correctamente');
      } catch (error) {
        this.toastService.error('Error al eliminar producto');
      }
    }
  }
  
  /**
   * Agrega producto al carrito
   */
  addToCart(product: Product): void {
    this.cartService.addItem(product, 1);
    this.toastService.success(`${product.nombre} agregado al carrito`);
  }
  
  /**
   * TrackBy para optimizar ngFor
   */
  trackById(index: number, item: Product): number {
    return item.id;
  }
  
  /**
   * Muestra diÃ¡logo de confirmaciÃ³n
   */
  private async confirmDelete(productName: string): Promise<boolean> {
    // Implementar confirmaciÃ³n
    return true;
  }
}

// â”â”â” DUMB COMPONENT â”â”â”
// src/app/shared/components/product-card/product-card.component.ts

import { Component, Input, Output, EventEmitter } from '@angular/core';
import { Product } from '@models/product.model';

/**
 * Tarjeta de producto (DUMB)
 * 
 * RESPONSABILIDADES:
 * - Mostrar informaciÃ³n del producto
 * - Emitir eventos de acciones
 * - NO gestionar estado
 * - NO llamar servicios
 */
@Component({
  selector: 'app-product-card',
  template: `
    <ion-card class="product-card">
      <!-- Imagen del producto -->
      <div class="product-card__image">
        <img 
          [src]="product.imagen || 'assets/images/product-placeholder.png'"
          [alt]="product.nombre"
          loading="lazy">
        
        <!-- Badge de stock bajo -->
        <ion-badge 
          *ngIf="isLowStock"
          color="warning"
          class="product-card__badge">
          Stock Bajo
        </ion-badge>
      </div>
      
      <!-- Contenido -->
      <ion-card-content>
        <!-- CategorÃ­a -->
        <p class="overline text-tertiary">
          {{ product.categoria.nombre }}
        </p>
        
        <!-- Nombre -->
        <h3 class="product-card__title">
          {{ product.nombre }}
        </h3>
        
        <!-- Precio -->
        <p class="product-card__price">
          {{ product.precio | currency: 'MXN' }}
        </p>
        
        <!-- Stock -->
        <div class="product-card__stock">
          <ion-icon 
            [name]="isLowStock ? 'warning' : 'cube'"
            [color]="isLowStock ? 'warning' : 'medium'">
          </ion-icon>
          <span [class.text-warning]="isLowStock">
            {{ product.stock }} unidades
          </span>
        </div>
      </ion-card-content>
      
      <!-- Acciones -->
      <div class="product-card__actions">
        <ion-button 
          fill="clear" 
          size="small"
          (click)="onEdit()"
          [attr.aria-label]="'Editar ' + product.nombre">
          <ion-icon slot="icon-only" name="create"></ion-icon>
        </ion-button>
        
        <ion-button 
          fill="clear" 
          size="small"
          color="danger"
          (click)="onDelete()"
          [attr.aria-label]="'Eliminar ' + product.nombre">
          <ion-icon slot="icon-only" name="trash"></ion-icon>
        </ion-button>
        
        <ion-button 
          expand="block"
          (click)="onAddToCart()"
          [disabled]="product.stock === 0"
          [attr.aria-label]="'Agregar ' + product.nombre + ' al carrito'">
          <ion-icon slot="start" name="cart"></ion-icon>
          Agregar
        </ion-button>
      </div>
    </ion-card>
  `,
  styleUrls: ['./product-card.component.scss'],
  standalone: true,
  imports: [
    CommonModule,
    IonCard, IonCardContent, IonButton, IonIcon, IonBadge
  ]
})
export class ProductCardComponent {
  /** Producto a mostrar */
  @Input({ required: true }) product!: Product;
  
  /** Evento al editar */
  @Output() edit = new EventEmitter<Product>();
  
  /** Evento al eliminar */
  @Output() delete = new EventEmitter<Product>();
  
  /** Evento al agregar al carrito */
  @Output() addToCart = new EventEmitter<Product>();
  
  /**
   * Verifica si el stock es bajo
   */
  get isLowStock(): boolean {
    return this.product.stock <= this.product.stockMinimo;
  }
  
  /**
   * Emite evento de ediciÃ³n
   */
  onEdit(): void {
    this.edit.emit(this.product);
  }
  
  /**
   * Emite evento de eliminaciÃ³n
   */
  onDelete(): void {
    this.delete.emit(this.product);
  }
  
  /**
   * Emite evento de agregar al carrito
   */
  onAddToCart(): void {
    this.addToCart.emit(this.product);
  }
}

REGLAS DE ORO:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ“ Smart components en src/app/modules/[feature]/pages/
âœ“ Dumb components en src/app/shared/components/
âœ“ Dumb components NO deben inyectar servicios
âœ“ Smart components coordinan, Dumb components presentan
âœ“ MÃ¡ximo 1 nivel de smart component por ruta
âœ“ Dumb components deben ser reutilizables
âœ“ Usar @Input/@Output para comunicaciÃ³n
âœ“ TrackBy en todos los *ngFor

âŒ NO inyectar servicios en componentes dumb
âŒ NO mezclar lÃ³gica de negocio con presentaciÃ³n
âŒ NO crear componentes gigantes (>300 lÃ­neas)
âŒ NO repetir cÃ³digo entre componentes

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 2.1.2 GestiÃ³n de Estado con Servicios
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

PATRÃ“N: Service with Subject (Estado reactivo sin NgRx)

CUÃNDO USAR:
â€¢ Estado compartido entre mÃºltiples componentes
â€¢ Estado que debe persistir durante la navegaciÃ³n
â€¢ Datos que cambian frecuentemente
â€¢ Necesidad de reactividad (subscripciones)

EJEMPLO: Servicio de Carrito de Compras

UBICACIÃ“N: src/app/core/services/cart.service.ts

import { Injectable } from '@angular/core';
import { BehaviorSubject, Observable } from 'rxjs';
import { map } from 'rxjs/operators';
import { Product } from '@models/product.model';

export interface CartItem {
  product: Product;
  quantity: number;
  subtotal: number;
}

export interface CartState {
  items: CartItem[];
  total: number;
  itemCount: number;
}

/**
 * Servicio de gestiÃ³n del carrito de compras
 * 
 * CARACTERÃSTICAS:
 * - Estado reactivo con BehaviorSubject
 * - MÃ©todos inmutables (no modifica estado directamente)
 * - CÃ¡lculos automÃ¡ticos (total, cantidad)
 * - Persistencia en localStorage
 * - Validaciones de stock
 * 
 * @example
 * ```typescript
 * constructor(private cartService: CartService) {
 *   // Subscribirse al estado del carrito
 *   this.cartService.state$.subscribe(state => {
 *     console.log('Items:', state.items);
 *     console.log('Total:', state.total);
 *   });
 * }
 * 
 * // Agregar producto
 * this.cartService.addItem(product, 2);
 * 
 * // Obtener total
 * const total = this.cartService.getTotal();
 * ```
 */
@Injectable({
  providedIn: 'root'
})
export class CartService {
  
  private readonly STORAGE_KEY = 'gestpharma-cart';
  
  /**
   * Estado privado del carrito
   */
  private state$ = new BehaviorSubject<CartState>({
    items: [],
    total: 0,
    itemCount: 0
  });
  
  /**
   * Observable pÃºblico del estado (read-only)
   */
  readonly cart$ = this.state$.asObservable();
  
  /**
   * Observable del total
   */
  readonly total$ = this.cart$.pipe(
    map(state => state.total)
  );
  
  /**
   * Observable de la cantidad de items
   */
  readonly itemCount$ = this.cart$.pipe(
    map(state => state.itemCount)
  );
  
  constructor() {
    this.loadFromStorage();
  }
  
  /**
   * Obtiene el estado actual del carrito
   */
  getState(): CartState {
    return this.state$.value;
  }
  
  /**
   * Obtiene los items del carrito
   */
  getItems(): CartItem[] {
    return this.state$.value.items;
  }
  
  /**
   * Obtiene el total del carrito
   */
  getTotal(): number {
    return this.state$.value.total;
  }
  
  /**
   * Obtiene la cantidad de items
   */
  getItemCount(): number {
    return this.state$.value.itemCount;
  }
  
  /**
   * Agrega un item al carrito
   * 
   * @param product - Producto a agregar
   * @param quantity - Cantidad (default: 1)
   * @returns true si se agregÃ³ exitosamente
   */
  addItem(product: Product, quantity = 1): boolean {
    // Validar stock disponible
    if (product.stock < quantity) {
      console.warn('Stock insuficiente');
      return false;
    }
    
    const currentItems = this.getItems();
    const existingItem = currentItems.find(
      item => item.product.id === product.id
    );
    
    let newItems: CartItem[];
    
    if (existingItem) {
      // Actualizar cantidad del item existente
      const newQuantity = existingItem.quantity + quantity;
      
      // Validar stock total
      if (product.stock < newQuantity) {
        console.warn('Stock insuficiente para la cantidad solicitada');
        return false;
      }
      
      newItems = currentItems.map(item =>
        item.product.id === product.id
          ? {
              ...item,
              quantity: newQuantity,
              subtotal: product.precio * newQuantity
            }
          : item
      );
    } else {
      // Agregar nuevo item
      newItems = [
        ...currentItems,
        {
          product,
          quantity,
          subtotal: product.precio * quantity
        }
      ];
    }
    
    this.updateState(newItems);
    return true;
  }
  
  /**
   * Elimina un item del carrito
   */
  removeItem(productId: number): void {
    const newItems = this.getItems().filter(
      item => item.product.id !== productId
    );
    this.updateState(newItems);
  }
  
  /**
   * Actualiza la cantidad de un item
   */
  updateQuantity(productId: number, quantity: number): boolean {
    if (quantity <= 0) {
      this.removeItem(productId);
      return true;
    }
    
    const item = this.getItems().find(
      item => item.product.id === productId
    );
    
    if (!item) {
      return false;
    }
    
    // Validar stock
    if (item.product.stock < quantity) {
      console.warn('Stock insuficiente');
      return false;
    }
    
    const newItems = this.getItems().map(item =>
      item.product.id === productId
        ? {
            ...item,
            quantity,
            subtotal: item.product.precio * quantity
          }
        : item
    );
    
    this.updateState(newItems);
    return true;
  }
  
  /**
   * Limpia el carrito completamente
   */
  clear(): void {
    this.updateState([]);
  }
  
  /**
   * Verifica si el carrito estÃ¡ vacÃ­o
   */
  isEmpty(): boolean {
    return this.getItems().length === 0;
  }
  
  /**
   * Actualiza el estado y recalcula totales
   */
  private updateState(items: CartItem[]): void {
    const total = items.reduce((sum, item) => sum + item.subtotal, 0);
    const itemCount = items.reduce((sum, item) => sum + item.quantity, 0);
    
    const newState: CartState = {
      items,
      total,
      itemCount
    };
    
    this.state$.next(newState);
    this.saveToStorage();
  }
  
  /**
   * Guarda el carrito en localStorage
   */
  private saveToStorage(): void {
    try {
      const state = this.getState();
      localStorage.setItem(this.STORAGE_KEY, JSON.stringify(state.items));
    } catch (error) {
      console.error('Error saving cart to storage:', error);
    }
  }
  
  /**
   * Carga el carrito desde localStorage
   */
  private loadFromStorage(): void {
    try {
      const stored = localStorage.getItem(this.STORAGE_KEY);
      if (stored) {
        const items: CartItem[] = JSON.parse(stored);
        this.updateState(items);
      }
    } catch (error) {
      console.error('Error loading cart from storage:', error);
    }
  }
}

PRINCIPIOS DE GESTIÃ“N DE ESTADO:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ“ INMUTABILIDAD: Nunca modificar el estado directamente
âœ“ SINGLE SOURCE OF TRUTH: Un solo lugar para cada dato
âœ“ REACTIVIDAD: Usar Observables para cambios
âœ“ ENCAPSULACIÃ“N: Estado privado, acceso por mÃ©todos
âœ“ PERSISTENCIA: Guardar en localStorage cuando necesario
âœ“ VALIDACIÃ“N: Validar antes de cambiar estado
âœ“ CÃLCULOS: Derivar datos en lugar de guardarlos
âœ“ UNSUBSCRIBE: Siempre limpiar subscripciones

âŒ NO mutar arrays/objetos del estado
âŒ NO exponer BehaviorSubject directamente
âŒ NO duplicar estado en mÃºltiples servicios
âŒ NO guardar datos derivados en el estado
âŒ NO olvidar unsubscribe en componentes

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 2.1.3 GestiÃ³n de Subscripciones y Memory Leaks
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

PROBLEMA: Las subscripciones no gestionadas causan memory leaks y degradan el performance.

SOLUCIONES:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ASYNC PIPE (RECOMENDADO)                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ VENTAJAS:                                                                   â”‚
â”‚ â€¢ Unsubscribe automÃ¡tico                                                   â”‚
â”‚ â€¢ Triggerea ChangeDetection automÃ¡ticamente                                â”‚
â”‚ â€¢ Menos cÃ³digo boilerplate                                                 â”‚
â”‚ â€¢ Maneja null/undefined de forma segura                                    â”‚
â”‚                                                                             â”‚
â”‚ CUÃNDO USAR:                                                               â”‚
â”‚ â€¢ Siempre que sea posible en templates                                     â”‚
â”‚ â€¢ Para mostrar datos directamente en la vista                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

EJEMPLO CON ASYNC PIPE:

import { Component } from '@angular/core';
import { ProductService } from '@services/product.service';
import { Observable } from 'rxjs';
import { Product } from '@models/product.model';

@Component({
  selector: 'app-product-list',
  template: `
    <ion-content>
      <!-- âœ… CORRECTO: Async pipe maneja la subscripciÃ³n -->
      <div *ngIf="products$ | async as products; else loading">
        <app-product-card
          *ngFor="let product of products; trackBy: trackById"
          [product]="product">
        </app-product-card>
      </div>
      
      <ng-template #loading>
        <app-skeleton type="card" [count]="5"></app-skeleton>
      </ng-template>
      
      <!-- MÃºltiples async pipes del mismo observable -->
      <ion-footer>
        <p>Total: {{ (products$ | async)?.length || 0 }} productos</p>
      </ion-footer>
    </ion-content>
  `,
  standalone: true
})
export class ProductListComponent {
  // Observable expuesto directamente para el template
  products$: Observable<Product[]>;
  
  constructor(private productService: ProductService) {
    this.products$ = this.productService.getAll();
  }
  
  trackById(index: number, item: Product): number {
    return item.id;
  }
}

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. TAKEUNTIL PATTERN                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ VENTAJAS:                                                                   â”‚
â”‚ â€¢ Control manual de subscripciones                                         â”‚
â”‚ â€¢ Un solo unsubscribe para mÃºltiples observables                           â”‚
â”‚ â€¢ CÃ³digo limpio y mantenible                                               â”‚
â”‚                                                                             â”‚
â”‚ CUÃNDO USAR:                                                               â”‚
â”‚ â€¢ Cuando no se puede usar async pipe                                       â”‚
â”‚ â€¢ MÃºltiples subscripciones en el mismo componente                          â”‚
â”‚ â€¢ LÃ³gica compleja que requiere el valor en el componente                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

EJEMPLO CON TAKEUNTIL:

import { Component, OnInit, OnDestroy } from '@angular/core';
import { Subject, combineLatest } from 'rxjs';
import { takeUntil } from 'rxjs/operators';

@Component({
  selector: 'app-sales-dashboard',
  template: `...`,
  standalone: true
})
export class SalesDashboardComponent implements OnInit, OnDestroy {
  
  /**
   * Subject para completar todas las subscripciones
   * IMPORTANTE: Debe emitir en ngOnDestroy
   */
  private destroy$ = new Subject<void>();
  
  salesData: Sale[] = [];
  products: Product[] = [];
  loading = false;
  
  constructor(
    private salesService: SalesService,
    private productService: ProductService
  ) {}
  
  ngOnInit(): void {
    this.loadDashboardData();
    this.setupRealtimeUpdates();
  }
  
  /**
   * CRÃTICO: Completar el Subject para limpiar subscripciones
   */
  ngOnDestroy(): void {
    this.destroy$.next();
    this.destroy$.complete();
  }
  
  /**
   * Carga datos del dashboard
   */
  private loadDashboardData(): void {
    this.loading = true;
    
    // Combinar mÃºltiples observables
    combineLatest([
      this.salesService.getRecentSales(),
      this.productService.getTopProducts()
    ])
      .pipe(
        takeUntil(this.destroy$) // âœ… Unsubscribe automÃ¡tico
      )
      .subscribe({
        next: ([sales, products]) => {
          this.salesData = sales;
          this.products = products;
          this.loading = false;
        },
        error: (error) => {
          console.error('Error loading dashboard:', error);
          this.loading = false;
        }
      });
  }
  
  /**
   * Configurar actualizaciones en tiempo real
   */
  private setupRealtimeUpdates(): void {
    // WebSocket o polling
    this.salesService.realtimeSales$
      .pipe(
        takeUntil(this.destroy$) // âœ… Se limpia al destruir
      )
      .subscribe(sale => {
        this.salesData = [sale, ...this.salesData];
      });
  }
}

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. SUBSCRIPTION ARRAY PATTERN                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ VENTAJAS:                                                                   â”‚
â”‚ â€¢ Control granular de cada subscripciÃ³n                                    â”‚
â”‚ â€¢ FÃ¡cil de entender para principiantes                                     â”‚
â”‚                                                                             â”‚
â”‚ DESVENTAJAS:                                                               â”‚
â”‚ â€¢ MÃ¡s cÃ³digo boilerplate                                                   â”‚
â”‚ â€¢ FÃ¡cil olvidar agregar al array                                           â”‚
â”‚                                                                             â”‚
â”‚ CUÃNDO USAR:                                                               â”‚
â”‚ â€¢ Cuando se necesita unsubscribe selectivo                                 â”‚
â”‚ â€¢ Subscripciones dinÃ¡micas (agregar/remover)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

EJEMPLO CON SUBSCRIPTION ARRAY:

import { Component, OnInit, OnDestroy } from '@angular/core';
import { Subscription } from 'rxjs';

@Component({
  selector: 'app-inventory',
  template: `...`,
  standalone: true
})
export class InventoryComponent implements OnInit, OnDestroy {
  
  /**
   * Array de subscripciones para limpiar
   */
  private subscriptions: Subscription[] = [];
  
  products: Product[] = [];
  
  constructor(private productService: ProductService) {}
  
  ngOnInit(): void {
    // Agregar cada subscripciÃ³n al array
    const productsSub = this.productService.getAll()
      .subscribe(products => {
        this.products = products;
      });
    
    this.subscriptions.push(productsSub);
    
    // Otra subscripciÃ³n
    const updatesSub = this.productService.updates$
      .subscribe(update => {
        this.handleUpdate(update);
      });
    
    this.subscriptions.push(updatesSub);
  }
  
  ngOnDestroy(): void {
    // Unsubscribe de todas las subscripciones
    this.subscriptions.forEach(sub => sub.unsubscribe());
  }
  
  private handleUpdate(update: any): void {
    // LÃ³gica de actualizaciÃ³n
  }
}

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. DESTROYREF (Angular 16+) - MODERNO                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ VENTAJAS:                                                                   â”‚
â”‚ â€¢ No necesita implementar OnDestroy                                        â”‚
â”‚ â€¢ Funciona con inject()                                                    â”‚
â”‚ â€¢ Menos boilerplate                                                        â”‚
â”‚ â€¢ Recomendado en Angular moderno                                           â”‚
â”‚                                                                             â”‚
â”‚ CUÃNDO USAR:                                                               â”‚
â”‚ â€¢ Angular 16+                                                              â”‚
â”‚ â€¢ Junto con inject() API                                                   â”‚
â”‚ â€¢ Funciones standalone o services                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

EJEMPLO CON DESTROYREF (Angular 16+):

import { Component, OnInit, DestroyRef, inject } from '@angular/core';
import { takeUntilDestroyed } from '@angular/core/rxjs-interop';

@Component({
  selector: 'app-user-profile',
  template: `...`,
  standalone: true
})
export class UserProfileComponent implements OnInit {
  
  // âœ… Inyectar DestroyRef
  private destroyRef = inject(DestroyRef);
  private userService = inject(UserService);
  
  user: User | null = null;
  
  ngOnInit(): void {
    this.userService.currentUser$
      .pipe(
        takeUntilDestroyed(this.destroyRef) // âœ… Limpieza automÃ¡tica
      )
      .subscribe(user => {
        this.user = user;
      });
  }
  
  // âœ… No necesita ngOnDestroy
}

OBSERVABLES QUE NO NECESITAN UNSUBSCRIBE:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… HttpClient requests (completan automÃ¡ticamente)
âœ… ActivatedRoute params/queryParams (Angular los limpia)
âœ… Router events (Angular los gestiona)
âœ… Observables finitos (of, from, timer con takeUntil)

âŒ Interval/Timer sin lÃ­mite (memory leak)
âŒ WebSocket/SSE streams (memory leak)
âŒ Custom observables infinitos (memory leak)
âŒ Subject subscriptions manuales (memory leak)
âŒ Store/State subscriptions (memory leak)

MATRIZ DE DECISIÃ“N:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

| Escenario                          | MÃ©todo Recomendado        |
|------------------------------------|---------------------------|
| Mostrar datos en template          | Async Pipe                |
| MÃºltiples subscripciones           | takeUntil                 |
| Angular 16+                        | DestroyRef + takeUntil... |
| HttpClient                         | No unsubscribe (auto)     |
| Interval/Timer                     | takeUntil OBLIGATORIO     |
| WebSocket                          | takeUntil OBLIGATORIO     |
| Router params                      | No unsubscribe (auto)     |

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 2.1.4 Lazy Loading y Code Splitting
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

OBJETIVO: Reducir el tamaÃ±o del bundle inicial y mejorar tiempos de carga.

BENEFICIOS:
â€¢ Carga inicial mÃ¡s rÃ¡pida (menos JavaScript)
â€¢ Mejor Time to Interactive (TTI)
â€¢ Carga bajo demanda de features
â€¢ Mejor experiencia en conexiones lentas

ESTRUCTURA DE MÃ“DULOS LAZY:

src/app/
â”œâ”€â”€ core/                          # Carga eager (singleton services)
â”‚   â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ guards/
â”‚   â””â”€â”€ interceptors/
â”œâ”€â”€ shared/                        # Compartido entre mÃ³dulos
â”‚   â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ directives/
â”‚   â””â”€â”€ pipes/
â””â”€â”€ modules/                       # Features lazy loaded
    â”œâ”€â”€ inventory/
    â”‚   â”œâ”€â”€ inventory.routes.ts    # Rutas del mÃ³dulo
    â”‚   â”œâ”€â”€ pages/
    â”‚   â”œâ”€â”€ components/
    â”‚   â””â”€â”€ services/
    â”œâ”€â”€ pos/
    â”œâ”€â”€ reports/
    â””â”€â”€ settings/

CONFIGURACIÃ“N DE RUTAS CON LAZY LOADING:

UBICACIÃ“N: src/app/app.routes.ts

import { Routes } from '@angular/router';
import { AuthGuard } from '@core/guards/auth.guard';

/**
 * Rutas principales de la aplicaciÃ³n
 * 
 * ESTRATEGIA:
 * - Login/Auth: Carga eager (necesario inmediatamente)
 * - Features: Lazy loading por mÃ³dulo
 * - Preloading: PreloadAllModules para rutas frecuentes
 */
export const routes: Routes = [
  {
    path: '',
    redirectTo: 'home',
    pathMatch: 'full'
  },
  
  // â”â”â” RUTAS PÃšBLICAS (Eager Loading) â”â”â”
  {
    path: 'login',
    loadComponent: () => 
      import('./modules/auth/pages/login.page').then(m => m.LoginPage)
  },
  
  {
    path: 'register',
    loadComponent: () => 
      import('./modules/auth/pages/register.page').then(m => m.RegisterPage)
  },
  
  // â”â”â” RUTAS PRIVADAS CON GUARD â”â”â”
  {
    path: 'home',
    loadComponent: () =>
      import('./modules/home/pages/home.page').then(m => m.HomePage),
    canActivate: [AuthGuard]
  },
  
  // â”â”â” MÃ“DULO INVENTARIO (Lazy Loading) â”â”â”
  {
    path: 'inventory',
    loadChildren: () =>
      import('./modules/inventory/inventory.routes').then(m => m.INVENTORY_ROUTES),
    canActivate: [AuthGuard],
    data: { 
      preload: true, // Precargar este mÃ³dulo
      roles: ['ADMIN', 'MANAGER'] 
    }
  },
  
  // â”â”â” MÃ“DULO POS (Lazy Loading) â”â”â”
  {
    path: 'pos',
    loadChildren: () =>
      import('./modules/pos/pos.routes').then(m => m.POS_ROUTES),
    canActivate: [AuthGuard],
    data: { 
      preload: true,
      roles: ['ADMIN', 'CASHIER'] 
    }
  },
  
  // â”â”â” MÃ“DULO REPORTES (Lazy Loading) â”â”â”
  {
    path: 'reports',
    loadChildren: () =>
      import('./modules/reports/reports.routes').then(m => m.REPORTS_ROUTES),
    canActivate: [AuthGuard],
    data: {
      preload: false, // No precargar (menos frecuente)
      roles: ['ADMIN', 'MANAGER']
    }
  },
  
  // â”â”â” MÃ“DULO CONFIGURACIÃ“N (Lazy Loading) â”â”â”
  {
    path: 'settings',
    loadChildren: () =>
      import('./modules/settings/settings.routes').then(m => m.SETTINGS_ROUTES),
    canActivate: [AuthGuard]
  },
  
  // â”â”â” 404 NOT FOUND â”â”â”
  {
    path: '**',
    loadComponent: () =>
      import('./shared/pages/not-found.page').then(m => m.NotFoundPage)
  }
];

RUTAS DE MÃ“DULO (Ejemplo: Inventory):

UBICACIÃ“N: src/app/modules/inventory/inventory.routes.ts

import { Routes } from '@angular/router';

/**
 * Rutas del mÃ³dulo de inventario
 * 
 * ESTRUCTURA:
 * - Lista de productos
 * - Detalle de producto
 * - Agregar producto
 * - Editar producto
 * - CategorÃ­as
 */
export const INVENTORY_ROUTES: Routes = [
  {
    path: '',
    redirectTo: 'products',
    pathMatch: 'full'
  },
  {
    path: 'products',
    children: [
      {
        path: '',
        loadComponent: () =>
          import('./pages/product-list.page').then(m => m.ProductListPage)
      },
      {
        path: 'add',
        loadComponent: () =>
          import('./pages/product-form.page').then(m => m.ProductFormPage)
      },
      {
        path: 'edit/:id',
        loadComponent: () =>
          import('./pages/product-form.page').then(m => m.ProductFormPage)
      },
      {
        path: ':id',
        loadComponent: () =>
          import('./pages/product-detail.page').then(m => m.ProductDetailPage)
      }
    ]
  },
  {
    path: 'categories',
    loadComponent: () =>
      import('./pages/category-list.page').then(m => m.CategoryListPage)
  },
  {
    path: 'low-stock',
    loadComponent: () =>
      import('./pages/low-stock.page').then(m => m.LowStockPage)
  }
];

PRELOADING STRATEGY PERSONALIZADA:

UBICACIÃ“N: src/app/core/strategies/selective-preload.strategy.ts

import { Injectable } from '@angular/core';
import { PreloadingStrategy, Route } from '@angular/router';
import { Observable, of } from 'rxjs';

/**
 * Estrategia de precarga selectiva
 * 
 * Precarga solo rutas marcadas con data.preload = true
 * Ãštil para cargar mÃ³dulos frecuentes sin afectar carga inicial
 */
@Injectable({
  providedIn: 'root'
})
export class SelectivePreloadStrategy implements PreloadingStrategy {
  
  /**
   * Determina si debe precargar una ruta
   */
  preload(route: Route, load: () => Observable<any>): Observable<any> {
    // Si la ruta tiene data.preload = true, precargar
    if (route.data && route.data['preload']) {
      console.log('Preloading:', route.path);
      return load();
    }
    
    // No precargar
    return of(null);
  }
}

CONFIGURACIÃ“N EN APP CONFIG:

UBICACIÃ“N: src/app/app.config.ts

import { ApplicationConfig } from '@angular/core';
import { provideRouter, withPreloading } from '@angular/router';
import { routes } from './app.routes';
import { SelectivePreloadStrategy } from '@core/strategies/selective-preload.strategy';

export const appConfig: ApplicationConfig = {
  providers: [
    provideRouter(
      routes,
      withPreloading(SelectivePreloadStrategy) // âœ… Usar estrategia custom
    ),
    // ... otros providers
  ]
};

LAZY LOADING DE COMPONENTES PESADOS:

EJEMPLO: Modal con grÃ¡ficos (Chart.js)

import { Component } from '@angular/core';
import { ModalController } from '@ionic/angular';

@Component({
  selector: 'app-sales-dashboard',
  template: `
    <ion-button (click)="openChartModal()">
      Ver GrÃ¡fico
    </ion-button>
  `,
  standalone: true
})
export class SalesDashboardPage {
  
  constructor(private modalCtrl: ModalController) {}
  
  /**
   * Carga el modal con Chart.js solo cuando se necesita
   * Evita cargar la librerÃ­a en el bundle inicial
   */
  async openChartModal(): Promise<void> {
    // âœ… Lazy load del componente pesado
    const { ChartModalComponent } = await import(
      './components/chart-modal.component'
    );
    
    const modal = await this.modalCtrl.create({
      component: ChartModalComponent,
      componentProps: {
        chartData: this.getChartData()
      }
    });
    
    await modal.present();
  }
  
  private getChartData(): any {
    // Preparar datos para el grÃ¡fico
    return {
      labels: ['Ene', 'Feb', 'Mar'],
      datasets: [{ data: [100, 200, 150] }]
    };
  }
}

ANÃLISIS DE BUNDLE SIZE:

# Analizar tamaÃ±o de bundles
ng build --stats-json

# Visualizar con webpack-bundle-analyzer
npx webpack-bundle-analyzer dist/stats.json

MEJORES PRÃCTICAS LAZY LOADING:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ“ Lazy load por feature/mÃ³dulo funcional
âœ“ Mantener bundle inicial < 200KB (gzipped)
âœ“ Usar preloading strategy para rutas frecuentes
âœ“ Lazy load librerÃ­as pesadas (Chart.js, PDF, etc.)
âœ“ Shared module solo para componentes comunes
âœ“ Core module para servicios singleton
âœ“ Analizar bundles regularmente
âœ“ Lazy load modals/popover con componentes pesados

âŒ NO lazy load todo (overhead de network requests)
âŒ NO duplicar cÃ³digo entre mÃ³dulos lazy
âŒ NO importar mÃ³dulos lazy en el bundle principal
âŒ NO crear mÃ³dulos lazy demasiado pequeÃ±os

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 2.1.5 Change Detection Strategies
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

OBJETIVO: Optimizar el ciclo de detecciÃ³n de cambios para mejorar performance.

PROBLEMA: Por defecto, Angular verifica TODOS los componentes en cada evento.

ESTRATEGIAS:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. DEFAULT (ChangeDetectionStrategy.Default)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ COMPORTAMIENTO:                                                             â”‚
â”‚ â€¢ Verifica el componente en cada ciclo de detecciÃ³n                        â”‚
â”‚ â€¢ Se dispara por cualquier evento (click, http, timer, etc.)              â”‚
â”‚ â€¢ Verifica todas las propiedades del componente                            â”‚
â”‚                                                                             â”‚
â”‚ CUÃNDO USAR:                                                               â”‚
â”‚ â€¢ Componentes con mutaciÃ³n directa de objetos                              â”‚
â”‚ â€¢ LÃ³gica compleja que modifica estado                                      â”‚
â”‚ â€¢ Desarrollo inicial (mÃ¡s permisivo)                                       â”‚
â”‚                                                                             â”‚
â”‚ DESVENTAJAS:                                                               â”‚
â”‚ â€¢ Menor performance en apps grandes                                        â”‚
â”‚ â€¢ Chequeos innecesarios                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. ONPUSH (ChangeDetectionStrategy.OnPush) - RECOMENDADO                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ COMPORTAMIENTO:                                                             â”‚
â”‚ â€¢ Solo verifica cuando:                                                    â”‚
â”‚   - Cambio en @Input (referencia, no mutaciÃ³n)                            â”‚
â”‚   - Evento en el template del componente                                   â”‚
â”‚   - Async pipe emite nuevo valor                                           â”‚
â”‚   - Llamada manual a markForCheck()                                        â”‚
â”‚                                                                             â”‚
â”‚ VENTAJAS:                                                                   â”‚
â”‚ â€¢ Mejor performance (menos chequeos)                                       â”‚
â”‚ â€¢ Fuerza inmutabilidad                                                     â”‚
â”‚ â€¢ Predecible y testeable                                                   â”‚
â”‚ â€¢ Escalable en apps grandes                                                â”‚
â”‚                                                                             â”‚
â”‚ REQUISITOS:                                                                â”‚
â”‚ â€¢ Usar datos inmutables                                                    â”‚
â”‚ â€¢ No mutar @Input directamente                                             â”‚
â”‚ â€¢ Usar async pipe o markForCheck()                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

EJEMPLO DE COMPONENTE ONPUSH:

import { 
  Component, 
  Input, 
  ChangeDetectionStrategy,
  ChangeDetectorRef 
} from '@angular/core';
import { Product } from '@models/product.model';

/**
 * Componente de tarjeta de producto con OnPush
 * 
 * IMPORTANTE:
 * - Usa OnPush para mejor performance
 * - Todos los @Input deben ser inmutables
 * - Cambios manuales requieren markForCheck()
 */
@Component({
  selector: 'app-product-card',
  template: `
    <ion-card>
      <img [src]="product.imagen" [alt]="product.nombre">
      
      <ion-card-content>
        <h3>{{ product.nombre }}</h3>
        <p>{{ product.precio | currency }}</p>
        
        <!-- Stock badge -->
        <ion-badge [color]="stockColor">
          {{ product.stock }} unidades
        </ion-badge>
        
        <!-- Loading indicator -->
        <ion-spinner *ngIf="loading"></ion-spinner>
      </ion-card-content>
      
      <ion-button 
        expand="block"
        (click)="addToCart()"
        [disabled]="loading || product.stock === 0">
        Agregar al Carrito
      </ion-button>
    </ion-card>
  `,
  styleUrls: ['./product-card.component.scss'],
  changeDetection: ChangeDetectionStrategy.OnPush, // âœ… OnPush strategy
  standalone: true
})
export class ProductCardComponent {
  
  /**
   * Producto a mostrar (DEBE ser inmutable)
   * Cambios deben crear nueva referencia
   */
  @Input({ required: true }) product!: Product;
  
  /**
   * Estado de carga (interno del componente)
   */
  loading = false;
  
  constructor(
    private cartService: CartService,
    private cdr: ChangeDetectorRef // Para markForCheck manual
  ) {}
  
  /**
   * Color del badge segÃºn stock
   */
  get stockColor(): string {
    if (this.product.stock === 0) return 'danger';
    if (this.product.stock <= this.product.stockMinimo) return 'warning';
    return 'success';
  }
  
  /**
   * Agrega producto al carrito
   * 
   * NOTA: Como modificamos 'loading' (estado interno),
   * necesitamos markForCheck() para que se refleje
   */
  async addToCart(): Promise<void> {
    this.loading = true;
    this.cdr.markForCheck(); // âœ… Forzar detecciÃ³n de cambio
    
    try {
      await this.cartService.addItem(this.product, 1);
      // Ã‰xito
    } catch (error) {
      console.error('Error adding to cart:', error);
    } finally {
      this.loading = false;
      this.cdr.markForCheck(); // âœ… Actualizar vista
    }
  }
}

PATRONES DE INMUTABILIDAD:

// âŒ INCORRECTO: Mutar objeto directamente
updateProduct(): void {
  this.product.nombre = 'Nuevo nombre'; // âŒ No dispara OnPush
  this.product.stock = 10;
}

// âœ… CORRECTO: Crear nueva referencia
updateProduct(): void {
  this.product = {
    ...this.product,              // Spread del objeto original
    nombre: 'Nuevo nombre',       // Sobrescribir propiedades
    stock: 10
  };
  // OnPush detecta el cambio (nueva referencia)
}

// âŒ INCORRECTO: Mutar array directamente
addItem(item: Product): void {
  this.products.push(item); // âŒ No dispara OnPush
}

// âœ… CORRECTO: Crear nuevo array
addItem(item: Product): void {
  this.products = [...this.products, item];
  // OnPush detecta el cambio (nueva referencia)
}

// âœ… ALTERNATIVA: Usar mÃ©todos inmutables
removeItem(id: number): void {
  this.products = this.products.filter(p => p.id !== id);
}

updateItem(updated: Product): void {
  this.products = this.products.map(p =>
    p.id === updated.id ? updated : p
  );
}

CUÃNDO USAR MARKFORCHECK():

import { Component, ChangeDetectorRef, ChangeDetectionStrategy } from '@angular/core';

@Component({
  selector: 'app-timer',
  template: `
    <div>Tiempo: {{ seconds }}s</div>
    <ion-button (click)="start()">Iniciar</ion-button>
  `,
  changeDetection: ChangeDetectionStrategy.OnPush,
  standalone: true
})
export class TimerComponent {
  seconds = 0;
  private intervalId?: number;
  
  constructor(private cdr: ChangeDetectorRef) {}
  
  /**
   * Inicia contador
   * 
   * PROBLEMA: setInterval no dispara change detection en OnPush
   * SOLUCIÃ“N: Llamar markForCheck() manualmente
   */
  start(): void {
    this.intervalId = window.setInterval(() => {
      this.seconds++;
      this.cdr.markForCheck(); // âœ… NECESARIO para actualizar vista
    }, 1000);
  }
  
  ngOnDestroy(): void {
    if (this.intervalId) {
      clearInterval(this.intervalId);
    }
  }
}

ONPUSH CON ASYNC PIPE (RECOMENDADO):

import { Component, ChangeDetectionStrategy } from '@angular/core';
import { Observable } from 'rxjs';

@Component({
  selector: 'app-product-list',
  template: `
    <!-- âœ… Async pipe + OnPush = Mejor performance -->
    <app-product-card
      *ngFor="let product of products$ | async; trackBy: trackById"
      [product]="product">
    </app-product-card>
  `,
  changeDetection: ChangeDetectionStrategy.OnPush,
  standalone: true
})
export class ProductListComponent {
  
  // âœ… Observable para usar con async pipe
  products$: Observable<Product[]>;
  
  constructor(private productService: ProductService) {
    this.products$ = this.productService.getAll();
    
    // âŒ NO hacer esto con OnPush:
    // this.productService.getAll().subscribe(products => {
    //   this.products = products; // Requiere markForCheck()
    // });
  }
  
  trackById(index: number, item: Product): number {
    return item.id;
  }
}

MATRIZ DE DECISIÃ“N:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

| Escenario                          | Strategy    | Notas                    |
|------------------------------------|-------------|--------------------------|
| Smart component (Page)             | Default     | Gestiona estado          |
| Dumb component (Presentational)    | OnPush      | Solo inputs inmutables   |
| Componente con async pipe          | OnPush      | Ideal para performance   |
| Componente con timers/intervals    | OnPush      | Usar markForCheck()      |
| Componente con mutaciÃ³n directa    | Default     | O refactorizar a OnPush  |
| Lista de items                     | OnPush      | Con trackBy              |

MEJORES PRÃCTICAS:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ“ Usar OnPush en componentes presentacionales
âœ“ Datos inmutables (spread operator, no mutation)
âœ“ Async pipe siempre que sea posible
âœ“ TrackBy en *ngFor para listas
âœ“ markForCheck() solo cuando necesario
âœ“ Medir performance antes y despuÃ©s
âœ“ OnPush desde el inicio (mÃ¡s fÃ¡cil que migrar)

âŒ NO mutar @Input directamente
âŒ NO usar OnPush si no se puede garantizar inmutabilidad
âŒ NO abusar de markForCheck() (anti-patrÃ³n)
âŒ NO mezclar mutaciÃ³n con OnPush

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  2.2 COMPOSICIÃ“N Y REUTILIZACIÃ“N DE COMPONENTES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

OBJETIVO: Crear componentes altamente reutilizables mediante composiciÃ³n en lugar
de herencia, siguiendo el principio "Composition over Inheritance".

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 2.2.1 Content Projection (ng-content)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

CONCEPTO: Permite pasar contenido HTML al componente desde el padre.

TIPOS DE PROJECTION:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. SINGLE-SLOT PROJECTION                                                  â”‚
â”‚ Proyecta todo el contenido en un solo lugar                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

EJEMPLO: Modal Container

// src/app/shared/components/modal/modal.component.ts

import { Component, Input, Output, EventEmitter } from '@angular/core';

/**
 * Componente modal reutilizable con content projection
 * 
 * USO:
 * <app-modal [isOpen]="showModal" (close)="handleClose()">
 *   <h2>TÃ­tulo del Modal</h2>
 *   <p>Contenido personalizado aquÃ­</p>
 *   <ion-button>AcciÃ³n</ion-button>
 * </app-modal>
 */
@Component({
  selector: 'app-modal',
  template: `
    <ion-modal 
      [isOpen]="isOpen"
      (didDismiss)="onDismiss()">
      
      <ng-template>
        <ion-header>
          <ion-toolbar>
            <ion-buttons slot="end">
              <ion-button (click)="onDismiss()">
                <ion-icon name="close"></ion-icon>
              </ion-button>
            </ion-buttons>
          </ion-toolbar>
        </ion-header>
        
        <ion-content class="ion-padding">
          <!-- âœ… Proyecta todo el contenido aquÃ­ -->
          <ng-content></ng-content>
        </ion-content>
      </ng-template>
    </ion-modal>
  `,
  standalone: true,
  imports: [IonModal, IonHeader, IonToolbar, IonButtons, IonButton, IonContent, IonIcon]
})
export class ModalComponent {
  @Input() isOpen = false;
  @Output() close = new EventEmitter<void>();
  
  onDismiss(): void {
    this.close.emit();
  }
}

// USO DEL COMPONENTE:
@Component({
  selector: 'app-product-detail',
  template: `
    <ion-button (click)="showDeleteConfirm = true">
      Eliminar
    </ion-button>
    
    <!-- âœ… Contenido personalizado dentro del modal -->
    <app-modal 
      [isOpen]="showDeleteConfirm"
      (close)="showDeleteConfirm = false">
      
      <div class="delete-confirm">
        <ion-icon name="warning" color="danger" size="large"></ion-icon>
        <h2>Â¿Eliminar producto?</h2>
        <p>Esta acciÃ³n no se puede deshacer.</p>
        
        <div class="button-group">
          <ion-button fill="outline" (click)="showDeleteConfirm = false">
            Cancelar
          </ion-button>
          <ion-button color="danger" (click)="confirmDelete()">
            Eliminar
          </ion-button>
        </div>
      </div>
    </app-modal>
  `,
  standalone: true
})
export class ProductDetailPage {
  showDeleteConfirm = false;
  
  confirmDelete(): void {
    // LÃ³gica de eliminaciÃ³n
    this.showDeleteConfirm = false;
  }
}

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. MULTI-SLOT PROJECTION                                                   â”‚
â”‚ Proyecta contenido en mÃºltiples lugares usando selectores                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

EJEMPLO: Card Component con Slots

// src/app/shared/components/card/card.component.ts

import { Component, Input } from '@angular/core';

/**
 * Card component con mÃºltiples slots
 * 
 * SLOTS DISPONIBLES:
 * - header: Encabezado de la card
 * - content: Contenido principal (default)
 * - footer: Acciones o informaciÃ³n adicional
 * 
 * USO:
 * <app-card>
 *   <div header>TÃ­tulo aquÃ­</div>
 *   <p>Contenido principal</p>
 *   <div footer>Acciones aquÃ­</div>
 * </app-card>
 */
@Component({
  selector: 'app-card',
  template: `
    <ion-card [class.clickable]="clickable">
      <!-- SLOT: Header -->
      <ion-card-header *ngIf="hasHeader">
        <ng-content select="[header]"></ng-content>
      </ion-card-header>
      
      <!-- SLOT: Content (default) -->
      <ion-card-content>
        <ng-content></ng-content>
      </ion-card-content>
      
      <!-- SLOT: Footer -->
      <div class="card-footer" *ngIf="hasFooter">
        <ng-content select="[footer]"></ng-content>
      </div>
    </ion-card>
  `,
  styles: [`
    .card-footer {
      padding: 12px 16px;
      border-top: 1px solid var(--border-color);
      display: flex;
      gap: var(--spacing-sm);
      justify-content: flex-end;
    }
    
    .clickable {
      cursor: pointer;
      transition: transform var(--transition-fast);
      
      &:hover {
        transform: translateY(-2px);
      }
    }
  `],
  standalone: true,
  imports: [CommonModule, IonCard, IonCardHeader, IonCardContent]
})
export class CardComponent {
  @Input() clickable = false;
  
  // Detectar si hay contenido en los slots
  hasHeader = false;
  hasFooter = false;
  
  ngAfterContentInit(): void {
    // Se puede usar ContentChild para detectar slots
  }
}

// USO CON MÃšLTIPLES SLOTS:
@Component({
  selector: 'app-product-list',
  template: `
    <app-card *ngFor="let product of products" [clickable]="true">
      <!-- HEADER SLOT -->
      <div header>
        <h3>{{ product.nombre }}</h3>
        <ion-badge [color]="getStockColor(product)">
          {{ product.stock }} unidades
        </ion-badge>
      </div>
      
      <!-- CONTENIDO PRINCIPAL (default slot) -->
      <div class="product-info">
        <img [src]="product.imagen" [alt]="product.nombre">
        <p class="overline">{{ product.categoria.nombre }}</p>
        <p class="price">{{ product.precio | currency }}</p>
      </div>
      
      <!-- FOOTER SLOT -->
      <div footer>
        <ion-button size="small" fill="outline" (click)="edit(product)">
          Editar
        </ion-button>
        <ion-button size="small" (click)="addToCart(product)">
          Agregar
        </ion-button>
      </div>
    </app-card>
  `,
  standalone: true
})
export class ProductListComponent {
  // ...
}

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. CONDITIONAL CONTENT PROJECTION                                          â”‚
â”‚ Proyectar contenido solo si existe                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

EJEMPLO: Alert Component con Template

// src/app/shared/components/alert/alert.component.ts

import { 
  Component, 
  Input, 
  ContentChild, 
  TemplateRef 
} from '@angular/core';

/**
 * Alert component con projection condicional
 * 
 * USO:
 * <app-alert type="warning">
 *   <ion-icon name="warning" alert-icon></ion-icon>
 *   <p>Mensaje de advertencia</p>
 *   <div alert-actions>
 *     <ion-button>AcciÃ³n</ion-button>
 *   </div>
 * </app-alert>
 */
@Component({
  selector: 'app-alert',
  template: `
    <div 
      class="alert"
      [class]="'alert--' + type"
      role="alert">
      
      <!-- Icon (opcional) -->
      <div class="alert__icon" *ngIf="iconTemplate">
        <ng-container *ngTemplateOutlet="iconTemplate"></ng-container>
      </div>
      
      <!-- Content -->
      <div class="alert__content">
        <ng-content></ng-content>
      </div>
      
      <!-- Actions (opcional) -->
      <div class="alert__actions" *ngIf="actionsTemplate">
        <ng-container *ngTemplateOutlet="actionsTemplate"></ng-container>
      </div>
    </div>
  `,
  styles: [`
    .alert {
      display: flex;
      gap: var(--spacing-md);
      padding: var(--spacing-md);
      border-radius: var(--radius-md);
      border: 1px solid;
      
      &--info {
        background: var(--color-info-light);
        border-color: var(--color-info);
        color: var(--color-info-dark);
      }
      
      &--success {
        background: var(--color-success-light);
        border-color: var(--color-success);
        color: var(--color-success-dark);
      }
      
      &--warning {
        background: var(--color-warning-light);
        border-color: var(--color-warning);
        color: var(--color-warning-dark);
      }
      
      &--error {
        background: var(--color-error-light);
        border-color: var(--color-error);
        color: var(--color-error-dark);
      }
    }
  `],
  standalone: true,
  imports: [CommonModule, NgTemplateOutlet]
})
export class AlertComponent {
  @Input() type: 'info' | 'success' | 'warning' | 'error' = 'info';
  
  // Capturar templates opcionales
  @ContentChild('alertIcon') iconTemplate?: TemplateRef<any>;
  @ContentChild('alertActions') actionsTemplate?: TemplateRef<any>;
}

// USO:
@Component({
  template: `
    <!-- Alert simple -->
    <app-alert type="info">
      <p>OperaciÃ³n completada exitosamente</p>
    </app-alert>
    
    <!-- Alert con icon y acciones -->
    <app-alert type="warning">
      <ng-template #alertIcon>
        <ion-icon name="warning" size="large"></ion-icon>
      </ng-template>
      
      <p>Stock bajo en 5 productos</p>
      
      <ng-template #alertActions>
        <ion-button size="small" fill="outline">Ignorar</ion-button>
        <ion-button size="small">Ver Productos</ion-button>
      </ng-template>
    </app-alert>
  `,
  standalone: true
})
export class DashboardPage {}

MEJORES PRÃCTICAS NG-CONTENT:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ“ Usar para componentes de layout/container
âœ“ Documentar slots disponibles claramente
âœ“ Proveer slots con nombres semÃ¡nticos (header, footer, actions)
âœ“ Usar ContentChild para detectar contenido proyectado
âœ“ Combinar con @Input para configuraciÃ³n
âœ“ Ideal para wrappers de Ionic components

âŒ NO abusar (mantener componentes simples)
âŒ NO proyectar lÃ³gica compleja
âŒ NO usar para comunicaciÃ³n de datos (usar @Input/@Output)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 2.2.2 Component Composition Patterns
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

PATRÃ“N: Construir componentes complejos combinando componentes simples.

EJEMPLO: Sistema de Forms Compuesto

// â”â”â” COMPONENTE BASE: Input Field â”â”â”
// src/app/shared/components/input-field/input-field.component.ts

import { Component, Input, forwardRef } from '@angular/core';
import { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';

/**
 * Input field reutilizable con FormControl integration
 * 
 * CARACTERÃSTICAS:
 * - IntegraciÃ³n con Reactive Forms
 * - ValidaciÃ³n visual
 * - Soporte para errores
 * - Accesibilidad built-in
 */
@Component({
  selector: 'app-input-field',
  template: `
    <div class="input-field" [class.has-error]="hasError">
      <!-- Label -->
      <label 
        [for]="inputId"
        [class.required]="required">
        {{ label }}
      </label>
      
      <!-- Input -->
      <input
        [id]="inputId"
        [type]="type"
        [placeholder]="placeholder"
        [disabled]="disabled"
        [attr.aria-describedby]="hasError ? errorId : null"
        [attr.aria-invalid]="hasError"
        [(ngModel)]="value"
        (blur)="onTouched()"
        (input)="onChange($any($event.target).value)">
      
      <!-- Error message -->
      <span 
        *ngIf="hasError && errorMessage"
        [id]="errorId"
        class="error-message"
        role="alert">
        {{ errorMessage }}
      </span>
      
      <!-- Helper text -->
      <span *ngIf="!hasError && helperText" class="helper-text">
        {{ helperText }}
      </span>
    </div>
  `,
  styles: [`
    .input-field {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-xs);
      margin-bottom: var(--spacing-md);
    }
    
    label {
      font-size: 14px;
      font-weight: 500;
      color: var(--text-primary);
      
      &.required::after {
        content: ' *';
        color: var(--color-error);
      }
    }
    
    input {
      padding: var(--spacing-sm);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-sm);
      font-size: 16px;
      transition: border-color var(--transition-fast);
      
      &:focus {
        outline: none;
        border-color: var(--color-primary);
        box-shadow: 0 0 0 3px var(--color-primary-alpha);
      }
      
      &:disabled {
        background: var(--bg-disabled);
        cursor: not-allowed;
      }
    }
    
    .has-error input {
      border-color: var(--color-error);
      
      &:focus {
        box-shadow: 0 0 0 3px var(--color-error-alpha);
      }
    }
    
    .error-message {
      color: var(--color-error);
      font-size: 12px;
    }
    
    .helper-text {
      color: var(--text-tertiary);
      font-size: 12px;
    }
  `],
  providers: [
    {
      provide: NG_VALUE_ACCESSOR,
      useExisting: forwardRef(() => InputFieldComponent),
      multi: true
    }
  ],
  standalone: true,
  imports: [CommonModule, FormsModule]
})
export class InputFieldComponent implements ControlValueAccessor {
  @Input() label = '';
  @Input() type: 'text' | 'email' | 'password' | 'number' = 'text';
  @Input() placeholder = '';
  @Input() required = false;
  @Input() helperText = '';
  @Input() errorMessage = '';
  @Input() hasError = false;
  
  inputId = `input-${Math.random().toString(36).substr(2, 9)}`;
  errorId = `${this.inputId}-error`;
  
  value = '';
  disabled = false;
  
  onChange = (value: any) => {};
  onTouched = () => {};
  
  writeValue(value: any): void {
    this.value = value || '';
  }
  
  registerOnChange(fn: any): void {
    this.onChange = fn;
  }
  
  registerOnTouched(fn: any): void {
    this.onTouched = fn;
  }
  
  setDisabledState(isDisabled: boolean): void {
    this.disabled = isDisabled;
  }
}

// â”â”â” COMPONENTE COMPUESTO: Product Form â”â”â”
// src/app/modules/inventory/components/product-form.component.ts

import { Component, Input, Output, EventEmitter } from '@angular/core';
import { FormBuilder, FormGroup, Validators } from '@angular/forms';
import { Product } from '@models/product.model';

/**
 * Formulario de producto usando componentes compuestos
 * 
 * COMPOSICIÃ“N:
 * - InputFieldComponent para campos de texto
 * - SelectFieldComponent para categorÃ­as
 * - FileUploadComponent para imagen
 */
@Component({
  selector: 'app-product-form',
  template: `
    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      
      <!-- Campo: Nombre -->
      <app-input-field
        label="Nombre del producto"
        placeholder="Ej: Paracetamol 500mg"
        [required]="true"
        [hasError]="hasError('nombre')"
        [errorMessage]="getError('nombre')"
        formControlName="nombre">
      </app-input-field>
      
      <!-- Campo: CÃ³digo -->
      <app-input-field
        label="CÃ³digo de barras"
        type="text"
        placeholder="Ej: 7501234567890"
        [required]="true"
        [hasError]="hasError('codigo')"
        [errorMessage]="getError('codigo')"
        helperText="CÃ³digo de barras EAN-13"
        formControlName="codigo">
      </app-input-field>
      
      <!-- Campo: Precio -->
      <app-input-field
        label="Precio"
        type="number"
        placeholder="0.00"
        [required]="true"
        [hasError]="hasError('precio')"
        [errorMessage]="getError('precio')"
        formControlName="precio">
      </app-input-field>
      
      <!-- Campo: Stock -->
      <app-input-field
        label="Stock"
        type="number"
        placeholder="0"
        [required]="true"
        [hasError]="hasError('stock')"
        [errorMessage]="getError('stock')"
        formControlName="stock">
      </app-input-field>
      
      <!-- Campo: Stock MÃ­nimo -->
      <app-input-field
        label="Stock MÃ­nimo"
        type="number"
        placeholder="0"
        [required]="true"
        helperText="Alerta cuando stock sea menor"
        formControlName="stockMinimo">
      </app-input-field>
      
      <!-- Campo: CategorÃ­a -->
      <app-select-field
        label="CategorÃ­a"
        placeholder="Selecciona una categorÃ­a"
        [options]="categories"
        [required]="true"
        [hasError]="hasError('categoriaId')"
        [errorMessage]="getError('categoriaId')"
        formControlName="categoriaId">
      </app-select-field>
      
      <!-- Campo: Imagen -->
      <app-file-upload
        label="Imagen del producto"
        accept="image/*"
        [preview]="true"
        [currentFile]="product?.imagen"
        (fileSelected)="onImageSelected($event)">
      </app-file-upload>
      
      <!-- Botones -->
      <div class="form-actions">
        <ion-button 
          type="button"
          fill="outline"
          (click)="cancel.emit()">
          Cancelar
        </ion-button>
        
        <ion-button 
          type="submit"
          [disabled]="form.invalid || loading">
          <ion-spinner *ngIf="loading" slot="start"></ion-spinner>
          {{ product ? 'Actualizar' : 'Guardar' }}
        </ion-button>
      </div>
    </form>
  `,
  styles: [`
    form {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-md);
    }
    
    .form-actions {
      display: flex;
      gap: var(--spacing-sm);
      justify-content: flex-end;
      margin-top: var(--spacing-lg);
    }
  `],
  standalone: true,
  imports: [
    CommonModule,
    ReactiveFormsModule,
    IonButton,
    IonSpinner,
    InputFieldComponent,
    SelectFieldComponent,
    FileUploadComponent
  ]
})
export class ProductFormComponent {
  @Input() product?: Product;
  @Input() categories: Category[] = [];
  @Output() save = new EventEmitter<Product>();
  @Output() cancel = new EventEmitter<void>();
  
  form: FormGroup;
  loading = false;
  
  constructor(private fb: FormBuilder) {
    this.form = this.createForm();
  }
  
  ngOnInit(): void {
    if (this.product) {
      this.form.patchValue(this.product);
    }
  }
  
  /**
   * Crea el formulario con validaciones
   */
  private createForm(): FormGroup {
    return this.fb.group({
      nombre: ['', [Validators.required, Validators.minLength(3)]],
      codigo: ['', [Validators.required, Validators.pattern(/^\d{13}$/)]],
      precio: [0, [Validators.required, Validators.min(0.01)]],
      stock: [0, [Validators.required, Validators.min(0)]],
      stockMinimo: [0, [Validators.required, Validators.min(0)]],
      categoriaId: ['', Validators.required],
      imagen: ['']
    });
  }
  
  /**
   * Verifica si un campo tiene error y fue tocado
   */
  hasError(fieldName: string): boolean {
    const field = this.form.get(fieldName);
    return !!(field && field.invalid && field.touched);
  }
  
  /**
   * Obtiene el mensaje de error para un campo
   */
  getError(fieldName: string): string {
    const field = this.form.get(fieldName);
    
    if (!field || !field.errors || !field.touched) {
      return '';
    }
    
    if (field.errors['required']) {
      return 'Este campo es requerido';
    }
    
    if (field.errors['minlength']) {
      const min = field.errors['minlength'].requiredLength;
      return `MÃ­nimo ${min} caracteres`;
    }
    
    if (field.errors['min']) {
      const min = field.errors['min'].min;
      return `El valor mÃ­nimo es ${min}`;
    }
    
    if (field.errors['pattern']) {
      return 'Formato invÃ¡lido';
    }
    
    return 'Campo invÃ¡lido';
  }
  
  /**
   * Maneja selecciÃ³n de imagen
   */
  onImageSelected(file: File): void {
    // LÃ³gica para subir imagen
    this.form.patchValue({ imagen: file });
  }
  
  /**
   * EnvÃ­a el formulario
   */
  onSubmit(): void {
    if (this.form.valid) {
      this.loading = true;
      const formValue = this.form.value;
      
      const product: Product = {
        ...this.product,
        ...formValue
      };
      
      this.save.emit(product);
    } else {
      // Marcar todos como tocados para mostrar errores
      Object.keys(this.form.controls).forEach(key => {
        this.form.get(key)?.markAsTouched();
      });
    }
  }
}

VENTAJAS DE COMPOSICIÃ“N:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ“ REUTILIZACIÃ“N: Componentes pequeÃ±os reutilizables
âœ“ TESTING: MÃ¡s fÃ¡cil testear componentes simples
âœ“ MANTENIBILIDAD: Cambios aislados en componentes especÃ­ficos
âœ“ LEGIBILIDAD: CÃ³digo mÃ¡s declarativo y claro
âœ“ ESCALABILIDAD: FÃ¡cil agregar nuevos componentes
âœ“ CONSISTENCIA: UI uniforme en toda la app

PRINCIPIOS:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ“ Componentes pequeÃ±os y enfocados (< 200 lÃ­neas)
âœ“ Un propÃ³sito por componente (SRP)
âœ“ ComunicaciÃ³n clara (@Input/@Output)
âœ“ Componentes presentacionales sin lÃ³gica de negocio
âœ“ ComposiciÃ³n sobre herencia
âœ“ DRY (Don't Repeat Yourself)

âŒ NO crear componentes monolÃ­ticos
âŒ NO acoplar componentes fuertemente
âŒ NO duplicar lÃ³gica de validaciÃ³n
âŒ NO mezclar responsabilidades

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 2.2.3 Directivas Personalizadas
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

OBJETIVO: Extender funcionalidad de elementos DOM de forma reutilizable.

TIPOS DE DIRECTIVAS:

1. **Attribute Directives**: Modifican apariencia/comportamiento
2. **Structural Directives**: Modifican estructura del DOM
3. **Component Directives**: Componentes (ya cubierto)

EJEMPLO 1: Auto-Focus Directive

UBICACIÃ“N: src/app/shared/directives/auto-focus.directive.ts

import { Directive, ElementRef, OnInit, Input } from '@angular/core';

/**
 * Directiva para auto-focus en inputs
 * 
 * USO:
 * <input appAutoFocus>
 * <input [appAutoFocus]="shouldFocus">
 * <input appAutoFocus [focusDelay]="500">
 */
@Directive({
  selector: '[appAutoFocus]',
  standalone: true
})
export class AutoFocusDirective implements OnInit {
  
  /**
   * CondiciÃ³n para aplicar focus (default: true)
   */
  @Input() appAutoFocus: boolean = true;
  
  /**
   * Delay en ms antes de hacer focus
   */
  @Input() focusDelay = 0;
  
  constructor(private el: ElementRef<HTMLElement>) {}
  
  ngOnInit(): void {
    if (this.appAutoFocus) {
      setTimeout(() => {
        this.el.nativeElement.focus();
      }, this.focusDelay);
    }
  }
}

// USO:
@Component({
  template: `
    <!-- Focus automÃ¡tico al cargar -->
    <ion-input appAutoFocus placeholder="Nombre"></ion-input>
    
    <!-- Focus condicional -->
    <ion-input 
      [appAutoFocus]="isEditMode"
      placeholder="Email">
    </ion-input>
    
    <!-- Focus con delay -->
    <ion-input 
      appAutoFocus
      [focusDelay]="300"
      placeholder="BÃºsqueda">
    </ion-input>
  `,
  standalone: true,
  imports: [IonInput, AutoFocusDirective]
})
export class LoginPage {
  isEditMode = false;
}

EJEMPLO 2: Click Outside Directive

UBICACIÃ“N: src/app/shared/directives/click-outside.directive.ts

import { 
  Directive, 
  ElementRef, 
  Output, 
  EventEmitter, 
  HostListener 
} from '@angular/core';

/**
 * Detecta clicks fuera del elemento
 * 
 * USO:
 * <div (clickOutside)="close()">
 *   Contenido del dropdown
 * </div>
 */
@Directive({
  selector: '[clickOutside]',
  standalone: true
})
export class ClickOutsideDirective {
  
  @Output() clickOutside = new EventEmitter<void>();
  
  constructor(private elementRef: ElementRef) {}
  
  @HostListener('document:click', ['$event.target'])
  onClick(target: HTMLElement): void {
    const clickedInside = this.elementRef.nativeElement.contains(target);
    
    if (!clickedInside) {
      this.clickOutside.emit();
    }
  }
}

// USO:
@Component({
  template: `
    <ion-button (click)="isOpen = !isOpen">
      {{ selectedOption }}
      <ion-icon name="chevron-down"></ion-icon>
    </ion-button>
    
    <!-- Dropdown que se cierra al hacer click fuera -->
    <div 
      *ngIf="isOpen"
      class="dropdown"
      (clickOutside)="isOpen = false">
      
      <ion-item *ngFor="let option of options" (click)="select(option)">
        {{ option }}
      </ion-item>
    </div>
  `,
  standalone: true,
  imports: [CommonModule, IonButton, IonIcon, IonItem, ClickOutsideDirective]
})
export class CustomSelectComponent {
  isOpen = false;
  selectedOption = 'Selecciona una opciÃ³n';
  options = ['OpciÃ³n 1', 'OpciÃ³n 2', 'OpciÃ³n 3'];
  
  select(option: string): void {
    this.selectedOption = option;
    this.isOpen = false;
  }
}

EJEMPLO 3: Lazy Load Image Directive

UBICACIÃ“N: src/app/shared/directives/lazy-image.directive.ts

import { 
  Directive, 
  ElementRef, 
  Input, 
  Renderer2,
  OnInit 
} from '@angular/core';

/**
 * Lazy loading de imÃ¡genes con IntersectionObserver
 * 
 * BENEFICIOS:
 * - Mejora performance inicial
 * - Reduce uso de ancho de banda
 * - Mejor experiencia en conexiones lentas
 * 
 * USO:
 * <img 
 *   appLazyImage
 *   [lazyLoad]="imageUrl"
 *   [placeholder]="placeholderUrl">
 */
@Directive({
  selector: 'img[appLazyImage]',
  standalone: true
})
export class LazyImageDirective implements OnInit {
  
  @Input() lazyLoad!: string;
  @Input() placeholder = 'assets/images/placeholder.png';
  
  private observer?: IntersectionObserver;
  
  constructor(
    private el: ElementRef<HTMLImageElement>,
    private renderer: Renderer2
  ) {}
  
  ngOnInit(): void {
    // Mostrar placeholder inicialmente
    this.renderer.setAttribute(
      this.el.nativeElement,
      'src',
      this.placeholder
    );
    
    // Configurar IntersectionObserver
    this.observer = new IntersectionObserver(
      entries => this.onIntersection(entries),
      {
        rootMargin: '50px' // Cargar 50px antes de que sea visible
      }
    );
    
    this.observer.observe(this.el.nativeElement);
  }
  
  ngOnDestroy(): void {
    if (this.observer) {
      this.observer.disconnect();
    }
  }
  
  private onIntersection(entries: IntersectionObserverEntry[]): void {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        this.loadImage();
        
        // Dejar de observar una vez cargada
        if (this.observer) {
          this.observer.unobserve(this.el.nativeElement);
        }
      }
    });
  }
  
  private loadImage(): void {
    const img = new Image();
    
    img.onload = () => {
      // Imagen cargada exitosamente
      this.renderer.setAttribute(
        this.el.nativeElement,
        'src',
        this.lazyLoad
      );
      this.renderer.addClass(this.el.nativeElement, 'loaded');
    };
    
    img.onerror = () => {
      // Error al cargar, mantener placeholder
      console.error('Error loading image:', this.lazyLoad);
    };
    
    img.src = this.lazyLoad;
  }
}

// USO:
@Component({
  template: `
    <div class="product-grid">
      <div *ngFor="let product of products" class="product-card">
        <!-- âœ… Lazy load de imÃ¡genes -->
        <img
          appLazyImage
          [lazyLoad]="product.imagen"
          [placeholder]="'assets/images/product-placeholder.png'"
          [alt]="product.nombre"
          class="product-image">
        
        <h3>{{ product.nombre }}</h3>
        <p>{{ product.precio | currency }}</p>
      </div>
    </div>
  `,
  styles: [`
    .product-image {
      width: 100%;
      height: 200px;
      object-fit: cover;
      opacity: 0;
      transition: opacity 0.3s ease;
      
      &.loaded {
        opacity: 1;
      }
    }
  `],
  standalone: true,
  imports: [CommonModule, LazyImageDirective]
})
export class ProductGridComponent {
  products: Product[] = [];
}

EJEMPLO 4: Debounce Input Directive

UBICACIÃ“N: src/app/shared/directives/debounce-input.directive.ts

import { 
  Directive, 
  ElementRef, 
  Output, 
  EventEmitter,
  OnInit,
  OnDestroy,
  Input
} from '@angular/core';
import { fromEvent, Subject } from 'rxjs';
import { debounceTime, takeUntil } from 'rxjs/operators';

/**
 * Debounce para inputs (bÃºsqueda, filtros)
 * 
 * BENEFICIOS:
 * - Reduce llamadas API innecesarias
 * - Mejora UX en bÃºsquedas
 * - Menor carga en servidor
 * 
 * USO:
 * <input 
 *   appDebounceInput
 *   [debounceTime]="500"
 *   (debounceInput)="search($event)">
 */
@Directive({
  selector: '[appDebounceInput]',
  standalone: true
})
export class DebounceInputDirective implements OnInit, OnDestroy {
  
  @Input() debounceTime = 300;
  @Output() debounceInput = new EventEmitter<string>();
  
  private destroy$ = new Subject<void>();
  
  constructor(private el: ElementRef<HTMLInputElement>) {}
  
  ngOnInit(): void {
    fromEvent<InputEvent>(this.el.nativeElement, 'input')
      .pipe(
        debounceTime(this.debounceTime),
        takeUntil(this.destroy$)
      )
      .subscribe(() => {
        const value = this.el.nativeElement.value;
        this.debounceInput.emit(value);
      });
  }
  
  ngOnDestroy(): void {
    this.destroy$.next();
    this.destroy$.complete();
  }
}

// USO:
@Component({
  template: `
    <ion-searchbar
      appDebounceInput
      [debounceTime]="500"
      (debounceInput)="onSearch($event)"
      placeholder="Buscar productos...">
    </ion-searchbar>
    
    <div *ngIf="searching">
      <ion-spinner></ion-spinner>
    </div>
    
    <div class="results">
      <app-product-card 
        *ngFor="let product of searchResults"
        [product]="product">
      </app-product-card>
    </div>
  `,
  standalone: true
})
export class ProductSearchComponent {
  searchResults: Product[] = [];
  searching = false;
  
  /**
   * Busca productos (solo se llama despuÃ©s del debounce)
   */
  onSearch(query: string): void {
    if (query.length < 3) {
      this.searchResults = [];
      return;
    }
    
    this.searching = true;
    
    this.productService.search(query).subscribe({
      next: (results) => {
        this.searchResults = results;
        this.searching = false;
      },
      error: () => {
        this.searching = false;
      }
    });
  }
}

MEJORES PRÃCTICAS DIRECTIVAS:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ“ Prefijo consistente (app, gp, etc.)
âœ“ Un propÃ³sito especÃ­fico por directiva
âœ“ Documentar uso y parÃ¡metros
âœ“ Limpiar listeners en ngOnDestroy
âœ“ Usar HostListener/HostBinding cuando sea posible
âœ“ Directivas standalone para mejor tree-shaking
âœ“ Testing unitario de directivas

âŒ NO manipular DOM directamente (usar Renderer2)
âŒ NO crear directivas muy complejas
âŒ NO olvidar unsubscribe
âŒ NO abusar de directivas (a veces un componente es mejor)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  2.3 STANDALONE COMPONENTS Y MODERNIZACIÃ“N
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CONTEXTO: Angular 18 usa Standalone Components como estÃ¡ndar. GestPharma debe
aprovechar esta arquitectura moderna para mejor tree-shaking y simplicidad.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 2.3.1 Estructura de Standalone Components
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

VENTAJAS DE STANDALONE:
â€¢ Menor boilerplate (sin NgModule)
â€¢ Mejor tree-shaking (importa solo lo necesario)
â€¢ MÃ¡s simple de entender y mantener
â€¢ Lazy loading mÃ¡s directo
â€¢ Mejor para testing (dependencias explÃ­citas)

ANATOMÃA DE UN STANDALONE COMPONENT:

import { Component } from '@angular/core';
import { CommonModule } from '@angular/common';
import { IonHeader, IonToolbar, IonTitle, IonContent } from '@ionic/angular/standalone';
import { ProductCardComponent } from '@shared/components/product-card.component';
import { ProductService } from '@services/product.service';

/**
 * Componente standalone moderno
 * 
 * CARACTERÃSTICAS:
 * - standalone: true (marca como standalone)
 * - imports: [] (todas las dependencias explÃ­citas)
 * - Sin necesidad de NgModule
 */
@Component({
  selector: 'app-product-list',
  templateUrl: './product-list.page.html',
  styleUrls: ['./product-list.page.scss'],
  standalone: true, // âœ… Marca como standalone
  imports: [
    // âœ… MÃ³dulos comunes
    CommonModule,
    
    // âœ… Componentes de Ionic (standalone)
    IonHeader,
    IonToolbar,
    IonTitle,
    IonContent,
    
    // âœ… Componentes custom
    ProductCardComponent
  ]
})
export class ProductListPage {
  products$ = this.productService.getAll();
  
  constructor(private productService: ProductService) {}
}

REGLAS DE ORO:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ“ TODOS los componentes deben ser standalone
âœ“ Importar solo lo que se usa en el template
âœ“ Ionic components desde @ionic/angular/standalone
âœ“ CommonModule cuando uses *ngIf, *ngFor, pipes
âœ“ ReactiveFormsModule/FormsModule cuando uses formularios
âœ“ Importar pipes personalizados explÃ­citamente

âŒ NO crear NgModules nuevos (legacy)
âŒ NO importar mÃ³dulos completos innecesarios
âŒ NO olvidar CommonModule (error comÃºn)
âŒ NO importar servicios en imports[] (solo en constructor)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 2.3.2 Imports Optimization
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

OBJETIVO: Importar solo componentes necesarios para reducir bundle size.

âŒ INCORRECTO - Importar mÃ³dulo completo:

import { IonicModule } from '@ionic/angular'; // âŒ Importa TODO Ionic

@Component({
  standalone: true,
  imports: [IonicModule] // âŒ Bundle innecesariamente grande
})
export class ProductPage {}

âœ… CORRECTO - Importar componentes especÃ­ficos:

import { 
  IonHeader, 
  IonToolbar, 
  IonTitle, 
  IonContent,
  IonButton,
  IonIcon
} from '@ionic/angular/standalone'; // âœ… Solo lo necesario

@Component({
  standalone: true,
  imports: [
    CommonModule,
    IonHeader,
    IonToolbar,
    IonTitle,
    IonContent,
    IonButton,
    IonIcon
  ]
})
export class ProductPage {}

PATRÃ“N DE IMPORTS COMUNES:

UBICACIÃ“N: src/app/shared/imports/common.imports.ts

/**
 * Imports comunes para componentes
 * Facilita importaciÃ³n de dependencias frecuentes
 */
import { CommonModule } from '@angular/common';
import { FormsModule, ReactiveFormsModule } from '@angular/forms';
import { RouterModule } from '@angular/router';

// Ionic Components mÃ¡s usados
import {
  IonHeader,
  IonToolbar,
  IonTitle,
  IonContent,
  IonButton,
  IonIcon,
  IonList,
  IonItem,
  IonLabel,
  IonCard,
  IonCardHeader,
  IonCardTitle,
  IonCardContent,
  IonSpinner,
  IonButtons,
  IonBackButton
} from '@ionic/angular/standalone';

/**
 * Imports bÃ¡sicos para pÃ¡ginas
 */
export const PAGE_IMPORTS = [
  CommonModule,
  RouterModule,
  IonHeader,
  IonToolbar,
  IonTitle,
  IonContent,
  IonButtons,
  IonBackButton
] as const;

/**
 * Imports para formularios
 */
export const FORM_IMPORTS = [
  CommonModule,
  FormsModule,
  ReactiveFormsModule,
  IonButton,
  IonIcon
] as const;

/**
 * Imports para listas
 */
export const LIST_IMPORTS = [
  CommonModule,
  IonList,
  IonItem,
  IonLabel,
  IonIcon
] as const;

// USO:
import { PAGE_IMPORTS } from '@shared/imports/common.imports';

@Component({
  standalone: true,
  imports: [
    ...PAGE_IMPORTS,
    ProductCardComponent // + componentes especÃ­ficos
  ]
})
export class ProductListPage {}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 2.3.3 Dependency Injection Moderna
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

EVOLUCIÃ“N: Angular 14+ introduce inject() como alternativa al constructor.

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PATRÃ“N CLÃSICO (Constructor Injection)                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

@Component({
  selector: 'app-product-list',
  standalone: true
})
export class ProductListPage {
  
  // âŒ Constructor puede volverse largo
  constructor(
    private productService: ProductService,
    private cartService: CartService,
    private toastService: ToastService,
    private router: Router,
    private activatedRoute: ActivatedRoute
  ) {}
}

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PATRÃ“N MODERNO (inject() Function)                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

import { Component, inject } from '@angular/core';

@Component({
  selector: 'app-product-list',
  standalone: true
})
export class ProductListPage {
  
  // âœ… InyecciÃ³n moderna con inject()
  private productService = inject(ProductService);
  private cartService = inject(CartService);
  private toastService = inject(ToastService);
  private router = inject(Router);
  private route = inject(ActivatedRoute);
  
  // âœ… MÃ¡s conciso y legible
  // âœ… Funciona en funciones y constructores
  // âœ… Mejor para functional programming
}

VENTAJAS DE INJECT():
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ“ Menos boilerplate
âœ“ MÃ¡s legible (dependencias como propiedades)
âœ“ Funciona en contextos donde constructor no estÃ¡ disponible
âœ“ Mejor tipado en algunos casos
âœ“ Ideal para functional reactive patterns

PATRÃ“N HÃBRIDO (RECOMENDADO):

import { Component, inject } from '@angular/core';

@Component({
  selector: 'app-product-detail',
  standalone: true
})
export class ProductDetailPage {
  
  // âœ… Servicios con inject()
  private productService = inject(ProductService);
  private route = inject(ActivatedRoute);
  private router = inject(Router);
  
  // âœ… Propiedades derivadas
  productId = Number(this.route.snapshot.paramMap.get('id'));
  product$ = this.productService.getById(this.productId);
  
  // âœ… MÃ©todos simples
  goBack(): void {
    this.router.navigate(['/inventory']);
  }
  
  deleteProduct(): void {
    this.productService.delete(this.productId).subscribe({
      next: () => this.goBack(),
      error: (err) => console.error(err)
    });
  }
}

PROVIDEDIN ROOT vs COMPONENT:

// â”â”â” SINGLETON SERVICE (providedIn: 'root') â”â”â”

@Injectable({
  providedIn: 'root' // âœ… Una sola instancia en toda la app
})
export class AuthService {
  // Estado compartido globalmente
}

// â”â”â” COMPONENT-LEVEL SERVICE â”â”â”

@Component({
  selector: 'app-product-form',
  standalone: true,
  providers: [ProductFormService] // âœ… Instancia Ãºnica por componente
})
export class ProductFormPage {
  private formService = inject(ProductFormService);
  
  // El servicio se destruye con el componente
}

INJECTION TOKENS PERSONALIZADOS:

UBICACIÃ“N: src/app/core/tokens/app.tokens.ts

import { InjectionToken } from '@angular/core';

/**
 * Token para configuraciÃ³n de API
 */
export const API_CONFIG = new InjectionToken<ApiConfig>('api.config', {
  providedIn: 'root',
  factory: () => ({
    baseUrl: environment.apiUrl,
    timeout: 30000
  })
});

/**
 * Token para configuraciÃ³n de paginaciÃ³n
 */
export const PAGINATION_CONFIG = new InjectionToken<PaginationConfig>(
  'pagination.config',
  {
    providedIn: 'root',
    factory: () => ({
      pageSize: 20,
      pageSizeOptions: [10, 20, 50, 100]
    })
  }
);

// USO:
@Component({
  selector: 'app-product-list',
  standalone: true
})
export class ProductListPage {
  private apiConfig = inject(API_CONFIG);
  private paginationConfig = inject(PAGINATION_CONFIG);
  
  pageSize = this.paginationConfig.pageSize;
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 2.3.4 Pipes Personalizados
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

OBJETIVO: Crear pipes reutilizables para transformaciones de datos en templates.

EJEMPLO 1: Pipe de Tiempo Relativo

UBICACIÃ“N: src/app/shared/pipes/time-ago.pipe.ts

import { Pipe, PipeTransform } from '@angular/core';

/**
 * Convierte fecha a tiempo relativo (ej: "hace 5 minutos")
 * 
 * USO:
 * {{ sale.fecha | timeAgo }}
 * // Output: "hace 5 minutos"
 */
@Pipe({
  name: 'timeAgo',
  standalone: true,
  pure: true // âœ… Pure pipe para mejor performance
})
export class TimeAgoPipe implements PipeTransform {
  
  transform(value: Date | string | number): string {
    if (!value) return '';
    
    const date = new Date(value);
    const now = new Date();
    const seconds = Math.floor((now.getTime() - date.getTime()) / 1000);
    
    // Menos de 1 minuto
    if (seconds < 60) {
      return 'hace unos segundos';
    }
    
    // Menos de 1 hora
    const minutes = Math.floor(seconds / 60);
    if (minutes < 60) {
      return `hace ${minutes} minuto${minutes > 1 ? 's' : ''}`;
    }
    
    // Menos de 1 dÃ­a
    const hours = Math.floor(minutes / 60);
    if (hours < 24) {
      return `hace ${hours} hora${hours > 1 ? 's' : ''}`;
    }
    
    // Menos de 1 semana
    const days = Math.floor(hours / 24);
    if (days < 7) {
      return `hace ${days} dÃ­a${days > 1 ? 's' : ''}`;
    }
    
    // Menos de 1 mes
    const weeks = Math.floor(days / 7);
    if (weeks < 4) {
      return `hace ${weeks} semana${weeks > 1 ? 's' : ''}`;
    }
    
    // MÃ¡s de 1 mes - mostrar fecha
    return date.toLocaleDateString('es-MX');
  }
}

EJEMPLO 2: Pipe de BÃºsqueda/Filtro

UBICACIÃ“N: src/app/shared/pipes/filter.pipe.ts

import { Pipe, PipeTransform } from '@angular/core';

/**
 * Filtra array por bÃºsqueda en propiedades
 * 
 * USO:
 * *ngFor="let product of products | filter:searchTerm:'nombre'"
 * 
 * âš ï¸ ADVERTENCIA: No usar en listas grandes (performance)
 * Para listas grandes, filtrar en el componente
 */
@Pipe({
  name: 'filter',
  standalone: true,
  pure: false // âœ… Impure para detectar cambios en arrays
})
export class FilterPipe implements PipeTransform {
  
  transform<T>(
    items: T[],
    searchTerm: string,
    properties: string | string[]
  ): T[] {
    if (!items || !searchTerm) {
      return items;
    }
    
    const term = searchTerm.toLowerCase();
    const props = Array.isArray(properties) ? properties : [properties];
    
    return items.filter(item => {
      return props.some(prop => {
        const value = this.getNestedProperty(item, prop);
        return value && value.toLowerCase().includes(term);
      });
    });
  }
  
  /**
   * Obtiene propiedad anidada (ej: "categoria.nombre")
   */
  private getNestedProperty(obj: any, path: string): string {
    return path.split('.').reduce((prev, curr) => {
      return prev ? prev[curr] : null;
    }, obj)?.toString() || '';
  }
}

EJEMPLO 3: Pipe de Estado de Stock

UBICACIÃ“N: src/app/shared/pipes/stock-status.pipe.ts

import { Pipe, PipeTransform } from '@angular/core';

export type StockStatus = 'out-of-stock' | 'low' | 'medium' | 'high';

/**
 * Determina el estado del stock
 * 
 * USO:
 * {{ product | stockStatus }}
 * // Output: "low" | "medium" | "high" | "out-of-stock"
 * 
 * <ion-badge [color]="(product | stockStatus) === 'low' ? 'warning' : 'success'">
 *   {{ product.stock }}
 * </ion-badge>
 */
@Pipe({
  name: 'stockStatus',
  standalone: true,
  pure: true
})
export class StockStatusPipe implements PipeTransform {
  
  transform(product: { stock: number; stockMinimo: number }): StockStatus {
    if (!product) return 'out-of-stock';
    
    const { stock, stockMinimo } = product;
    
    if (stock === 0) {
      return 'out-of-stock';
    }
    
    if (stock <= stockMinimo) {
      return 'low';
    }
    
    if (stock <= stockMinimo * 2) {
      return 'medium';
    }
    
    return 'high';
  }
}

EJEMPLO 4: Pipe de Highlight de BÃºsqueda

UBICACIÃ“N: src/app/shared/pipes/highlight.pipe.ts

import { Pipe, PipeTransform } from '@angular/core';
import { DomSanitizer, SafeHtml } from '@angular/platform-browser';

/**
 * Resalta tÃ©rminos de bÃºsqueda en texto
 * 
 * USO:
 * <p [innerHTML]="product.nombre | highlight:searchTerm"></p>
 * // "Para<mark>cet</mark>amol" si searchTerm = "cet"
 */
@Pipe({
  name: 'highlight',
  standalone: true,
  pure: true
})
export class HighlightPipe implements PipeTransform {
  
  constructor(private sanitizer: DomSanitizer) {}
  
  transform(text: string, search: string): SafeHtml {
    if (!search || !text) {
      return text;
    }
    
    const pattern = new RegExp(search, 'gi');
    const highlighted = text.replace(
      pattern,
      match => `<mark class="highlight">${match}</mark>`
    );
    
    return this.sanitizer.sanitize(1, highlighted) || text;
  }
}

// CSS para highlight:
.highlight {
  background-color: var(--color-primary-light);
  color: var(--color-primary-dark);
  padding: 2px 4px;
  border-radius: 2px;
  font-weight: 500;
}

EJEMPLO 5: Pipe de Truncate

UBICACIÃ“N: src/app/shared/pipes/truncate.pipe.ts

import { Pipe, PipeTransform } from '@angular/core';

/**
 * Trunca texto largo con ellipsis
 * 
 * USO:
 * {{ product.descripcion | truncate:100 }}
 * {{ product.descripcion | truncate:50:'...' }}
 */
@Pipe({
  name: 'truncate',
  standalone: true,
  pure: true
})
export class TruncatePipe implements PipeTransform {
  
  transform(
    value: string,
    limit = 50,
    ellipsis = '...'
  ): string {
    if (!value) return '';
    
    if (value.length <= limit) {
      return value;
    }
    
    return value.substring(0, limit).trim() + ellipsis;
  }
}

MEJORES PRÃCTICAS PIPES:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ“ Pure pipes por defecto (mejor performance)
âœ“ Impure solo cuando necesario (arrays, objetos mutables)
âœ“ Standalone: true para todos los pipes
âœ“ Nombre descriptivo y conciso
âœ“ Documentar parÃ¡metros y ejemplos de uso
âœ“ Manejar casos null/undefined
âœ“ Testing unitario de pipes

âŒ NO hacer operaciones pesadas en pipes
âŒ NO filtrar listas grandes en pipes (hacerlo en componente)
âŒ NO hacer llamadas HTTP en pipes
âŒ NO usar impure pipes sin necesidad (performance)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  2.4 RXJS PATTERNS Y BEST PRACTICES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

OBJETIVO: Dominar RxJS para manejo reactivo de datos y estado.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 2.4.1 Operadores RxJS Esenciales
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TRANSFORMATION OPERATORS                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

// â”â”â” MAP: Transforma cada valor â”â”â”
import { map } from 'rxjs/operators';

this.products$ = this.productService.getAll().pipe(
  map(products => products.filter(p => p.stock > 0))
);

// â”â”â” PLUCK: Extrae propiedad (deprecated, usar map) â”â”â”
// Antes:
// this.names$ = this.products$.pipe(pluck('nombre'));

// Ahora:
this.names$ = this.products$.pipe(
  map(products => products.map(p => p.nombre))
);

// â”â”â” SWITCHMAP: Cancela observable anterior â”â”â”
// Ideal para bÃºsquedas (cancela request anterior si usuario sigue escribiendo)
import { switchMap } from 'rxjs/operators';

this.searchControl.valueChanges.pipe(
  debounceTime(300),
  switchMap(query => this.productService.search(query)) // âœ… Cancela request anterior
).subscribe(results => {
  this.searchResults = results;
});

// â”â”â” MERGEMAP: No cancela, ejecuta todos â”â”â”
// Ideal para acciones independientes
import { mergeMap } from 'rxjs/operators';

this.selectedProducts$.pipe(
  mergeMap(products => 
    forkJoin(products.map(p => this.productService.delete(p.id)))
  )
).subscribe(() => {
  console.log('Todos eliminados');
});

// â”â”â” CONCATMAP: Espera a que termine anterior â”â”â”
// Ideal para operaciones que deben ser secuenciales
import { concatMap } from 'rxjs/operators';

this.queue$.pipe(
  concatMap(item => this.processItem(item)) // âœ… Procesa uno por uno en orden
).subscribe();

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FILTERING OPERATORS                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

// â”â”â” FILTER: Filtra valores â”â”â”
import { filter } from 'rxjs/operators';

this.products$.pipe(
  filter(products => products.length > 0) // âœ… Solo emite si hay productos
).subscribe();

// â”â”â” DISTINCTUNTILCHANGED: Solo emite si cambiÃ³ â”â”â”
import { distinctUntilChanged } from 'rxjs/operators';

this.searchControl.valueChanges.pipe(
  distinctUntilChanged() // âœ… No emite si valor es igual al anterior
).subscribe();

// â”â”â” DEBOUNCETIME: Espera tiempo sin eventos â”â”â”
import { debounceTime } from 'rxjs/operators';

this.searchControl.valueChanges.pipe(
  debounceTime(300) // âœ… Espera 300ms despuÃ©s del Ãºltimo evento
).subscribe();

// â”â”â” THROTTLETIME: Emite mÃ¡ximo cada X ms â”â”â”
import { throttleTime } from 'rxjs/operators';

fromEvent(window, 'scroll').pipe(
  throttleTime(200) // âœ… MÃ¡ximo cada 200ms
).subscribe(() => {
  console.log('Scroll event');
});

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ COMBINATION OPERATORS                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

// â”â”â” COMBINELATEST: Emite cuando cualquiera emite â”â”â”
import { combineLatest } from 'rxjs';

combineLatest([
  this.products$,
  this.categories$,
  this.searchTerm$
]).pipe(
  map(([products, categories, searchTerm]) => {
    // Combinar y procesar
    return this.filterProducts(products, categories, searchTerm);
  })
).subscribe();

// â”â”â” FORKJOIN: Espera a que todos completen â”â”â”
import { forkJoin } from 'rxjs';

forkJoin({
  products: this.productService.getAll(),
  categories: this.categoryService.getAll(),
  suppliers: this.supplierService.getAll()
}).subscribe(({ products, categories, suppliers }) => {
  // Todos completados
});

// â”â”â” MERGE: Combina mÃºltiples observables â”â”â”
import { merge } from 'rxjs';

merge(
  this.saveAction$,
  this.updateAction$,
  this.deleteAction$
).subscribe(action => {
  this.handleAction(action);
});

// â”â”â” ZIP: Emite cuando todos tienen valor â”â”â”
import { zip } from 'rxjs';

zip(
  this.observable1$,
  this.observable2$
).subscribe(([value1, value2]) => {
  // Ambos emitieron
});

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ERROR HANDLING OPERATORS                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

// â”â”â” CATCHERROR: Maneja errores â”â”â”
import { catchError } from 'rxjs/operators';
import { of } from 'rxjs';

this.productService.getAll().pipe(
  catchError(error => {
    console.error('Error:', error);
    this.toastService.error('Error al cargar productos');
    return of([]); // âœ… Retornar valor por defecto
  })
).subscribe();

// â”â”â” RETRY: Reintenta en caso de error â”â”â”
import { retry } from 'rxjs/operators';

this.productService.getAll().pipe(
  retry(3), // âœ… Reintentar 3 veces
  catchError(error => {
    // Solo llega aquÃ­ despuÃ©s de 3 intentos fallidos
    return of([]);
  })
).subscribe();

// â”â”â” RETRYWHEN: Reintento con lÃ³gica custom â”â”â”
import { retryWhen, delay, take } from 'rxjs/operators';

this.productService.getAll().pipe(
  retryWhen(errors =>
    errors.pipe(
      delay(1000), // Esperar 1s entre reintentos
      take(3)      // MÃ¡ximo 3 reintentos
    )
  )
).subscribe();

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UTILITY OPERATORS                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

// â”â”â” TAP: Side effects sin modificar stream â”â”â”
import { tap } from 'rxjs/operators';

this.productService.getAll().pipe(
  tap(products => console.log('Products:', products)), // âœ… Debugging
  map(products => products.filter(p => p.stock > 0))
).subscribe();

// â”â”â” DELAY: Retrasa emisiÃ³n â”â”â”
import { delay } from 'rxjs/operators';

this.showMessage$.pipe(
  delay(2000) // âœ… Espera 2s antes de emitir
).subscribe();

// â”â”â” TAKE: Toma N valores y completa â”â”â”
import { take } from 'rxjs/operators';

this.updates$.pipe(
  take(1) // âœ… Solo el primer valor, luego completa
).subscribe();

// â”â”â” TAKEUNTIL: Completa cuando otro observable emite â”â”â”
import { takeUntil } from 'rxjs/operators';

this.updates$.pipe(
  takeUntil(this.destroy$) // âœ… Completa cuando destroy$ emite
).subscribe();

// â”â”â” SHAREAREPLAY: Comparte observable y cachea valores â”â”â”
import { shareReplay } from 'rxjs/operators';

this.config$ = this.configService.getConfig().pipe(
  shareReplay(1) // âœ… Cachea Ãºltimo valor, no hace request mÃºltiple
);

PATRÃ“N DE USO RECOMENDADO:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

import { Component, inject } from '@angular/core';
import { 
  debounceTime, 
  distinctUntilChanged, 
  switchMap,
  catchError,
  tap,
  shareReplay
} from 'rxjs/operators';
import { of } from 'rxjs';

@Component({
  selector: 'app-product-search',
  standalone: true
})
export class ProductSearchComponent {
  private productService = inject(ProductService);
  
  searchControl = new FormControl('');
  
  /**
   * BÃºsqueda reactiva con debounce
   */
  searchResults$ = this.searchControl.valueChanges.pipe(
    debounceTime(300),           // âœ… Espera 300ms
    distinctUntilChanged(),      // âœ… Solo si cambiÃ³
    tap(() => this.loading = true),
    switchMap(query =>           // âœ… Cancela request anterior
      this.productService.search(query).pipe(
        catchError(error => {    // âœ… Maneja errores
          console.error(error);
          return of([]);
        })
      )
    ),
    tap(() => this.loading = false),
    shareReplay(1)               // âœ… Cachea resultado
  );
  
  loading = false;
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 2.4.2 Subjects y Patrones Avanzados
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

TIPOS DE SUBJECTS:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. SUBJECT - Subject bÃ¡sico                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ COMPORTAMIENTO:                                                             â”‚
â”‚ â€¢ No tiene valor inicial                                                   â”‚
â”‚ â€¢ Solo emite a subscribers existentes al momento de emit                   â”‚
â”‚ â€¢ Nuevos subscribers no reciben valores anteriores                         â”‚
â”‚                                                                             â”‚
â”‚ CUÃNDO USAR:                                                               â”‚
â”‚ â€¢ Eventos puntuales (clicks, actions)                                      â”‚
â”‚ â€¢ ComunicaciÃ³n entre componentes                                           â”‚
â”‚ â€¢ Event bus                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

import { Subject } from 'rxjs';

export class EventBusService {
  private events$ = new Subject<AppEvent>();
  
  // Observable pÃºblico (read-only)
  readonly events = this.events$.asObservable();
  
  emit(event: AppEvent): void {
    this.events$.next(event);
  }
}

// USO:
this.eventBus.events.subscribe(event => {
  console.log('Event:', event);
  // âš ï¸ No recibe eventos emitidos antes de la subscripciÃ³n
});

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. BEHAVIORSUBJECT - Con valor inicial                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ COMPORTAMIENTO:                                                             â”‚
â”‚ â€¢ Requiere valor inicial                                                   â”‚
â”‚ â€¢ Cachea Ãºltimo valor emitido                                              â”‚
â”‚ â€¢ Nuevos subscribers reciben Ãºltimo valor inmediatamente                   â”‚
â”‚ â€¢ Puedes obtener valor actual con .value                                   â”‚
â”‚                                                                             â”‚
â”‚ CUÃNDO USAR:                                                               â”‚
â”‚ â€¢ Estado de la aplicaciÃ³n                                                  â”‚
â”‚ â€¢ Valores que siempre deben tener un estado                                â”‚
â”‚ â€¢ Datos que nuevos subscribers necesitan inmediatamente                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

import { BehaviorSubject } from 'rxjs';

export class UserService {
  // âœ… Valor inicial: null (no autenticado)
  private currentUser$ = new BehaviorSubject<User | null>(null);
  
  readonly user$ = this.currentUser$.asObservable();
  
  /**
   * Obtener usuario actual sincrÃ³nicamente
   */
  getCurrentUser(): User | null {
    return this.currentUser$.value; // âœ… Acceso al valor actual
  }
  
  login(user: User): void {
    this.currentUser$.next(user);
  }
  
  logout(): void {
    this.currentUser$.next(null);
  }
}

// USO:
this.userService.user$.subscribe(user => {
  // âœ… Recibe valor actual inmediatamente (aunque sea null)
  if (user) {
    console.log('Usuario:', user.nombre);
  }
});

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. REPLAYSUBJECT - Cachea N valores                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ COMPORTAMIENTO:                                                             â”‚
â”‚ â€¢ Cachea N Ãºltimos valores                                                 â”‚
â”‚ â€¢ Nuevos subscribers reciben N valores cacheados                           â”‚
â”‚ â€¢ Opcional: ventana de tiempo                                              â”‚
â”‚                                                                             â”‚
â”‚ CUÃNDO USAR:                                                               â”‚
â”‚ â€¢ Historial de acciones                                                    â”‚
â”‚ â€¢ Log de eventos                                                           â”‚
â”‚ â€¢ Cuando necesitas reproducir Ãºltimas N emisiones                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

import { ReplaySubject } from 'rxjs';

export class ActivityLogService {
  // Cachea Ãºltimas 10 actividades
  private activities$ = new ReplaySubject<Activity>(10);
  
  readonly activities = this.activities$.asObservable();
  
  log(activity: Activity): void {
    this.activities$.next(activity);
  }
}

// USO:
this.activityLog.activities.subscribe(activity => {
  // âœ… Recibe Ãºltimas 10 actividades al subscribirse
  console.log('Activity:', activity);
});

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. ASYNCSUBJECT - Solo Ãºltimo valor al completar                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ COMPORTAMIENTO:                                                             â”‚
â”‚ â€¢ No emite nada hasta completar                                            â”‚
â”‚ â€¢ Al completar, emite SOLO el Ãºltimo valor                                 â”‚
â”‚ â€¢ Similar a Promise (un solo valor)                                        â”‚
â”‚                                                                             â”‚
â”‚ CUÃNDO USAR:                                                               â”‚
â”‚ â€¢ Operaciones que necesitan completarse                                    â”‚
â”‚ â€¢ Resultados finales de computaciones                                      â”‚
â”‚ â€¢ Poco comÃºn en prÃ¡ctica                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

import { AsyncSubject } from 'rxjs';

const subject = new AsyncSubject<number>();

subject.subscribe(value => {
  console.log('Value:', value); // Solo imprime: 3
});

subject.next(1);
subject.next(2);
subject.next(3);
subject.complete(); // âœ… AquÃ­ emite el Ãºltimo valor (3)

PATRÃ“N: Event Bus Service

UBICACIÃ“N: src/app/core/services/event-bus.service.ts

import { Injectable } from '@angular/core';
import { Subject, Observable } from 'rxjs';
import { filter, map } from 'rxjs/operators';

export interface AppEvent {
  type: string;
  payload?: any;
}

/**
 * Event Bus para comunicaciÃ³n entre componentes desacoplados
 * 
 * VENTAJAS:
 * - ComunicaciÃ³n sin dependencias directas
 * - Broadcast de eventos globales
 * - PatrÃ³n pub/sub
 * 
 * CUÃNDO USAR:
 * - Notificaciones globales
 * - Refresh de datos en mÃºltiples componentes
 * - SincronizaciÃ³n de estado
 * 
 * @example
 * // Emitir evento
 * this.eventBus.emit({ type: 'PRODUCT_UPDATED', payload: product });
 * 
 * // Escuchar evento especÃ­fico
 * this.eventBus.on('PRODUCT_UPDATED').subscribe(product => {
 *   this.refreshProduct(product);
 * });
 */
@Injectable({
  providedIn: 'root'
})
export class EventBusService {
  
  private eventSubject$ = new Subject<AppEvent>();
  
  /**
   * Emite un evento global
   */
  emit(event: AppEvent): void {
    this.eventSubject$.next(event);
  }
  
  /**
   * Escucha eventos de un tipo especÃ­fico
   */
  on<T = any>(eventType: string): Observable<T> {
    return this.eventSubject$.pipe(
      filter(event => event.type === eventType),
      map(event => event.payload)
    );
  }
  
  /**
   * Escucha todos los eventos
   */
  onAll(): Observable<AppEvent> {
    return this.eventSubject$.asObservable();
  }
}

// USO EN COMPONENTE A (Emisor):
@Component({
  selector: 'app-product-form',
  standalone: true
})
export class ProductFormComponent {
  private eventBus = inject(EventBusService);
  
  saveProduct(product: Product): void {
    this.productService.save(product).subscribe({
      next: (saved) => {
        // âœ… Notificar a toda la app
        this.eventBus.emit({
          type: 'PRODUCT_UPDATED',
          payload: saved
        });
      }
    });
  }
}

// USO EN COMPONENTE B (Receptor):
@Component({
  selector: 'app-product-list',
  standalone: true
})
export class ProductListComponent implements OnInit {
  private eventBus = inject(EventBusService);
  private destroy$ = new Subject<void>();
  
  ngOnInit(): void {
    // âœ… Escuchar actualizaciones de productos
    this.eventBus.on<Product>('PRODUCT_UPDATED')
      .pipe(takeUntil(this.destroy$))
      .subscribe(product => {
        this.updateProductInList(product);
      });
  }
  
  ngOnDestroy(): void {
    this.destroy$.next();
    this.destroy$.complete();
  }
}

PATRÃ“N: Loading State Service

UBICACIÃ“N: src/app/core/services/loading.service.ts

import { Injectable } from '@angular/core';
import { BehaviorSubject, Observable } from 'rxjs';
import { map } from 'rxjs/operators';

/**
 * Servicio para gestionar estado de carga global
 * 
 * CARACTERÃSTICAS:
 * - Tracking de mÃºltiples operaciones simultÃ¡neas
 * - Estado reactivo
 * - Loading counter para manejar concurrencia
 */
@Injectable({
  providedIn: 'root'
})
export class LoadingService {
  
  private loadingCount$ = new BehaviorSubject<number>(0);
  
  /**
   * Observable del estado de carga
   * true si hay al menos una operaciÃ³n en progreso
   */
  readonly isLoading$: Observable<boolean> = this.loadingCount$.pipe(
    map(count => count > 0)
  );
  
  /**
   * Incrementa contador de carga
   */
  show(): void {
    const current = this.loadingCount$.value;
    this.loadingCount$.next(current + 1);
  }
  
  /**
   * Decrementa contador de carga
   */
  hide(): void {
    const current = this.loadingCount$.value;
    if (current > 0) {
      this.loadingCount$.next(current - 1);
    }
  }
  
  /**
   * Resetea contador (Ãºtil en caso de error)
   */
  reset(): void {
    this.loadingCount$.next(0);
  }
}

// USO EN INTERCEPTOR:
@Injectable()
export class LoadingInterceptor implements HttpInterceptor {
  
  constructor(private loadingService: LoadingService) {}
  
  intercept(req: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {
    // âœ… Mostrar loading al iniciar request
    this.loadingService.show();
    
    return next.handle(req).pipe(
      finalize(() => {
        // âœ… Ocultar loading al finalizar (Ã©xito o error)
        this.loadingService.hide();
      })
    );
  }
}

// USO EN COMPONENTE:
@Component({
  selector: 'app-root',
  template: `
    <ion-app>
      <!-- Loading global -->
      <div *ngIf="isLoading$ | async" class="global-loader">
        <ion-spinner></ion-spinner>
      </div>
      
      <ion-router-outlet></ion-router-outlet>
    </ion-app>
  `,
  standalone: true
})
export class AppComponent {
  isLoading$ = inject(LoadingService).isLoading$;
}

HOT vs COLD OBSERVABLES:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ COLD OBSERVABLE                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Crea nuevo stream para cada subscriber                                   â”‚
â”‚ â€¢ Datos producidos por el observable mismo                                 â”‚
â”‚ â€¢ Unicast (1 productor â†’ 1 consumer)                                       â”‚
â”‚                                                                             â”‚
â”‚ EJEMPLOS: HTTP requests, of(), interval(), timer()                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

// COLD: Cada subscriber obtiene su propio stream
const cold$ = interval(1000);

cold$.subscribe(x => console.log('A:', x)); // 0, 1, 2...
setTimeout(() => {
  cold$.subscribe(x => console.log('B:', x)); // 0, 1, 2... (empieza de cero)
}, 3000);

// HttpClient es COLD
this.http.get('/api/products').subscribe(); // Request 1
this.http.get('/api/products').subscribe(); // Request 2 (otro request!)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HOT OBSERVABLE                                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Comparte mismo stream entre subscribers                                  â”‚
â”‚ â€¢ Datos producidos externamente                                            â”‚
â”‚ â€¢ Multicast (1 productor â†’ N consumers)                                    â”‚
â”‚                                                                             â”‚
â”‚ EJEMPLOS: Subjects, fromEvent(), WebSocket                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

// HOT: Todos los subscribers comparten el mismo stream
const hot$ = new Subject<number>();

hot$.subscribe(x => console.log('A:', x));
hot$.next(1); // A: 1

setTimeout(() => {
  hot$.subscribe(x => console.log('B:', x));
  hot$.next(2); // A: 2, B: 2 (ambos reciben)
}, 1000);

CONVERTIR COLD A HOT:

import { share, shareReplay } from 'rxjs/operators';

// âŒ COLD: MÃºltiples requests HTTP
const products$ = this.http.get<Product[]>('/api/products');

products$.subscribe(); // Request 1
products$.subscribe(); // Request 2
products$.subscribe(); // Request 3

// âœ… HOT: Un solo request, compartido
const products$ = this.http.get<Product[]>('/api/products').pipe(
  shareReplay(1) // Cachea Ãºltimo valor y comparte
);

products$.subscribe(); // Request 1
products$.subscribe(); // Usa cache
products$.subscribe(); // Usa cache

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 2.4.3 Patrones de State Management
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

PATRÃ“N: Store Service (NgRx-lite)

UBICACIÃ“N: src/app/core/services/store.service.ts

import { Injectable } from '@angular/core';
import { BehaviorSubject, Observable } from 'rxjs';
import { map, distinctUntilChanged } from 'rxjs/operators';

/**
 * Store genÃ©rico para state management sin NgRx
 * 
 * CARACTERÃSTICAS:
 * - Estado inmutable
 * - Selectors tipados
 * - Reactive updates
 * - DevTools-friendly
 * 
 * @example
 * interface AppState {
 *   user: User | null;
 *   cart: CartItem[];
 * }
 * 
 * const store = new Store<AppState>({
 *   user: null,
 *   cart: []
 * });
 */
export class Store<T> {
  
  private state$: BehaviorSubject<T>;
  
  constructor(initialState: T) {
    this.state$ = new BehaviorSubject<T>(initialState);
  }
  
  /**
   * Obtiene el estado actual
   */
  getState(): T {
    return this.state$.value;
  }
  
  /**
   * Actualiza el estado (inmutable)
   */
  setState(nextState: Partial<T>): void {
    const currentState = this.getState();
    this.state$.next({
      ...currentState,
      ...nextState
    });
  }
  
  /**
   * Selecciona parte del estado
   */
  select<K>(selector: (state: T) => K): Observable<K> {
    return this.state$.pipe(
      map(selector),
      distinctUntilChanged()
    );
  }
  
  /**
   * Observable del estado completo
   */
  get state(): Observable<T> {
    return this.state$.asObservable();
  }
}

// IMPLEMENTACIÃ“N: Cart Store

UBICACIÃ“N: src/app/core/store/cart.store.ts

import { Injectable } from '@angular/core';
import { Store } from './store.service';
import { Product } from '@models/product.model';

export interface CartItem {
  product: Product;
  quantity: number;
  subtotal: number;
}

export interface CartState {
  items: CartItem[];
  total: number;
  itemCount: number;
}

/**
 * Store del carrito de compras
 * 
 * USO:
 * constructor(private cartStore: CartStore) {
 *   this.cartStore.items$.subscribe(items => {
 *     console.log('Items:', items);
 *   });
 * }
 */
@Injectable({
  providedIn: 'root'
})
export class CartStore extends Store<CartState> {
  
  constructor() {
    super({
      items: [],
      total: 0,
      itemCount: 0
    });
    
    this.loadFromStorage();
  }
  
  // â”â”â” SELECTORS â”â”â”
  
  readonly items$ = this.select(state => state.items);
  readonly total$ = this.select(state => state.total);
  readonly itemCount$ = this.select(state => state.itemCount);
  readonly isEmpty$ = this.select(state => state.items.length === 0);
  
  // â”â”â” ACTIONS â”â”â”
  
  /**
   * Agrega item al carrito
   */
  addItem(product: Product, quantity = 1): void {
    const state = this.getState();
    const existingItem = state.items.find(
      item => item.product.id === product.id
    );
    
    let newItems: CartItem[];
    
    if (existingItem) {
      // Actualizar cantidad
      newItems = state.items.map(item =>
        item.product.id === product.id
          ? {
              ...item,
              quantity: item.quantity + quantity,
              subtotal: product.precio * (item.quantity + quantity)
            }
          : item
      );
    } else {
      // Agregar nuevo
      newItems = [
        ...state.items,
        {
          product,
          quantity,
          subtotal: product.precio * quantity
        }
      ];
    }
    
    this.updateItems(newItems);
  }
  
  /**
   * Elimina item del carrito
   */
  removeItem(productId: number): void {
    const state = this.getState();
    const newItems = state.items.filter(
      item => item.product.id !== productId
    );
    this.updateItems(newItems);
  }
  
  /**
   * Actualiza cantidad de un item
   */
  updateQuantity(productId: number, quantity: number): void {
    if (quantity <= 0) {
      this.removeItem(productId);
      return;
    }
    
    const state = this.getState();
    const newItems = state.items.map(item =>
      item.product.id === productId
        ? {
            ...item,
            quantity,
            subtotal: item.product.precio * quantity
          }
        : item
    );
    
    this.updateItems(newItems);
  }
  
  /**
   * Limpia el carrito
   */
  clear(): void {
    this.updateItems([]);
  }
  
  /**
   * Actualiza items y recalcula totales
   */
  private updateItems(items: CartItem[]): void {
    const total = items.reduce((sum, item) => sum + item.subtotal, 0);
    const itemCount = items.reduce((sum, item) => sum + item.quantity, 0);
    
    this.setState({ items, total, itemCount });
    this.saveToStorage();
  }
  
  /**
   * Guarda en localStorage
   */
  private saveToStorage(): void {
    try {
      const state = this.getState();
      localStorage.setItem('cart', JSON.stringify(state.items));
    } catch (error) {
      console.error('Error saving cart:', error);
    }
  }
  
  /**
   * Carga desde localStorage
   */
  private loadFromStorage(): void {
    try {
      const stored = localStorage.getItem('cart');
      if (stored) {
        const items: CartItem[] = JSON.parse(stored);
        this.updateItems(items);
      }
    } catch (error) {
      console.error('Error loading cart:', error);
    }
  }
}

// USO EN COMPONENTE:

@Component({
  selector: 'app-cart',
  template: `
    <ion-header>
      <ion-toolbar>
        <ion-title>
          Carrito ({{ itemCount$ | async }})
        </ion-title>
      </ion-toolbar>
    </ion-header>
    
    <ion-content>
      <!-- Empty state -->
      <app-empty-state
        *ngIf="isEmpty$ | async"
        icon="cart-outline"
        title="Carrito vacÃ­o"
        description="Agrega productos para continuar">
      </app-empty-state>
      
      <!-- Items -->
      <ion-list *ngIf="!(isEmpty$ | async)">
        <ion-item *ngFor="let item of items$ | async">
          <ion-thumbnail slot="start">
            <img [src]="item.product.imagen" [alt]="item.product.nombre">
          </ion-thumbnail>
          
          <ion-label>
            <h2>{{ item.product.nombre }}</h2>
            <p>{{ item.product.precio | currency }} Ã— {{ item.quantity }}</p>
          </ion-label>
          
          <div slot="end">
            <ion-button size="small" fill="clear" (click)="decrease(item)">
              <ion-icon name="remove"></ion-icon>
            </ion-button>
            <span>{{ item.quantity }}</span>
            <ion-button size="small" fill="clear" (click)="increase(item)">
              <ion-icon name="add"></ion-icon>
            </ion-button>
          </div>
        </ion-item>
      </ion-list>
      
      <!-- Total -->
      <div class="cart-total" *ngIf="!(isEmpty$ | async)">
        <h3>Total: {{ total$ | async | currency }}</h3>
        <ion-button expand="block" (click)="checkout()">
          Proceder al Pago
        </ion-button>
      </div>
    </ion-content>
  `,
  standalone: true
})
export class CartPage {
  private cartStore = inject(CartStore);
  
  // Selectors
  items$ = this.cartStore.items$;
  total$ = this.cartStore.total$;
  itemCount$ = this.cartStore.itemCount$;
  isEmpty$ = this.cartStore.isEmpty$;
  
  // Actions
  increase(item: CartItem): void {
    this.cartStore.updateQuantity(
      item.product.id,
      item.quantity + 1
    );
  }
  
  decrease(item: CartItem): void {
    this.cartStore.updateQuantity(
      item.product.id,
      item.quantity - 1
    );
  }
  
  checkout(): void {
    // LÃ³gica de checkout
  }
}

VENTAJAS DEL PATRÃ“N STORE:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ“ Estado centralizado y predecible
âœ“ SeparaciÃ³n de datos y UI
âœ“ Selectors memoizados (distinctUntilChanged)
âœ“ FÃ¡cil de testear
âœ“ Inmutabilidad forzada
âœ“ Single source of truth
âœ“ Reactivo por defecto
âœ“ Sin dependencias externas (no NgRx necesario)

CUÃNDO USAR:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ“ Estado compartido entre mÃºltiples componentes
âœ“ Estado que persiste durante navegaciÃ³n
âœ“ Datos complejos con mÃºltiples relaciones
âœ“ Necesidad de undo/redo
âœ“ SincronizaciÃ³n tiempo real
âœ“ Debugging de estado

âŒ NO usar para:
â€¢ Estado local de componente simple
â€¢ Datos que no se comparten
â€¢ Formularios simples
â€¢ Estado efÃ­mero

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  2.5 PERFORMANCE OPTIMIZATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 2.5.1 Virtual Scrolling
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

PROBLEMA: Renderizar listas grandes (>100 items) causa lag y consume memoria.

SOLUCIÃ“N: Virtual scrolling renderiza solo los elementos visibles.

CONFIGURACIÃ“N:

@Component({
  selector: 'app-product-list',
  template: `
    <ion-content>
      <!-- âœ… Virtual scroll para listas grandes -->
      <ion-virtual-scroll
        [items]="products"
        [approxItemHeight]="80">
        
        <ion-item *virtualItem="let product">
          <ion-thumbnail slot="start">
            <img [src]="product.imagen" [alt]="product.nombre">
          </ion-thumbnail>
          
          <ion-label>
            <h2>{{ product.nombre }}</h2>
            <p>{{ product.precio | currency }}</p>
          </ion-label>
        </ion-item>
      </ion-virtual-scroll>
    </ion-content>
  `,
  standalone: true,
  imports: [IonContent, IonVirtualScroll, IonItem, IonThumbnail, IonLabel]
})
export class ProductListPage {
  products: Product[] = []; // Lista grande
  
  ngOnInit(): void {
    this.loadProducts();
  }
  
  async loadProducts(): Promise<void> {
    // Cargar 1000+ productos
    this.products = await this.productService.getAll().toPromise();
  }
}

MEJORES PRÃCTICAS:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ“ Usar para listas > 50 items
âœ“ Especificar approxItemHeight para mejor performance
âœ“ Items de altura uniforme (mejor performance)
âœ“ TrackBy function obligatorio
âœ“ Evitar operaciones pesadas en template

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 2.5.2 TrackBy Functions
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

PROBLEMA: Sin trackBy, Angular re-renderiza toda la lista en cada cambio.

// âŒ SIN TRACKBY (Re-renderiza TODO)
<ion-item *ngFor="let product of products">
  {{ product.nombre }}
</ion-item>

// âœ… CON TRACKBY (Solo renderiza cambios)
<ion-item *ngFor="let product of products; trackBy: trackById">
  {{ product.nombre }}
</ion-item>

@Component({...})
export class ProductListPage {
  products: Product[] = [];
  
  /**
   * TrackBy por ID (mÃ¡s eficiente)
   * Angular usa el ID para identificar si el item cambiÃ³
   */
  trackById(index: number, item: Product): number {
    return item.id; // âœ… Identifica cada item por ID Ãºnico
  }
  
  // Alternativa: TrackBy por index (menos recomendado)
  trackByIndex(index: number): number {
    return index;
  }
}

IMPACTO DE PERFORMANCE:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Sin trackBy:    1000 items â†’ 1000 DOM operations
Con trackBy:    1000 items â†’ Solo items modificados

âœ“ SIEMPRE usar trackBy en *ngFor
âœ“ TrackBy por ID Ãºnico (mejor opciÃ³n)
âœ“ TrackBy por index solo si no hay ID
âœ“ Nunca trackBy por objeto completo

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 2.5.3 Image Optimization
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

TÃ‰CNICAS:

1. LAZY LOADING (con directiva creada anteriormente)

<img 
  appLazyImage
  [lazyLoad]="product.imagen"
  [placeholder]="'assets/images/placeholder.png'"
  [alt]="product.nombre">

2. RESPONSIVE IMAGES

<!-- Diferentes tamaÃ±os segÃºn viewport -->
<img 
  [src]="product.imagen"
  [srcset]="
    product.imagen_small + ' 320w, ' +
    product.imagen_medium + ' 768w, ' +
    product.imagen_large + ' 1024w'
  "
  sizes="(max-width: 768px) 100vw, 50vw"
  [alt]="product.nombre">

3. WEBP CON FALLBACK

<picture>
  <source 
    [srcset]="product.imagen_webp" 
    type="image/webp">
  <img 
    [src]="product.imagen" 
    [alt]="product.nombre">
</picture>

4. IONIC IMAGE COMPONENT

<ion-img
  [src]="product.imagen"
  [alt]="product.nombre">
</ion-img>

OPTIMIZACIÃ“N DE ASSETS:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ“ Comprimir imÃ¡genes (TinyPNG, Squoosh)
âœ“ Usar WebP cuando sea posible
âœ“ TamaÃ±os adecuados (no 4K para thumbnails)
âœ“ CDN para assets estÃ¡ticos
âœ“ Cache-Control headers apropiados
âœ“ Lazy loading por defecto

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 2.5.4 Memoization y Caching
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

PATRÃ“N: HTTP Caching Service

UBICACIÃ“N: src/app/core/services/cache.service.ts

import { Injectable } from '@angular/core';
import { Observable, of } from 'rxjs';
import { tap, shareReplay } from 'rxjs/operators';

interface CacheEntry<T> {
  data: Observable<T>;
  timestamp: number;
}

/**
 * Servicio de cachÃ© para HTTP requests
 * 
 * CARACTERÃSTICAS:
 * - Cache en memoria
 * - TTL configurable
 * - InvalidaciÃ³n manual
 */
@Injectable({
  providedIn: 'root'
})
export class CacheService {
  
  private cache = new Map<string, CacheEntry<any>>();
  private defaultTTL = 5 * 60 * 1000; // 5 minutos
  
  /**
   * Obtiene datos del cache o ejecuta request
   */
  get<T>(
    key: string,
    request: Observable<T>,
    ttl = this.defaultTTL
  ): Observable<T> {
    const cached = this.cache.get(key);
    const now = Date.now();
    
    // Si estÃ¡ en cache y no expirÃ³
    if (cached && (now - cached.timestamp) < ttl) {
      return cached.data;
    }
    
    // Ejecutar request y cachear
    const data$ = request.pipe(
      tap(() => {
        this.cache.set(key, {
          data: data$,
          timestamp: now
        });
      }),
      shareReplay(1)
    );
    
    return data$;
  }
  
  /**
   * Invalida cache de una key
   */
  invalidate(key: string): void {
    this.cache.delete(key);
  }
  
  /**
   * Invalida todo el cache
   */
  invalidateAll(): void {
    this.cache.clear();
  }
  
  /**
   * Invalida cache por patrÃ³n
   */
  invalidatePattern(pattern: string): void {
    const keys = Array.from(this.cache.keys());
    keys.forEach(key => {
      if (key.includes(pattern)) {
        this.cache.delete(key);
      }
    });
  }
}

// USO EN SERVICE:

@Injectable({
  providedIn: 'root'
})
export class ProductService {
  
  constructor(
    private http: HttpClient,
    private cache: CacheService
  ) {}
  
  /**
   * Obtiene productos con cache de 5 minutos
   */
  getAll(): Observable<Product[]> {
    return this.cache.get(
      'products',
      this.http.get<Product[]>('/api/products'),
      5 * 60 * 1000 // 5 minutos
    );
  }
  
  /**
   * Invalida cache al crear producto
   */
  create(product: Product): Observable<Product> {
    return this.http.post<Product>('/api/products', product).pipe(
      tap(() => {
        this.cache.invalidate('products'); // âœ… Invalidar cache
      })
    );
  }
}

MEJORES PRÃCTICAS:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ“ Cache datos estÃ¡ticos o que cambian poco
âœ“ TTL apropiado segÃºn tipo de dato
âœ“ Invalidar cache despuÃ©s de mutations
âœ“ shareReplay para compartir requests
âœ“ Considerar localStorage para persistencia

âŒ NO cachear datos sensibles
âŒ NO cachear datos en tiempo real
âŒ NO olvidar invalidar cache

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ  âœ… FIN DE FASE 2: ARQUITECTURA Y BUENAS PRÃCTICAS                         â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ  ğŸ§ª FASE 3: TESTING Y CALIDAD DE CÃ“DIGO (PRIORIDAD CRÃTICA)               â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

OBJETIVO: Garantizar calidad excelsa mediante testing exhaustivo y cobertura >80%.
Todo el cÃ³digo debe ser testeable, testeado y mantenible.

STACK DE TESTING:
â€¢ Jasmine: Framework de testing (describe, it, expect)
â€¢ Karma: Test runner para unit tests
â€¢ Cypress/Playwright: E2E testing
â€¢ Jest (opcional): Alternativa a Jasmine mÃ¡s rÃ¡pida

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  3.1 UNIT TESTING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 3.1.1 Testing de Servicios
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

EJEMPLO: Testing de ProductService

UBICACIÃ“N: src/app/core/services/product.service.spec.ts

import { TestBed } from '@angular/core/testing';
import { HttpClientTestingModule, HttpTestingController } from '@angular/common/http/testing';
import { ProductService } from './product.service';
import { Product } from '@models/product.model';

/**
 * Test suite para ProductService
 * 
 * COBERTURA:
 * - CRUD operations
 * - Error handling
 * - Data transformation
 * - Edge cases
 */
describe('ProductService', () => {
  let service: ProductService;
  let httpMock: HttpTestingController;
  
  const mockProducts: Product[] = [
    {
      id: 1,
      nombre: 'Paracetamol 500mg',
      codigo: '7501234567890',
      precio: 25.50,
      stock: 100,
      stockMinimo: 10,
      categoriaId: 1,
      categoria: { id: 1, nombre: 'AnalgÃ©sicos' },
      imagen: 'https://example.com/paracetamol.jpg'
    },
    {
      id: 2,
      nombre: 'Ibuprofeno 400mg',
      codigo: '7501234567891',
      precio: 35.00,
      stock: 50,
      stockMinimo: 5,
      categoriaId: 1,
      categoria: { id: 1, nombre: 'AnalgÃ©sicos' },
      imagen: 'https://example.com/ibuprofeno.jpg'
    }
  ];
  
  /**
   * Setup antes de cada test
   */
  beforeEach(() => {
    TestBed.configureTestingModule({
      imports: [HttpClientTestingModule],
      providers: [ProductService]
    });
    
    service = TestBed.inject(ProductService);
    httpMock = TestBed.inject(HttpTestingController);
  });
  
  /**
   * Cleanup despuÃ©s de cada test
   */
  afterEach(() => {
    httpMock.verify(); // âœ… Verifica que no haya requests pendientes
  });
  
  // â”â”â” TESTS BÃSICOS â”â”â”
  
  it('should be created', () => {
    expect(service).toBeTruthy();
  });
  
  // â”â”â” GET ALL â”â”â”
  
  describe('getAll()', () => {
    
    it('should return all products', (done) => {
      service.getAll().subscribe(products => {
        expect(products).toEqual(mockProducts);
        expect(products.length).toBe(2);
        done();
      });
      
      const req = httpMock.expectOne('/api/products');
      expect(req.request.method).toBe('GET');
      req.flush(mockProducts);
    });
    
    it('should handle empty response', (done) => {
      service.getAll().subscribe(products => {
        expect(products).toEqual([]);
        expect(products.length).toBe(0);
        done();
      });
      
      const req = httpMock.expectOne('/api/products');
      req.flush([]);
    });
    
    it('should handle error', (done) => {
      const errorMessage = 'Network error';
      
      service.getAll().subscribe({
        next: () => fail('Should have failed'),
        error: (error) => {
          expect(error.status).toBe(500);
          done();
        }
      });
      
      const req = httpMock.expectOne('/api/products');
      req.flush(errorMessage, { status: 500, statusText: 'Server Error' });
    });
  });
  
  // â”â”â” GET BY ID â”â”â”
  
  describe('getById()', () => {
    
    it('should return product by id', (done) => {
      const productId = 1;
      const expectedProduct = mockProducts[0];
      
      service.getById(productId).subscribe(product => {
        expect(product).toEqual(expectedProduct);
        expect(product.id).toBe(productId);
        done();
      });
      
      const req = httpMock.expectOne(`/api/products/${productId}`);
      expect(req.request.method).toBe('GET');
      req.flush(expectedProduct);
    });
    
    it('should handle not found error', (done) => {
      const productId = 999;
      
      service.getById(productId).subscribe({
        next: () => fail('Should have failed'),
        error: (error) => {
          expect(error.status).toBe(404);
          done();
        }
      });
      
      const req = httpMock.expectOne(`/api/products/${productId}`);
      req.flush('Not found', { status: 404, statusText: 'Not Found' });
    });
  });
  
  // â”â”â” CREATE â”â”â”
  
  describe('create()', () => {
    
    it('should create a new product', (done) => {
      const newProduct: Partial<Product> = {
        nombre: 'Aspirina 100mg',
        codigo: '7501234567892',
        precio: 15.00,
        stock: 200,
        stockMinimo: 20,
        categoriaId: 1
      };
      
      const createdProduct: Product = {
        id: 3,
        ...newProduct,
        categoria: { id: 1, nombre: 'AnalgÃ©sicos' }
      } as Product;
      
      service.create(newProduct).subscribe(product => {
        expect(product).toEqual(createdProduct);
        expect(product.id).toBe(3);
        done();
      });
      
      const req = httpMock.expectOne('/api/products');
      expect(req.request.method).toBe('POST');
      expect(req.request.body).toEqual(newProduct);
      req.flush(createdProduct);
    });
    
    it('should handle validation error', (done) => {
      const invalidProduct: Partial<Product> = {
        nombre: '', // âŒ Nombre vacÃ­o
        precio: -10 // âŒ Precio negativo
      };
      
      service.create(invalidProduct).subscribe({
        next: () => fail('Should have failed'),
        error: (error) => {
          expect(error.status).toBe(400);
          done();
        }
      });
      
      const req = httpMock.expectOne('/api/products');
      req.flush(
        { message: 'Validation error' },
        { status: 400, statusText: 'Bad Request' }
      );
    });
  });
  
  // â”â”â” UPDATE â”â”â”
  
  describe('update()', () => {
    
    it('should update existing product', (done) => {
      const updatedProduct: Product = {
        ...mockProducts[0],
        precio: 30.00, // Precio actualizado
        stock: 150     // Stock actualizado
      };
      
      service.update(updatedProduct.id, updatedProduct).subscribe(product => {
        expect(product.precio).toBe(30.00);
        expect(product.stock).toBe(150);
        done();
      });
      
      const req = httpMock.expectOne(`/api/products/${updatedProduct.id}`);
      expect(req.request.method).toBe('PUT');
      expect(req.request.body).toEqual(updatedProduct);
      req.flush(updatedProduct);
    });
  });
  
  // â”â”â” DELETE â”â”â”
  
  describe('delete()', () => {
    
    it('should delete product', (done) => {
      const productId = 1;
      
      service.delete(productId).subscribe(() => {
        expect().nothing(); // Solo verificamos que complete sin error
        done();
      });
      
      const req = httpMock.expectOne(`/api/products/${productId}`);
      expect(req.request.method).toBe('DELETE');
      req.flush(null);
    });
    
    it('should handle delete error', (done) => {
      const productId = 1;
      
      service.delete(productId).subscribe({
        next: () => fail('Should have failed'),
        error: (error) => {
          expect(error.status).toBe(409);
          done();
        }
      });
      
      const req = httpMock.expectOne(`/api/products/${productId}`);
      req.flush(
        { message: 'Product has related records' },
        { status: 409, statusText: 'Conflict' }
      );
    });
  });
  
  // â”â”â” SEARCH â”â”â”
  
  describe('search()', () => {
    
    it('should search products by query', (done) => {
      const query = 'paracet';
      const expectedResults = [mockProducts[0]];
      
      service.search(query).subscribe(results => {
        expect(results).toEqual(expectedResults);
        expect(results.length).toBe(1);
        done();
      });
      
      const req = httpMock.expectOne(`/api/products/search?q=${query}`);
      expect(req.request.method).toBe('GET');
      req.flush(expectedResults);
    });
    
    it('should return empty array for no matches', (done) => {
      const query = 'xyz123';
      
      service.search(query).subscribe(results => {
        expect(results).toEqual([]);
        done();
      });
      
      const req = httpMock.expectOne(`/api/products/search?q=${query}`);
      req.flush([]);
    });
  });
  
  // â”â”â” BUSINESS LOGIC â”â”â”
  
  describe('isLowStock()', () => {
    
    it('should return true when stock is below minimum', () => {
      const product: Product = {
        ...mockProducts[0],
        stock: 5,
        stockMinimo: 10
      };
      
      expect(service.isLowStock(product)).toBe(true);
    });
    
    it('should return false when stock is above minimum', () => {
      const product: Product = {
        ...mockProducts[0],
        stock: 100,
        stockMinimo: 10
      };
      
      expect(service.isLowStock(product)).toBe(false);
    });
    
    it('should return true when stock equals minimum', () => {
      const product: Product = {
        ...mockProducts[0],
        stock: 10,
        stockMinimo: 10
      };
      
      expect(service.isLowStock(product)).toBe(true);
    });
  });
});

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 3.1.2 Testing de Componentes
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

EJEMPLO: Testing de ProductCardComponent

UBICACIÃ“N: src/app/shared/components/product-card/product-card.component.spec.ts

import { ComponentFixture, TestBed } from '@angular/core/testing';
import { ProductCardComponent } from './product-card.component';
import { Product } from '@models/product.model';
import { DebugElement } from '@angular/core';
import { By } from '@angular/platform-browser';

describe('ProductCardComponent', () => {
  let component: ProductCardComponent;
  let fixture: ComponentFixture<ProductCardComponent>;
  let compiled: HTMLElement;
  
  const mockProduct: Product = {
    id: 1,
    nombre: 'Paracetamol 500mg',
    codigo: '7501234567890',
    precio: 25.50,
    stock: 100,
    stockMinimo: 10,
    categoriaId: 1,
    categoria: { id: 1, nombre: 'AnalgÃ©sicos' },
    imagen: 'https://example.com/paracetamol.jpg'
  };
  
  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [ProductCardComponent] // âœ… Standalone component
    }).compileComponents();
    
    fixture = TestBed.createComponent(ProductCardComponent);
    component = fixture.componentInstance;
    compiled = fixture.nativeElement;
  });
  
  it('should create', () => {
    expect(component).toBeTruthy();
  });
  
  // â”â”â” RENDERING â”â”â”
  
  describe('Rendering', () => {
    
    beforeEach(() => {
      component.product = mockProduct;
      fixture.detectChanges();
    });
    
    it('should display product name', () => {
      const nameElement = compiled.querySelector('.product-card__title');
      expect(nameElement?.textContent).toContain(mockProduct.nombre);
    });
    
    it('should display product price', () => {
      const priceElement = compiled.querySelector('.product-card__price');
      expect(priceElement?.textContent).toContain('25.50');
    });
    
    it('should display product image', () => {
      const imgElement = compiled.querySelector('img') as HTMLImageElement;
      expect(imgElement.src).toBe(mockProduct.imagen);
      expect(imgElement.alt).toBe(mockProduct.nombre);
    });
    
    it('should display category', () => {
      const categoryElement = compiled.querySelector('.overline');
      expect(categoryElement?.textContent).toContain(mockProduct.categoria.nombre);
    });
    
    it('should display stock', () => {
      const stockElement = compiled.querySelector('.product-card__stock');
      expect(stockElement?.textContent).toContain('100 unidades');
    });
  });
  
  // â”â”â” STOCK BADGE â”â”â”
  
  describe('Stock Badge', () => {
    
    it('should show warning badge when stock is low', () => {
      component.product = {
        ...mockProduct,
        stock: 5,
        stockMinimo: 10
      };
      fixture.detectChanges();
      
      const badge = compiled.querySelector('ion-badge');
      expect(badge?.getAttribute('color')).toBe('warning');
      expect(badge?.textContent).toContain('Stock Bajo');
    });
    
    it('should not show badge when stock is normal', () => {
      component.product = mockProduct;
      fixture.detectChanges();
      
      const badge = compiled.querySelector('ion-badge');
      expect(badge).toBeNull();
    });
  });
  
  // â”â”â” EVENTS â”â”â”
  
  describe('Events', () => {
    
    beforeEach(() => {
      component.product = mockProduct;
      fixture.detectChanges();
    });
    
    it('should emit edit event when edit button is clicked', () => {
      spyOn(component.edit, 'emit');
      
      const editButton = fixture.debugElement.query(
        By.css('[aria-label*="Editar"]')
      );
      editButton.nativeElement.click();
      
      expect(component.edit.emit).toHaveBeenCalledWith(mockProduct);
    });
    
    it('should emit delete event when delete button is clicked', () => {
      spyOn(component.delete, 'emit');
      
      const deleteButton = fixture.debugElement.query(
        By.css('[aria-label*="Eliminar"]')
      );
      deleteButton.nativeElement.click();
      
      expect(component.delete.emit).toHaveBeenCalledWith(mockProduct);
    });
    
    it('should emit addToCart event when add button is clicked', () => {
      spyOn(component.addToCart, 'emit');
      
      const addButton = fixture.debugElement.query(
        By.css('ion-button:last-child')
      );
      addButton.nativeElement.click();
      
      expect(component.addToCart.emit).toHaveBeenCalledWith(mockProduct);
    });
    
    it('should not emit addToCart when stock is 0', () => {
      component.product = { ...mockProduct, stock: 0 };
      fixture.detectChanges();
      
      spyOn(component.addToCart, 'emit');
      
      const addButton = fixture.debugElement.query(
        By.css('ion-button:last-child')
      );
      
      expect(addButton.nativeElement.disabled).toBe(true);
    });
  });
  
  // â”â”â” COMPUTED PROPERTIES â”â”â”
  
  describe('isLowStock', () => {
    
    it('should return true when stock <= stockMinimo', () => {
      component.product = {
        ...mockProduct,
        stock: 10,
        stockMinimo: 10
      };
      
      expect(component.isLowStock).toBe(true);
    });
    
    it('should return false when stock > stockMinimo', () => {
      component.product = mockProduct;
      
      expect(component.isLowStock).toBe(false);
    });
  });
  
  // â”â”â” ACCESSIBILITY â”â”â”
  
  describe('Accessibility', () => {
    
    beforeEach(() => {
      component.product = mockProduct;
      fixture.detectChanges();
    });
    
    it('should have proper aria-labels on buttons', () => {
      const editButton = compiled.querySelector('[aria-label*="Editar"]');
      const deleteButton = compiled.querySelector('[aria-label*="Eliminar"]');
      const addButton = compiled.querySelector('[aria-label*="Agregar"]');
      
      expect(editButton?.getAttribute('aria-label')).toContain(mockProduct.nombre);
      expect(deleteButton?.getAttribute('aria-label')).toContain(mockProduct.nombre);
      expect(addButton?.getAttribute('aria-label')).toContain(mockProduct.nombre);
    });
    
    it('should have alt text on image', () => {
      const img = compiled.querySelector('img') as HTMLImageElement;
      expect(img.alt).toBe(mockProduct.nombre);
    });
  });
});

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 3.1.3 Testing de Componentes con Formularios
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

EJEMPLO: Testing de ProductFormComponent

UBICACIÃ“N: src/app/modules/inventory/components/product-form.component.spec.ts

import { ComponentFixture, TestBed } from '@angular/core/testing';
import { ReactiveFormsModule } from '@angular/forms';
import { ProductFormComponent } from './product-form.component';

describe('ProductFormComponent', () => {
  let component: ProductFormComponent;
  let fixture: ComponentFixture<ProductFormComponent>;
  
  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [
        ProductFormComponent,
        ReactiveFormsModule
      ]
    }).compileComponents();
    
    fixture = TestBed.createComponent(ProductFormComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });
  
  it('should create', () => {
    expect(component).toBeTruthy();
  });
  
  // â”â”â” FORM INITIALIZATION â”â”â”
  
  describe('Form Initialization', () => {
    
    it('should initialize form with empty values', () => {
      expect(component.form.value).toEqual({
        nombre: '',
        codigo: '',
        precio: 0,
        stock: 0,
        stockMinimo: 0,
        categoriaId: '',
        imagen: ''
      });
    });
    
    it('should have required validators', () => {
      const form = component.form;
      
      expect(form.get('nombre')?.hasError('required')).toBe(true);
      expect(form.get('codigo')?.hasError('required')).toBe(true);
      expect(form.get('precio')?.hasError('required')).toBe(true);
    });
  });
  
  // â”â”â” FORM VALIDATION â”â”â”
  
  describe('Form Validation', () => {
    
    it('should validate nombre minLength', () => {
      const nombreControl = component.form.get('nombre')!;
      
      nombreControl.setValue('ab'); // < 3 caracteres
      expect(nombreControl.hasError('minlength')).toBe(true);
      
      nombreControl.setValue('abc'); // >= 3 caracteres
      expect(nombreControl.hasError('minlength')).toBe(false);
    });
    
    it('should validate codigo pattern (EAN-13)', () => {
      const codigoControl = component.form.get('codigo')!;
      
      codigoControl.setValue('123'); // No es EAN-13
      expect(codigoControl.hasError('pattern')).toBe(true);
      
      codigoControl.setValue('7501234567890'); // EAN-13 vÃ¡lido
      expect(codigoControl.hasError('pattern')).toBe(false);
    });
    
    it('should validate precio min value', () => {
      const precioControl = component.form.get('precio')!;
      
      precioControl.setValue(0); // Menor al mÃ­nimo
      expect(precioControl.hasError('min')).toBe(true);
      
      precioControl.setValue(0.01); // Mayor al mÃ­nimo
      expect(precioControl.hasError('min')).toBe(false);
    });
    
    it('should validate stock min value', () => {
      const stockControl = component.form.get('stock')!;
      
      stockControl.setValue(-1); // Negativo
      expect(stockControl.hasError('min')).toBe(true);
      
      stockControl.setValue(0); // VÃ¡lido
      expect(stockControl.hasError('min')).toBe(false);
    });
  });
  
  // â”â”â” FORM SUBMISSION â”â”â”
  
  describe('Form Submission', () => {
    
    it('should not submit invalid form', () => {
      spyOn(component.save, 'emit');
      
      component.onSubmit();
      
      expect(component.save.emit).not.toHaveBeenCalled();
    });
    
    it('should mark all fields as touched when invalid', () => {
      component.onSubmit();
      
      expect(component.form.get('nombre')?.touched).toBe(true);
      expect(component.form.get('codigo')?.touched).toBe(true);
      expect(component.form.get('precio')?.touched).toBe(true);
    });
    
    it('should emit save event with valid data', () => {
      spyOn(component.save, 'emit');
      
      const validProduct = {
        nombre: 'Paracetamol 500mg',
        codigo: '7501234567890',
        precio: 25.50,
        stock: 100,
        stockMinimo: 10,
        categoriaId: '1',
        imagen: ''
      };
      
      component.form.setValue(validProduct);
      component.onSubmit();
      
      expect(component.save.emit).toHaveBeenCalledWith(
        jasmine.objectContaining(validProduct)
      );
    });
  });
  
  // â”â”â” ERROR MESSAGES â”â”â”
  
  describe('Error Messages', () => {
    
    it('should return required error message', () => {
      const nombreControl = component.form.get('nombre')!;
      nombreControl.markAsTouched();
      
      const error = component.getError('nombre');
      expect(error).toBe('Este campo es requerido');
    });
    
    it('should return minlength error message', () => {
      const nombreControl = component.form.get('nombre')!;
      nombreControl.setValue('ab');
      nombreControl.markAsTouched();
      
      const error = component.getError('nombre');
      expect(error).toBe('MÃ­nimo 3 caracteres');
    });
    
    it('should return pattern error message', () => {
      const codigoControl = component.form.get('codigo')!;
      codigoControl.setValue('123');
      codigoControl.markAsTouched();
      
      const error = component.getError('codigo');
      expect(error).toBe('Formato invÃ¡lido');
    });
    
    it('should return empty string when no error', () => {
      const nombreControl = component.form.get('nombre')!;
      nombreControl.setValue('Valid Name');
      
      const error = component.getError('nombre');
      expect(error).toBe('');
    });
  });
  
  // â”â”â” EDIT MODE â”â”â”
  
  describe('Edit Mode', () => {
    
    it('should populate form when product is provided', () => {
      const existingProduct = {
        id: 1,
        nombre: 'Paracetamol 500mg',
        codigo: '7501234567890',
        precio: 25.50,
        stock: 100,
        stockMinimo: 10,
        categoriaId: 1,
        imagen: 'image.jpg'
      };
      
      component.product = existingProduct;
      component.ngOnInit();
      
      expect(component.form.value).toEqual(
        jasmine.objectContaining({
          nombre: existingProduct.nombre,
          codigo: existingProduct.codigo,
          precio: existingProduct.precio
        })
      );
    });
  });
});

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 3.1.4 Testing de Pipes
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

EJEMPLO: Testing de TimeAgoPipe

UBICACIÃ“N: src/app/shared/pipes/time-ago.pipe.spec.ts

import { TimeAgoPipe } from './time-ago.pipe';

describe('TimeAgoPipe', () => {
  let pipe: TimeAgoPipe;
  
  beforeEach(() => {
    pipe = new TimeAgoPipe();
  });
  
  it('should create', () => {
    expect(pipe).toBeTruthy();
  });
  
  // â”â”â” EDGE CASES â”â”â”
  
  it('should return empty string for null', () => {
    expect(pipe.transform(null as any)).toBe('');
  });
  
  it('should return empty string for undefined', () => {
    expect(pipe.transform(undefined as any)).toBe('');
  });
  
  // â”â”â” TIME RANGES â”â”â”
  
  it('should return "hace unos segundos" for recent time', () => {
    const now = new Date();
    const recent = new Date(now.getTime() - 30 * 1000); // 30 segundos atrÃ¡s
    
    expect(pipe.transform(recent)).toBe('hace unos segundos');
  });
  
  it('should return minutes for time < 1 hour', () => {
    const now = new Date();
    const fiveMinutesAgo = new Date(now.getTime() - 5 * 60 * 1000);
    
    expect(pipe.transform(fiveMinutesAgo)).toBe('hace 5 minutos');
  });
  
  it('should use singular for 1 minute', () => {
    const now = new Date();
    const oneMinuteAgo = new Date(now.getTime() - 60 * 1000);
    
    expect(pipe.transform(oneMinuteAgo)).toBe('hace 1 minuto');
  });
  
  it('should return hours for time < 1 day', () => {
    const now = new Date();
    const threeHoursAgo = new Date(now.getTime() - 3 * 60 * 60 * 1000);
    
    expect(pipe.transform(threeHoursAgo)).toBe('hace 3 horas');
  });
  
  it('should return days for time < 1 week', () => {
    const now = new Date();
    const twoDaysAgo = new Date(now.getTime() - 2 * 24 * 60 * 60 * 1000);
    
    expect(pipe.transform(twoDaysAgo)).toBe('hace 2 dÃ­as');
  });
  
  it('should return weeks for time < 1 month', () => {
    const now = new Date();
    const twoWeeksAgo = new Date(now.getTime() - 14 * 24 * 60 * 60 * 1000);
    
    expect(pipe.transform(twoWeeksAgo)).toBe('hace 2 semanas');
  });
  
  it('should return formatted date for time > 1 month', () => {
    const twoMonthsAgo = new Date('2024-09-01');
    const result = pipe.transform(twoMonthsAgo);
    
    expect(result).toMatch(/\d{1,2}\/\d{1,2}\/\d{4}/); // Formato de fecha
  });
  
  // â”â”â” INPUT FORMATS â”â”â”
  
  it('should accept Date object', () => {
    const date = new Date();
    expect(() => pipe.transform(date)).not.toThrow();
  });
  
  it('should accept ISO string', () => {
    const isoString = '2024-11-28T10:00:00Z';
    expect(() => pipe.transform(isoString)).not.toThrow();
  });
  
  it('should accept timestamp number', () => {
    const timestamp = Date.now();
    expect(() => pipe.transform(timestamp)).not.toThrow();
  });
});

MEJORES PRÃCTICAS DE TESTING:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ“ ARRANGE-ACT-ASSERT: Estructura clara de tests
âœ“ DESCRIPTIVE NAMES: Nombres que describen lo que se testea
âœ“ ONE ASSERTION PER TEST: Enfoque en un aspecto
âœ“ TEST EDGE CASES: null, undefined, empty, lÃ­mites
âœ“ MOCK DEPENDENCIES: Aislar componente bajo test
âœ“ CLEANUP: afterEach para limpiar
âœ“ COVERAGE >80%: Meta mÃ­nima de cobertura
âœ“ FAST TESTS: Tests deben ser rÃ¡pidos (<100ms)

âŒ NO testear detalles de implementaciÃ³n
âŒ NO hacer tests frÃ¡giles (dependientes de estructura DOM)
âŒ NO duplicar lÃ³gica de producciÃ³n en tests
âŒ NO tests que dependen de otros tests
âŒ NO ignorar tests fallidos

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  3.2 INTEGRATION TESTING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

OBJETIVO: Testear interacciÃ³n entre mÃºltiples componentes y servicios.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 3.2.1 Testing de PÃ¡ginas Completas
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

EJEMPLO: Testing de ProductListPage (integraciÃ³n completa)

UBICACIÃ“N: src/app/modules/inventory/pages/product-list.page.spec.ts

import { ComponentFixture, TestBed } from '@angular/core/testing';
import { ProductListPage } from './product-list.page';
import { ProductService } from '@services/product.service';
import { ToastService } from '@services/toast.service';
import { Router } from '@angular/router';
import { of, throwError } from 'rxjs';
import { Product } from '@models/product.model';
import { By } from '@angular/platform-browser';

describe('ProductListPage (Integration)', () => {
  let component: ProductListPage;
  let fixture: ComponentFixture<ProductListPage>;
  let productService: jasmine.SpyObj<ProductService>;
  let toastService: jasmine.SpyObj<ToastService>;
  let router: jasmine.SpyObj<Router>;
  
  const mockProducts: Product[] = [
    {
      id: 1,
      nombre: 'Paracetamol 500mg',
      codigo: '7501234567890',
      precio: 25.50,
      stock: 100,
      stockMinimo: 10,
      categoriaId: 1,
      categoria: { id: 1, nombre: 'AnalgÃ©sicos' },
      imagen: 'https://example.com/paracetamol.jpg'
    },
    {
      id: 2,
      nombre: 'Ibuprofeno 400mg',
      codigo: '7501234567891',
      precio: 35.00,
      stock: 5, // Stock bajo
      stockMinimo: 10,
      categoriaId: 1,
      categoria: { id: 1, nombre: 'AnalgÃ©sicos' },
      imagen: 'https://example.com/ibuprofeno.jpg'
    }
  ];
  
  beforeEach(async () => {
    // âœ… Crear spies de servicios
    const productServiceSpy = jasmine.createSpyObj('ProductService', [
      'getAll',
      'delete'
    ]);
    const toastServiceSpy = jasmine.createSpyObj('ToastService', [
      'success',
      'error'
    ]);
    const routerSpy = jasmine.createSpyObj('Router', ['navigate']);
    
    await TestBed.configureTestingModule({
      imports: [ProductListPage],
      providers: [
        { provide: ProductService, useValue: productServiceSpy },
        { provide: ToastService, useValue: toastServiceSpy },
        { provide: Router, useValue: routerSpy }
      ]
    }).compileComponents();
    
    productService = TestBed.inject(ProductService) as jasmine.SpyObj<ProductService>;
    toastService = TestBed.inject(ToastService) as jasmine.SpyObj<ToastService>;
    router = TestBed.inject(Router) as jasmine.SpyObj<Router>;
    
    fixture = TestBed.createComponent(ProductListPage);
    component = fixture.componentInstance;
  });
  
  // â”â”â” INITIAL LOAD â”â”â”
  
  describe('Initial Load', () => {
    
    it('should load products on init', async () => {
      productService.getAll.and.returnValue(of(mockProducts));
      
      fixture.detectChanges(); // Trigger ngOnInit
      await fixture.whenStable();
      
      expect(component.products.length).toBe(2);
      expect(component.loading).toBe(false);
    });
    
    it('should show loading state while fetching', () => {
      productService.getAll.and.returnValue(of(mockProducts));
      
      expect(component.loading).toBe(true);
      
      fixture.detectChanges();
      
      expect(component.loading).toBe(false);
    });
    
    it('should show skeleton loader during loading', () => {
      productService.getAll.and.returnValue(of(mockProducts));
      component.loading = true;
      fixture.detectChanges();
      
      const skeleton = fixture.debugElement.query(By.css('app-skeleton'));
      expect(skeleton).toBeTruthy();
    });
    
    it('should handle load error', async () => {
      const error = new Error('Network error');
      productService.getAll.and.returnValue(throwError(() => error));
      
      fixture.detectChanges();
      await fixture.whenStable();
      
      expect(toastService.error).toHaveBeenCalledWith('Error al cargar productos');
      expect(component.products.length).toBe(0);
    });
  });
  
  // â”â”â” RENDERING PRODUCTS â”â”â”
  
  describe('Rendering Products', () => {
    
    beforeEach(async () => {
      productService.getAll.and.returnValue(of(mockProducts));
      fixture.detectChanges();
      await fixture.whenStable();
      fixture.detectChanges();
    });
    
    it('should render product cards', () => {
      const cards = fixture.debugElement.queryAll(By.css('app-product-card'));
      expect(cards.length).toBe(2);
    });
    
    it('should pass correct product to each card', () => {
      const cards = fixture.debugElement.queryAll(By.css('app-product-card'));
      
      expect(cards[0].componentInstance.product).toEqual(mockProducts[0]);
      expect(cards[1].componentInstance.product).toEqual(mockProducts[1]);
    });
    
    it('should not show empty state when products exist', () => {
      const emptyState = fixture.debugElement.query(By.css('app-empty-state'));
      expect(emptyState).toBeFalsy();
    });
  });
  
  // â”â”â” EMPTY STATE â”â”â”
  
  describe('Empty State', () => {
    
    it('should show empty state when no products', async () => {
      productService.getAll.and.returnValue(of([]));
      
      fixture.detectChanges();
      await fixture.whenStable();
      fixture.detectChanges();
      
      const emptyState = fixture.debugElement.query(By.css('app-empty-state'));
      expect(emptyState).toBeTruthy();
    });
    
    it('should handle add product action from empty state', async () => {
      productService.getAll.and.returnValue(of([]));
      
      fixture.detectChanges();
      await fixture.whenStable();
      fixture.detectChanges();
      
      const emptyState = fixture.debugElement.query(By.css('app-empty-state'));
      emptyState.componentInstance.actionClick.emit();
      
      expect(router.navigate).toHaveBeenCalledWith(['/inventory/add']);
    });
  });
  
  // â”â”â” PRODUCT ACTIONS â”â”â”
  
  describe('Product Actions', () => {
    
    beforeEach(async () => {
      productService.getAll.and.returnValue(of(mockProducts));
      fixture.detectChanges();
      await fixture.whenStable();
      fixture.detectChanges();
    });
    
    it('should navigate to edit page when edit clicked', () => {
      const firstCard = fixture.debugElement.query(By.css('app-product-card'));
      firstCard.componentInstance.edit.emit(mockProducts[0]);
      
      expect(router.navigate).toHaveBeenCalledWith(['/inventory/edit', 1]);
    });
    
    it('should delete product when confirmed', async () => {
      spyOn(window, 'confirm').and.returnValue(true);
      productService.delete.and.returnValue(of(void 0));
      
      const firstCard = fixture.debugElement.query(By.css('app-product-card'));
      firstCard.componentInstance.delete.emit(mockProducts[0]);
      
      await fixture.whenStable();
      
      expect(productService.delete).toHaveBeenCalledWith(1);
      expect(toastService.success).toHaveBeenCalledWith(
        'Producto eliminado correctamente'
      );
      expect(component.products.length).toBe(1);
    });
    
    it('should not delete product when cancelled', async () => {
      spyOn(window, 'confirm').and.returnValue(false);
      
      const firstCard = fixture.debugElement.query(By.css('app-product-card'));
      firstCard.componentInstance.delete.emit(mockProducts[0]);
      
      await fixture.whenStable();
      
      expect(productService.delete).not.toHaveBeenCalled();
      expect(component.products.length).toBe(2);
    });
    
    it('should handle delete error', async () => {
      spyOn(window, 'confirm').and.returnValue(true);
      const error = new Error('Delete failed');
      productService.delete.and.returnValue(throwError(() => error));
      
      const firstCard = fixture.debugElement.query(By.css('app-product-card'));
      firstCard.componentInstance.delete.emit(mockProducts[0]);
      
      await fixture.whenStable();
      
      expect(toastService.error).toHaveBeenCalledWith('Error al eliminar producto');
      expect(component.products.length).toBe(2); // No se eliminÃ³
    });
  });
  
  // â”â”â” ADD TO CART â”â”â”
  
  describe('Add to Cart', () => {
    
    beforeEach(async () => {
      productService.getAll.and.returnValue(of(mockProducts));
      fixture.detectChanges();
      await fixture.whenStable();
      fixture.detectChanges();
    });
    
    it('should add product to cart', () => {
      spyOn(component.cartService, 'addItem');
      
      const firstCard = fixture.debugElement.query(By.css('app-product-card'));
      firstCard.componentInstance.addToCart.emit(mockProducts[0]);
      
      expect(component.cartService.addItem).toHaveBeenCalledWith(
        mockProducts[0],
        1
      );
      expect(toastService.success).toHaveBeenCalled();
    });
  });
  
  // â”â”â” TRACKBY â”â”â”
  
  describe('TrackBy', () => {
    
    it('should track products by id', () => {
      const product = mockProducts[0];
      const result = component.trackById(0, product);
      
      expect(result).toBe(product.id);
    });
  });
});

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 3.2.2 Testing de Stores
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

EJEMPLO: Testing de CartStore

UBICACIÃ“N: src/app/core/store/cart.store.spec.ts

import { TestBed } from '@angular/core/testing';
import { CartStore } from './cart.store';
import { Product } from '@models/product.model';

describe('CartStore', () => {
  let store: CartStore;
  
  const mockProduct: Product = {
    id: 1,
    nombre: 'Paracetamol 500mg',
    codigo: '7501234567890',
    precio: 25.50,
    stock: 100,
    stockMinimo: 10,
    categoriaId: 1,
    categoria: { id: 1, nombre: 'AnalgÃ©sicos' },
    imagen: 'https://example.com/paracetamol.jpg'
  };
  
  beforeEach(() => {
    TestBed.configureTestingModule({
      providers: [CartStore]
    });
    
    store = TestBed.inject(CartStore);
    localStorage.clear();
  });
  
  afterEach(() => {
    localStorage.clear();
  });
  
  it('should be created', () => {
    expect(store).toBeTruthy();
  });
  
  // â”â”â” INITIAL STATE â”â”â”
  
  describe('Initial State', () => {
    
    it('should have empty initial state', (done) => {
      store.items$.subscribe(items => {
        expect(items).toEqual([]);
        done();
      });
    });
    
    it('should have zero total', (done) => {
      store.total$.subscribe(total => {
        expect(total).toBe(0);
        done();
      });
    });
    
    it('should have zero item count', (done) => {
      store.itemCount$.subscribe(count => {
        expect(count).toBe(0);
        done();
      });
    });
    
    it('should be empty', (done) => {
      store.isEmpty$.subscribe(isEmpty => {
        expect(isEmpty).toBe(true);
        done();
      });
    });
  });
  
  // â”â”â” ADD ITEM â”â”â”
  
  describe('addItem()', () => {
    
    it('should add new item to cart', (done) => {
      store.addItem(mockProduct, 2);
      
      store.items$.subscribe(items => {
        expect(items.length).toBe(1);
        expect(items[0].product).toEqual(mockProduct);
        expect(items[0].quantity).toBe(2);
        expect(items[0].subtotal).toBe(51); // 25.50 * 2
        done();
      });
    });
    
    it('should increment quantity if product exists', (done) => {
      store.addItem(mockProduct, 2);
      store.addItem(mockProduct, 3);
      
      store.items$.subscribe(items => {
        expect(items.length).toBe(1);
        expect(items[0].quantity).toBe(5);
        expect(items[0].subtotal).toBe(127.5); // 25.50 * 5
        done();
      });
    });
    
    it('should update total', (done) => {
      store.addItem(mockProduct, 2);
      
      store.total$.subscribe(total => {
        expect(total).toBe(51);
        done();
      });
    });
    
    it('should update item count', (done) => {
      store.addItem(mockProduct, 2);
      
      store.itemCount$.subscribe(count => {
        expect(count).toBe(2);
        done();
      });
    });
    
    it('should set isEmpty to false', (done) => {
      store.addItem(mockProduct, 1);
      
      store.isEmpty$.subscribe(isEmpty => {
        expect(isEmpty).toBe(false);
        done();
      });
    });
  });
  
  // â”â”â” REMOVE ITEM â”â”â”
  
  describe('removeItem()', () => {
    
    beforeEach(() => {
      store.addItem(mockProduct, 2);
    });
    
    it('should remove item from cart', (done) => {
      store.removeItem(mockProduct.id);
      
      store.items$.subscribe(items => {
        expect(items.length).toBe(0);
        done();
      });
    });
    
    it('should update total after removal', (done) => {
      store.removeItem(mockProduct.id);
      
      store.total$.subscribe(total => {
        expect(total).toBe(0);
        done();
      });
    });
  });
  
  // â”â”â” UPDATE QUANTITY â”â”â”
  
  describe('updateQuantity()', () => {
    
    beforeEach(() => {
      store.addItem(mockProduct, 2);
    });
    
    it('should update item quantity', (done) => {
      store.updateQuantity(mockProduct.id, 5);
      
      store.items$.subscribe(items => {
        expect(items[0].quantity).toBe(5);
        expect(items[0].subtotal).toBe(127.5);
        done();
      });
    });
    
    it('should remove item if quantity is 0', (done) => {
      store.updateQuantity(mockProduct.id, 0);
      
      store.items$.subscribe(items => {
        expect(items.length).toBe(0);
        done();
      });
    });
    
    it('should remove item if quantity is negative', (done) => {
      store.updateQuantity(mockProduct.id, -1);
      
      store.items$.subscribe(items => {
        expect(items.length).toBe(0);
        done();
      });
    });
  });
  
  // â”â”â” CLEAR â”â”â”
  
  describe('clear()', () => {
    
    beforeEach(() => {
      store.addItem(mockProduct, 2);
    });
    
    it('should clear all items', (done) => {
      store.clear();
      
      store.items$.subscribe(items => {
        expect(items.length).toBe(0);
        done();
      });
    });
    
    it('should reset total', (done) => {
      store.clear();
      
      store.total$.subscribe(total => {
        expect(total).toBe(0);
        done();
      });
    });
  });
  
  // â”â”â” PERSISTENCE â”â”â”
  
  describe('LocalStorage Persistence', () => {
    
    it('should save to localStorage when adding item', () => {
      store.addItem(mockProduct, 2);
      
      const stored = localStorage.getItem('cart');
      expect(stored).toBeTruthy();
      
      const items = JSON.parse(stored!);
      expect(items.length).toBe(1);
    });
    
    it('should load from localStorage on init', () => {
      // Simular datos guardados
      const savedItems = [{
        product: mockProduct,
        quantity: 3,
        subtotal: 76.5
      }];
      localStorage.setItem('cart', JSON.stringify(savedItems));
      
      // Crear nueva instancia (simula reload)
      const newStore = new CartStore();
      
      newStore.items$.subscribe(items => {
        expect(items.length).toBe(1);
        expect(items[0].quantity).toBe(3);
      });
    });
  });
  
  // â”â”â” MULTIPLE PRODUCTS â”â”â”
  
  describe('Multiple Products', () => {
    
    const product2: Product = {
      ...mockProduct,
      id: 2,
      nombre: 'Ibuprofeno 400mg',
      precio: 35.00
    };
    
    it('should handle multiple different products', (done) => {
      store.addItem(mockProduct, 2);
      store.addItem(product2, 1);
      
      store.items$.subscribe(items => {
        expect(items.length).toBe(2);
        done();
      });
    });
    
    it('should calculate total for multiple products', (done) => {
      store.addItem(mockProduct, 2); // 51
      store.addItem(product2, 1);    // 35
      
      store.total$.subscribe(total => {
        expect(total).toBe(86); // 51 + 35
        done();
      });
    });
    
    it('should calculate item count for multiple products', (done) => {
      store.addItem(mockProduct, 2);
      store.addItem(product2, 3);
      
      store.itemCount$.subscribe(count => {
        expect(count).toBe(5); // 2 + 3
        done();
      });
    });
  });
});

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  3.3 END-TO-END TESTING (E2E)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

OBJETIVO: Testear flujos completos de usuario en ambiente real.

HERRAMIENTA RECOMENDADA: Cypress (mÃ¡s fÃ¡cil) o Playwright (mÃ¡s potente)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 3.3.1 ConfiguraciÃ³n de Cypress
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

INSTALACIÃ“N:

```bash
# Instalar Cypress
npm install --save-dev cypress

# Abrir Cypress (primera vez)
npx cypress open

# Ejecutar tests en headless
npx cypress run
```

CONFIGURACIÃ“N: cypress.config.ts

import { defineConfig } from 'cypress';

export default defineConfig({
  e2e: {
    baseUrl: 'http://localhost:8100',
    specPattern: 'cypress/e2e/**/*.cy.ts',
    supportFile: 'cypress/support/e2e.ts',
    viewportWidth: 375,  // iPhone size
    viewportHeight: 667,
    video: true,
    screenshotOnRunFailure: true,
    setupNodeEvents(on, config) {
      // implement node event listeners here
    },
  },
});

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 3.3.2 E2E Test Examples
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

EJEMPLO 1: Login Flow

UBICACIÃ“N: cypress/e2e/auth/login.cy.ts

describe('Login Flow', () => {
  
  beforeEach(() => {
    cy.visit('/login');
  });
  
  it('should display login page', () => {
    cy.get('ion-title').should('contain', 'Iniciar SesiÃ³n');
    cy.get('input[type="email"]').should('be.visible');
    cy.get('input[type="password"]').should('be.visible');
    cy.get('ion-button[type="submit"]').should('be.visible');
  });
  
  it('should show validation errors for empty fields', () => {
    cy.get('ion-button[type="submit"]').click();
    
    cy.get('.error-message')
      .should('be.visible')
      .and('contain', 'requerido');
  });
  
  it('should show error for invalid email', () => {
    cy.get('input[type="email"]').type('invalid-email');
    cy.get('input[type="password"]').type('password123');
    cy.get('ion-button[type="submit"]').click();
    
    cy.get('.error-message')
      .should('contain', 'correo electrÃ³nico vÃ¡lido');
  });
  
  it('should login successfully with valid credentials', () => {
    cy.get('input[type="email"]').type('admin@gestpharma.com');
    cy.get('input[type="password"]').type('Admin123!');
    cy.get('ion-button[type="submit"]').click();
    
    // Should redirect to home
    cy.url().should('include', '/home');
    cy.get('ion-title').should('contain', 'Inicio');
  });
  
  it('should show error for invalid credentials', () => {
    cy.get('input[type="email"]').type('wrong@example.com');
    cy.get('input[type="password"]').type('wrongpassword');
    cy.get('ion-button[type="submit"]').click();
    
    cy.get('ion-toast')
      .should('be.visible')
      .and('contain', 'Credenciales invÃ¡lidas');
  });
  
  it('should persist session after reload', () => {
    // Login
    cy.get('input[type="email"]').type('admin@gestpharma.com');
    cy.get('input[type="password"]').type('Admin123!');
    cy.get('ion-button[type="submit"]').click();
    
    cy.url().should('include', '/home');
    
    // Reload page
    cy.reload();
    
    // Should still be logged in
    cy.url().should('include', '/home');
  });
});

EJEMPLO 2: Product Management Flow

UBICACIÃ“N: cypress/e2e/inventory/product-management.cy.ts

describe('Product Management', () => {
  
  beforeEach(() => {
    // Login first
    cy.login('admin@gestpharma.com', 'Admin123!');
    cy.visit('/inventory/products');
  });
  
  it('should display product list', () => {
    cy.get('ion-title').should('contain', 'Productos');
    cy.get('app-product-card').should('have.length.gt', 0);
  });
  
  it('should search products', () => {
    cy.get('ion-searchbar').type('Paracetamol');
    
    // Wait for debounce
    cy.wait(500);
    
    cy.get('app-product-card')
      .should('have.length.gt', 0)
      .first()
      .should('contain', 'Paracetamol');
  });
  
  it('should create new product', () => {
    // Click add button
    cy.get('ion-button[aria-label*="Agregar"]').click();
    
    // Fill form
    cy.get('input[formControlName="nombre"]')
      .type('Test Product');
    
    cy.get('input[formControlName="codigo"]')
      .type('7501234567890');
    
    cy.get('input[formControlName="precio"]')
      .type('50.00');
    
    cy.get('input[formControlName="stock"]')
      .type('100');
    
    cy.get('input[formControlName="stockMinimo"]')
      .type('10');
    
    cy.get('ion-select[formControlName="categoriaId"]')
      .click();
    cy.get('ion-alert button').contains('AnalgÃ©sicos').click();
    cy.get('ion-alert button').contains('OK').click();
    
    // Submit
    cy.get('ion-button[type="submit"]').click();
    
    // Verify success
    cy.get('ion-toast')
      .should('contain', 'Producto creado');
    
    cy.url().should('include', '/inventory/products');
    
    // Verify product appears in list
    cy.get('app-product-card')
      .should('contain', 'Test Product');
  });
  
  it('should edit existing product', () => {
    // Click edit on first product
    cy.get('app-product-card')
      .first()
      .find('ion-button[aria-label*="Editar"]')
      .click();
    
    // Update price
    cy.get('input[formControlName="precio"]')
      .clear()
      .type('75.00');
    
    // Submit
    cy.get('ion-button[type="submit"]').click();
    
    // Verify success
    cy.get('ion-toast')
      .should('contain', 'Producto actualizado');
  });
  
  it('should delete product', () => {
    // Get initial count
    cy.get('app-product-card').then($cards => {
      const initialCount = $cards.length;
      
      // Click delete on first product
      cy.get('app-product-card')
        .first()
        .find('ion-button[aria-label*="Eliminar"]')
        .click();
      
      // Confirm deletion
      cy.get('ion-alert button').contains('Eliminar').click();
      
      // Verify success
      cy.get('ion-toast')
        .should('contain', 'Producto eliminado');
      
      // Verify count decreased
      cy.get('app-product-card')
        .should('have.length', initialCount - 1);
    });
  });
  
  it('should show low stock badge', () => {
    cy.get('app-product-card')
      .filter(':contains("Ibuprofeno")') // Producto con stock bajo
      .find('ion-badge[color="warning"]')
      .should('contain', 'Stock Bajo');
  });
});

EJEMPLO 3: POS (Point of Sale) Flow

UBICACIÃ“N: cypress/e2e/pos/sale-process.cy.ts

describe('Point of Sale', () => {
  
  beforeEach(() => {
    cy.login('cashier@gestpharma.com', 'Cashier123!');
    cy.visit('/pos');
  });
  
  it('should complete sale process', () => {
    // Search product
    cy.get('ion-searchbar').type('Paracetamol');
    cy.wait(500);
    
    // Add to cart
    cy.get('app-product-card')
      .first()
      .find('ion-button').contains('Agregar')
      .click();
    
    // Verify added to cart
    cy.get('.cart-badge').should('contain', '1');
    
    // Open cart
    cy.get('ion-button[aria-label*="Carrito"]').click();
    
    // Verify product in cart
    cy.get('.cart-item')
      .should('have.length', 1)
      .and('contain', 'Paracetamol');
    
    // Update quantity
    cy.get('.cart-item')
      .find('ion-button[aria-label*="Aumentar"]')
      .click();
    
    cy.get('.cart-item')
      .find('.quantity')
      .should('contain', '2');
    
    // Proceed to checkout
    cy.get('ion-button').contains('Proceder al Pago').click();
    
    // Select payment method
    cy.get('ion-radio').first().click();
    
    // Complete sale
    cy.get('ion-button').contains('Completar Venta').click();
    
    // Verify success
    cy.get('ion-toast')
      .should('contain', 'Venta realizada exitosamente');
    
    // Verify cart is empty
    cy.get('.cart-badge').should('not.exist');
  });
});

CUSTOM COMMANDS:

UBICACIÃ“N: cypress/support/commands.ts

// Login command
Cypress.Commands.add('login', (email: string, password: string) => {
  cy.session([email, password], () => {
    cy.visit('/login');
    cy.get('input[type="email"]').type(email);
    cy.get('input[type="password"]').type(password);
    cy.get('ion-button[type="submit"]').click();
    cy.url().should('include', '/home');
  });
});

// Type declarations
declare global {
  namespace Cypress {
    interface Chainable {
      login(email: string, password: string): Chainable<void>;
    }
  }
}

MEJORES PRÃCTICAS E2E:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ“ Testear flujos crÃ­ticos de usuario
âœ“ Usar data-cy attributes para selectores estables
âœ“ Implementar custom commands para acciones comunes
âœ“ Usar cy.session() para compartir auth
âœ“ Tests independientes (no dependen de orden)
âœ“ Limpiar datos entre tests
âœ“ Screenshots y videos para debugging
âœ“ Ejecutar en CI/CD

âŒ NO usar selectores frÃ¡giles (classes CSS)
âŒ NO hacer tests muy largos (dividir en casos)
âŒ NO hardcodear valores que cambian
âŒ NO olvidar waits para operaciones async

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  3.4 ACCESSIBILITY TESTING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

OBJETIVO: Garantizar WCAG 2.1 AAA compliance.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 3.4.1 Automated Accessibility Testing
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

HERRAMIENTAS:
â€¢ axe-core: LibrerÃ­a de testing de accesibilidad
â€¢ cypress-axe: IntegraciÃ³n con Cypress
â€¢ pa11y: CLI para auditorÃ­as

INSTALACIÃ“N:

```bash
npm install --save-dev axe-core cypress-axe
```

CONFIGURACIÃ“N: cypress/support/e2e.ts

import 'cypress-axe';

EJEMPLO: Accessibility Tests

UBICACIÃ“N: cypress/e2e/accessibility/wcag-compliance.cy.ts

describe('WCAG Compliance', () => {
  
  beforeEach(() => {
    cy.visit('/');
    cy.injectAxe();
  });
  
  it('should have no accessibility violations on home page', () => {
    cy.checkA11y();
  });
  
  it('should have no violations on product list', () => {
    cy.login('admin@gestpharma.com', 'Admin123!');
    cy.visit('/inventory/products');
    cy.injectAxe();
    cy.checkA11y();
  });
  
  it('should have proper heading hierarchy', () => {
    cy.get('h1').should('have.length', 1);
    
    // Verificar que h2 viene despuÃ©s de h1
    cy.get('h1').then($h1 => {
      cy.get('h2').should('exist');
    });
  });
  
  it('should have alt text on all images', () => {
    cy.get('img').each($img => {
      cy.wrap($img).should('have.attr', 'alt');
    });
  });
  
  it('should have labels for all form inputs', () => {
    cy.visit('/inventory/add');
    
    cy.get('input, select, textarea').each($input => {
      const id = $input.attr('id');
      if (id) {
        cy.get(`label[for="${id}"]`).should('exist');
      }
    });
  });
  
  it('should have sufficient color contrast', () => {
    cy.checkA11y(null, {
      rules: {
        'color-contrast': { enabled: true }
      }
    });
  });
  
  it('should be keyboard navigable', () => {
    cy.get('ion-button').first().focus();
    cy.focused().should('have.class', 'ion-button');
    
    // Tab through focusable elements
    cy.realPress('Tab');
    cy.focused().should('be.visible');
  });
  
  it('should have proper ARIA roles', () => {
    cy.get('[role="navigation"]').should('exist');
    cy.get('[role="main"]').should('exist');
  });
  
  it('should announce dynamic content to screen readers', () => {
    cy.get('[aria-live]').should('exist');
  });
});

UNIT TEST CON AXE:

import { ComponentFixture, TestBed } from '@angular/core/testing';
import { axe, toHaveNoViolations } from 'jasmine-axe';
import { ProductCardComponent } from './product-card.component';

describe('ProductCardComponent Accessibility', () => {
  let fixture: ComponentFixture<ProductCardComponent>;
  
  beforeEach(() => {
    jasmine.addMatchers(toHaveNoViolations);
  });
  
  it('should have no accessibility violations', async () => {
    const results = await axe(fixture.nativeElement);
    expect(results).toHaveNoViolations();
  });
});

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 3.4.2 Manual Accessibility Checklist
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

CHECKLIST DE VERIFICACIÃ“N MANUAL:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NAVEGACIÃ“N POR TECLADO                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â˜ Todos los elementos interactivos accesibles con Tab                      â”‚
â”‚ â˜ Orden de tabulaciÃ³n lÃ³gico                                               â”‚
â”‚ â˜ Focus visible en todos los elementos                                     â”‚
â”‚ â˜ Trampas de teclado evitadas                                              â”‚
â”‚ â˜ Atajos de teclado documentados                                           â”‚
â”‚ â˜ Skip links funcionales                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SCREEN READERS                                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â˜ Testear con NVDA (Windows)                                               â”‚
â”‚ â˜ Testear con JAWS (Windows)                                               â”‚
â”‚ â˜ Testear con VoiceOver (macOS/iOS)                                        â”‚
â”‚ â˜ Testear con TalkBack (Android)                                           â”‚
â”‚ â˜ Contenido dinÃ¡mico anunciado                                             â”‚
â”‚ â˜ Mensajes de error anunciados                                             â”‚
â”‚ â˜ Loading states anunciados                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CONTENIDO VISUAL                                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â˜ Contraste de color â‰¥ 7:1 (AAA)                                           â”‚
â”‚ â˜ Texto redimensionable hasta 200%                                         â”‚
â”‚ â˜ No depender solo de color                                                â”‚
â”‚ â˜ Textos alternativos en imÃ¡genes                                          â”‚
â”‚ â˜ Transcripciones para audio                                               â”‚
â”‚ â˜ SubtÃ­tulos para video                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FORMULARIOS                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â˜ Labels asociados a inputs                                                â”‚
â”‚ â˜ Instrucciones claras                                                     â”‚
â”‚ â˜ Errores identificables                                                   â”‚
â”‚ â˜ Sugerencias de correcciÃ³n                                                â”‚
â”‚ â˜ ConfirmaciÃ³n de acciones crÃ­ticas                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  3.5 PERFORMANCE TESTING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

OBJETIVO: Garantizar rendimiento Ã³ptimo en dispositivos reales.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 3.5.1 Lighthouse Performance Testing
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

HERRAMIENTAS:
â€¢ Lighthouse CI: Testing automatizado de performance
â€¢ Chrome DevTools: AnÃ¡lisis manual
â€¢ WebPageTest: Testing multi-regiÃ³n

INSTALACIÃ“N:

```bash
# Lighthouse CI
npm install --save-dev @lhci/cli

# Script de package.json
"scripts": {
  "lighthouse": "lhci autorun"
}
```

CONFIGURACIÃ“N: lighthouserc.json

{
  "ci": {
    "collect": {
      "startServerCommand": "npm run start",
      "url": [
        "http://localhost:8100",
        "http://localhost:8100/inventory/products",
        "http://localhost:8100/pos"
      ],
      "numberOfRuns": 3,
      "settings": {
        "preset": "desktop",
        "throttling": {
          "rttMs": 40,
          "throughputKbps": 10240,
          "cpuSlowdownMultiplier": 1
        }
      }
    },
    "assert": {
      "assertions": {
        "categories:performance": ["error", {"minScore": 0.9}],
        "categories:accessibility": ["error", {"minScore": 0.95}],
        "categories:best-practices": ["error", {"minScore": 0.9}],
        "categories:seo": ["error", {"minScore": 0.9}],
        
        // Performance metrics
        "first-contentful-paint": ["error", {"maxNumericValue": 2000}],
        "largest-contentful-paint": ["error", {"maxNumericValue": 2500}],
        "cumulative-layout-shift": ["error", {"maxNumericValue": 0.1}],
        "total-blocking-time": ["error", {"maxNumericValue": 300}],
        "speed-index": ["error", {"maxNumericValue": 3000}],
        
        // Bundle size
        "resource-summary:script:size": ["error", {"maxNumericValue": 500000}],
        "resource-summary:stylesheet:size": ["error", {"maxNumericValue": 50000}],
        "resource-summary:image:size": ["error", {"maxNumericValue": 1000000}],
        
        // Best practices
        "uses-http2": "error",
        "uses-text-compression": "error",
        "efficient-animated-content": "error",
        "offscreen-images": "warn",
        "unminified-css": "error",
        "unminified-javascript": "error",
        "unused-css-rules": "warn",
        "unused-javascript": "warn",
        "modern-image-formats": "warn"
      }
    },
    "upload": {
      "target": "temporary-public-storage"
    }
  }
}

MÃ‰TRICAS OBJETIVO (WCAG AAA + Mobile):
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MÃ‰TRICA                              â”‚ OBJETIVO  â”‚ EXCELENTE â”‚ CRÃTICO    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ First Contentful Paint (FCP)         â”‚ < 1.8s    â”‚ < 1.0s    â”‚ < 2.0s     â”‚
â”‚ Largest Contentful Paint (LCP)       â”‚ < 2.5s    â”‚ < 1.5s    â”‚ < 4.0s     â”‚
â”‚ Time to Interactive (TTI)            â”‚ < 3.8s    â”‚ < 2.5s    â”‚ < 5.0s     â”‚
â”‚ Total Blocking Time (TBT)            â”‚ < 200ms   â”‚ < 100ms   â”‚ < 300ms    â”‚
â”‚ Cumulative Layout Shift (CLS)        â”‚ < 0.1     â”‚ < 0.05    â”‚ < 0.25     â”‚
â”‚ Speed Index                          â”‚ < 3.0s    â”‚ < 2.0s    â”‚ < 4.3s     â”‚
â”‚ First Input Delay (FID)              â”‚ < 100ms   â”‚ < 50ms    â”‚ < 300ms    â”‚
â”‚                                      â”‚           â”‚           â”‚            â”‚
â”‚ LIGHTHOUSE SCORES:                   â”‚           â”‚           â”‚            â”‚
â”‚ - Performance                        â”‚ â‰¥ 90      â”‚ â‰¥ 95      â”‚ â‰¥ 80       â”‚
â”‚ - Accessibility                      â”‚ â‰¥ 95      â”‚ 100       â”‚ â‰¥ 90       â”‚
â”‚ - Best Practices                     â”‚ â‰¥ 90      â”‚ 100       â”‚ â‰¥ 85       â”‚
â”‚ - SEO                                â”‚ â‰¥ 90      â”‚ 100       â”‚ â‰¥ 85       â”‚
â”‚                                      â”‚           â”‚           â”‚            â”‚
â”‚ BUNDLE SIZES:                        â”‚           â”‚           â”‚            â”‚
â”‚ - Initial JS Bundle                  â”‚ < 300KB   â”‚ < 200KB   â”‚ < 500KB    â”‚
â”‚ - CSS Bundle                         â”‚ < 50KB    â”‚ < 30KB    â”‚ < 75KB     â”‚
â”‚ - Total Page Weight                  â”‚ < 1.5MB   â”‚ < 1.0MB   â”‚ < 2.0MB    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 3.5.2 Bundle Analysis
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

HERRAMIENTA: webpack-bundle-analyzer

INSTALACIÃ“N:

```bash
npm install --save-dev webpack-bundle-analyzer
```

CONFIGURACIÃ“N: angular.json

```json
{
  "projects": {
    "app": {
      "architect": {
        "build": {
          "configurations": {
            "analyze": {
              "budgets": [
                {
                  "type": "initial",
                  "maximumWarning": "300kb",
                  "maximumError": "500kb"
                },
                {
                  "type": "anyComponentStyle",
                  "maximumWarning": "6kb",
                  "maximumError": "10kb"
                }
              ],
              "statsJson": true
            }
          }
        }
      }
    }
  }
}
```

SCRIPTS: package.json

```json
{
  "scripts": {
    "analyze": "ng build --configuration analyze && webpack-bundle-analyzer dist/app/stats.json",
    "analyze:size": "ng build --stats-json && npx source-map-explorer dist/app/**/*.js"
  }
}
```

EJEMPLO: Automated Bundle Size Test

UBICACIÃ“N: cypress/e2e/performance/bundle-size.cy.ts

describe('Bundle Size Performance', () => {
  
  it('should have acceptable bundle sizes', () => {
    cy.visit('/');
    
    cy.window().then((win) => {
      // Analyze resources loaded
      const resources = win.performance.getEntriesByType('resource');
      
      // JS bundles
      const jsBundles = resources.filter(r => r.name.endsWith('.js'));
      const totalJsSize = jsBundles.reduce((sum, r) => {
        return sum + (r.transferSize || 0);
      }, 0);
      
      expect(totalJsSize).to.be.lessThan(500000); // 500KB
      
      // CSS bundles
      const cssBundles = resources.filter(r => r.name.endsWith('.css'));
      const totalCssSize = cssBundles.reduce((sum, r) => {
        return sum + (r.transferSize || 0);
      }, 0);
      
      expect(totalCssSize).to.be.lessThan(50000); // 50KB
      
      // Log sizes
      cy.log(`Total JS: ${(totalJsSize / 1024).toFixed(2)} KB`);
      cy.log(`Total CSS: ${(totalCssSize / 1024).toFixed(2)} KB`);
    });
  });
});

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 3.5.3 Runtime Performance Testing
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

EJEMPLO: Page Load Performance

UBICACIÃ“N: cypress/e2e/performance/page-load.cy.ts

describe('Page Load Performance', () => {
  
  it('should load home page within performance budget', () => {
    cy.visit('/', {
      onBeforeLoad: (win) => {
        // Start measuring
        win.performance.mark('test-start');
      }
    });
    
    cy.window().then((win) => {
      win.performance.mark('test-end');
      win.performance.measure('test-duration', 'test-start', 'test-end');
      
      const measure = win.performance.getEntriesByName('test-duration')[0];
      
      // Total load time should be < 3s
      expect(measure.duration).to.be.lessThan(3000);
      
      // Check paint metrics
      const fcp = win.performance.getEntriesByName('first-contentful-paint')[0];
      expect(fcp.startTime).to.be.lessThan(2000);
      
      cy.log(`FCP: ${fcp.startTime.toFixed(2)}ms`);
    });
  });
  
  it('should load product list efficiently', () => {
    cy.visit('/inventory/products');
    
    cy.get('app-product-card').should('have.length.gt', 0);
    
    cy.window().then((win) => {
      const navigation = win.performance.getEntriesByType('navigation')[0];
      
      // Time to interactive
      expect(navigation.domInteractive).to.be.lessThan(2000);
      
      // DOM content loaded
      expect(navigation.domContentLoadedEventEnd).to.be.lessThan(2500);
      
      cy.log(`DOM Interactive: ${navigation.domInteractive.toFixed(2)}ms`);
    });
  });
});

EJEMPLO: Rendering Performance

UBICACIÃ“N: cypress/e2e/performance/rendering.cy.ts

describe('Rendering Performance', () => {
  
  beforeEach(() => {
    cy.login('admin@gestpharma.com', 'Admin123!');
  });
  
  it('should scroll large lists smoothly', () => {
    cy.visit('/inventory/products');
    
    // Measure FPS during scroll
    cy.window().then((win) => {
      let frameCount = 0;
      let startTime = win.performance.now();
      
      const measureFPS = () => {
        frameCount++;
        const currentTime = win.performance.now();
        const elapsed = currentTime - startTime;
        
        if (elapsed >= 1000) {
          const fps = Math.round((frameCount * 1000) / elapsed);
          
          // Should maintain at least 30 FPS (smooth scrolling)
          expect(fps).to.be.greaterThan(30);
          
          cy.log(`FPS: ${fps}`);
          return;
        }
        
        win.requestAnimationFrame(measureFPS);
      };
      
      // Start scrolling
      cy.get('ion-content').scrollTo('bottom', { duration: 2000 });
      
      // Measure FPS
      win.requestAnimationFrame(measureFPS);
    });
  });
  
  it('should not cause layout thrashing', () => {
    cy.visit('/inventory/products');
    
    cy.window().then((win) => {
      const observer = new win.PerformanceObserver((list) => {
        const entries = list.getEntries();
        
        entries.forEach((entry) => {
          if (entry.name === 'layout-shift') {
            // CLS should be < 0.1
            expect(entry.value).to.be.lessThan(0.1);
          }
        });
      });
      
      observer.observe({ entryTypes: ['layout-shift'] });
      
      // Trigger interactions
      cy.get('ion-searchbar').type('test');
      cy.wait(1000);
    });
  });
});

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 3.5.4 Memory Leak Detection
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

EJEMPLO: Memory Leak Test

UBICACIÃ“N: cypress/e2e/performance/memory-leaks.cy.ts

describe('Memory Leak Detection', () => {
  
  it('should not leak memory when navigating pages', () => {
    cy.login('admin@gestpharma.com', 'Admin123!');
    
    let initialMemory = 0;
    
    cy.window().then((win) => {
      if (win.performance.memory) {
        initialMemory = win.performance.memory.usedJSHeapSize;
        cy.log(`Initial Memory: ${(initialMemory / 1024 / 1024).toFixed(2)} MB`);
      }
    });
    
    // Navigate through pages multiple times
    for (let i = 0; i < 5; i++) {
      cy.visit('/inventory/products');
      cy.wait(500);
      cy.visit('/pos');
      cy.wait(500);
      cy.visit('/reports');
      cy.wait(500);
    }
    
    // Force garbage collection (if available)
    cy.window().then((win) => {
      if (win.gc) {
        win.gc();
      }
    });
    
    cy.wait(1000);
    
    cy.window().then((win) => {
      if (win.performance.memory) {
        const finalMemory = win.performance.memory.usedJSHeapSize;
        const memoryIncrease = finalMemory - initialMemory;
        const increasePercent = (memoryIncrease / initialMemory) * 100;
        
        cy.log(`Final Memory: ${(finalMemory / 1024 / 1024).toFixed(2)} MB`);
        cy.log(`Increase: ${increasePercent.toFixed(2)}%`);
        
        // Memory increase should be < 50%
        expect(increasePercent).to.be.lessThan(50);
      }
    });
  });
  
  it('should clean up subscriptions on component destroy', () => {
    cy.visit('/inventory/products');
    
    // Get initial subscription count (if exposed in dev mode)
    cy.window().then((win) => {
      const initialSubs = (win as any).__rxjsSubscriptionCount || 0;
      cy.log(`Initial Subscriptions: ${initialSubs}`);
      
      // Navigate away
      cy.visit('/pos');
      cy.wait(500);
      
      // Check subscriptions again
      const finalSubs = (win as any).__rxjsSubscriptionCount || 0;
      cy.log(`Final Subscriptions: ${finalSubs}`);
      
      // Should not accumulate subscriptions
      expect(finalSubs).to.be.lessThan(initialSubs + 10);
    });
  });
});

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 3.5.5 Network Performance
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

EJEMPLO: API Response Time Test

UBICACIÃ“N: cypress/e2e/performance/api-performance.cy.ts

describe('API Performance', () => {
  
  beforeEach(() => {
    cy.login('admin@gestpharma.com', 'Admin123!');
  });
  
  it('should load products within acceptable time', () => {
    cy.intercept('GET', '/api/products*').as('getProducts');
    
    const startTime = Date.now();
    
    cy.visit('/inventory/products');
    cy.wait('@getProducts');
    
    const endTime = Date.now();
    const duration = endTime - startTime;
    
    // API response should be < 500ms
    expect(duration).to.be.lessThan(500);
    
    cy.log(`API Response: ${duration}ms`);
  });
  
  it('should handle slow network gracefully', () => {
    // Simulate slow 3G
    cy.intercept('GET', '/api/products*', (req) => {
      req.reply((res) => {
        res.delay = 3000; // 3s delay
      });
    }).as('slowProducts');
    
    cy.visit('/inventory/products');
    
    // Should show loading state
    cy.get('app-skeleton').should('be.visible');
    
    cy.wait('@slowProducts');
    
    // Should eventually show data
    cy.get('app-product-card').should('be.visible');
  });
  
  it('should batch multiple requests', () => {
    let requestCount = 0;
    
    cy.intercept('GET', '/api/products*', (req) => {
      requestCount++;
    }).as('getProducts');
    
    cy.visit('/inventory/products');
    cy.wait(1000);
    
    // Should make minimal requests
    expect(requestCount).to.be.lessThan(3);
  });
  
  it('should use HTTP caching', () => {
    cy.intercept('GET', '/api/products*', (req) => {
      req.reply((res) => {
        res.headers['cache-control'] = 'max-age=300'; // 5 min
      });
    }).as('getProducts');
    
    cy.visit('/inventory/products');
    cy.wait('@getProducts');
    
    // Navigate away and back
    cy.visit('/pos');
    cy.visit('/inventory/products');
    
    // Should use cached data (no new request)
    cy.get('@getProducts.all').should('have.length', 1);
  });
});

MEJORES PRÃCTICAS PERFORMANCE:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ“ Monitorear mÃ©tricas Core Web Vitals
âœ“ Establecer budgets de performance
âœ“ Testear en dispositivos reales (no solo emuladores)
âœ“ Testear con throttling de red (Slow 3G)
âœ“ Analizar bundle size regularmente
âœ“ Detectar memory leaks
âœ“ Optimizar imÃ¡genes (WebP, lazy loading)
âœ“ Implementar code splitting
âœ“ Usar OnPush change detection
âœ“ Implementar virtual scrolling
âœ“ Cachear responses HTTP

âŒ NO cargar todo en initial bundle
âŒ NO ignorar warnings de bundle size
âŒ NO olvidar limpiar subscriptions
âŒ NO hacer requests innecesarios

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  3.6 CODE COVERAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

OBJETIVO: Alcanzar >80% de cobertura de cÃ³digo.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 3.6.1 Karma Coverage Configuration
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

CONFIGURACIÃ“N: karma.conf.js

module.exports = function(config) {
  config.set({
    basePath: '',
    frameworks: ['jasmine', '@angular-devkit/build-angular'],
    plugins: [
      require('karma-jasmine'),
      require('karma-chrome-launcher'),
      require('karma-jasmine-html-reporter'),
      require('karma-coverage'),
      require('@angular-devkit/build-angular/plugins/karma')
    ],
    client: {
      jasmine: {
        random: false,
        seed: 42,
        stopSpecOnExpectationFailure: false
      },
      clearContext: false
    },
    jasmineHtmlReporter: {
      suppressAll: false
    },
    coverageReporter: {
      dir: require('path').join(__dirname, './coverage'),
      subdir: '.',
      reporters: [
        { type: 'html' },
        { type: 'text-summary' },
        { type: 'lcovonly' },
        { type: 'json-summary' }
      ],
      check: {
        global: {
          statements: 80,
          branches: 80,
          functions: 80,
          lines: 80
        }
      }
    },
    reporters: ['progress', 'kjhtml', 'coverage'],
    port: 9876,
    colors: true,
    logLevel: config.LOG_INFO,
    autoWatch: true,
    browsers: ['Chrome'],
    singleRun: false,
    restartOnFileChange: true
  });
};

SCRIPTS: package.json

```json
{
  "scripts": {
    "test": "ng test",
    "test:ci": "ng test --browsers=ChromeHeadless --watch=false --code-coverage",
    "test:coverage": "ng test --code-coverage --watch=false",
    "coverage:open": "open coverage/index.html",
    "coverage:check": "node scripts/check-coverage.js"
  }
}
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 3.6.2 Coverage Report Analysis
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

SCRIPT: scripts/check-coverage.js

const fs = require('fs');
const path = require('path');

// Leer coverage summary
const coveragePath = path.join(__dirname, '../coverage/coverage-summary.json');

if (!fs.existsSync(coveragePath)) {
  console.error('âŒ Coverage file not found. Run tests with --code-coverage first.');
  process.exit(1);
}

const coverage = JSON.parse(fs.readFileSync(coveragePath, 'utf8'));
const total = coverage.total;

// Thresholds
const thresholds = {
  statements: 80,
  branches: 80,
  functions: 80,
  lines: 80
};

console.log('\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
console.log('ğŸ“Š CODE COVERAGE REPORT');
console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n');

// Mostrar mÃ©tricas
const metrics = ['statements', 'branches', 'functions', 'lines'];
let allPassed = true;

metrics.forEach(metric => {
  const value = total[metric].pct;
  const threshold = thresholds[metric];
  const passed = value >= threshold;
  
  if (!passed) allPassed = false;
  
  const icon = passed ? 'âœ“' : 'âœ—';
  const color = passed ? '\x1b[32m' : '\x1b[31m'; // Green or Red
  const reset = '\x1b[0m';
  
  console.log(
    `${color}${icon}${reset} ${metric.padEnd(15)} ${value.toFixed(2)}% ` +
    `(threshold: ${threshold}%)`
  );
});

console.log('\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n');

// Encontrar archivos con baja cobertura
console.log('ğŸ“‰ FILES WITH LOW COVERAGE (<80%):\n');

const files = Object.keys(coverage).filter(key => key !== 'total');
const lowCoverageFiles = [];

files.forEach(file => {
  const fileCoverage = coverage[file];
  const avgCoverage = (
    fileCoverage.statements.pct +
    fileCoverage.branches.pct +
    fileCoverage.functions.pct +
    fileCoverage.lines.pct
  ) / 4;
  
  if (avgCoverage < 80) {
    lowCoverageFiles.push({
      file,
      coverage: avgCoverage
    });
  }
});

if (lowCoverageFiles.length === 0) {
  console.log('âœ“ All files meet coverage threshold!\n');
} else {
  lowCoverageFiles
    .sort((a, b) => a.coverage - b.coverage)
    .slice(0, 10) // Top 10
    .forEach(({ file, coverage }) => {
      console.log(`  ${coverage.toFixed(2)}% - ${file}`);
    });
  console.log(`\n  ... and ${lowCoverageFiles.length - 10} more files\n`);
}

console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n');

// Exit con error si no se cumple threshold
if (!allPassed) {
  console.error('âŒ Coverage thresholds not met!\n');
  process.exit(1);
} else {
  console.log('âœ… All coverage thresholds met!\n');
  process.exit(0);
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 3.6.3 Cypress Coverage
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

INSTALACIÃ“N:

```bash
npm install --save-dev @cypress/code-coverage babel-plugin-istanbul istanbul-lib-coverage nyc
```

CONFIGURACIÃ“N: cypress/support/e2e.ts

import '@cypress/code-coverage/support';

CONFIGURACIÃ“N: cypress.config.ts

import { defineConfig } from 'cypress';
import codeCoverageTask from '@cypress/code-coverage/task';

export default defineConfig({
  e2e: {
    baseUrl: 'http://localhost:8100',
    setupNodeEvents(on, config) {
      codeCoverageTask(on, config);
      return config;
    },
  },
});

SCRIPTS: package.json

```json
{
  "scripts": {
    "cypress:coverage": "nyc report --reporter=html --reporter=text-summary",
    "test:e2e:coverage": "npm run cypress:run && npm run cypress:coverage"
  },
  "nyc": {
    "report-dir": "coverage-e2e",
    "exclude": [
      "**/*.spec.ts",
      "**/*.cy.ts",
      "**/test/**",
      "**/cypress/**"
    ]
  }
}
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 3.6.4 Combined Coverage Report
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

OBJETIVO: Combinar cobertura de Unit + Integration + E2E

SCRIPT: scripts/merge-coverage.js

const { execSync } = require('child_process');
const fs = require('fs');
const path = require('path');

console.log('ğŸ”„ Merging coverage reports...\n');

// Crear directorio para merged coverage
const mergedDir = path.join(__dirname, '../coverage-merged');
if (!fs.existsSync(mergedDir)) {
  fs.mkdirSync(mergedDir, { recursive: true });
}

try {
  // Merge coverage files
  execSync(
    'npx nyc merge coverage coverage-merged/coverage.json',
    { stdio: 'inherit' }
  );
  
  execSync(
    'npx nyc merge coverage-e2e coverage-merged/coverage-e2e.json',
    { stdio: 'inherit' }
  );
  
  // Generate combined report
  execSync(
    `npx nyc report --reporter=html --reporter=text-summary --reporter=lcov ` +
    `--report-dir=coverage-merged --temp-dir=coverage-merged`,
    { stdio: 'inherit' }
  );
  
  console.log('\nâœ… Coverage reports merged successfully!');
  console.log(`ğŸ“Š Report available at: coverage-merged/index.html\n`);
  
} catch (error) {
  console.error('âŒ Failed to merge coverage reports:', error.message);
  process.exit(1);
}

SCRIPTS: package.json

```json
{
  "scripts": {
    "test:all": "npm run test:ci && npm run test:e2e:coverage && npm run coverage:merge",
    "coverage:merge": "node scripts/merge-coverage.js",
    "coverage:total": "npm run coverage:merge && open coverage-merged/index.html"
  }
}
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 3.6.5 Coverage Badges
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

HERRAMIENTA: coverage-badges

INSTALACIÃ“N:

```bash
npm install --save-dev coverage-badges
```

SCRIPT: scripts/generate-badges.js

const fs = require('fs');
const path = require('path');
const { generateBadges } = require('coverage-badges');

const coveragePath = path.join(__dirname, '../coverage');

if (!fs.existsSync(coveragePath)) {
  console.error('âŒ Coverage directory not found.');
  process.exit(1);
}

generateBadges({
  input: path.join(coveragePath, 'coverage-summary.json'),
  output: path.join(__dirname, '../badges'),
  readmeFile: path.join(__dirname, '../README.md')
});

console.log('âœ… Coverage badges generated!');

SCRIPTS: package.json

```json
{
  "scripts": {
    "badges": "node scripts/generate-badges.js"
  }
}
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 3.6.6 CI/CD Integration
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

GITHUB ACTIONS WORKFLOW:

UBICACIÃ“N: .github/workflows/test-coverage.yml

name: Test & Coverage

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Run unit tests with coverage
        run: npm run test:ci
      
      - name: Run E2E tests
        run: npm run test:e2e:ci
      
      - name: Merge coverage reports
        run: npm run coverage:merge
      
      - name: Check coverage thresholds
        run: npm run coverage:check
      
      - name: Generate coverage badges
        run: npm run badges
      
      - name: Upload coverage to Codecov
        uses: codecov/codecov-action@v3
        with:
          files: ./coverage-merged/lcov.info
          flags: unittests,e2e
          name: gestpharma-coverage
      
      - name: Comment PR with coverage
        uses: romeovs/lcov-reporter-action@v0.3.1
        with:
          lcov-file: ./coverage-merged/lcov.info
          github-token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Archive coverage report
        uses: actions/upload-artifact@v3
        with:
          name: coverage-report
          path: coverage-merged/

COVERAGE TARGETS:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TIPO DE COBERTURA          â”‚ MÃNIMO   â”‚ OBJETIVO â”‚ EXCELENTE              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Statements                 â”‚ 80%      â”‚ 85%      â”‚ 90%                    â”‚
â”‚ Branches                   â”‚ 80%      â”‚ 85%      â”‚ 90%                    â”‚
â”‚ Functions                  â”‚ 80%      â”‚ 85%      â”‚ 90%                    â”‚
â”‚ Lines                      â”‚ 80%      â”‚ 85%      â”‚ 90%                    â”‚
â”‚                            â”‚          â”‚          â”‚                        â”‚
â”‚ COBERTURA POR TIPO:        â”‚          â”‚          â”‚                        â”‚
â”‚ - Services                 â”‚ 90%      â”‚ 95%      â”‚ 100%                   â”‚
â”‚ - Components (logic)       â”‚ 85%      â”‚ 90%      â”‚ 95%                    â”‚
â”‚ - Pipes                    â”‚ 90%      â”‚ 95%      â”‚ 100%                   â”‚
â”‚ - Guards                   â”‚ 90%      â”‚ 95%      â”‚ 100%                   â”‚
â”‚ - Interceptors             â”‚ 85%      â”‚ 90%      â”‚ 95%                    â”‚
â”‚ - Models                   â”‚ 100%     â”‚ 100%     â”‚ 100%                   â”‚
â”‚ - Utils                    â”‚ 90%      â”‚ 95%      â”‚ 100%                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

MEJORES PRÃCTICAS COVERAGE:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ“ Establecer thresholds desde el inicio
âœ“ Monitorear coverage en CI/CD
âœ“ Testear edge cases (no solo happy path)
âœ“ Priorizar cobertura de lÃ³gica crÃ­tica
âœ“ Combinar unit + integration + e2e coverage
âœ“ Revisar coverage reports regularmente
âœ“ No permitir PRs que bajen coverage
âœ“ Documentar cÃ³digo no testeable (y por quÃ©)
âœ“ Usar badges en README
âœ“ Automatizar generaciÃ³n de reportes

âŒ NO buscar 100% a toda costa (pÃ©rdida de tiempo)
âŒ NO escribir tests solo por coverage
âŒ NO testear cÃ³digo generado automÃ¡ticamente
âŒ NO ignorar warnings de coverage

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  RESUMEN FASE 3: TESTING & QUALITY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

IMPLEMENTACIÃ“N COMPLETADA:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… 3.1 UNIT TESTING
   â†’ Testing de Services con HttpTestingController
   â†’ Testing de Components con fixtures
   â†’ Testing de Forms con ReactiveFormsModule
   â†’ Testing de Pipes con edge cases
   â†’ Best practices (AAA, descriptive names, coverage >80%)

âœ… 3.2 INTEGRATION TESTING
   â†’ Testing de pÃ¡ginas completas (ProductListPage)
   â†’ Testing de Stores (CartStore con RxJS)
   â†’ InteracciÃ³n entre componentes y servicios
   â†’ Testing de flujos completos

âœ… 3.3 END-TO-END TESTING
   â†’ ConfiguraciÃ³n de Cypress
   â†’ Login flow testing
   â†’ Product management flow (CRUD)
   â†’ POS sale process
   â†’ Custom commands para reusabilidad

âœ… 3.4 ACCESSIBILITY TESTING
   â†’ Automated testing con axe-core
   â†’ WCAG 2.1 AAA compliance
   â†’ Screen reader testing
   â†’ Keyboard navigation
   â†’ Color contrast verification

âœ… 3.5 PERFORMANCE TESTING
   â†’ Lighthouse CI configuration
   â†’ Bundle size analysis
   â†’ Page load performance
   â†’ Rendering performance (FPS)
   â†’ Memory leak detection
   â†’ Network performance (API response times)

âœ… 3.6 CODE COVERAGE
   â†’ Karma coverage configuration (>80%)
   â†’ Coverage report analysis
   â†’ Cypress E2E coverage
   â†’ Combined coverage reports
   â†’ Coverage badges
   â†’ CI/CD integration

MÃ‰TRICAS DE CALIDAD ALCANZABLES:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“Š Code Coverage: >80% (objetivo: 85%)
âš¡ Performance Score: â‰¥90 (Lighthouse)
â™¿ Accessibility Score: â‰¥95 (WCAG AAA)
ğŸ¯ Best Practices: â‰¥90
ğŸ“¦ Bundle Size: <500KB (initial)
ğŸš€ FCP: <2s, LCP: <2.5s, CLS: <0.1
âœ… Zero accessibility violations
ğŸ§ª 100% E2E coverage de flujos crÃ­ticos

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                                                                             â”ƒ
â”ƒ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—    â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—                              â”ƒ
â”ƒ  â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•    â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘                              â”ƒ
â”ƒ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘                              â”ƒ
â”ƒ  â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â•šâ•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•      â•šâ•â•â•â•â–ˆâ–ˆâ•‘                              â”ƒ
â”ƒ  â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—         â–ˆâ–ˆâ•‘                              â”ƒ
â”ƒ  â•šâ•â•     â•šâ•â•  â•šâ•â•â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â•         â•šâ•â•                              â”ƒ
â”ƒ                                                                             â”ƒ
â”ƒ  CODE QUALITY & STANDARDIZATION                                            â”ƒ
â”ƒ                                                                             â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

OBJETIVO: Establecer estÃ¡ndares de cÃ³digo, automatizar linting, formateo y 
          anÃ¡lisis de calidad para garantizar consistencia y mantenibilidad.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  4.1 ESLINT CONFIGURATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

OBJETIVO: Detectar problemas de cÃ³digo automÃ¡ticamente con reglas estrictas.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 4.1.1 InstalaciÃ³n y Setup
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

INSTALACIÃ“N:

```bash
# ESLint + plugins para Angular, TypeScript y mejores prÃ¡cticas
npm install --save-dev \
  @angular-eslint/builder \
  @angular-eslint/eslint-plugin \
  @angular-eslint/eslint-plugin-template \
  @angular-eslint/schematics \
  @angular-eslint/template-parser \
  @typescript-eslint/eslint-plugin \
  @typescript-eslint/parser \
  eslint \
  eslint-plugin-import \
  eslint-plugin-jsdoc \
  eslint-plugin-prefer-arrow \
  eslint-plugin-rxjs \
  eslint-plugin-rxjs-angular

# Inicializar Angular ESLint
ng add @angular-eslint/schematics
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 4.1.2 ESLint Configuration
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

CONFIGURACIÃ“N: .eslintrc.json

{
  "root": true,
  "ignorePatterns": [
    "projects/**/*",
    "node_modules/**/*",
    "dist/**/*",
    "coverage/**/*",
    "www/**/*"
  ],
  "overrides": [
    {
      "files": ["*.ts"],
      "parserOptions": {
        "project": ["tsconfig.json"],
        "createDefaultProgram": true
      },
      "extends": [
        "eslint:recommended",
        "plugin:@typescript-eslint/recommended",
        "plugin:@angular-eslint/recommended",
        "plugin:@angular-eslint/template/process-inline-templates",
        "plugin:rxjs/recommended"
      ],
      "rules": {
        // â”â”â” ANGULAR RULES â”â”â”
        "@angular-eslint/component-class-suffix": [
          "error",
          {
            "suffixes": ["Component", "Page"]
          }
        ],
        "@angular-eslint/component-selector": [
          "error",
          {
            "type": "element",
            "prefix": "app",
            "style": "kebab-case"
          }
        ],
        "@angular-eslint/directive-class-suffix": [
          "error",
          {
            "suffixes": ["Directive"]
          }
        ],
        "@angular-eslint/directive-selector": [
          "error",
          {
            "type": "attribute",
            "prefix": "app",
            "style": "camelCase"
          }
        ],
        "@angular-eslint/no-host-metadata-property": "error",
        "@angular-eslint/no-input-rename": "error",
        "@angular-eslint/no-output-on-prefix": "error",
        "@angular-eslint/no-output-rename": "error",
        "@angular-eslint/use-lifecycle-interface": "error",
        "@angular-eslint/use-pipe-transform-interface": "error",
        "@angular-eslint/prefer-on-push-component-change-detection": "warn",
        
        // â”â”â” TYPESCRIPT RULES â”â”â”
        "@typescript-eslint/adjacent-overload-signatures": "error",
        "@typescript-eslint/array-type": [
          "error",
          {
            "default": "array-simple"
          }
        ],
        "@typescript-eslint/ban-types": [
          "error",
          {
            "types": {
              "Object": {
                "message": "Use {} instead"
              },
              "String": {
                "message": "Use string instead"
              },
              "Number": {
                "message": "Use number instead"
              },
              "Boolean": {
                "message": "Use boolean instead"
              }
            }
          }
        ],
        "@typescript-eslint/consistent-type-definitions": "error",
        "@typescript-eslint/explicit-member-accessibility": [
          "error",
          {
            "accessibility": "explicit",
            "overrides": {
              "constructors": "no-public"
            }
          }
        ],
        "@typescript-eslint/member-ordering": [
          "error",
          {
            "default": [
              // Fields
              "public-static-field",
              "protected-static-field",
              "private-static-field",
              "public-instance-field",
              "protected-instance-field",
              "private-instance-field",
              
              // Constructors
              "constructor",
              
              // Methods
              "public-static-method",
              "protected-static-method",
              "private-static-method",
              "public-instance-method",
              "protected-instance-method",
              "private-instance-method"
            ]
          }
        ],
        "@typescript-eslint/naming-convention": [
          "error",
          {
            "selector": "default",
            "format": ["camelCase"],
            "leadingUnderscore": "allow",
            "trailingUnderscore": "forbid"
          },
          {
            "selector": "variable",
            "format": ["camelCase", "UPPER_CASE"],
            "leadingUnderscore": "allow"
          },
          {
            "selector": "typeLike",
            "format": ["PascalCase"]
          },
          {
            "selector": "enumMember",
            "format": ["PascalCase", "UPPER_CASE"]
          },
          {
            "selector": "property",
            "modifiers": ["private"],
            "format": ["camelCase"],
            "leadingUnderscore": "require"
          }
        ],
        "@typescript-eslint/no-empty-function": "error",
        "@typescript-eslint/no-empty-interface": "error",
        "@typescript-eslint/no-explicit-any": "error",
        "@typescript-eslint/no-inferrable-types": "error",
        "@typescript-eslint/no-misused-new": "error",
        "@typescript-eslint/no-non-null-assertion": "error",
        "@typescript-eslint/no-unused-vars": [
          "error",
          {
            "argsIgnorePattern": "^_"
          }
        ],
        "@typescript-eslint/prefer-function-type": "error",
        "@typescript-eslint/prefer-namespace-keyword": "error",
        "@typescript-eslint/unified-signatures": "error",
        
        // â”â”â” RXJS RULES â”â”â”
        "rxjs/no-async-subscribe": "error",
        "rxjs/no-create": "error",
        "rxjs/no-ignored-observable": "error",
        "rxjs/no-ignored-subscription": "error",
        "rxjs/no-nested-subscribe": "error",
        "rxjs/no-unbound-methods": "error",
        "rxjs/throw-error": "error",
        "rxjs-angular/prefer-takeuntil": [
          "error",
          {
            "alias": ["untilDestroyed"],
            "checkComplete": true,
            "checkDecorators": ["Component"]
          }
        ],
        
        // â”â”â” IMPORT RULES â”â”â”
        "import/order": [
          "error",
          {
            "groups": [
              "builtin",
              "external",
              "internal",
              ["parent", "sibling"],
              "index",
              "object",
              "type"
            ],
            "pathGroups": [
              {
                "pattern": "@angular/**",
                "group": "external",
                "position": "before"
              },
              {
                "pattern": "@ionic/**",
                "group": "external",
                "position": "before"
              },
              {
                "pattern": "@app/**",
                "group": "internal",
                "position": "before"
              },
              {
                "pattern": "@core/**",
                "group": "internal",
                "position": "before"
              },
              {
                "pattern": "@shared/**",
                "group": "internal",
                "position": "before"
              }
            ],
            "pathGroupsExcludedImportTypes": ["builtin"],
            "alphabetize": {
              "order": "asc",
              "caseInsensitive": true
            },
            "newlines-between": "always"
          }
        ],
        "import/no-deprecated": "warn",
        "import/no-duplicates": "error",
        
        // â”â”â” GENERAL RULES â”â”â”
        "arrow-body-style": ["error", "as-needed"],
        "constructor-super": "error",
        "curly": ["error", "all"],
        "eqeqeq": ["error", "always"],
        "guard-for-in": "error",
        "max-classes-per-file": ["error", 1],
        "max-len": [
          "error",
          {
            "code": 120,
            "ignorePattern": "^import |^export ",
            "ignoreUrls": true,
            "ignoreStrings": true,
            "ignoreTemplateLiterals": true,
            "ignoreRegExpLiterals": true
          }
        ],
        "no-bitwise": "error",
        "no-caller": "error",
        "no-console": [
          "error",
          {
            "allow": ["warn", "error"]
          }
        ],
        "no-debugger": "error",
        "no-duplicate-case": "error",
        "no-duplicate-imports": "error",
        "no-empty": "error",
        "no-eval": "error",
        "no-fallthrough": "error",
        "no-new-wrappers": "error",
        "no-restricted-imports": [
          "error",
          {
            "patterns": ["../*"]
          }
        ],
        "no-throw-literal": "error",
        "no-undef-init": "error",
        "no-unsafe-finally": "error",
        "no-unused-expressions": "error",
        "no-unused-labels": "error",
        "no-var": "error",
        "object-shorthand": "error",
        "prefer-arrow-callback": "error",
        "prefer-const": "error",
        "prefer-template": "error",
        "radix": "error",
        "use-isnan": "error"
      }
    },
    {
      "files": ["*.html"],
      "extends": [
        "plugin:@angular-eslint/template/recommended",
        "plugin:@angular-eslint/template/accessibility"
      ],
      "rules": {
        "@angular-eslint/template/accessibility-alt-text": "error",
        "@angular-eslint/template/accessibility-elements-content": "error",
        "@angular-eslint/template/accessibility-label-for": "error",
        "@angular-eslint/template/accessibility-table-scope": "error",
        "@angular-eslint/template/accessibility-valid-aria": "error",
        "@angular-eslint/template/click-events-have-key-events": "error",
        "@angular-eslint/template/mouse-events-have-key-events": "error",
        "@angular-eslint/template/no-autofocus": "error",
        "@angular-eslint/template/no-distracting-elements": "error",
        "@angular-eslint/template/no-positive-tabindex": "error"
      }
    }
  ]
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 4.1.3 ESLint Scripts
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

SCRIPTS: package.json

```json
{
  "scripts": {
    "lint": "ng lint",
    "lint:fix": "ng lint --fix",
    "lint:ci": "ng lint --format=json --output-file=eslint-report.json",
    "lint:staged": "eslint --fix",
    "lint:check": "eslint . --ext .ts,.html"
  }
}
```

VS CODE SETTINGS: .vscode/settings.json

```json
{
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  },
  "eslint.validate": [
    "javascript",
    "typescript",
    "html"
  ],
  "eslint.options": {
    "extensions": [".ts", ".html"]
  }
}
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  4.2 PRETTIER CONFIGURATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

OBJETIVO: Formateo automÃ¡tico consistente de cÃ³digo.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 4.2.1 InstalaciÃ³n
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

```bash
npm install --save-dev \
  prettier \
  eslint-config-prettier \
  eslint-plugin-prettier \
  prettier-plugin-organize-imports
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 4.2.2 Prettier Configuration
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

CONFIGURACIÃ“N: .prettierrc

{
  "semi": true,
  "trailingComma": "es5",
  "singleQuote": true,
  "printWidth": 120,
  "tabWidth": 2,
  "useTabs": false,
  "arrowParens": "always",
  "bracketSpacing": true,
  "endOfLine": "lf",
  "htmlWhitespaceSensitivity": "css",
  "insertPragma": false,
  "jsxBracketSameLine": false,
  "jsxSingleQuote": false,
  "proseWrap": "preserve",
  "quoteProps": "as-needed",
  "requirePragma": false,
  "overrides": [
    {
      "files": "*.html",
      "options": {
        "parser": "angular",
        "printWidth": 140
      }
    },
    {
      "files": "*.scss",
      "options": {
        "singleQuote": false
      }
    },
    {
      "files": "*.json",
      "options": {
        "printWidth": 80,
        "trailingComma": "none"
      }
    }
  ],
  "plugins": ["prettier-plugin-organize-imports"]
}

IGNORE: .prettierignore

# Dependencies
node_modules
package-lock.json

# Build outputs
dist
www
.angular
coverage
coverage-*

# IDE
.vscode
.idea

# Other
*.log
*.md
CHANGELOG.md

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 4.2.3 Integration con ESLint
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ACTUALIZAR .eslintrc.json (agregar al final de extends):

```json
{
  "extends": [
    "...",
    "plugin:prettier/recommended"
  ]
}
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 4.2.4 Prettier Scripts
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

SCRIPTS: package.json

```json
{
  "scripts": {
    "format": "prettier --write \"src/**/*.{ts,html,scss,json}\"",
    "format:check": "prettier --check \"src/**/*.{ts,html,scss,json}\"",
    "format:staged": "prettier --write"
  }
}
```

VS CODE SETTINGS: .vscode/settings.json

```json
{
  "editor.formatOnSave": true,
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "[typescript]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode",
    "editor.formatOnSave": true
  },
  "[html]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode",
    "editor.formatOnSave": true
  },
  "[scss]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode",
    "editor.formatOnSave": true
  },
  "[json]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  }
}
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  4.3 HUSKY & GIT HOOKS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

OBJETIVO: Automatizar checks en pre-commit y pre-push.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 4.3.1 InstalaciÃ³n
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

```bash
npm install --save-dev husky lint-staged

# Inicializar Husky
npx husky init

# Crear hooks
npx husky add .husky/pre-commit "npm run pre-commit"
npx husky add .husky/pre-push "npm run pre-push"
npx husky add .husky/commit-msg "npm run commit-msg"
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 4.3.2 Lint-Staged Configuration
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

CONFIGURACIÃ“N: .lintstagedrc.json

{
  "*.ts": [
    "eslint --fix",
    "prettier --write"
  ],
  "*.html": [
    "eslint --fix",
    "prettier --write"
  ],
  "*.{scss,css}": [
    "prettier --write"
  ],
  "*.{json,md}": [
    "prettier --write"
  ]
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 4.3.3 Pre-commit Hook
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ARCHIVO: .husky/pre-commit

#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

# Lint staged files
npx lint-staged

# Check TypeScript compilation
echo "ğŸ“¦ Checking TypeScript compilation..."
npm run build -- --configuration development

if [ $? -ne 0 ]; then
  echo "âŒ TypeScript compilation failed"
  exit 1
fi

echo "âœ… Pre-commit checks passed"

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 4.3.4 Pre-push Hook
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ARCHIVO: .husky/pre-push

#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ§ª Running pre-push checks..."

# Run tests
echo "ğŸ§ª Running unit tests..."
npm run test:ci

if [ $? -ne 0 ]; then
  echo "âŒ Tests failed"
  exit 1
fi

# Check coverage
echo "ğŸ“Š Checking code coverage..."
npm run coverage:check

if [ $? -ne 0 ]; then
  echo "âŒ Coverage threshold not met"
  exit 1
fi

# Lint all files
echo "ğŸ” Running ESLint..."
npm run lint

if [ $? -ne 0 ]; then
  echo "âŒ Linting failed"
  exit 1
fi

echo "âœ… Pre-push checks passed"

SCRIPTS: package.json

```json
{
  "scripts": {
    "pre-commit": "lint-staged",
    "pre-push": "npm run test:ci && npm run lint",
    "prepare": "husky install"
  }
}
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  4.4 CONVENTIONAL COMMITS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

OBJETIVO: Estandarizar mensajes de commit para generar changelogs automÃ¡ticos.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 4.4.1 InstalaciÃ³n
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

```bash
npm install --save-dev \
  @commitlint/cli \
  @commitlint/config-conventional \
  commitizen \
  cz-conventional-changelog
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 4.4.2 Commitlint Configuration
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

CONFIGURACIÃ“N: .commitlintrc.json

{
  "extends": ["@commitlint/config-conventional"],
  "rules": {
    "type-enum": [
      2,
      "always",
      [
        "feat",      // Nueva funcionalidad
        "fix",       // Bug fix
        "docs",      // DocumentaciÃ³n
        "style",     // Formato (sin cambio de cÃ³digo)
        "refactor",  // RefactorizaciÃ³n
        "perf",      // Mejora de performance
        "test",      // Tests
        "build",     // Build system
        "ci",        // CI/CD
        "chore",     // Mantenimiento
        "revert"     // Revert commit
      ]
    ],
    "type-case": [2, "always", "lower-case"],
    "type-empty": [2, "never"],
    "scope-case": [2, "always", "lower-case"],
    "subject-empty": [2, "never"],
    "subject-full-stop": [2, "never", "."],
    "subject-case": [
      2,
      "never",
      ["sentence-case", "start-case", "pascal-case", "upper-case"]
    ],
    "header-max-length": [2, "always", 100],
    "body-leading-blank": [2, "always"],
    "body-max-line-length": [2, "always", 120],
    "footer-leading-blank": [2, "always"]
  }
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 4.4.3 Commitizen Configuration
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

CONFIGURACIÃ“N: package.json

```json
{
  "config": {
    "commitizen": {
      "path": "./node_modules/cz-conventional-changelog"
    }
  },
  "scripts": {
    "commit": "git-cz",
    "commit-msg": "commitlint --edit"
  }
}
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 4.4.4 Commit Message Hook
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ARCHIVO: .husky/commit-msg

#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

npx --no -- commitlint --edit "$1"

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 4.4.5 Conventional Commits Guide
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

FORMATO:

```
<type>(<scope>): <subject>

<body>

<footer>
```

EJEMPLOS:

âœ… VÃLIDOS:

```bash
feat(auth): add JWT authentication
fix(product): correct price calculation
docs(readme): update installation guide
style(button): format code with prettier
refactor(service): extract API logic to separate service
perf(list): implement virtual scrolling
test(product): add unit tests for ProductService
build(deps): upgrade Angular to v18
ci(github): add automated testing workflow
chore(release): bump version to 1.2.0
```

âœ… CON SCOPE Y BREAKING CHANGE:

```bash
feat(api)!: change authentication endpoint

BREAKING CHANGE: The /login endpoint now requires email instead of username
```

âœ… CON BODY Y FOOTER:

```bash
feat(pos): add barcode scanner support

Implement barcode scanning using Capacitor plugin.
Support Code128 and EAN13 formats.

Closes #123
```

âŒ INVÃLIDOS:

```bash
Added new feature              # No type
FEAT: new feature             # Type en mayÃºsculas
feat: New feature             # Subject en mayÃºsculas
feat: add new feature.        # Punto al final
feature: add login            # Type invÃ¡lido
```

USO CON COMMITIZEN:

```bash
# En lugar de git commit, usar:
npm run commit

# Sigue el wizard interactivo:
# 1. Selecciona type
# 2. Ingresa scope (opcional)
# 3. Escribe subject
# 4. Escribe body (opcional)
# 5. Breaking changes (opcional)
# 6. Issues cerrados (opcional)
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  4.5 SONARQUBE / SONARCLOUD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

OBJETIVO: AnÃ¡lisis estÃ¡tico de calidad de cÃ³digo, bugs, vulnerabilidades y code smells.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 4.5.1 SonarCloud Setup (Recomendado para proyectos Open Source)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

PASOS:

1. Crear cuenta en https://sonarcloud.io
2. Importar repositorio de GitHub
3. Obtener token de organizaciÃ³n
4. Configurar GitHub Actions

INSTALACIÃ“N:

```bash
npm install --save-dev sonarqube-scanner
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 4.5.2 SonarCloud Configuration
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

CONFIGURACIÃ“N: sonar-project.properties

sonar.projectKey=gestpharma-app
sonar.organization=your-org-name

# Project metadata
sonar.projectName=GestPharma
sonar.projectVersion=1.0.0

# Source code
sonar.sources=src/app
sonar.tests=src/app
sonar.test.inclusions=**/*.spec.ts
sonar.exclusions=**/node_modules/**,**/dist/**,**/www/**,**/coverage/**,**/*.spec.ts

# TypeScript
sonar.typescript.lcov.reportPaths=coverage/lcov.info
sonar.javascript.lcov.reportPaths=coverage/lcov.info

# Coverage
sonar.coverage.exclusions=**/*.spec.ts,**/*.module.ts,**/main.ts,**/environments/**

# Code analysis
sonar.qualitygate.wait=true

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 4.5.3 GitHub Actions Integration
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ARCHIVO: .github/workflows/sonarcloud.yml

name: SonarCloud Analysis

on:
  push:
    branches:
      - main
      - develop
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  sonarcloud:
    name: SonarCloud
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0  # Shallow clones should be disabled for better analysis
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Run tests with coverage
        run: npm run test:ci
      
      - name: SonarCloud Scan
        uses: SonarSource/sonarcloud-github-action@master
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
        with:
          args: >
            -Dsonar.projectKey=gestpharma-app
            -Dsonar.organization=your-org-name

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 4.5.4 Quality Gates
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

CONFIGURAR EN SONARCLOUD:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MÃ‰TRICA                              â”‚ OBJETIVO   â”‚ GATE                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Coverage                             â”‚ > 80%      â”‚ Fail if < 80%         â”‚
â”‚ Duplicated Lines                     â”‚ < 3%       â”‚ Fail if > 3%          â”‚
â”‚ Maintainability Rating               â”‚ A          â”‚ Fail if < A           â”‚
â”‚ Reliability Rating                   â”‚ A          â”‚ Fail if < A           â”‚
â”‚ Security Rating                      â”‚ A          â”‚ Fail if < A           â”‚
â”‚ Security Hotspots Reviewed           â”‚ 100%       â”‚ Fail if < 100%        â”‚
â”‚ New Bugs                             â”‚ 0          â”‚ Fail if > 0           â”‚
â”‚ New Vulnerabilities                  â”‚ 0          â”‚ Fail if > 0           â”‚
â”‚ New Code Smells                      â”‚ < 5        â”‚ Fail if > 5           â”‚
â”‚ New Security Hotspots                â”‚ 0          â”‚ Fail if > 0           â”‚
â”‚ New Coverage on New Code             â”‚ > 80%      â”‚ Fail if < 80%         â”‚
â”‚ New Duplicated Lines                 â”‚ < 3%       â”‚ Fail if > 3%          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 4.5.5 SonarLint (IDE Integration)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

INSTALACIÃ“N EN VS CODE:

1. Instalar extensiÃ³n: SonarLint
2. Conectar con SonarCloud:
   - Command Palette: "SonarLint: Add SonarCloud Connection"
   - Ingresar token y organizaciÃ³n
   - Vincular proyecto

BENEFICIOS:
âœ“ AnÃ¡lisis en tiempo real mientras codificas
âœ“ Quick fixes automÃ¡ticos
âœ“ SincronizaciÃ³n con Quality Profiles de SonarCloud
âœ“ DetecciÃ³n temprana de bugs y vulnerabilidades

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  4.6 CHANGELOG AUTOMATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

OBJETIVO: Generar changelogs automÃ¡ticamente desde commits convencionales.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 4.6.1 Standard Version
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

INSTALACIÃ“N:

```bash
npm install --save-dev standard-version
```

CONFIGURACIÃ“N: .versionrc.json

{
  "types": [
    {"type": "feat", "section": "ğŸš€ Features"},
    {"type": "fix", "section": "ğŸ› Bug Fixes"},
    {"type": "perf", "section": "âš¡ Performance"},
    {"type": "refactor", "section": "â™»ï¸ Refactoring"},
    {"type": "test", "section": "âœ… Tests"},
    {"type": "build", "section": "ğŸ“¦ Build"},
    {"type": "ci", "section": "ğŸ‘· CI/CD"},
    {"type": "docs", "hidden": true},
    {"type": "style", "hidden": true},
    {"type": "chore", "hidden": true}
  ],
  "skip": {
    "bump": false,
    "changelog": false,
    "commit": false,
    "tag": false
  },
  "scripts": {
    "postchangelog": "prettier --write CHANGELOG.md"
  }
}

SCRIPTS: package.json

```json
{
  "scripts": {
    "release": "standard-version",
    "release:minor": "standard-version --release-as minor",
    "release:major": "standard-version --release-as major",
    "release:patch": "standard-version --release-as patch",
    "release:dry": "standard-version --dry-run"
  }
}
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 4.6.2 Uso de Standard Version
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

FLUJO DE RELEASE:

```bash
# 1. Asegurarse de estar en main/master
git checkout main

# 2. Traer Ãºltimos cambios
git pull origin main

# 3. Generar release (automÃ¡tico basado en commits)
npm run release

# Esto hace:
# - Analiza commits desde Ãºltimo tag
# - Calcula nueva versiÃ³n (patch/minor/major)
# - Actualiza package.json
# - Genera/actualiza CHANGELOG.md
# - Crea commit de release
# - Crea git tag

# 4. Pushear cambios y tags
git push --follow-tags origin main

# 5. Publicar en GitHub Releases (manual o con GitHub Actions)
```

VERSIONADO MANUAL:

```bash
# Patch version (1.0.0 -> 1.0.1)
npm run release:patch

# Minor version (1.0.0 -> 1.1.0)
npm run release:minor

# Major version (1.0.0 -> 2.0.0)
npm run release:major

# Dry run (preview sin cambios)
npm run release:dry
```

EJEMPLO DE CHANGELOG GENERADO:

```markdown
# Changelog

All notable changes to this project will be documented in this file.

## [1.2.0] - 2025-11-28

### ğŸš€ Features

- **auth**: add biometric authentication ([#123](link))
- **pos**: implement barcode scanner ([#124](link))
- **inventory**: add bulk import from Excel ([#125](link))

### ğŸ› Bug Fixes

- **product**: correct price calculation for discounts ([#126](link))
- **cart**: fix quantity update issue ([#127](link))

### âš¡ Performance

- **list**: implement virtual scrolling for products ([#128](link))
- **api**: add HTTP response caching ([#129](link))

### â™»ï¸ Refactoring

- **service**: extract API logic to separate service ([#130](link))

## [1.1.0] - 2025-11-20

...
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 4.6.3 GitHub Release Automation
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ARCHIVO: .github/workflows/release.yml

name: Release

on:
  push:
    tags:
      - 'v*'

jobs:
  release:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Build
        run: npm run build
      
      - name: Extract changelog
        id: changelog
        run: |
          VERSION=${GITHUB_REF#refs/tags/v}
          CHANGELOG=$(awk -v ver="$VERSION" '
            /^## \[/ { if (p) exit; if ($2 == "["ver"]") p=1; next }
            p { print }
          ' CHANGELOG.md)
          echo "::set-output name=notes::$CHANGELOG"
      
      - name: Create GitHub Release
        uses: actions/create-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          tag_name: ${{ github.ref }}
          release_name: Release ${{ github.ref }}
          body: ${{ steps.changelog.outputs.notes }}
          draft: false
          prerelease: false
      
      - name: Upload build artifacts
        uses: actions/upload-artifact@v3
        with:
          name: build
          path: www/

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  4.7 CODE REVIEW CHECKLIST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

OBJETIVO: Establecer criterios consistentes para revisiones de cÃ³digo.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 4.7.1 Pull Request Template
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ARCHIVO: .github/PULL_REQUEST_TEMPLATE.md

```markdown
## ğŸ“ DescripciÃ³n

Describe brevemente los cambios realizados.

## ğŸ¯ Tipo de Cambio

- [ ] ğŸš€ Feature (nueva funcionalidad)
- [ ] ğŸ› Bug fix (correcciÃ³n de bug)
- [ ] â™»ï¸ Refactoring (cambio que no afecta funcionalidad)
- [ ] âš¡ Performance (mejora de rendimiento)
- [ ] ğŸ“š Docs (cambios en documentaciÃ³n)
- [ ] âœ… Tests (agregar o corregir tests)
- [ ] ğŸ¨ Style (formato, sin cambios de lÃ³gica)
- [ ] ğŸ”§ Chore (cambios de mantenimiento)

## ğŸ”— Issue Relacionado

Closes #(issue)

## ğŸ§ª Testing

Describe cÃ³mo se testearon los cambios:

- [ ] Unit tests agregados/actualizados
- [ ] Integration tests agregados/actualizados
- [ ] E2E tests agregados/actualizados
- [ ] Testing manual completado

### Pasos para testear:

1. 
2. 
3. 

## ğŸ“¸ Screenshots (si aplica)

Adjuntar capturas de pantalla de cambios visuales.

| Before | After |
|--------|-------|
|        |       |

## âœ… Checklist

### Code Quality

- [ ] CÃ³digo sigue guÃ­a de estilo del proyecto
- [ ] Nombres de variables/funciones descriptivos
- [ ] Funciones pequeÃ±as y con responsabilidad Ãºnica
- [ ] Sin cÃ³digo comentado/muerto
- [ ] Sin console.log/debugger
- [ ] ESLint passing sin warnings
- [ ] Prettier formateado aplicado

### Testing

- [ ] Tests unitarios agregados (coverage >80%)
- [ ] Tests passing en CI/CD
- [ ] Edge cases considerados
- [ ] Error handling implementado

### Performance

- [ ] No hay memory leaks
- [ ] OnPush change detection usado donde es posible
- [ ] TrackBy functions en *ngFor
- [ ] Lazy loading implementado
- [ ] ImÃ¡genes optimizadas

### Accessibility

- [ ] Elementos interactivos accesibles por teclado
- [ ] ARIA labels apropiados
- [ ] Contraste de color adecuado
- [ ] Focus visible

### Documentation

- [ ] Comentarios JSDoc agregados
- [ ] README actualizado (si aplica)
- [ ] CHANGELOG actualizado
- [ ] API documentation actualizada (si aplica)

### Security

- [ ] No hay secretos/tokens hardcodeados
- [ ] Input validation implementada
- [ ] XSS protection considerada
- [ ] CSRF protection (si aplica)

## ğŸ“ Notas Adicionales

Cualquier informaciÃ³n adicional para los revisores.

## ğŸš€ Deployment Notes

Notas especiales para deployment (migraciones, variables de entorno, etc.)

---

**Reviewer Checklist:**
- [ ] CÃ³digo revisado
- [ ] Tests passing
- [ ] Sin conflictos
- [ ] Aprobado
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 4.7.2 Code Review Checklist Detallado
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ 1. ARQUITECTURA & DISEÃ‘O                                                  â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

â˜ Los cambios siguen la arquitectura del proyecto
â˜ Componentes Smart/Dumb correctamente separados
â˜ Services para lÃ³gica de negocio
â˜ No hay lÃ³gica de negocio en componentes
â˜ InyecciÃ³n de dependencias correcta
â˜ MÃ³dulos lazy-loaded apropiadamente
â˜ Standalone components usados correctamente

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ 2. CÃ“DIGO & LÃ“GICA                                                        â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

â˜ CÃ³digo fÃ¡cil de entender
â˜ Funciones/mÃ©todos con responsabilidad Ãºnica
â˜ Nombres descriptivos (variables, funciones, clases)
â˜ Complejidad ciclomÃ¡tica baja (<10)
â˜ No hay cÃ³digo duplicado
â˜ No hay cÃ³digo muerto/comentado
â˜ No hay TODOs sin issue asociado
â˜ Edge cases manejados
â˜ Error handling apropiado
â˜ Validaciones de inputs
â˜ Tipado estricto (no any)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ 3. ANGULAR BEST PRACTICES                                                 â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

â˜ OnPush change detection usado donde es posible
â˜ TrackBy functions en *ngFor
â˜ Async pipe usado en lugar de subscribe manual
â˜ Subscriptions limpiadas correctamente
â˜ Signals usados apropiadamente (Angular 16+)
â˜ inject() usado en lugar de constructor injection
â˜ Pipes pure cuando es posible
â˜ Lazy loading implementado
â˜ Preloading strategies configuradas

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ 4. RXJS & STATE MANAGEMENT                                                â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

â˜ Operadores RxJS apropiados
â˜ No hay nested subscribes
â˜ takeUntil/takeWhile para limpiar subscriptions
â˜ shareReplay usado para HTTP caching
â˜ BehaviorSubject/ReplaySubject usados correctamente
â˜ Estado inmutable
â˜ No hay side effects en selectores

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ 5. PERFORMANCE                                                             â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

â˜ No hay memory leaks
â˜ Virtual scrolling para listas largas
â˜ Lazy loading de imÃ¡genes
â˜ Code splitting apropiado
â˜ Bundle size aceptable
â˜ No hay llamadas innecesarias a la API
â˜ HTTP caching implementado
â˜ Debounce/throttle en bÃºsquedas

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ 6. TESTING                                                                 â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

â˜ Unit tests agregados/actualizados
â˜ Integration tests agregados (si aplica)
â˜ E2E tests agregados (si aplica)
â˜ Coverage >80%
â˜ Tests pasan en local
â˜ Tests pasan en CI/CD
â˜ Edge cases testeados
â˜ Error scenarios testeados
â˜ Tests legibles (AAA pattern)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ 7. ACCESSIBILITY                                                           â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

â˜ ARIA labels apropiados
â˜ Roles semÃ¡nticos correctos
â˜ NavegaciÃ³n por teclado funcional
â˜ Focus visible
â˜ Alt text en imÃ¡genes
â˜ Contraste de color adecuado (WCAG AAA)
â˜ Screen reader friendly
â˜ No hay trampas de teclado

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ 8. SECURITY                                                                â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

â˜ No hay secretos/tokens hardcodeados
â˜ Input sanitization implementada
â˜ XSS protection
â˜ CSRF protection (si aplica)
â˜ AutenticaciÃ³n/autorizaciÃ³n correcta
â˜ Datos sensibles no logueados
â˜ HTTPS para todas las requests
â˜ Dependencias sin vulnerabilidades conocidas

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ 9. UI/UX                                                                   â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

â˜ Design system seguido
â˜ Componentes reusables usados
â˜ Loading states implementados
â˜ Error states implementados
â˜ Empty states implementados
â˜ Feedback visual apropiado
â˜ Responsive en todos los breakpoints
â˜ Animaciones suaves
â˜ No hay layout shifts

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ 10. DOCUMENTATION                                                          â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

â˜ JSDoc comments en funciones pÃºblicas
â˜ Comentarios para lÃ³gica compleja
â˜ README actualizado (si aplica)
â˜ CHANGELOG actualizado
â˜ API documentation actualizada (si aplica)
â˜ Inline comments claros y concisos
â˜ No hay comentarios obsoletos

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ 11. GIT & COMMITS                                                          â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

â˜ Commits atÃ³micos
â˜ Mensajes siguiendo Conventional Commits
â˜ Branch actualizado con base
â˜ No hay conflictos
â˜ No hay archivos innecesarios committed
â˜ .gitignore actualizado (si aplica)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ 12. CI/CD                                                                  â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

â˜ Todos los checks de CI passing
â˜ Build exitoso
â˜ Tests passing
â˜ Linting passing
â˜ Coverage threshold cumplido
â˜ SonarQube quality gate passed
â˜ No hay regresiones de performance

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 4.7.3 Automated PR Checks
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ARCHIVO: .github/workflows/pr-checks.yml

name: PR Checks

on:
  pull_request:
    branches: [main, develop]

jobs:
  checks:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Lint
        run: npm run lint
      
      - name: Format check
        run: npm run format:check
      
      - name: Build
        run: npm run build
      
      - name: Tests
        run: npm run test:ci
      
      - name: Coverage check
        run: npm run coverage:check
      
      - name: Bundle size check
        uses: andresz1/size-limit-action@v1
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  RESUMEN FASE 4: CODE QUALITY & STANDARDIZATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

IMPLEMENTACIÃ“N COMPLETADA:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… 4.1 ESLINT CONFIGURATION
   â†’ Reglas estrictas para Angular, TypeScript, RxJS
   â†’ Import ordering y naming conventions
   â†’ Template accessibility rules
   â†’ VS Code integration con auto-fix

âœ… 4.2 PRETTIER CONFIGURATION
   â†’ Formateo automÃ¡tico consistente
   â†’ Overrides para HTML, SCSS, JSON
   â†’ Organize imports plugin
   â†’ Format on save en VS Code

âœ… 4.3 HUSKY & GIT HOOKS
   â†’ Pre-commit: lint-staged + compilation check
   â†’ Pre-push: tests + coverage + lint
   â†’ Commit-msg: conventional commits validation
   â†’ Lint-staged para archivos especÃ­ficos

âœ… 4.4 CONVENTIONAL COMMITS
   â†’ Commitlint configuration
   â†’ Commitizen wizard interactivo
   â†’ Commit message validation
   â†’ GuÃ­a completa con ejemplos

âœ… 4.5 SONARQUBE/SONARCLOUD
   â†’ AnÃ¡lisis estÃ¡tico de calidad
   â†’ Quality gates configurados
   â†’ GitHub Actions integration
   â†’ SonarLint para IDE

âœ… 4.6 CHANGELOG AUTOMATION
   â†’ Standard-version configuration
   â†’ Changelog automÃ¡tico desde commits
   â†’ Semantic versioning automÃ¡tico
   â†’ GitHub Releases automation

âœ… 4.7 CODE REVIEW CHECKLIST
   â†’ Pull Request template completo
   â†’ Checklist detallado (12 categorÃ­as)
   â†’ Automated PR checks con GitHub Actions
   â†’ Bundle size monitoring

HERRAMIENTAS INTEGRADAS:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ” ESLint: Linting con 50+ reglas
ğŸ’… Prettier: Formateo automÃ¡tico
ğŸ¶ Husky: Git hooks automatizados
ğŸ“ Commitlint: ValidaciÃ³n de commits
ğŸ“Š SonarCloud: AnÃ¡lisis de calidad estÃ¡tico
ğŸ“‹ Standard-version: Changelog + versioning
âœ… PR Template: Code review sistemÃ¡tico

MÃ‰TRICAS DE CALIDAD ASEGURADAS:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ“ Zero ESLint errors/warnings
âœ“ Code formateado 100% con Prettier
âœ“ Conventional commits obligatorios
âœ“ Tests + coverage checks en pre-push
âœ“ SonarCloud quality gate: Grade A
âœ“ Changelog automÃ¡tico actualizado
âœ“ Code review checklist completo

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                                                                             â”ƒ
â”ƒ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—                              â”ƒ
â”ƒ  â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•    â–ˆâ–ˆâ•”â•â•â•â•â•                              â”ƒ
â”ƒ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—                              â”ƒ
â”ƒ  â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â•šâ•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•      â•šâ•â•â•â•â–ˆâ–ˆâ•‘                              â”ƒ
â”ƒ  â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘                              â”ƒ
â”ƒ  â•šâ•â•     â•šâ•â•  â•šâ•â•â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â•    â•šâ•â•â•â•â•â•â•                              â”ƒ
â”ƒ                                                                             â”ƒ
â”ƒ  FUNCTIONAL IMPROVEMENTS                                                   â”ƒ
â”ƒ                                                                             â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

OBJETIVO: Implementar mejoras funcionales especÃ­ficas para GestPharma que 
          mejoren la experiencia del usuario y optimicen los procesos de negocio.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  5.1 BÃšSQUEDA AVANZADA Y FILTROS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

OBJETIVO: BÃºsqueda rÃ¡pida con filtros mÃºltiples y autocompletado.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 5.1.1 Advanced Search Service
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/app/core/services/search.service.ts

import { Injectable, inject } from '@angular/core';
import { HttpClient, HttpParams } from '@angular/common/http';
import { Observable, of } from 'rxjs';
import { debounceTime, distinctUntilChanged, switchMap, catchError, map } from 'rxjs/operators';
import { environment } from '@environments/environment';

export interface SearchFilters {
  query?: string;
  category?: number;
  minPrice?: number;
  maxPrice?: number;
  inStock?: boolean;
  lowStock?: boolean;
  sortBy?: 'name' | 'price' | 'stock';
  sortOrder?: 'asc' | 'desc';
}

export interface SearchResult<T> {
  items: T[];
  total: number;
  page: number;
  pageSize: number;
  hasMore: boolean;
}

@Injectable({
  providedIn: 'root'
})
export class SearchService {
  private readonly http = inject(HttpClient);
  private readonly baseUrl = `${environment.apiUrl}/search`;
  
  /**
   * BÃºsqueda de productos con filtros
   */
  public searchProducts(
    filters: SearchFilters,
    page = 1,
    pageSize = 20
  ): Observable<SearchResult<Product>> {
    let params = new HttpParams()
      .set('page', page.toString())
      .set('pageSize', pageSize.toString());
    
    if (filters.query) {
      params = params.set('q', filters.query);
    }
    
    if (filters.category) {
      params = params.set('categoryId', filters.category.toString());
    }
    
    if (filters.minPrice !== undefined) {
      params = params.set('minPrice', filters.minPrice.toString());
    }
    
    if (filters.maxPrice !== undefined) {
      params = params.set('maxPrice', filters.maxPrice.toString());
    }
    
    if (filters.inStock !== undefined) {
      params = params.set('inStock', filters.inStock.toString());
    }
    
    if (filters.lowStock !== undefined) {
      params = params.set('lowStock', filters.lowStock.toString());
    }
    
    if (filters.sortBy) {
      params = params.set('sortBy', filters.sortBy);
      params = params.set('sortOrder', filters.sortOrder || 'asc');
    }
    
    return this.http.get<SearchResult<Product>>(`${this.baseUrl}/products`, { params });
  }
  
  /**
   * Autocompletado de productos
   */
  public autocomplete(query: string): Observable<Product[]> {
    if (!query || query.length < 2) {
      return of([]);
    }
    
    const params = new HttpParams()
      .set('q', query)
      .set('limit', '10');
    
    return this.http.get<Product[]>(`${this.baseUrl}/autocomplete`, { params })
      .pipe(
        catchError(() => of([]))
      );
  }
  
  /**
   * BÃºsqueda por cÃ³digo de barras
   */
  public searchByBarcode(barcode: string): Observable<Product | null> {
    return this.http.get<Product>(`${this.baseUrl}/barcode/${barcode}`)
      .pipe(
        catchError(() => of(null))
      );
  }
  
  /**
   * Sugerencias de bÃºsqueda
   */
  public getSuggestions(query: string): Observable<string[]> {
    if (!query || query.length < 2) {
      return of([]);
    }
    
    const params = new HttpParams().set('q', query);
    
    return this.http.get<string[]>(`${this.baseUrl}/suggestions`, { params })
      .pipe(
        catchError(() => of([]))
      );
  }
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 5.1.2 Search Component con Filtros
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/app/shared/components/advanced-search/advanced-search.component.ts

import { Component, OnInit, Output, EventEmitter, inject, signal } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';
import { IonicModule } from '@ionic/angular';
import { Subject } from 'rxjs';
import { debounceTime, distinctUntilChanged } from 'rxjs/operators';

import { SearchService, SearchFilters } from '@core/services/search.service';
import { CategoryService } from '@core/services/category.service';

@Component({
  selector: 'app-advanced-search',
  standalone: true,
  imports: [CommonModule, FormsModule, IonicModule],
  template: `
    <ion-toolbar>
      <!-- Barra de bÃºsqueda principal -->
      <ion-searchbar
        [(ngModel)]="searchQuery"
        (ionInput)="onSearchInput($event)"
        (ionClear)="onClearSearch()"
        placeholder="Buscar productos..."
        debounce="300"
        [showClearButton]="'always'"
      >
      </ion-searchbar>
      
      <ion-buttons slot="end">
        <ion-button (click)="toggleFilters()">
          <ion-icon 
            slot="icon-only" 
            [name]="showFilters() ? 'close' : 'filter'"
          ></ion-icon>
        </ion-button>
      </ion-buttons>
    </ion-toolbar>
    
    <!-- Autocompletado -->
    <ion-list *ngIf="suggestions().length > 0" class="suggestions-list">
      <ion-item 
        *ngFor="let suggestion of suggestions()"
        button
        (click)="selectSuggestion(suggestion)"
      >
        <ion-icon name="search" slot="start"></ion-icon>
        <ion-label>{{ suggestion }}</ion-label>
      </ion-item>
    </ion-list>
    
    <!-- Panel de filtros -->
    <ion-card *ngIf="showFilters()" class="filters-card">
      <ion-card-content>
        <!-- CategorÃ­a -->
        <ion-item>
          <ion-label position="stacked">CategorÃ­a</ion-label>
          <ion-select 
            [(ngModel)]="filters.category"
            (ionChange)="applyFilters()"
            placeholder="Todas"
          >
            <ion-select-option [value]="undefined">Todas</ion-select-option>
            <ion-select-option 
              *ngFor="let cat of categories()"
              [value]="cat.id"
            >
              {{ cat.nombre }}
            </ion-select-option>
          </ion-select>
        </ion-item>
        
        <!-- Rango de precios -->
        <ion-item>
          <ion-label position="stacked">Precio MÃ­nimo</ion-label>
          <ion-input
            type="number"
            [(ngModel)]="filters.minPrice"
            (ionChange)="applyFilters()"
            placeholder="0"
            min="0"
          ></ion-input>
        </ion-item>
        
        <ion-item>
          <ion-label position="stacked">Precio MÃ¡ximo</ion-label>
          <ion-input
            type="number"
            [(ngModel)]="filters.maxPrice"
            (ionChange)="applyFilters()"
            placeholder="999999"
            min="0"
          ></ion-input>
        </ion-item>
        
        <!-- Stock -->
        <ion-item>
          <ion-label>Solo en Stock</ion-label>
          <ion-toggle
            [(ngModel)]="filters.inStock"
            (ionChange)="applyFilters()"
          ></ion-toggle>
        </ion-item>
        
        <ion-item>
          <ion-label>Stock Bajo</ion-label>
          <ion-toggle
            [(ngModel)]="filters.lowStock"
            (ionChange)="applyFilters()"
          ></ion-toggle>
        </ion-item>
        
        <!-- Ordenamiento -->
        <ion-item>
          <ion-label position="stacked">Ordenar por</ion-label>
          <ion-select 
            [(ngModel)]="filters.sortBy"
            (ionChange)="applyFilters()"
          >
            <ion-select-option value="name">Nombre</ion-select-option>
            <ion-select-option value="price">Precio</ion-select-option>
            <ion-select-option value="stock">Stock</ion-select-option>
          </ion-select>
        </ion-item>
        
        <ion-item>
          <ion-label position="stacked">Orden</ion-label>
          <ion-select 
            [(ngModel)]="filters.sortOrder"
            (ionChange)="applyFilters()"
          >
            <ion-select-option value="asc">Ascendente</ion-select-option>
            <ion-select-option value="desc">Descendente</ion-select-option>
          </ion-select>
        </ion-item>
        
        <!-- Botones -->
        <div class="filter-actions">
          <ion-button expand="block" (click)="clearFilters()">
            Limpiar Filtros
          </ion-button>
        </div>
      </ion-card-content>
    </ion-card>
  `,
  styles: [`
    .suggestions-list {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      z-index: 1000;
      max-height: 300px;
      overflow-y: auto;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    
    .filters-card {
      margin: 16px;
    }
    
    .filter-actions {
      margin-top: 16px;
    }
  `]
})
export class AdvancedSearchComponent implements OnInit {
  private readonly searchService = inject(SearchService);
  private readonly categoryService = inject(CategoryService);
  
  @Output() public search = new EventEmitter<SearchFilters>();
  
  public searchQuery = '';
  public showFilters = signal(false);
  public suggestions = signal<string[]>([]);
  public categories = signal<Category[]>([]);
  
  public filters: SearchFilters = {
    sortBy: 'name',
    sortOrder: 'asc'
  };
  
  private readonly searchSubject = new Subject<string>();
  
  public ngOnInit(): void {
    this.loadCategories();
    this.setupSearchDebounce();
  }
  
  private loadCategories(): void {
    this.categoryService.getAll().subscribe({
      next: (categories) => this.categories.set(categories),
      error: (error) => console.error('Error loading categories:', error)
    });
  }
  
  private setupSearchDebounce(): void {
    this.searchSubject.pipe(
      debounceTime(300),
      distinctUntilChanged()
    ).subscribe((query) => {
      this.loadSuggestions(query);
      this.applyFilters();
    });
  }
  
  public onSearchInput(event: any): void {
    const query = event.target.value;
    this.searchSubject.next(query);
  }
  
  private loadSuggestions(query: string): void {
    if (!query || query.length < 2) {
      this.suggestions.set([]);
      return;
    }
    
    this.searchService.getSuggestions(query).subscribe({
      next: (suggestions) => this.suggestions.set(suggestions),
      error: () => this.suggestions.set([])
    });
  }
  
  public selectSuggestion(suggestion: string): void {
    this.searchQuery = suggestion;
    this.suggestions.set([]);
    this.applyFilters();
  }
  
  public onClearSearch(): void {
    this.searchQuery = '';
    this.suggestions.set([]);
    this.applyFilters();
  }
  
  public toggleFilters(): void {
    this.showFilters.set(!this.showFilters());
  }
  
  public applyFilters(): void {
    const filters: SearchFilters = {
      ...this.filters,
      query: this.searchQuery || undefined
    };
    
    this.search.emit(filters);
  }
  
  public clearFilters(): void {
    this.filters = {
      sortBy: 'name',
      sortOrder: 'asc'
    };
    this.searchQuery = '';
    this.applyFilters();
  }
}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  5.2 SCANNER DE CÃ“DIGO DE BARRAS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

OBJETIVO: Integrar escÃ¡ner de cÃ³digo de barras para bÃºsqueda rÃ¡pida de productos.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 5.2.1 Barcode Scanner Plugin
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

INSTALACIÃ“N:

```bash
# Instalar plugin de Capacitor
npm install @capacitor-community/barcode-scanner
npx cap sync
```

PERMISOS: android/app/src/main/AndroidManifest.xml

```xml
<uses-permission android:name="android.permission.CAMERA" />
```

PERMISOS: ios/App/App/Info.plist

```xml
<key>NSCameraUsageDescription</key>
<string>Para escanear cÃ³digos de barras de productos</string>
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 5.2.2 Barcode Scanner Service
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/app/core/services/barcode-scanner.service.ts

import { Injectable, inject } from '@angular/core';
import { BarcodeScanner, ScanResult } from '@capacitor-community/barcode-scanner';
import { Platform } from '@ionic/angular';
import { Observable, from, of } from 'rxjs';
import { map, catchError } from 'rxjs/operators';

@Injectable({
  providedIn: 'root'
})
export class BarcodeScannerService {
  private readonly platform = inject(Platform);
  
  /**
   * Verificar si el dispositivo tiene cÃ¡mara
   */
  public async checkPermissions(): Promise<boolean> {
    if (!this.platform.is('capacitor')) {
      return false;
    }
    
    const status = await BarcodeScanner.checkPermission({ force: false });
    
    if (status.granted) {
      return true;
    }
    
    if (status.denied) {
      // Permiso denegado permanentemente
      return false;
    }
    
    // Solicitar permiso
    const request = await BarcodeScanner.checkPermission({ force: true });
    return request.granted;
  }
  
  /**
   * Iniciar escaneo
   */
  public async startScan(): Promise<string | null> {
    const hasPermission = await this.checkPermissions();
    
    if (!hasPermission) {
      throw new Error('Camera permission denied');
    }
    
    // Preparar scanner
    await BarcodeScanner.prepare();
    
    // Ocultar background para mostrar cÃ¡mara
    document.body.classList.add('scanner-active');
    
    try {
      const result: ScanResult = await BarcodeScanner.startScan();
      
      if (result.hasContent) {
        return result.content;
      }
      
      return null;
    } finally {
      this.stopScan();
    }
  }
  
  /**
   * Detener escaneo
   */
  public async stopScan(): Promise<void> {
    document.body.classList.remove('scanner-active');
    await BarcodeScanner.stopScan();
  }
  
  /**
   * Abrir configuraciÃ³n de cÃ¡mara
   */
  public async openSettings(): Promise<void> {
    await BarcodeScanner.openAppSettings();
  }
}

ESTILOS GLOBALES: src/global.scss

```scss
// Scanner styles
body.scanner-active {
  --background: transparent;
  --ion-background-color: transparent;
  
  app-root {
    display: none;
  }
}

.scanner-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 9999;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  align-items: center;
  padding: 20px;
  
  .scanner-header {
    color: white;
    text-align: center;
    
    h2 {
      font-size: 24px;
      margin-bottom: 8px;
    }
    
    p {
      font-size: 14px;
      opacity: 0.8;
    }
  }
  
  .scanner-frame {
    width: 250px;
    height: 250px;
    border: 2px solid var(--ion-color-primary);
    border-radius: 8px;
    box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.5);
  }
  
  .scanner-actions {
    display: flex;
    gap: 12px;
  }
}
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 5.2.3 Barcode Scanner Component
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/app/shared/components/barcode-scanner/barcode-scanner.component.ts

import { Component, Output, EventEmitter, inject } from '@angular/core';
import { CommonModule } from '@angular/common';
import { IonicModule } from '@ionic/angular';

import { BarcodeScannerService } from '@core/services/barcode-scanner.service';
import { ToastService } from '@core/services/toast.service';

@Component({
  selector: 'app-barcode-scanner',
  standalone: true,
  imports: [CommonModule, IonicModule],
  template: `
    <ion-button (click)="scan()" [disabled]="scanning">
      <ion-icon 
        slot="start" 
        [name]="scanning ? 'hourglass-outline' : 'scan-outline'"
      ></ion-icon>
      {{ scanning ? 'Escaneando...' : 'Escanear' }}
    </ion-button>
    
    <!-- Overlay durante escaneo -->
    <div *ngIf="scanning" class="scanner-overlay">
      <div class="scanner-header">
        <h2>Escanear CÃ³digo de Barras</h2>
        <p>Centra el cÃ³digo dentro del marco</p>
      </div>
      
      <div class="scanner-frame"></div>
      
      <div class="scanner-actions">
        <ion-button color="light" (click)="cancel()">
          Cancelar
        </ion-button>
      </div>
    </div>
  `
})
export class BarcodeScannerComponent {
  private readonly scannerService = inject(BarcodeScannerService);
  private readonly toastService = inject(ToastService);
  
  @Output() public scanned = new EventEmitter<string>();
  
  public scanning = false;
  
  public async scan(): Promise<void> {
    this.scanning = true;
    
    try {
      const barcode = await this.scannerService.startScan();
      
      if (barcode) {
        this.scanned.emit(barcode);
        this.toastService.success(`CÃ³digo escaneado: ${barcode}`);
      }
    } catch (error: any) {
      if (error.message === 'Camera permission denied') {
        this.toastService.error('Permiso de cÃ¡mara denegado');
        
        // Ofrecer ir a configuraciÃ³n
        const shouldOpenSettings = confirm(
          'Â¿Deseas abrir la configuraciÃ³n para habilitar la cÃ¡mara?'
        );
        
        if (shouldOpenSettings) {
          await this.scannerService.openSettings();
        }
      } else {
        this.toastService.error('Error al escanear cÃ³digo');
      }
    } finally {
      this.scanning = false;
    }
  }
  
  public async cancel(): Promise<void> {
    await this.scannerService.stopScan();
    this.scanning = false;
  }
}

USO EN PRODUCT LIST:

```typescript
// En product-list.component.html
<app-barcode-scanner (scanned)="onBarcodeScanned($event)"></app-barcode-scanner>

// En product-list.component.ts
public async onBarcodeScanned(barcode: string): Promise<void> {
  this.loading = true;
  
  try {
    const product = await this.searchService.searchByBarcode(barcode).toPromise();
    
    if (product) {
      // Navegar a detalle o agregar al carrito
      this.router.navigate(['/inventory/product', product.id]);
    } else {
      this.toastService.warning('Producto no encontrado');
    }
  } catch (error) {
    this.toastService.error('Error al buscar producto');
  } finally {
    this.loading = false;
  }
}
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  5.3 NOTIFICACIONES PUSH
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

OBJETIVO: Notificaciones para stock bajo, ventas, recordatorios, etc.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 5.3.1 Push Notifications Plugin
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

INSTALACIÃ“N:

```bash
# Instalar plugin
npm install @capacitor/push-notifications
npx cap sync
```

CONFIGURACIÃ“N: capacitor.config.ts

```typescript
import { CapacitorConfig } from '@capacitor/cli';

const config: CapacitorConfig = {
  appId: 'com.gestpharma.app',
  appName: 'GestPharma',
  webDir: 'www',
  plugins: {
    PushNotifications: {
      presentationOptions: ['badge', 'sound', 'alert']
    }
  }
};

export default config;
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 5.3.2 Push Notifications Service
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/app/core/services/push-notifications.service.ts

import { Injectable, inject } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { Platform } from '@ionic/angular';
import { 
  PushNotifications, 
  Token, 
  PushNotificationSchema,
  ActionPerformed 
} from '@capacitor/push-notifications';
import { BehaviorSubject, Observable } from 'rxjs';
import { environment } from '@environments/environment';

export interface NotificationPayload {
  title: string;
  body: string;
  data?: any;
}

@Injectable({
  providedIn: 'root'
})
export class PushNotificationsService {
  private readonly http = inject(HttpClient);
  private readonly platform = inject(Platform);
  
  private readonly notificationSubject = new BehaviorSubject<PushNotificationSchema | null>(null);
  public readonly notification$ = this.notificationSubject.asObservable();
  
  /**
   * Inicializar servicio de notificaciones
   */
  public async initialize(): Promise<void> {
    if (!this.platform.is('capacitor')) {
      console.warn('Push notifications only work on native platforms');
      return;
    }
    
    // Solicitar permiso
    const permission = await PushNotifications.requestPermissions();
    
    if (permission.receive === 'granted') {
      await PushNotifications.register();
      this.setupListeners();
    }
  }
  
  /**
   * Configurar listeners de eventos
   */
  private setupListeners(): void {
    // Registration successful
    PushNotifications.addListener('registration', (token: Token) => {
      console.log('Push registration success, token:', token.value);
      this.registerToken(token.value);
    });
    
    // Registration failed
    PushNotifications.addListener('registrationError', (error: any) => {
      console.error('Error on registration:', error);
    });
    
    // Notification received (app en foreground)
    PushNotifications.addListener(
      'pushNotificationReceived',
      (notification: PushNotificationSchema) => {
        console.log('Push received:', notification);
        this.notificationSubject.next(notification);
      }
    );
    
    // Notification clicked (app en background)
    PushNotifications.addListener(
      'pushNotificationActionPerformed',
      (notification: ActionPerformed) => {
        console.log('Push action performed:', notification);
        this.handleNotificationClick(notification.notification);
      }
    );
  }
  
  /**
   * Registrar token en backend
   */
  private registerToken(token: string): void {
    this.http.post(`${environment.apiUrl}/notifications/register`, { token })
      .subscribe({
        next: () => console.log('Token registered successfully'),
        error: (error) => console.error('Error registering token:', error)
      });
  }
  
  /**
   * Manejar click en notificaciÃ³n
   */
  private handleNotificationClick(notification: PushNotificationSchema): void {
    const data = notification.data;
    
    // Navegar segÃºn tipo de notificaciÃ³n
    if (data?.type === 'low-stock') {
      // Navegar a producto con stock bajo
      // this.router.navigate(['/inventory/product', data.productId]);
    } else if (data?.type === 'new-sale') {
      // Navegar a detalle de venta
      // this.router.navigate(['/sales', data.saleId]);
    }
  }
  
  /**
   * Obtener badges pendientes
   */
  public async getBadgeCount(): Promise<number> {
    const result = await PushNotifications.getBadge();
    return result.badge || 0;
  }
  
  /**
   * Actualizar badge count
   */
  public async setBadgeCount(count: number): Promise<void> {
    await PushNotifications.setBadge({ badge: count });
  }
  
  /**
   * Limpiar badge
   */
  public async clearBadge(): Promise<void> {
    await PushNotifications.setBadge({ badge: 0 });
  }
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 5.3.3 Inicializar en App Component
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/app/app.component.ts

import { Component, OnInit, inject } from '@angular/core';
import { PushNotificationsService } from '@core/services/push-notifications.service';
import { ToastService } from '@core/services/toast.service';

@Component({
  selector: 'app-root',
  template: `<ion-app><ion-router-outlet /></ion-app>`
})
export class AppComponent implements OnInit {
  private readonly pushNotifications = inject(PushNotificationsService);
  private readonly toastService = inject(ToastService);
  
  public async ngOnInit(): Promise<void> {
    await this.pushNotifications.initialize();
    
    // Escuchar notificaciones en foreground
    this.pushNotifications.notification$.subscribe((notification) => {
      if (notification) {
        this.toastService.info(
          notification.body || 'Nueva notificaciÃ³n',
          notification.title || 'GestPharma'
        );
      }
    });
  }
}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  5.4 REPORTES Y ANALYTICS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

OBJETIVO: Dashboard con mÃ©tricas clave y generaciÃ³n de reportes exportables.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 5.4.1 Analytics Service
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/app/core/services/analytics.service.ts

import { Injectable, inject } from '@angular/core';
import { HttpClient, HttpParams } from '@angular/common/http';
import { Observable } from 'rxjs';
import { environment } from '@environments/environment';

export interface DashboardMetrics {
  totalSales: number;
  salesGrowth: number;
  totalRevenue: number;
  revenueGrowth: number;
  lowStockProducts: number;
  expiredProducts: number;
  topProducts: ProductSalesData[];
  recentSales: Sale[];
  salesByCategory: CategorySalesData[];
  salesTrend: SalesTrendData[];
}

export interface ProductSalesData {
  product: Product;
  quantity: number;
  revenue: number;
}

export interface CategorySalesData {
  category: Category;
  totalSales: number;
  revenue: number;
  percentage: number;
}

export interface SalesTrendData {
  date: string;
  sales: number;
  revenue: number;
}

export interface DateRange {
  startDate: string;
  endDate: string;
}

@Injectable({
  providedIn: 'root'
})
export class AnalyticsService {
  private readonly http = inject(HttpClient);
  private readonly baseUrl = `${environment.apiUrl}/analytics`;
  
  /**
   * Obtener mÃ©tricas del dashboard
   */
  public getDashboardMetrics(range?: DateRange): Observable<DashboardMetrics> {
    let params = new HttpParams();
    
    if (range) {
      params = params
        .set('startDate', range.startDate)
        .set('endDate', range.endDate);
    }
    
    return this.http.get<DashboardMetrics>(`${this.baseUrl}/dashboard`, { params });
  }
  
  /**
   * Reporte de ventas
   */
  public getSalesReport(range: DateRange): Observable<any> {
    const params = new HttpParams()
      .set('startDate', range.startDate)
      .set('endDate', range.endDate);
    
    return this.http.get(`${this.baseUrl}/sales-report`, { params });
  }
  
  /**
   * Reporte de inventario
   */
  public getInventoryReport(): Observable<any> {
    return this.http.get(`${this.baseUrl}/inventory-report`);
  }
  
  /**
   * Productos mÃ¡s vendidos
   */
  public getTopProducts(limit = 10, range?: DateRange): Observable<ProductSalesData[]> {
    let params = new HttpParams().set('limit', limit.toString());
    
    if (range) {
      params = params
        .set('startDate', range.startDate)
        .set('endDate', range.endDate);
    }
    
    return this.http.get<ProductSalesData[]>(`${this.baseUrl}/top-products`, { params });
  }
  
  /**
   * Ventas por categorÃ­a
   */
  public getSalesByCategory(range?: DateRange): Observable<CategorySalesData[]> {
    let params = new HttpParams();
    
    if (range) {
      params = params
        .set('startDate', range.startDate)
        .set('endDate', range.endDate);
    }
    
    return this.http.get<CategorySalesData[]>(`${this.baseUrl}/sales-by-category`, { params });
  }
  
  /**
   * Tendencia de ventas
   */
  public getSalesTrend(range: DateRange, groupBy: 'day' | 'week' | 'month' = 'day'): Observable<SalesTrendData[]> {
    const params = new HttpParams()
      .set('startDate', range.startDate)
      .set('endDate', range.endDate)
      .set('groupBy', groupBy);
    
    return this.http.get<SalesTrendData[]>(`${this.baseUrl}/sales-trend`, { params });
  }
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 5.4.2 Dashboard Component
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/app/pages/dashboard/dashboard.page.ts

import { Component, OnInit, inject, signal } from '@angular/core';
import { CommonModule } from '@angular/common';
import { IonicModule } from '@ionic/angular';
import { FormsModule } from '@angular/forms';

import { AnalyticsService, DashboardMetrics } from '@core/services/analytics.service';
import { TimeAgoPipe } from '@shared/pipes/time-ago.pipe';
import { CurrencyPipe } from '@angular/common';

@Component({
  selector: 'app-dashboard',
  standalone: true,
  imports: [CommonModule, FormsModule, IonicModule, TimeAgoPipe, CurrencyPipe],
  template: `
    <ion-header>
      <ion-toolbar color="primary">
        <ion-title>Dashboard</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="refresh()">
            <ion-icon name="refresh-outline"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>
    
    <ion-content>
      <!-- Date Range Selector -->
      <ion-card>
        <ion-card-content>
          <ion-segment [(ngModel)]="selectedPeriod" (ionChange)="onPeriodChange()">
            <ion-segment-button value="today">
              <ion-label>Hoy</ion-label>
            </ion-segment-button>
            <ion-segment-button value="week">
              <ion-label>Semana</ion-label>
            </ion-segment-button>
            <ion-segment-button value="month">
              <ion-label>Mes</ion-label>
            </ion-segment-button>
            <ion-segment-button value="year">
              <ion-label>AÃ±o</ion-label>
            </ion-segment-button>
          </ion-segment>
        </ion-card-content>
      </ion-card>
      
      <!-- Loading -->
      <div *ngIf="loading()" class="loading-container">
        <ion-spinner></ion-spinner>
      </div>
      
      <!-- Metrics Cards -->
      <div *ngIf="!loading() && metrics()" class="metrics-grid">
        <!-- Total Sales -->
        <ion-card class="metric-card">
          <ion-card-content>
            <div class="metric-icon sales">
              <ion-icon name="cart-outline"></ion-icon>
            </div>
            <div class="metric-content">
              <p class="metric-label">Ventas Totales</p>
              <h2 class="metric-value">{{ metrics()!.totalSales }}</h2>
              <div 
                class="metric-growth"
                [class.positive]="metrics()!.salesGrowth >= 0"
                [class.negative]="metrics()!.salesGrowth < 0"
              >
                <ion-icon 
                  [name]="metrics()!.salesGrowth >= 0 ? 'trending-up' : 'trending-down'"
                ></ion-icon>
                {{ metrics()!.salesGrowth | number:'1.1-1' }}%
              </div>
            </div>
          </ion-card-content>
        </ion-card>
        
        <!-- Revenue -->
        <ion-card class="metric-card">
          <ion-card-content>
            <div class="metric-icon revenue">
              <ion-icon name="cash-outline"></ion-icon>
            </div>
            <div class="metric-content">
              <p class="metric-label">Ingresos</p>
              <h2 class="metric-value">{{ metrics()!.totalRevenue | currency }}</h2>
              <div 
                class="metric-growth"
                [class.positive]="metrics()!.revenueGrowth >= 0"
                [class.negative]="metrics()!.revenueGrowth < 0"
              >
                <ion-icon 
                  [name]="metrics()!.revenueGrowth >= 0 ? 'trending-up' : 'trending-down'"
                ></ion-icon>
                {{ metrics()!.revenueGrowth | number:'1.1-1' }}%
              </div>
            </div>
          </ion-card-content>
        </ion-card>
        
        <!-- Low Stock -->
        <ion-card class="metric-card warning">
          <ion-card-content>
            <div class="metric-icon">
              <ion-icon name="warning-outline"></ion-icon>
            </div>
            <div class="metric-content">
              <p class="metric-label">Stock Bajo</p>
              <h2 class="metric-value">{{ metrics()!.lowStockProducts }}</h2>
              <p class="metric-subtitle">Productos</p>
            </div>
          </ion-card-content>
        </ion-card>
        
        <!-- Expired -->
        <ion-card class="metric-card danger">
          <ion-card-content>
            <div class="metric-icon">
              <ion-icon name="close-circle-outline"></ion-icon>
            </div>
            <div class="metric-content">
              <p class="metric-label">Expirados</p>
              <h2 class="metric-value">{{ metrics()!.expiredProducts }}</h2>
              <p class="metric-subtitle">Productos</p>
            </div>
          </ion-card-content>
        </ion-card>
      </div>
      
      <!-- Charts Section -->
      <ion-card *ngIf="!loading() && metrics()">
        <ion-card-header>
          <ion-card-title>Ventas por CategorÃ­a</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <div class="category-chart">
            <div 
              *ngFor="let item of metrics()!.salesByCategory"
              class="category-item"
            >
              <div class="category-info">
                <span class="category-name">{{ item.category.nombre }}</span>
                <span class="category-value">{{ item.revenue | currency }}</span>
              </div>
              <div class="category-bar">
                <div 
                  class="category-fill"
                  [style.width.%]="item.percentage"
                ></div>
              </div>
              <span class="category-percentage">{{ item.percentage | number:'1.0-0' }}%</span>
            </div>
          </div>
        </ion-card-content>
      </ion-card>
      
      <!-- Top Products -->
      <ion-card *ngIf="!loading() && metrics()">
        <ion-card-header>
          <ion-card-title>Productos MÃ¡s Vendidos</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <ion-list>
            <ion-item *ngFor="let item of metrics()!.topProducts; let i = index">
              <div class="ranking-badge" slot="start">{{ i + 1 }}</div>
              <ion-label>
                <h3>{{ item.product.nombre }}</h3>
                <p>{{ item.quantity }} unidades vendidas</p>
              </ion-label>
              <ion-note slot="end">{{ item.revenue | currency }}</ion-note>
            </ion-item>
          </ion-list>
        </ion-card-content>
      </ion-card>
      
      <!-- Recent Sales -->
      <ion-card *ngIf="!loading() && metrics()">
        <ion-card-header>
          <ion-card-title>Ventas Recientes</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <ion-list>
            <ion-item *ngFor="let sale of metrics()!.recentSales">
              <ion-label>
                <h3>Venta #{{ sale.id }}</h3>
                <p>{{ sale.createdAt | timeAgo }}</p>
              </ion-label>
              <ion-note slot="end">{{ sale.total | currency }}</ion-note>
            </ion-item>
          </ion-list>
        </ion-card-content>
      </ion-card>
    </ion-content>
  `,
  styles: [`
    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 16px;
      padding: 16px;
    }
    
    .metric-card {
      margin: 0;
      
      ion-card-content {
        display: flex;
        gap: 16px;
        align-items: center;
      }
      
      &.warning {
        border-left: 4px solid var(--ion-color-warning);
      }
      
      &.danger {
        border-left: 4px solid var(--ion-color-danger);
      }
    }
    
    .metric-icon {
      width: 60px;
      height: 60px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--ion-color-light);
      
      ion-icon {
        font-size: 32px;
        color: var(--ion-color-medium);
      }
      
      &.sales {
        background: rgba(var(--ion-color-primary-rgb), 0.1);
        
        ion-icon {
          color: var(--ion-color-primary);
        }
      }
      
      &.revenue {
        background: rgba(var(--ion-color-success-rgb), 0.1);
        
        ion-icon {
          color: var(--ion-color-success);
        }
      }
    }
    
    .metric-content {
      flex: 1;
    }
    
    .metric-label {
      font-size: 14px;
      color: var(--ion-color-medium);
      margin: 0 0 4px 0;
    }
    
    .metric-value {
      font-size: 28px;
      font-weight: bold;
      margin: 0 0 4px 0;
    }
    
    .metric-growth {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 14px;
      font-weight: 500;
      
      &.positive {
        color: var(--ion-color-success);
      }
      
      &.negative {
        color: var(--ion-color-danger);
      }
      
      ion-icon {
        font-size: 18px;
      }
    }
    
    .metric-subtitle {
      font-size: 12px;
      color: var(--ion-color-medium);
      margin: 0;
    }
    
    .category-chart {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .category-item {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 8px;
      align-items: center;
    }
    
    .category-info {
      display: flex;
      justify-content: space-between;
      grid-column: 1 / -1;
      margin-bottom: 4px;
    }
    
    .category-name {
      font-weight: 500;
    }
    
    .category-value {
      color: var(--ion-color-medium);
    }
    
    .category-bar {
      height: 8px;
      background: var(--ion-color-light);
      border-radius: 4px;
      overflow: hidden;
    }
    
    .category-fill {
      height: 100%;
      background: var(--ion-color-primary);
      transition: width 0.3s ease;
    }
    
    .category-percentage {
      font-size: 12px;
      color: var(--ion-color-medium);
      min-width: 40px;
      text-align: right;
    }
    
    .ranking-badge {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: var(--ion-color-primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }
    
    .loading-container {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 200px;
    }
  `]
})
export class DashboardPage implements OnInit {
  private readonly analyticsService = inject(AnalyticsService);
  
  public loading = signal(true);
  public metrics = signal<DashboardMetrics | null>(null);
  public selectedPeriod = 'today';
  
  public ngOnInit(): void {
    this.loadMetrics();
  }
  
  public onPeriodChange(): void {
    this.loadMetrics();
  }
  
  public refresh(): void {
    this.loadMetrics();
  }
  
  private loadMetrics(): void {
    this.loading.set(true);
    
    const range = this.getDateRange(this.selectedPeriod);
    
    this.analyticsService.getDashboardMetrics(range).subscribe({
      next: (metrics) => {
        this.metrics.set(metrics);
        this.loading.set(false);
      },
      error: (error) => {
        console.error('Error loading metrics:', error);
        this.loading.set(false);
      }
    });
  }
  
  private getDateRange(period: string): any {
    const now = new Date();
    let startDate: Date;
    
    switch (period) {
      case 'today':
        startDate = new Date(now.setHours(0, 0, 0, 0));
        break;
      case 'week':
        startDate = new Date(now.setDate(now.getDate() - 7));
        break;
      case 'month':
        startDate = new Date(now.setMonth(now.getMonth() - 1));
        break;
      case 'year':
        startDate = new Date(now.setFullYear(now.getFullYear() - 1));
        break;
      default:
        startDate = new Date(now.setHours(0, 0, 0, 0));
    }
    
    return {
      startDate: startDate.toISOString(),
      endDate: new Date().toISOString()
    };
  }
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 5.4.3 Export Service
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/app/core/services/export.service.ts

import { Injectable } from '@angular/core';
import { Filesystem, Directory, Encoding } from '@capacitor/filesystem';
import { Share } from '@capacitor/share';

@Injectable({
  providedIn: 'root'
})
export class ExportService {
  
  /**
   * Exportar datos a CSV
   */
  public async exportToCSV(data: any[], filename: string): Promise<void> {
    if (data.length === 0) {
      throw new Error('No data to export');
    }
    
    // Obtener headers
    const headers = Object.keys(data[0]);
    
    // Construir CSV
    let csv = headers.join(',') + '\n';
    
    data.forEach((row) => {
      const values = headers.map((header) => {
        const value = row[header];
        // Escapar valores con comas o comillas
        if (typeof value === 'string' && (value.includes(',') || value.includes('"'))) {
          return `"${value.replace(/"/g, '""')}"`;
        }
        return value;
      });
      csv += values.join(',') + '\n';
    });
    
    await this.saveAndShare(csv, filename, 'text/csv');
  }
  
  /**
   * Exportar datos a JSON
   */
  public async exportToJSON(data: any, filename: string): Promise<void> {
    const json = JSON.stringify(data, null, 2);
    await this.saveAndShare(json, filename, 'application/json');
  }
  
  /**
   * Exportar a PDF (requiere librerÃ­a adicional)
   */
  public async exportToPDF(html: string, filename: string): Promise<void> {
    // Implementar con jsPDF o similar
    // Por ahora, exportar como HTML
    await this.saveAndShare(html, filename.replace('.pdf', '.html'), 'text/html');
  }
  
  /**
   * Guardar y compartir archivo
   */
  private async saveAndShare(
    content: string, 
    filename: string,
    mimeType: string
  ): Promise<void> {
    try {
      // Guardar archivo
      const result = await Filesystem.writeFile({
        path: filename,
        data: content,
        directory: Directory.Documents,
        encoding: Encoding.UTF8
      });
      
      // Compartir archivo
      await Share.share({
        title: 'Exportar Reporte',
        text: `Reporte: ${filename}`,
        url: result.uri,
        dialogTitle: 'Compartir Reporte'
      });
    } catch (error) {
      console.error('Error exporting file:', error);
      throw error;
    }
  }
}

USO EN COMPONENTE:

```typescript
public async exportSalesReport(): Promise<void> {
  try {
    const data = await this.analyticsService.getSalesReport(this.dateRange).toPromise();
    await this.exportService.exportToCSV(data, 'ventas-report.csv');
    this.toastService.success('Reporte exportado correctamente');
  } catch (error) {
    this.toastService.error('Error al exportar reporte');
  }
}
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  5.5 MODO OFFLINE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

OBJETIVO: Funcionamiento bÃ¡sico sin conexiÃ³n con sincronizaciÃ³n automÃ¡tica.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 5.5.1 Network Service
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/app/core/services/network.service.ts

import { Injectable, inject } from '@angular/core';
import { Platform } from '@ionic/angular';
import { Network } from '@capacitor/network';
import { BehaviorSubject, Observable, fromEvent, merge, of } from 'rxjs';
import { map } from 'rxjs/operators';

@Injectable({
  providedIn: 'root'
})
export class NetworkService {
  private readonly platform = inject(Platform);
  
  private readonly onlineSubject = new BehaviorSubject<boolean>(true);
  public readonly online$ = this.onlineSubject.asObservable();
  
  constructor() {
    this.initialize();
  }
  
  /**
   * Inicializar monitoreo de red
   */
  private async initialize(): Promise<void> {
    if (this.platform.is('capacitor')) {
      // Usar Capacitor Network API
      const status = await Network.getStatus();
      this.onlineSubject.next(status.connected);
      
      Network.addListener('networkStatusChange', (status) => {
        this.onlineSubject.next(status.connected);
      });
    } else {
      // Usar eventos del navegador
      this.onlineSubject.next(navigator.onLine);
      
      merge(
        fromEvent(window, 'online').pipe(map(() => true)),
        fromEvent(window, 'offline').pipe(map(() => false))
      ).subscribe((online) => {
        this.onlineSubject.next(online);
      });
    }
  }
  
  /**
   * Obtener estado actual de conexiÃ³n
   */
  public isOnline(): boolean {
    return this.onlineSubject.value;
  }
  
  /**
   * Obtener estado de conexiÃ³n como Observable
   */
  public getConnectionStatus(): Observable<boolean> {
    return this.online$;
  }
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 5.5.2 Storage Service (IndexedDB)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

INSTALACIÃ“N:

```bash
npm install dexie
```

UBICACIÃ“N: src/app/core/services/offline-storage.service.ts

import { Injectable } from '@angular/core';
import Dexie, { Table } from 'dexie';

export interface OfflineAction {
  id?: number;
  type: 'CREATE' | 'UPDATE' | 'DELETE';
  entity: string;
  data: any;
  timestamp: number;
  synced: boolean;
}

export class OfflineDatabase extends Dexie {
  public products!: Table<Product, number>;
  public categories!: Table<Category, number>;
  public sales!: Table<Sale, number>;
  public actions!: Table<OfflineAction, number>;
  
  constructor() {
    super('GestPharmaDB');
    
    this.version(1).stores({
      products: '++id, nombre, codigo, categoriaId',
      categories: '++id, nombre',
      sales: '++id, fecha, total',
      actions: '++id, synced, timestamp'
    });
  }
}

@Injectable({
  providedIn: 'root'
})
export class OfflineStorageService {
  private readonly db = new OfflineDatabase();
  
  /**
   * Guardar producto localmente
   */
  public async saveProduct(product: Product): Promise<void> {
    await this.db.products.put(product);
  }
  
  /**
   * Obtener todos los productos locales
   */
  public async getAllProducts(): Promise<Product[]> {
    return await this.db.products.toArray();
  }
  
  /**
   * Guardar acciÃ³n pendiente
   */
  public async saveAction(action: Omit<OfflineAction, 'id' | 'synced' | 'timestamp'>): Promise<void> {
    await this.db.actions.add({
      ...action,
      timestamp: Date.now(),
      synced: false
    });
  }
  
  /**
   * Obtener acciones pendientes
   */
  public async getPendingActions(): Promise<OfflineAction[]> {
    return await this.db.actions
      .where('synced')
      .equals(0)
      .toArray();
  }
  
  /**
   * Marcar acciÃ³n como sincronizada
   */
  public async markActionSynced(id: number): Promise<void> {
    await this.db.actions.update(id, { synced: true });
  }
  
  /**
   * Limpiar acciones sincronizadas
   */
  public async clearSyncedActions(): Promise<void> {
    await this.db.actions
      .where('synced')
      .equals(1)
      .delete();
  }
  
  /**
   * Limpiar toda la base de datos
   */
  public async clearAll(): Promise<void> {
    await this.db.delete();
  }
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 5.5.3 Sync Service
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/app/core/services/sync.service.ts

import { Injectable, inject } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { firstValueFrom } from 'rxjs';

import { NetworkService } from './network.service';
import { OfflineStorageService, OfflineAction } from './offline-storage.service';
import { ToastService } from './toast.service';
import { environment } from '@environments/environment';

@Injectable({
  providedIn: 'root'
})
export class SyncService {
  private readonly http = inject(HttpClient);
  private readonly networkService = inject(NetworkService);
  private readonly storage = inject(OfflineStorageService);
  private readonly toastService = inject(ToastService);
  
  private syncing = false;
  
  constructor() {
    this.setupAutoSync();
  }
  
  /**
   * Configurar sincronizaciÃ³n automÃ¡tica
   */
  private setupAutoSync(): void {
    // Sincronizar cuando la conexiÃ³n se recupera
    this.networkService.online$.subscribe((online) => {
      if (online && !this.syncing) {
        this.syncPendingActions();
      }
    });
  }
  
  /**
   * Sincronizar acciones pendientes
   */
  public async syncPendingActions(): Promise<void> {
    if (this.syncing || !this.networkService.isOnline()) {
      return;
    }
    
    this.syncing = true;
    
    try {
      const actions = await this.storage.getPendingActions();
      
      if (actions.length === 0) {
        return;
      }
      
      this.toastService.info(`Sincronizando ${actions.length} cambios...`);
      
      for (const action of actions) {
        try {
          await this.syncAction(action);
          await this.storage.markActionSynced(action.id!);
        } catch (error) {
          console.error('Error syncing action:', error);
          // Continuar con las demÃ¡s acciones
        }
      }
      
      // Limpiar acciones sincronizadas
      await this.storage.clearSyncedActions();
      
      this.toastService.success('SincronizaciÃ³n completada');
    } catch (error) {
      console.error('Error during sync:', error);
      this.toastService.error('Error al sincronizar');
    } finally {
      this.syncing = false;
    }
  }
  
  /**
   * Sincronizar una acciÃ³n individual
   */
  private async syncAction(action: OfflineAction): Promise<void> {
    const url = `${environment.apiUrl}/${action.entity}`;
    
    switch (action.type) {
      case 'CREATE':
        await firstValueFrom(this.http.post(url, action.data));
        break;
      case 'UPDATE':
        await firstValueFrom(this.http.put(`${url}/${action.data.id}`, action.data));
        break;
      case 'DELETE':
        await firstValueFrom(this.http.delete(`${url}/${action.data.id}`));
        break;
    }
  }
  
  /**
   * Descargar datos para offline
   */
  public async downloadForOffline(): Promise<void> {
    if (!this.networkService.isOnline()) {
      throw new Error('No connection available');
    }
    
    try {
      this.toastService.info('Descargando datos...');
      
      // Descargar productos
      const products = await firstValueFrom(
        this.http.get<Product[]>(`${environment.apiUrl}/products`)
      );
      
      for (const product of products) {
        await this.storage.saveProduct(product);
      }
      
      this.toastService.success('Datos descargados correctamente');
    } catch (error) {
      console.error('Error downloading data:', error);
      throw error;
    }
  }
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 5.5.4 Offline Indicator Component
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/app/shared/components/offline-indicator/offline-indicator.component.ts

import { Component, inject, signal } from '@angular/core';
import { CommonModule } from '@angular/common';
import { IonicModule } from '@ionic/angular';

import { NetworkService } from '@core/services/network.service';
import { SyncService } from '@core/services/sync.service';

@Component({
  selector: 'app-offline-indicator',
  standalone: true,
  imports: [CommonModule, IonicModule],
  template: `
    <ion-toast
      *ngIf="!isOnline()"
      [isOpen]="true"
      message="Sin conexiÃ³n - Trabajando en modo offline"
      icon="cloud-offline-outline"
      color="warning"
      position="top"
      [buttons]="[
        {
          text: 'Sincronizar',
          role: 'cancel',
          handler: () => sync()
        }
      ]"
    ></ion-toast>
  `
})
export class OfflineIndicatorComponent {
  private readonly networkService = inject(NetworkService);
  private readonly syncService = inject(SyncService);
  
  public readonly isOnline = signal(true);
  
  constructor() {
    this.networkService.online$.subscribe((online) => {
      this.isOnline.set(online);
    });
  }
  
  public sync(): void {
    this.syncService.syncPendingActions();
  }
}

AGREGAR A APP COMPONENT:

```html
<ion-app>
  <app-offline-indicator></app-offline-indicator>
  <ion-router-outlet></ion-router-outlet>
</ion-app>
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 5.5.5 HTTP Interceptor para Offline
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/app/core/interceptors/offline.interceptor.ts

import { Injectable, inject } from '@angular/core';
import { 
  HttpInterceptor, 
  HttpRequest, 
  HttpHandler, 
  HttpEvent,
  HttpErrorResponse 
} from '@angular/common/http';
import { Observable, throwError, from } from 'rxjs';
import { catchError, switchMap } from 'rxjs/operators';

import { NetworkService } from '@core/services/network.service';
import { OfflineStorageService } from '@core/services/offline-storage.service';
import { ToastService } from '@core/services/toast.service';

@Injectable()
export class OfflineInterceptor implements HttpInterceptor {
  private readonly networkService = inject(NetworkService);
  private readonly storage = inject(OfflineStorageService);
  private readonly toastService = inject(ToastService);
  
  public intercept(req: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {
    // Si hay conexiÃ³n, proceder normalmente
    if (this.networkService.isOnline()) {
      return next.handle(req).pipe(
        catchError((error: HttpErrorResponse) => {
          // Si el error es de red, guardar para sincronizar despuÃ©s
          if (error.status === 0) {
            return this.handleOfflineRequest(req);
          }
          return throwError(() => error);
        })
      );
    }
    
    // Sin conexiÃ³n - manejar segÃºn el mÃ©todo
    if (req.method === 'GET') {
      return this.handleOfflineGet(req);
    } else {
      return this.handleOfflineRequest(req);
    }
  }
  
  /**
   * Manejar peticiones GET offline (desde cache)
   */
  private handleOfflineGet(req: HttpRequest<any>): Observable<HttpEvent<any>> {
    return from(this.getFromCache(req)).pipe(
      switchMap((cachedData) => {
        if (cachedData) {
          return throwError(() => new HttpErrorResponse({
            error: cachedData,
            status: 200,
            statusText: 'OK (from cache)'
          }));
        }
        
        this.toastService.warning('Sin conexiÃ³n y sin datos en cachÃ©');
        return throwError(() => new HttpErrorResponse({
          error: 'No connection and no cached data',
          status: 0
        }));
      })
    );
  }
  
  /**
   * Manejar peticiones POST/PUT/DELETE offline
   */
  private handleOfflineRequest(req: HttpRequest<any>): Observable<HttpEvent<any>> {
    return from(this.queueForSync(req)).pipe(
      switchMap(() => {
        this.toastService.info('AcciÃ³n guardada para sincronizar');
        
        // Retornar respuesta simulada
        return throwError(() => new HttpErrorResponse({
          error: { message: 'Queued for sync' },
          status: 202,
          statusText: 'Accepted'
        }));
      })
    );
  }
  
  /**
   * Obtener datos del cache local
   */
  private async getFromCache(req: HttpRequest<any>): Promise<any> {
    // Extraer entidad de la URL
    const entity = this.extractEntity(req.url);
    
    switch (entity) {
      case 'products':
        return await this.storage.getAllProducts();
      default:
        return null;
    }
  }
  
  /**
   * Guardar peticiÃ³n para sincronizar despuÃ©s
   */
  private async queueForSync(req: HttpRequest<any>): Promise<void> {
    const entity = this.extractEntity(req.url);
    
    let type: 'CREATE' | 'UPDATE' | 'DELETE';
    
    switch (req.method) {
      case 'POST':
        type = 'CREATE';
        break;
      case 'PUT':
      case 'PATCH':
        type = 'UPDATE';
        break;
      case 'DELETE':
        type = 'DELETE';
        break;
      default:
        return;
    }
    
    await this.storage.saveAction({
      type,
      entity,
      data: req.body
    });
  }
  
  /**
   * Extraer nombre de entidad de la URL
   */
  private extractEntity(url: string): string {
    const parts = url.split('/');
    return parts[parts.length - 1];
  }
}

REGISTRAR EN APP.CONFIG.TS:

```typescript
import { HTTP_INTERCEPTORS } from '@angular/common/http';
import { OfflineInterceptor } from '@core/interceptors/offline.interceptor';

export const appConfig: ApplicationConfig = {
  providers: [
    // ... otros providers
    {
      provide: HTTP_INTERCEPTORS,
      useClass: OfflineInterceptor,
      multi: true
    }
  ]
};
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  5.6 AUTENTICACIÃ“N BIOMÃ‰TRICA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

OBJETIVO: Login rÃ¡pido y seguro usando huella digital o Face ID.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 5.6.1 InstalaciÃ³n y ConfiguraciÃ³n
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

INSTALACIÃ“N:

```bash
npm install @capacitor/biometric-auth
npx cap sync
```

CONFIGURACIÃ“N iOS (ios/App/App/Info.plist):

```xml
<key>NSFaceIDUsageDescription</key>
<string>Usamos Face ID para autenticaciÃ³n rÃ¡pida y segura</string>
```

CONFIGURACIÃ“N ANDROID (android/app/src/main/AndroidManifest.xml):

```xml
<uses-permission android:name="android.permission.USE_BIOMETRIC" />
<uses-feature android:name="android.hardware.fingerprint" android:required="false" />
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 5.6.2 Biometric Service
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/app/core/services/biometric.service.ts

import { Injectable, inject } from '@angular/core';
import { Platform } from '@ionic/angular';
import { BiometricAuth, BiometryType } from '@capacitor/biometric-auth';
import { Preferences } from '@capacitor/preferences';

export interface BiometricConfig {
  enabled: boolean;
  biometryType?: BiometryType;
}

@Injectable({
  providedIn: 'root'
})
export class BiometricService {
  private readonly platform = inject(Platform);
  private readonly BIOMETRIC_KEY = 'biometric_enabled';
  
  /**
   * Verificar si el dispositivo soporta biometrÃ­a
   */
  public async isAvailable(): Promise<boolean> {
    if (!this.platform.is('capacitor')) {
      return false;
    }
    
    try {
      const result = await BiometricAuth.checkBiometry();
      return result.isAvailable;
    } catch (error) {
      console.error('Error checking biometry:', error);
      return false;
    }
  }
  
  /**
   * Obtener tipo de biometrÃ­a disponible
   */
  public async getBiometryType(): Promise<BiometryType | null> {
    try {
      const result = await BiometricAuth.checkBiometry();
      return result.biometryType || null;
    } catch (error) {
      return null;
    }
  }
  
  /**
   * Obtener nombre del tipo de biometrÃ­a
   */
  public async getBiometryName(): Promise<string> {
    const type = await this.getBiometryType();
    
    switch (type) {
      case BiometryType.FINGERPRINT:
        return 'Huella Digital';
      case BiometryType.FACE_AUTHENTICATION:
        return 'Face ID';
      case BiometryType.IRIS_AUTHENTICATION:
        return 'Reconocimiento Iris';
      default:
        return 'BiometrÃ­a';
    }
  }
  
  /**
   * Autenticar con biometrÃ­a
   */
  public async authenticate(reason?: string): Promise<boolean> {
    if (!await this.isAvailable()) {
      throw new Error('Biometric authentication not available');
    }
    
    try {
      await BiometricAuth.authenticate({
        reason: reason || 'AutenticaciÃ³n requerida',
        cancelTitle: 'Cancelar',
        allowDeviceCredential: true,
        iosFallbackTitle: 'Usar contraseÃ±a',
        androidTitle: 'AutenticaciÃ³n BiomÃ©trica',
        androidSubtitle: 'Verificar identidad',
        androidConfirmationRequired: false
      });
      
      return true;
    } catch (error) {
      console.error('Biometric authentication failed:', error);
      return false;
    }
  }
  
  /**
   * Verificar si la autenticaciÃ³n biomÃ©trica estÃ¡ habilitada
   */
  public async isEnabled(): Promise<boolean> {
    const { value } = await Preferences.get({ key: this.BIOMETRIC_KEY });
    return value === 'true';
  }
  
  /**
   * Habilitar autenticaciÃ³n biomÃ©trica
   */
  public async enable(): Promise<void> {
    await Preferences.set({ 
      key: this.BIOMETRIC_KEY, 
      value: 'true' 
    });
  }
  
  /**
   * Deshabilitar autenticaciÃ³n biomÃ©trica
   */
  public async disable(): Promise<void> {
    await Preferences.remove({ key: this.BIOMETRIC_KEY });
  }
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 5.6.3 Secure Storage Service
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

INSTALACIÃ“N:

```bash
npm install @capacitor-community/secure-storage
npx cap sync
```

UBICACIÃ“N: src/app/core/services/secure-storage.service.ts

import { Injectable, inject } from '@angular/core';
import { Platform } from '@ionic/angular';
import { SecureStorage } from '@capacitor-community/secure-storage';

@Injectable({
  providedIn: 'root'
})
export class SecureStorageService {
  private readonly platform = inject(Platform);
  
  /**
   * Guardar valor de forma segura
   */
  public async set(key: string, value: string): Promise<void> {
    if (!this.platform.is('capacitor')) {
      // Fallback para navegador (no es seguro)
      localStorage.setItem(key, value);
      return;
    }
    
    try {
      await SecureStorage.set({ key, value });
    } catch (error) {
      console.error('Error saving to secure storage:', error);
      throw error;
    }
  }
  
  /**
   * Obtener valor seguro
   */
  public async get(key: string): Promise<string | null> {
    if (!this.platform.is('capacitor')) {
      return localStorage.getItem(key);
    }
    
    try {
      const { value } = await SecureStorage.get({ key });
      return value;
    } catch (error) {
      console.error('Error getting from secure storage:', error);
      return null;
    }
  }
  
  /**
   * Eliminar valor seguro
   */
  public async remove(key: string): Promise<void> {
    if (!this.platform.is('capacitor')) {
      localStorage.removeItem(key);
      return;
    }
    
    try {
      await SecureStorage.remove({ key });
    } catch (error) {
      console.error('Error removing from secure storage:', error);
    }
  }
  
  /**
   * Limpiar todo el almacenamiento seguro
   */
  public async clear(): Promise<void> {
    if (!this.platform.is('capacitor')) {
      localStorage.clear();
      return;
    }
    
    try {
      await SecureStorage.clear();
    } catch (error) {
      console.error('Error clearing secure storage:', error);
    }
  }
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 5.6.4 Biometric Login Component
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/app/pages/login/login.page.ts (actualizar)

import { Component, OnInit, inject, signal } from '@angular/core';
import { Router } from '@angular/router';
import { FormBuilder, FormGroup, Validators, ReactiveFormsModule } from '@angular/forms';
import { CommonModule } from '@angular/common';
import { IonicModule } from '@ionic/angular';

import { AuthService } from '@core/services/auth.service';
import { BiometricService } from '@core/services/biometric.service';
import { SecureStorageService } from '@core/services/secure-storage.service';
import { ToastService } from '@core/services/toast.service';

@Component({
  selector: 'app-login',
  standalone: true,
  imports: [CommonModule, ReactiveFormsModule, IonicModule],
  template: `
    <ion-content class="ion-padding">
      <div class="login-container">
        <div class="logo-section">
          <ion-icon name="medical-outline" class="logo-icon"></ion-icon>
          <h1>GestPharma</h1>
          <p>Sistema de GestiÃ³n FarmacÃ©utica</p>
        </div>
        
        <form [formGroup]="loginForm" (ngSubmit)="onSubmit()">
          <ion-item>
            <ion-input
              formControlName="email"
              type="email"
              label="Correo ElectrÃ³nico"
              labelPlacement="floating"
              [clearInput]="true"
            ></ion-input>
          </ion-item>
          
          <ion-item>
            <ion-input
              formControlName="password"
              [type]="showPassword() ? 'text' : 'password'"
              label="ContraseÃ±a"
              labelPlacement="floating"
              [clearInput]="true"
            ></ion-input>
            <ion-button 
              slot="end" 
              fill="clear"
              (click)="togglePassword()"
            >
              <ion-icon 
                [name]="showPassword() ? 'eye-off-outline' : 'eye-outline'"
              ></ion-icon>
            </ion-button>
          </ion-item>
          
          <ion-button
            expand="block"
            type="submit"
            [disabled]="loginForm.invalid || loading()"
          >
            <ion-spinner *ngIf="loading()" name="crescent"></ion-spinner>
            <span *ngIf="!loading()">Iniciar SesiÃ³n</span>
          </ion-button>
        </form>
        
        <!-- Biometric Login -->
        <div *ngIf="biometricAvailable()" class="biometric-section">
          <ion-button
            expand="block"
            fill="outline"
            (click)="loginWithBiometric()"
            [disabled]="loading()"
          >
            <ion-icon 
              [name]="biometricIcon()"
              slot="start"
            ></ion-icon>
            Iniciar con {{ biometricName() }}
          </ion-button>
        </div>
        
        <div class="forgot-password">
          <a routerLink="/forgot-password">Â¿Olvidaste tu contraseÃ±a?</a>
        </div>
      </div>
    </ion-content>
  `,
  styles: [`
    .login-container {
      max-width: 400px;
      margin: 0 auto;
      padding: 40px 20px;
    }
    
    .logo-section {
      text-align: center;
      margin-bottom: 40px;
      
      .logo-icon {
        font-size: 80px;
        color: var(--ion-color-primary);
        margin-bottom: 16px;
      }
      
      h1 {
        font-size: 32px;
        font-weight: bold;
        margin: 0 0 8px 0;
      }
      
      p {
        color: var(--ion-color-medium);
        margin: 0;
      }
    }
    
    form {
      ion-item {
        --padding-start: 0;
        --inner-padding-end: 0;
        margin-bottom: 16px;
      }
      
      ion-button[type="submit"] {
        margin-top: 24px;
      }
    }
    
    .biometric-section {
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid var(--ion-color-light);
    }
    
    .forgot-password {
      text-align: center;
      margin-top: 24px;
      
      a {
        color: var(--ion-color-primary);
        text-decoration: none;
        
        &:hover {
          text-decoration: underline;
        }
      }
    }
  `]
})
export class LoginPage implements OnInit {
  private readonly fb = inject(FormBuilder);
  private readonly router = inject(Router);
  private readonly authService = inject(AuthService);
  private readonly biometricService = inject(BiometricService);
  private readonly secureStorage = inject(SecureStorageService);
  private readonly toastService = inject(ToastService);
  
  public loginForm!: FormGroup;
  public loading = signal(false);
  public showPassword = signal(false);
  public biometricAvailable = signal(false);
  public biometricName = signal('BiometrÃ­a');
  public biometricIcon = signal('finger-print-outline');
  
  public async ngOnInit(): Promise<void> {
    this.initForm();
    await this.checkBiometricAvailability();
  }
  
  private initForm(): void {
    this.loginForm = this.fb.group({
      email: ['', [Validators.required, Validators.email]],
      password: ['', [Validators.required, Validators.minLength(6)]]
    });
  }
  
  private async checkBiometricAvailability(): Promise<void> {
    const available = await this.biometricService.isAvailable();
    const enabled = await this.biometricService.isEnabled();
    
    this.biometricAvailable.set(available && enabled);
    
    if (available) {
      const name = await this.biometricService.getBiometryName();
      this.biometricName.set(name);
      
      // Establecer icono segÃºn el tipo
      if (name.includes('Face')) {
        this.biometricIcon.set('scan-outline');
      } else {
        this.biometricIcon.set('finger-print-outline');
      }
    }
  }
  
  public togglePassword(): void {
    this.showPassword.update(v => !v);
  }
  
  public async onSubmit(): Promise<void> {
    if (this.loginForm.invalid) {
      return;
    }
    
    this.loading.set(true);
    
    try {
      const { email, password } = this.loginForm.value;
      const result = await this.authService.login(email, password);
      
      if (result) {
        // Preguntar si quiere habilitar biometrÃ­a
        if (await this.biometricService.isAvailable() && 
            !await this.biometricService.isEnabled()) {
          await this.promptEnableBiometric(email, password);
        }
        
        this.router.navigate(['/tabs/home']);
      } else {
        this.toastService.error('Credenciales invÃ¡lidas');
      }
    } catch (error) {
      this.toastService.error('Error al iniciar sesiÃ³n');
    } finally {
      this.loading.set(false);
    }
  }
  
  public async loginWithBiometric(): Promise<void> {
    this.loading.set(true);
    
    try {
      const authenticated = await this.biometricService.authenticate(
        'Autenticar para iniciar sesiÃ³n'
      );
      
      if (authenticated) {
        // Obtener credenciales guardadas
        const email = await this.secureStorage.get('biometric_email');
        const password = await this.secureStorage.get('biometric_password');
        
        if (email && password) {
          const result = await this.authService.login(email, password);
          
          if (result) {
            this.router.navigate(['/tabs/home']);
          } else {
            this.toastService.error('Error al autenticar');
          }
        } else {
          this.toastService.error('No hay credenciales guardadas');
          await this.biometricService.disable();
          this.biometricAvailable.set(false);
        }
      }
    } catch (error) {
      this.toastService.error('AutenticaciÃ³n biomÃ©trica cancelada');
    } finally {
      this.loading.set(false);
    }
  }
  
  private async promptEnableBiometric(email: string, password: string): Promise<void> {
    const name = await this.biometricService.getBiometryName();
    
    const alert = await this.alertController.create({
      header: 'Habilitar ' + name,
      message: `Â¿Deseas habilitar ${name} para iniciar sesiÃ³n rÃ¡pidamente?`,
      buttons: [
        {
          text: 'Ahora no',
          role: 'cancel'
        },
        {
          text: 'Habilitar',
          handler: async () => {
            try {
              // Guardar credenciales de forma segura
              await this.secureStorage.set('biometric_email', email);
              await this.secureStorage.set('biometric_password', password);
              await this.biometricService.enable();
              
              this.toastService.success(`${name} habilitado correctamente`);
            } catch (error) {
              this.toastService.error('Error al habilitar biometrÃ­a');
            }
          }
        }
      ]
    });
    
    await alert.present();
  }
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 5.6.5 Settings para BiometrÃ­a
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/app/pages/settings/settings.page.ts (agregar secciÃ³n)

```typescript
public biometricSection = {
  available: signal(false),
  enabled: signal(false),
  name: signal('BiometrÃ­a')
};

private async initBiometricSettings(): Promise<void> {
  const available = await this.biometricService.isAvailable();
  const enabled = await this.biometricService.isEnabled();
  const name = await this.biometricService.getBiometryName();
  
  this.biometricSection.available.set(available);
  this.biometricSection.enabled.set(enabled);
  this.biometricSection.name.set(name);
}

public async toggleBiometric(event: any): Promise<void> {
  const enabled = event.detail.checked;
  
  if (enabled) {
    // Autenticar antes de habilitar
    const authenticated = await this.biometricService.authenticate(
      'Autenticar para habilitar biometrÃ­a'
    );
    
    if (authenticated) {
      // Solicitar credenciales para guardar
      await this.promptSaveCredentials();
    } else {
      event.target.checked = false;
    }
  } else {
    await this.biometricService.disable();
    await this.secureStorage.remove('biometric_email');
    await this.secureStorage.remove('biometric_password');
    this.biometricSection.enabled.set(false);
    this.toastService.success('BiometrÃ­a deshabilitada');
  }
}
```

TEMPLATE:

```html
<ion-list *ngIf="biometricSection.available()">
  <ion-list-header>
    <ion-label>Seguridad</ion-label>
  </ion-list-header>
  
  <ion-item>
    <ion-icon name="finger-print-outline" slot="start"></ion-icon>
    <ion-label>
      <h3>{{ biometricSection.name() }}</h3>
      <p>Inicio de sesiÃ³n rÃ¡pido y seguro</p>
    </ion-label>
    <ion-toggle
      [checked]="biometricSection.enabled()"
      (ionChange)="toggleBiometric($event)"
    ></ion-toggle>
  </ion-item>
</ion-list>
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  5.7 FUNCIONALIDADES ADICIONALES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

OBJETIVO: CaracterÃ­sticas que mejoran la experiencia del usuario.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 5.7.1 InternacionalizaciÃ³n (i18n)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

INSTALACIÃ“N:

```bash
npm install @ngx-translate/core @ngx-translate/http-loader
```

CONFIGURACIÃ“N: src/app/app.config.ts

```typescript
import { HttpClient } from '@angular/common/http';
import { TranslateLoader, TranslateModule } from '@ngx-translate/core';
import { TranslateHttpLoader } from '@ngx-translate/http-loader';

export function createTranslateLoader(http: HttpClient) {
  return new TranslateHttpLoader(http, './assets/i18n/', '.json');
}

export const appConfig: ApplicationConfig = {
  providers: [
    // ... otros providers
    importProvidersFrom(
      TranslateModule.forRoot({
        loader: {
          provide: TranslateLoader,
          useFactory: createTranslateLoader,
          deps: [HttpClient]
        },
        defaultLanguage: 'es'
      })
    )
  ]
};
```

ARCHIVOS DE TRADUCCIÃ“N:

src/assets/i18n/es.json:

```json
{
  "common": {
    "save": "Guardar",
    "cancel": "Cancelar",
    "delete": "Eliminar",
    "edit": "Editar",
    "search": "Buscar",
    "loading": "Cargando...",
    "error": "Error",
    "success": "Ã‰xito"
  },
  "products": {
    "title": "Productos",
    "add": "Agregar Producto",
    "name": "Nombre",
    "price": "Precio",
    "stock": "Stock",
    "category": "CategorÃ­a",
    "barcode": "CÃ³digo de Barras",
    "description": "DescripciÃ³n",
    "deleted": "Producto eliminado correctamente",
    "saved": "Producto guardado correctamente"
  },
  "sales": {
    "title": "Ventas",
    "new": "Nueva Venta",
    "total": "Total",
    "date": "Fecha",
    "items": "ArtÃ­culos",
    "completed": "Venta completada"
  }
}
```

src/assets/i18n/en.json:

```json
{
  "common": {
    "save": "Save",
    "cancel": "Cancel",
    "delete": "Delete",
    "edit": "Edit",
    "search": "Search",
    "loading": "Loading...",
    "error": "Error",
    "success": "Success"
  },
  "products": {
    "title": "Products",
    "add": "Add Product",
    "name": "Name",
    "price": "Price",
    "stock": "Stock",
    "category": "Category",
    "barcode": "Barcode",
    "description": "Description",
    "deleted": "Product deleted successfully",
    "saved": "Product saved successfully"
  },
  "sales": {
    "title": "Sales",
    "new": "New Sale",
    "total": "Total",
    "date": "Date",
    "items": "Items",
    "completed": "Sale completed"
  }
}
```

LANGUAGE SERVICE:

```typescript
import { Injectable, inject } from '@angular/core';
import { TranslateService } from '@ngx-translate/core';
import { Preferences } from '@capacitor/preferences';

@Injectable({
  providedIn: 'root'
})
export class LanguageService {
  private readonly translate = inject(TranslateService);
  private readonly LANGUAGE_KEY = 'app_language';
  
  public readonly availableLanguages = [
    { code: 'es', name: 'EspaÃ±ol' },
    { code: 'en', name: 'English' }
  ];
  
  constructor() {
    this.initLanguage();
  }
  
  private async initLanguage(): Promise<void> {
    const { value } = await Preferences.get({ key: this.LANGUAGE_KEY });
    const language = value || this.getBrowserLanguage();
    
    this.translate.use(language);
  }
  
  public async setLanguage(language: string): Promise<void> {
    this.translate.use(language);
    await Preferences.set({ 
      key: this.LANGUAGE_KEY, 
      value: language 
    });
  }
  
  public getCurrentLanguage(): string {
    return this.translate.currentLang || 'es';
  }
  
  private getBrowserLanguage(): string {
    const lang = this.translate.getBrowserLang();
    return lang && this.availableLanguages.some(l => l.code === lang) 
      ? lang 
      : 'es';
  }
}
```

USO EN COMPONENTES:

```typescript
import { TranslateModule } from '@ngx-translate/core';

@Component({
  imports: [TranslateModule],
  template: `
    <ion-title>{{ 'products.title' | translate }}</ion-title>
    
    <ion-button>
      {{ 'common.save' | translate }}
    </ion-button>
  `
})
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 5.7.2 Modo Oscuro
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/app/core/services/theme.service.ts

import { Injectable, inject } from '@angular/core';
import { Preferences } from '@capacitor/preferences';

export type Theme = 'light' | 'dark' | 'auto';

@Injectable({
  providedIn: 'root'
})
export class ThemeService {
  private readonly THEME_KEY = 'app_theme';
  private prefersDark = window.matchMedia('(prefers-color-scheme: dark)');
  
  constructor() {
    this.initialize();
  }
  
  /**
   * Inicializar tema
   */
  private async initialize(): Promise<void> {
    const { value } = await Preferences.get({ key: this.THEME_KEY });
    const theme = (value as Theme) || 'auto';
    
    this.applyTheme(theme);
    
    // Escuchar cambios en preferencias del sistema
    this.prefersDark.addEventListener('change', (e) => {
      this.getTheme().then(currentTheme => {
        if (currentTheme === 'auto') {
          this.applyTheme('auto');
        }
      });
    });
  }
  
  /**
   * Establecer tema
   */
  public async setTheme(theme: Theme): Promise<void> {
    await Preferences.set({ 
      key: this.THEME_KEY, 
      value: theme 
    });
    
    this.applyTheme(theme);
  }
  
  /**
   * Obtener tema actual
   */
  public async getTheme(): Promise<Theme> {
    const { value } = await Preferences.get({ key: this.THEME_KEY });
    return (value as Theme) || 'auto';
  }
  
  /**
   * Aplicar tema
   */
  private applyTheme(theme: Theme): void {
    const isDark = theme === 'dark' || 
                   (theme === 'auto' && this.prefersDark.matches);
    
    document.body.classList.toggle('dark', isDark);
  }
  
  /**
   * Alternar entre claro y oscuro
   */
  public async toggleTheme(): Promise<void> {
    const current = await this.getTheme();
    const newTheme: Theme = current === 'dark' ? 'light' : 'dark';
    await this.setTheme(newTheme);
  }
}

AGREGAR A SETTINGS:

```typescript
public async onThemeChange(event: any): Promise<void> {
  const theme = event.detail.value as Theme;
  await this.themeService.setTheme(theme);
}
```

```html
<ion-item>
  <ion-icon name="moon-outline" slot="start"></ion-icon>
  <ion-label>Tema</ion-label>
  <ion-select
    [value]="currentTheme()"
    (ionChange)="onThemeChange($event)"
    interface="action-sheet"
  >
    <ion-select-option value="light">Claro</ion-select-option>
    <ion-select-option value="dark">Oscuro</ion-select-option>
    <ion-select-option value="auto">AutomÃ¡tico</ion-select-option>
  </ion-select>
</ion-item>
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 5.7.3 ImpresiÃ³n de Tickets
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

INSTALACIÃ“N (para impresoras tÃ©rmicas):

```bash
npm install @capacitor-community/bluetooth-le
npx cap sync
```

UBICACIÃ“N: src/app/core/services/printer.service.ts

import { Injectable, inject } from '@angular/core';
import { Share } from '@capacitor/share';

export interface Receipt {
  saleId: number;
  date: Date;
  items: ReceiptItem[];
  subtotal: number;
  tax: number;
  total: number;
  paymentMethod: string;
  cashReceived?: number;
  change?: number;
}

export interface ReceiptItem {
  name: string;
  quantity: number;
  price: number;
  total: number;
}

@Injectable({
  providedIn: 'root'
})
export class PrinterService {
  
  /**
   * Generar HTML del ticket
   */
  public generateReceiptHTML(receipt: Receipt): string {
    return `
      <!DOCTYPE html>
      <html>
      <head>
        <meta charset="UTF-8">
        <title>Ticket #${receipt.saleId}</title>
        <style>
          @media print {
            @page { 
              margin: 0; 
              size: 80mm auto; 
            }
            body { 
              margin: 0; 
              padding: 10mm; 
            }
          }
          
          body {
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.4;
            max-width: 80mm;
            margin: 0 auto;
            padding: 10mm;
          }
          
          .header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px dashed #000;
          }
          
          .header h1 {
            margin: 0 0 5px 0;
            font-size: 18px;
          }
          
          .header p {
            margin: 2px 0;
            font-size: 10px;
          }
          
          .info {
            margin-bottom: 15px;
            font-size: 10px;
          }
          
          .items {
            margin-bottom: 15px;
          }
          
          .item {
            margin-bottom: 8px;
          }
          
          .item-name {
            font-weight: bold;
          }
          
          .item-details {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
          }
          
          .totals {
            border-top: 2px dashed #000;
            padding-top: 10px;
            margin-top: 15px;
          }
          
          .total-row {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
          }
          
          .total-row.grand {
            font-weight: bold;
            font-size: 14px;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #000;
          }
          
          .footer {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 2px dashed #000;
            text-align: center;
            font-size: 10px;
          }
        </style>
      </head>
      <body>
        <div class="header">
          <h1>GESTPHARMA</h1>
          <p>RFC: XXXX-XXXX-XXX</p>
          <p>Calle Principal #123</p>
          <p>Tel: (555) 123-4567</p>
        </div>
        
        <div class="info">
          <div>Ticket: #${receipt.saleId}</div>
          <div>Fecha: ${this.formatDate(receipt.date)}</div>
          <div>Hora: ${this.formatTime(receipt.date)}</div>
        </div>
        
        <div class="items">
          ${receipt.items.map(item => `
            <div class="item">
              <div class="item-name">${item.name}</div>
              <div class="item-details">
                <span>${item.quantity} x $${item.price.toFixed(2)}</span>
                <span>$${item.total.toFixed(2)}</span>
              </div>
            </div>
          `).join('')}
        </div>
        
        <div class="totals">
          <div class="total-row">
            <span>Subtotal:</span>
            <span>$${receipt.subtotal.toFixed(2)}</span>
          </div>
          <div class="total-row">
            <span>IVA (16%):</span>
            <span>$${receipt.tax.toFixed(2)}</span>
          </div>
          <div class="total-row grand">
            <span>TOTAL:</span>
            <span>$${receipt.total.toFixed(2)}</span>
          </div>
          
          ${receipt.cashReceived ? `
            <div class="total-row" style="margin-top: 15px;">
              <span>Efectivo:</span>
              <span>$${receipt.cashReceived.toFixed(2)}</span>
            </div>
            <div class="total-row">
              <span>Cambio:</span>
              <span>$${receipt.change?.toFixed(2)}</span>
            </div>
          ` : ''}
          
          <div class="total-row" style="margin-top: 10px; font-size: 11px;">
            <span>MÃ©todo de pago:</span>
            <span>${receipt.paymentMethod}</span>
          </div>
        </div>
        
        <div class="footer">
          <p>Â¡Gracias por su compra!</p>
          <p>www.gestpharma.com</p>
          <p>-------------------------------</p>
        </div>
      </body>
      </html>
    `;
  }
  
  /**
   * Imprimir ticket (abre diÃ¡logo de impresiÃ³n)
   */
  public async printReceipt(receipt: Receipt): Promise<void> {
    const html = this.generateReceiptHTML(receipt);
    
    // Crear ventana temporal para imprimir
    const printWindow = window.open('', '_blank', 'width=300,height=600');
    
    if (printWindow) {
      printWindow.document.write(html);
      printWindow.document.close();
      
      // Esperar a que cargue y luego imprimir
      printWindow.onload = () => {
        printWindow.print();
        printWindow.close();
      };
    }
  }
  
  /**
   * Compartir ticket
   */
  public async shareReceipt(receipt: Receipt): Promise<void> {
    const html = this.generateReceiptHTML(receipt);
    
    // Crear blob del HTML
    const blob = new Blob([html], { type: 'text/html' });
    const file = new File([blob], `ticket-${receipt.saleId}.html`, { type: 'text/html' });
    
    // Usar Web Share API si estÃ¡ disponible
    if (navigator.share && navigator.canShare({ files: [file] })) {
      await navigator.share({
        title: `Ticket #${receipt.saleId}`,
        text: `Ticket de venta #${receipt.saleId}`,
        files: [file]
      });
    } else {
      // Fallback: usar Capacitor Share
      await Share.share({
        title: `Ticket #${receipt.saleId}`,
        text: html,
        dialogTitle: 'Compartir Ticket'
      });
    }
  }
  
  private formatDate(date: Date): string {
    return new Date(date).toLocaleDateString('es-MX', {
      year: 'numeric',
      month: '2-digit',
      day: '2-digit'
    });
  }
  
  private formatTime(date: Date): string {
    return new Date(date).toLocaleTimeString('es-MX', {
      hour: '2-digit',
      minute: '2-digit'
    });
  }
}

USO EN COMPONENTE DE VENTA:

```typescript
public async completeSale(): Promise<void> {
  // ... procesar venta
  
  const receipt: Receipt = {
    saleId: sale.id,
    date: new Date(),
    items: this.cartItems.map(item => ({
      name: item.product.nombre,
      quantity: item.cantidad,
      price: item.product.precio,
      total: item.cantidad * item.product.precio
    })),
    subtotal: this.subtotal,
    tax: this.tax,
    total: this.total,
    paymentMethod: this.selectedPaymentMethod,
    cashReceived: this.cashReceived,
    change: this.change
  };
  
  // Mostrar opciones
  const actionSheet = await this.actionSheetController.create({
    header: 'Ticket de Venta',
    buttons: [
      {
        text: 'Imprimir',
        icon: 'print-outline',
        handler: () => {
          this.printerService.printReceipt(receipt);
        }
      },
      {
        text: 'Compartir',
        icon: 'share-outline',
        handler: () => {
          this.printerService.shareReceipt(receipt);
        }
      },
      {
        text: 'Cancelar',
        icon: 'close',
        role: 'cancel'
      }
    ]
  });
  
  await actionSheet.present();
}
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 5.7.4 GestiÃ³n de Clientes
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

MODELO: src/app/core/models/customer.model.ts

```typescript
export interface Customer {
  id: number;
  nombre: string;
  apellido: string;
  telefono: string;
  email?: string;
  direccion?: string;
  fechaRegistro: Date;
  puntos: number;
  totalCompras: number;
  ultimaCompra?: Date;
  activo: boolean;
}
```

UBICACIÃ“N: src/app/core/services/customer.service.ts

```typescript
import { Injectable, inject } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { Observable } from 'rxjs';
import { environment } from '@environments/environment';

@Injectable({
  providedIn: 'root'
})
export class CustomerService {
  private readonly http = inject(HttpClient);
  private readonly baseUrl = `${environment.apiUrl}/customers`;
  
  public getAll(): Observable<Customer[]> {
    return this.http.get<Customer[]>(this.baseUrl);
  }
  
  public getById(id: number): Observable<Customer> {
    return this.http.get<Customer>(`${this.baseUrl}/${id}`);
  }
  
  public create(customer: Partial<Customer>): Observable<Customer> {
    return this.http.post<Customer>(this.baseUrl, customer);
  }
  
  public update(id: number, customer: Partial<Customer>): Observable<Customer> {
    return this.http.put<Customer>(`${this.baseUrl}/${id}`, customer);
  }
  
  public delete(id: number): Observable<void> {
    return this.http.delete<void>(`${this.baseUrl}/${id}`);
  }
  
  public searchByPhone(phone: string): Observable<Customer | null> {
    return this.http.get<Customer | null>(`${this.baseUrl}/search`, {
      params: { phone }
    });
  }
  
  public getPurchaseHistory(customerId: number): Observable<Sale[]> {
    return this.http.get<Sale[]>(`${this.baseUrl}/${customerId}/purchases`);
  }
  
  public addPoints(customerId: number, points: number): Observable<Customer> {
    return this.http.post<Customer>(`${this.baseUrl}/${customerId}/points`, { points });
  }
}
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 5.7.5 Programa de Lealtad
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/app/core/services/loyalty.service.ts

```typescript
import { Injectable } from '@angular/core';

export interface LoyaltyTier {
  name: string;
  minPoints: number;
  discount: number;
  color: string;
}

export interface LoyaltyReward {
  id: number;
  name: string;
  description: string;
  pointsCost: number;
  icon: string;
}

@Injectable({
  providedIn: 'root'
})
export class LoyaltyService {
  
  private readonly tiers: LoyaltyTier[] = [
    { name: 'Bronce', minPoints: 0, discount: 0, color: 'warning' },
    { name: 'Plata', minPoints: 500, discount: 5, color: 'medium' },
    { name: 'Oro', minPoints: 1500, discount: 10, color: 'warning' },
    { name: 'Platino', minPoints: 3000, discount: 15, color: 'dark' }
  ];
  
  /**
   * Calcular puntos por compra (1 punto por cada $10)
   */
  public calculatePoints(amount: number): number {
    return Math.floor(amount / 10);
  }
  
  /**
   * Obtener tier del cliente
   */
  public getTier(points: number): LoyaltyTier {
    return [...this.tiers]
      .reverse()
      .find(tier => points >= tier.minPoints) || this.tiers[0];
  }
  
  /**
   * Obtener siguiente tier
   */
  public getNextTier(points: number): LoyaltyTier | null {
    const currentIndex = this.tiers.findIndex(tier => points >= tier.minPoints);
    return currentIndex < this.tiers.length - 1 
      ? this.tiers[currentIndex + 1] 
      : null;
  }
  
  /**
   * Calcular progreso al siguiente nivel
   */
  public getProgressToNextTier(points: number): number {
    const nextTier = this.getNextTier(points);
    if (!nextTier) return 100;
    
    const currentTier = this.getTier(points);
    const range = nextTier.minPoints - currentTier.minPoints;
    const progress = points - currentTier.minPoints;
    
    return Math.min((progress / range) * 100, 100);
  }
  
  /**
   * Calcular descuento
   */
  public calculateDiscount(amount: number, points: number): number {
    const tier = this.getTier(points);
    return amount * (tier.discount / 100);
  }
}
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 5.7.6 CachÃ© HTTP con TTL
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/app/core/services/cache.service.ts

```typescript
import { Injectable } from '@angular/core';

interface CacheEntry<T> {
  data: T;
  timestamp: number;
  ttl: number;
}

@Injectable({
  providedIn: 'root'
})
export class CacheService {
  private cache = new Map<string, CacheEntry<any>>();
  
  /**
   * Guardar en cache con TTL (en milisegundos)
   */
  public set<T>(key: string, data: T, ttl: number = 300000): void {
    this.cache.set(key, {
      data,
      timestamp: Date.now(),
      ttl
    });
  }
  
  /**
   * Obtener del cache
   */
  public get<T>(key: string): T | null {
    const entry = this.cache.get(key);
    
    if (!entry) {
      return null;
    }
    
    // Verificar si expirÃ³
    if (Date.now() - entry.timestamp > entry.ttl) {
      this.cache.delete(key);
      return null;
    }
    
    return entry.data as T;
  }
  
  /**
   * Eliminar del cache
   */
  public delete(key: string): void {
    this.cache.delete(key);
  }
  
  /**
   * Limpiar cache completo
   */
  public clear(): void {
    this.cache.clear();
  }
  
  /**
   * Limpiar cache expirado
   */
  public clearExpired(): void {
    const now = Date.now();
    
    for (const [key, entry] of this.cache.entries()) {
      if (now - entry.timestamp > entry.ttl) {
        this.cache.delete(key);
      }
    }
  }
}
```

INTERCEPTOR PARA CACHE:

```typescript
import { Injectable, inject } from '@angular/core';
import { HttpInterceptor, HttpRequest, HttpHandler, HttpEvent, HttpResponse } from '@angular/common/http';
import { Observable, of } from 'rxjs';
import { tap } from 'rxjs/operators';
import { CacheService } from '@core/services/cache.service';

@Injectable()
export class CacheInterceptor implements HttpInterceptor {
  private readonly cache = inject(CacheService);
  
  // URLs que deben cachearse
  private readonly cacheable = ['/products', '/categories'];
  
  public intercept(req: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {
    // Solo cachear GET requests
    if (req.method !== 'GET') {
      return next.handle(req);
    }
    
    // Verificar si la URL debe cachearse
    const shouldCache = this.cacheable.some(url => req.url.includes(url));
    
    if (!shouldCache) {
      return next.handle(req);
    }
    
    // Intentar obtener del cache
    const cached = this.cache.get<HttpResponse<any>>(req.url);
    
    if (cached) {
      return of(cached);
    }
    
    // Si no estÃ¡ en cache, hacer request y cachear
    return next.handle(req).pipe(
      tap(event => {
        if (event instanceof HttpResponse) {
          this.cache.set(req.url, event, 300000); // 5 minutos
        }
      })
    );
  }
}
```


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                         FASE 6                                            â”ƒ
â”ƒ              REQUISITOS NO FUNCIONALES                                    â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

OBJETIVO: Seguridad, rendimiento, manejo de errores, logging y caracterÃ­sticas PWA.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  6.1 SEGURIDAD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 6.1.1 Content Security Policy (CSP)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/index.html

```html
<head>
  <meta charset="utf-8" />
  <title>GestPharma</title>
  
  <base href="/" />
  
  <meta name="viewport" content="viewport-fit=cover, width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="format-detection" content="telephone=no" />
  <meta name="msapplication-tap-highlight" content="no" />
  
  <!-- Content Security Policy -->
  <meta 
    http-equiv="Content-Security-Policy" 
    content="
      default-src 'self';
      script-src 'self' 'unsafe-inline' 'unsafe-eval';
      style-src 'self' 'unsafe-inline';
      img-src 'self' data: https:;
      font-src 'self' data:;
      connect-src 'self' https://api.gestpharma.com;
      media-src 'self';
      frame-src 'none';
    "
  />
  
  <!-- Otros meta tags -->
</head>
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 6.1.2 ProtecciÃ³n XSS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/app/core/services/sanitizer.service.ts

```typescript
import { Injectable, inject } from '@angular/core';
import { DomSanitizer, SafeHtml, SafeUrl } from '@angular/platform-browser';

@Injectable({
  providedIn: 'root'
})
export class SanitizerService {
  private readonly sanitizer = inject(DomSanitizer);
  
  /**
   * Sanitizar HTML
   */
  public sanitizeHtml(html: string): SafeHtml {
    return this.sanitizer.sanitize(1, html) || '';
  }
  
  /**
   * Sanitizar URL
   */
  public sanitizeUrl(url: string): SafeUrl {
    return this.sanitizer.sanitize(4, url) || '';
  }
  
  /**
   * Escapar caracteres especiales HTML
   */
  public escapeHtml(text: string): string {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  }
  
  /**
   * Remover scripts de texto
   */
  public removeScripts(text: string): string {
    return text.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '');
  }
  
  /**
   * Validar entrada numÃ©rica
   */
  public sanitizeNumber(value: any): number | null {
    const num = Number(value);
    return isNaN(num) ? null : num;
  }
}
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 6.1.3 JWT Token Management
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/app/core/services/token.service.ts

```typescript
import { Injectable, inject } from '@angular/core';
import { SecureStorageService } from './secure-storage.service';

export interface TokenPayload {
  sub: string;
  email: string;
  roles: string[];
  exp: number;
  iat: number;
}

@Injectable({
  providedIn: 'root'
})
export class TokenService {
  private readonly storage = inject(SecureStorageService);
  private readonly TOKEN_KEY = 'auth_token';
  private readonly REFRESH_TOKEN_KEY = 'refresh_token';
  
  /**
   * Guardar token
   */
  public async setToken(token: string): Promise<void> {
    await this.storage.set(this.TOKEN_KEY, token);
  }
  
  /**
   * Obtener token
   */
  public async getToken(): Promise<string | null> {
    return await this.storage.get(this.TOKEN_KEY);
  }
  
  /**
   * Guardar refresh token
   */
  public async setRefreshToken(token: string): Promise<void> {
    await this.storage.set(this.REFRESH_TOKEN_KEY, token);
  }
  
  /**
   * Obtener refresh token
   */
  public async getRefreshToken(): Promise<string | null> {
    return await this.storage.get(this.REFRESH_TOKEN_KEY);
  }
  
  /**
   * Eliminar tokens
   */
  public async clearTokens(): Promise<void> {
    await this.storage.remove(this.TOKEN_KEY);
    await this.storage.remove(this.REFRESH_TOKEN_KEY);
  }
  
  /**
   * Decodificar token JWT
   */
  public decodeToken(token: string): TokenPayload | null {
    try {
      const parts = token.split('.');
      if (parts.length !== 3) {
        return null;
      }
      
      const payload = parts[1];
      const decoded = atob(payload.replace(/-/g, '+').replace(/_/g, '/'));
      return JSON.parse(decoded);
    } catch (error) {
      console.error('Error decoding token:', error);
      return null;
    }
  }
  
  /**
   * Verificar si el token expirÃ³
   */
  public isTokenExpired(token: string): boolean {
    const payload = this.decodeToken(token);
    
    if (!payload || !payload.exp) {
      return true;
    }
    
    const expirationDate = new Date(payload.exp * 1000);
    return expirationDate < new Date();
  }
  
  /**
   * Verificar si el token expirarÃ¡ pronto (< 5 minutos)
   */
  public isTokenExpiringSoon(token: string): boolean {
    const payload = this.decodeToken(token);
    
    if (!payload || !payload.exp) {
      return true;
    }
    
    const expirationDate = new Date(payload.exp * 1000);
    const fiveMinutesFromNow = new Date(Date.now() + 5 * 60 * 1000);
    
    return expirationDate < fiveMinutesFromNow;
  }
}
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 6.1.4 Auth Interceptor con Refresh Token
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/app/core/interceptors/auth.interceptor.ts

```typescript
import { Injectable, inject } from '@angular/core';
import { 
  HttpInterceptor, 
  HttpRequest, 
  HttpHandler, 
  HttpEvent,
  HttpErrorResponse 
} from '@angular/common/http';
import { Observable, throwError, from, BehaviorSubject } from 'rxjs';
import { catchError, switchMap, filter, take } from 'rxjs/operators';

import { TokenService } from '@core/services/token.service';
import { AuthService } from '@core/services/auth.service';

@Injectable()
export class AuthInterceptor implements HttpInterceptor {
  private readonly tokenService = inject(TokenService);
  private readonly authService = inject(AuthService);
  
  private isRefreshing = false;
  private refreshTokenSubject = new BehaviorSubject<string | null>(null);
  
  public intercept(req: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {
    return from(this.tokenService.getToken()).pipe(
      switchMap(token => {
        // Agregar token si existe
        if (token) {
          req = this.addToken(req, token);
        }
        
        return next.handle(req).pipe(
          catchError((error: HttpErrorResponse) => {
            // Si es error 401, intentar refresh
            if (error.status === 401) {
              return this.handle401Error(req, next);
            }
            
            return throwError(() => error);
          })
        );
      })
    );
  }
  
  /**
   * Agregar token a la request
   */
  private addToken(req: HttpRequest<any>, token: string): HttpRequest<any> {
    return req.clone({
      setHeaders: {
        Authorization: `Bearer ${token}`
      }
    });
  }
  
  /**
   * Manejar error 401 - Refresh token
   */
  private handle401Error(
    req: HttpRequest<any>, 
    next: HttpHandler
  ): Observable<HttpEvent<any>> {
    if (!this.isRefreshing) {
      this.isRefreshing = true;
      this.refreshTokenSubject.next(null);
      
      return from(this.authService.refreshToken()).pipe(
        switchMap((newToken) => {
          this.isRefreshing = false;
          this.refreshTokenSubject.next(newToken);
          return next.handle(this.addToken(req, newToken));
        }),
        catchError((error) => {
          this.isRefreshing = false;
          this.authService.logout();
          return throwError(() => error);
        })
      );
    } else {
      // Esperar a que termine el refresh
      return this.refreshTokenSubject.pipe(
        filter(token => token !== null),
        take(1),
        switchMap(token => {
          return next.handle(this.addToken(req, token!));
        })
      );
    }
  }
}
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 6.1.5 EncriptaciÃ³n de Datos Sensibles
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

INSTALACIÃ“N:

```bash
npm install crypto-js
npm install --save-dev @types/crypto-js
```

UBICACIÃ“N: src/app/core/services/encryption.service.ts

```typescript
import { Injectable } from '@angular/core';
import * as CryptoJS from 'crypto-js';
import { environment } from '@environments/environment';

@Injectable({
  providedIn: 'root'
})
export class EncryptionService {
  private readonly secretKey = environment.encryptionKey;
  
  /**
   * Encriptar texto
   */
  public encrypt(text: string): string {
    try {
      return CryptoJS.AES.encrypt(text, this.secretKey).toString();
    } catch (error) {
      console.error('Error encrypting:', error);
      throw error;
    }
  }
  
  /**
   * Desencriptar texto
   */
  public decrypt(ciphertext: string): string {
    try {
      const bytes = CryptoJS.AES.decrypt(ciphertext, this.secretKey);
      return bytes.toString(CryptoJS.enc.Utf8);
    } catch (error) {
      console.error('Error decrypting:', error);
      throw error;
    }
  }
  
  /**
   * Hash de texto (para contraseÃ±as - solo validaciÃ³n)
   */
  public hash(text: string): string {
    return CryptoJS.SHA256(text).toString();
  }
  
  /**
   * Generar clave aleatoria
   */
  public generateKey(length: number = 32): string {
    return CryptoJS.lib.WordArray.random(length).toString();
  }
}
```

AGREGAR A ENVIRONMENT:

```typescript
export const environment = {
  production: false,
  apiUrl: 'http://localhost:8080/api',
  encryptionKey: 'your-secret-key-here-change-in-production'
};
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  6.2 MANEJO DE ERRORES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 6.2.1 Global Error Handler
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/app/core/handlers/global-error.handler.ts

```typescript
import { ErrorHandler, Injectable, inject, Injector } from '@angular/core';
import { HttpErrorResponse } from '@angular/common/http';
import { Router } from '@angular/router';

import { LoggerService } from '@core/services/logger.service';
import { ToastService } from '@core/services/toast.service';

@Injectable()
export class GlobalErrorHandler implements ErrorHandler {
  private readonly injector = inject(Injector);
  
  public handleError(error: Error | HttpErrorResponse): void {
    const logger = this.injector.get(LoggerService);
    const toastService = this.injector.get(ToastService);
    const router = this.injector.get(Router);
    
    if (error instanceof HttpErrorResponse) {
      // Error HTTP
      this.handleHttpError(error, logger, toastService, router);
    } else {
      // Error de JavaScript
      this.handleClientError(error, logger, toastService);
    }
  }
  
  /**
   * Manejar errores HTTP
   */
  private handleHttpError(
    error: HttpErrorResponse,
    logger: LoggerService,
    toastService: ToastService,
    router: Router
  ): void {
    let message = 'Error en la comunicaciÃ³n con el servidor';
    
    switch (error.status) {
      case 0:
        message = 'Sin conexiÃ³n al servidor';
        break;
      case 400:
        message = error.error?.message || 'Solicitud invÃ¡lida';
        break;
      case 401:
        message = 'SesiÃ³n expirada';
        router.navigate(['/login']);
        break;
      case 403:
        message = 'No tienes permisos para realizar esta acciÃ³n';
        break;
      case 404:
        message = 'Recurso no encontrado';
        break;
      case 409:
        message = error.error?.message || 'Conflicto en la operaciÃ³n';
        break;
      case 422:
        message = error.error?.message || 'Datos invÃ¡lidos';
        break;
      case 500:
        message = 'Error interno del servidor';
        break;
      case 503:
        message = 'Servicio no disponible temporalmente';
        break;
      default:
        message = `Error ${error.status}: ${error.message}`;
    }
    
    logger.error('HTTP Error', {
      status: error.status,
      message: error.message,
      url: error.url,
      error: error.error
    });
    
    toastService.error(message);
  }
  
  /**
   * Manejar errores del cliente
   */
  private handleClientError(
    error: Error,
    logger: LoggerService,
    toastService: ToastService
  ): void {
    logger.error('Client Error', {
      name: error.name,
      message: error.message,
      stack: error.stack
    });
    
    // Mostrar mensaje genÃ©rico al usuario
    toastService.error('Ha ocurrido un error inesperado');
    
    // En desarrollo, mostrar error completo
    if (!environment.production) {
      console.error('Error capturado por GlobalErrorHandler:', error);
    }
  }
}
```

REGISTRAR EN APP.CONFIG.TS:

```typescript
import { ErrorHandler } from '@angular/core';
import { GlobalErrorHandler } from '@core/handlers/global-error.handler';

export const appConfig: ApplicationConfig = {
  providers: [
    {
      provide: ErrorHandler,
      useClass: GlobalErrorHandler
    }
  ]
};
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 6.2.2 Error Interceptor
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/app/core/interceptors/error.interceptor.ts

```typescript
import { Injectable, inject } from '@angular/core';
import { 
  HttpInterceptor, 
  HttpRequest, 
  HttpHandler, 
  HttpEvent,
  HttpErrorResponse 
} from '@angular/common/http';
import { Observable, throwError, timer } from 'rxjs';
import { catchError, retry, retryWhen, mergeMap, finalize } from 'rxjs/operators';

import { LoadingService } from '@core/services/loading.service';
import { NetworkService } from '@core/services/network.service';

@Injectable()
export class ErrorInterceptor implements HttpInterceptor {
  private readonly loadingService = inject(LoadingService);
  private readonly networkService = inject(NetworkService);
  
  public intercept(req: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {
    return next.handle(req).pipe(
      // Retry con backoff exponencial para errores de red
      retryWhen(errors =>
        errors.pipe(
          mergeMap((error, index) => {
            // Solo reintentar errores de red (status 0 o 503)
            if (
              (error instanceof HttpErrorResponse) &&
              (error.status === 0 || error.status === 503) &&
              index < 3 &&
              this.networkService.isOnline()
            ) {
              // Backoff exponencial: 1s, 2s, 4s
              const retryDelay = Math.pow(2, index) * 1000;
              return timer(retryDelay);
            }
            
            return throwError(() => error);
          })
        )
      ),
      catchError((error: HttpErrorResponse) => {
        // Loggear error
        console.error('HTTP Error:', {
          status: error.status,
          message: error.message,
          url: error.url
        });
        
        return throwError(() => error);
      }),
      finalize(() => {
        // Asegurar que se oculte el loading
        this.loadingService.hide();
      })
    );
  }
}
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 6.2.3 Retry Strategy Service
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/app/core/services/retry-strategy.service.ts

```typescript
import { Injectable } from '@angular/core';
import { Observable, throwError, timer } from 'rxjs';
import { mergeMap, finalize } from 'rxjs/operators';
import { HttpErrorResponse } from '@angular/common/http';

export interface RetryConfig {
  maxRetries?: number;
  delay?: number;
  backoff?: boolean;
  shouldRetry?: (error: HttpErrorResponse) => boolean;
}

@Injectable({
  providedIn: 'root'
})
export class RetryStrategyService {
  
  /**
   * Estrategia de reintento con configuraciÃ³n personalizada
   */
  public retry(config: RetryConfig = {}) {
    const {
      maxRetries = 3,
      delay = 1000,
      backoff = true,
      shouldRetry = (error: HttpErrorResponse) => 
        error.status === 0 || error.status === 503
    } = config;
    
    return (errors: Observable<any>) => {
      return errors.pipe(
        mergeMap((error, index) => {
          const retryAttempt = index + 1;
          
          // Verificar si debemos reintentar
          if (
            retryAttempt > maxRetries ||
            !(error instanceof HttpErrorResponse) ||
            !shouldRetry(error)
          ) {
            return throwError(() => error);
          }
          
          // Calcular delay (con o sin backoff)
          const retryDelay = backoff 
            ? Math.pow(2, index) * delay 
            : delay;
          
          console.log(
            `Retry attempt ${retryAttempt} after ${retryDelay}ms`,
            error
          );
          
          return timer(retryDelay);
        }),
        finalize(() => console.log('Retry strategy completed'))
      );
    };
  }
}
```

USO:

```typescript
this.http.get('/api/products').pipe(
  retryWhen(this.retryStrategy.retry({
    maxRetries: 3,
    delay: 1000,
    backoff: true
  }))
).subscribe();
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  6.3 LOGGING Y MONITOREO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 6.3.1 Logger Service
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/app/core/services/logger.service.ts

```typescript
import { Injectable } from '@angular/core';
import { environment } from '@environments/environment';

export enum LogLevel {
  DEBUG = 0,
  INFO = 1,
  WARN = 2,
  ERROR = 3
}

export interface LogEntry {
  level: LogLevel;
  timestamp: Date;
  message: string;
  data?: any;
  source?: string;
}

@Injectable({
  providedIn: 'root'
})
export class LoggerService {
  private logs: LogEntry[] = [];
  private readonly maxLogs = 1000;
  private readonly minLevel = environment.production ? LogLevel.WARN : LogLevel.DEBUG;
  
  /**
   * Debug log
   */
  public debug(message: string, data?: any, source?: string): void {
    this.log(LogLevel.DEBUG, message, data, source);
  }
  
  /**
   * Info log
   */
  public info(message: string, data?: any, source?: string): void {
    this.log(LogLevel.INFO, message, data, source);
  }
  
  /**
   * Warning log
   */
  public warn(message: string, data?: any, source?: string): void {
    this.log(LogLevel.WARN, message, data, source);
  }
  
  /**
   * Error log
   */
  public error(message: string, data?: any, source?: string): void {
    this.log(LogLevel.ERROR, message, data, source);
  }
  
  /**
   * Log genÃ©rico
   */
  private log(level: LogLevel, message: string, data?: any, source?: string): void {
    // Verificar nivel mÃ­nimo
    if (level < this.minLevel) {
      return;
    }
    
    const entry: LogEntry = {
      level,
      timestamp: new Date(),
      message,
      data,
      source
    };
    
    // Guardar en array
    this.logs.push(entry);
    
    // Limitar tamaÃ±o del array
    if (this.logs.length > this.maxLogs) {
      this.logs.shift();
    }
    
    // Console output
    this.logToConsole(entry);
    
    // En producciÃ³n, enviar a servidor
    if (environment.production && level >= LogLevel.ERROR) {
      this.sendToServer(entry);
    }
  }
  
  /**
   * Log a consola con colores
   */
  private logToConsole(entry: LogEntry): void {
    const timestamp = entry.timestamp.toISOString();
    const source = entry.source ? `[${entry.source}]` : '';
    
    switch (entry.level) {
      case LogLevel.DEBUG:
        console.log(
          `%c[DEBUG]%c ${timestamp} ${source} ${entry.message}`,
          'color: gray',
          'color: inherit',
          entry.data
        );
        break;
      case LogLevel.INFO:
        console.info(
          `%c[INFO]%c ${timestamp} ${source} ${entry.message}`,
          'color: blue',
          'color: inherit',
          entry.data
        );
        break;
      case LogLevel.WARN:
        console.warn(
          `%c[WARN]%c ${timestamp} ${source} ${entry.message}`,
          'color: orange',
          'color: inherit',
          entry.data
        );
        break;
      case LogLevel.ERROR:
        console.error(
          `%c[ERROR]%c ${timestamp} ${source} ${entry.message}`,
          'color: red',
          'color: inherit',
          entry.data
        );
        break;
    }
  }
  
  /**
   * Enviar logs al servidor
   */
  private sendToServer(entry: LogEntry): void {
    // Implementar envÃ­o a servidor de logging
    // Ejemplo: Sentry, LogRocket, custom endpoint
    console.log('Sending log to server:', entry);
  }
  
  /**
   * Obtener todos los logs
   */
  public getLogs(): LogEntry[] {
    return [...this.logs];
  }
  
  /**
   * Obtener logs por nivel
   */
  public getLogsByLevel(level: LogLevel): LogEntry[] {
    return this.logs.filter(log => log.level === level);
  }
  
  /**
   * Limpiar logs
   */
  public clearLogs(): void {
    this.logs = [];
  }
  
  /**
   * Exportar logs como JSON
   */
  public exportLogs(): string {
    return JSON.stringify(this.logs, null, 2);
  }
}
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 6.3.2 Performance Monitoring
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/app/core/services/performance.service.ts

```typescript
import { Injectable, inject } from '@angular/core';
import { LoggerService } from './logger.service';

export interface PerformanceMetric {
  name: string;
  duration: number;
  timestamp: Date;
  metadata?: any;
}

@Injectable({
  providedIn: 'root'
})
export class PerformanceService {
  private readonly logger = inject(LoggerService);
  private readonly marks = new Map<string, number>();
  private readonly metrics: PerformanceMetric[] = [];
  
  /**
   * Iniciar mediciÃ³n
   */
  public start(name: string): void {
    this.marks.set(name, performance.now());
  }
  
  /**
   * Finalizar mediciÃ³n
   */
  public end(name: string, metadata?: any): number {
    const startTime = this.marks.get(name);
    
    if (!startTime) {
      this.logger.warn(`Performance mark "${name}" not found`);
      return 0;
    }
    
    const duration = performance.now() - startTime;
    this.marks.delete(name);
    
    // Guardar mÃ©trica
    const metric: PerformanceMetric = {
      name,
      duration,
      timestamp: new Date(),
      metadata
    };
    
    this.metrics.push(metric);
    
    // Log si es muy lento (> 1s)
    if (duration > 1000) {
      this.logger.warn(`Slow operation: ${name}`, {
        duration: `${duration.toFixed(2)}ms`,
        metadata
      });
    } else {
      this.logger.debug(`Performance: ${name}`, {
        duration: `${duration.toFixed(2)}ms`,
        metadata
      });
    }
    
    return duration;
  }
  
  /**
   * Medir funciÃ³n
   */
  public measure<T>(name: string, fn: () => T): T {
    this.start(name);
    try {
      const result = fn();
      this.end(name);
      return result;
    } catch (error) {
      this.end(name, { error: true });
      throw error;
    }
  }
  
  /**
   * Medir funciÃ³n asÃ­ncrona
   */
  public async measureAsync<T>(name: string, fn: () => Promise<T>): Promise<T> {
    this.start(name);
    try {
      const result = await fn();
      this.end(name);
      return result;
    } catch (error) {
      this.end(name, { error: true });
      throw error;
    }
  }
  
  /**
   * Obtener mÃ©tricas
   */
  public getMetrics(): PerformanceMetric[] {
    return [...this.metrics];
  }
  
  /**
   * Obtener mÃ©tricas por nombre
   */
  public getMetricsByName(name: string): PerformanceMetric[] {
    return this.metrics.filter(m => m.name === name);
  }
  
  /**
   * Calcular promedio de duraciÃ³n
   */
  public getAverageDuration(name: string): number {
    const metrics = this.getMetricsByName(name);
    if (metrics.length === 0) return 0;
    
    const total = metrics.reduce((sum, m) => sum + m.duration, 0);
    return total / metrics.length;
  }
  
  /**
   * Limpiar mÃ©tricas
   */
  public clearMetrics(): void {
    this.metrics.length = 0;
    this.marks.clear();
  }
  
  /**
   * Obtener mÃ©tricas de navegaciÃ³n
   */
  public getNavigationMetrics(): any {
    if (!performance.getEntriesByType) {
      return null;
    }
    
    const navigation = performance.getEntriesByType('navigation')[0] as PerformanceNavigationTiming;
    
    if (!navigation) {
      return null;
    }
    
    return {
      dns: navigation.domainLookupEnd - navigation.domainLookupStart,
      tcp: navigation.connectEnd - navigation.connectStart,
      request: navigation.responseStart - navigation.requestStart,
      response: navigation.responseEnd - navigation.responseStart,
      domProcessing: navigation.domContentLoadedEventEnd - navigation.domContentLoadedEventStart,
      loadComplete: navigation.loadEventEnd - navigation.loadEventStart,
      total: navigation.loadEventEnd - navigation.fetchStart
    };
  }
}
```

DECORADOR PARA MEDIR MÃ‰TODOS:

```typescript
import { PerformanceService } from '@core/services/performance.service';

export function Measure(name?: string) {
  return function (
    target: any,
    propertyKey: string,
    descriptor: PropertyDescriptor
  ) {
    const originalMethod = descriptor.value;
    const metricName = name || `${target.constructor.name}.${propertyKey}`;
    
    descriptor.value = async function (...args: any[]) {
      const performanceService = this.performanceService as PerformanceService;
      
      if (!performanceService) {
        return originalMethod.apply(this, args);
      }
      
      return performanceService.measureAsync(metricName, () => 
        originalMethod.apply(this, args)
      );
    };
    
    return descriptor;
  };
}

// USO:
@Injectable()
export class ProductService {
  @Measure('ProductService.getAll')
  public async getAll(): Promise<Product[]> {
    // ...
  }
}
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 6.3.3 Analytics Service
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

INSTALACIÃ“N (opcional - Google Analytics):

```bash
npm install @angular/fire
```

UBICACIÃ“N: src/app/core/services/analytics-tracking.service.ts

```typescript
import { Injectable, inject } from '@angular/core';
import { Router, NavigationEnd } from '@angular/router';
import { filter } from 'rxjs/operators';
import { LoggerService } from './logger.service';

export interface AnalyticsEvent {
  category: string;
  action: string;
  label?: string;
  value?: number;
  timestamp: Date;
}

@Injectable({
  providedIn: 'root'
})
export class AnalyticsTrackingService {
  private readonly router = inject(Router);
  private readonly logger = inject(LoggerService);
  
  private events: AnalyticsEvent[] = [];
  
  constructor() {
    this.trackPageViews();
  }
  
  /**
   * Tracking automÃ¡tico de pÃ¡ginas
   */
  private trackPageViews(): void {
    this.router.events.pipe(
      filter(event => event instanceof NavigationEnd)
    ).subscribe((event: NavigationEnd) => {
      this.trackPageView(event.urlAfterRedirects);
    });
  }
  
  /**
   * Track page view
   */
  public trackPageView(page: string): void {
    this.trackEvent({
      category: 'Navigation',
      action: 'Page View',
      label: page,
      timestamp: new Date()
    });
    
    // Si tienes Google Analytics configurado:
    // gtag('config', 'GA_MEASUREMENT_ID', { page_path: page });
  }
  
  /**
   * Track evento personalizado
   */
  public trackEvent(event: Omit<AnalyticsEvent, 'timestamp'>): void {
    const fullEvent: AnalyticsEvent = {
      ...event,
      timestamp: new Date()
    };
    
    this.events.push(fullEvent);
    
    this.logger.info('Analytics Event', fullEvent);
    
    // Si tienes Google Analytics configurado:
    // gtag('event', event.action, {
    //   event_category: event.category,
    //   event_label: event.label,
    //   value: event.value
    // });
  }
  
  /**
   * Track acciÃ³n de usuario
   */
  public trackUserAction(action: string, label?: string, value?: number): void {
    this.trackEvent({
      category: 'User',
      action,
      label,
      value
    });
  }
  
  /**
   * Track error
   */
  public trackError(error: string, fatal: boolean = false): void {
    this.trackEvent({
      category: 'Error',
      action: error,
      label: fatal ? 'Fatal' : 'Non-Fatal'
    });
  }
  
  /**
   * Track tiempo de operaciÃ³n
   */
  public trackTiming(category: string, variable: string, time: number, label?: string): void {
    this.trackEvent({
      category: 'Timing',
      action: `${category} - ${variable}`,
      label,
      value: time
    });
  }
  
  /**
   * Obtener eventos
   */
  public getEvents(): AnalyticsEvent[] {
    return [...this.events];
  }
  
  /**
   * Limpiar eventos
   */
  public clearEvents(): void {
    this.events = [];
  }
}
```

USO EN COMPONENTES:

```typescript
// Track click en botÃ³n
this.analytics.trackUserAction('Button Click', 'Add Product');

// Track feature usage
this.analytics.trackUserAction('Feature Used', 'Barcode Scanner');

// Track tiempo de carga
this.analytics.trackTiming('API', 'Load Products', 1523, 'Products Page');

// Track error
this.analytics.trackError('Payment Failed', false);
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  6.4 PROGRESSIVE WEB APP (PWA)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 6.4.1 ConfiguraciÃ³n de Service Worker
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

INSTALACIÃ“N:

```bash
ng add @angular/pwa
```

CONFIGURACIÃ“N: ngsw-config.json

```json
{
  "$schema": "./node_modules/@angular/service-worker/config/schema.json",
  "index": "/index.html",
  "assetGroups": [
    {
      "name": "app",
      "installMode": "prefetch",
      "resources": {
        "files": [
          "/favicon.ico",
          "/index.html",
          "/manifest.webmanifest",
          "/*.css",
          "/*.js"
        ]
      }
    },
    {
      "name": "assets",
      "installMode": "lazy",
      "updateMode": "prefetch",
      "resources": {
        "files": [
          "/assets/**",
          "/*.(svg|cur|jpg|jpeg|png|apng|webp|avif|gif|otf|ttf|woff|woff2)"
        ]
      }
    }
  ],
  "dataGroups": [
    {
      "name": "api-cache",
      "urls": [
        "/api/products",
        "/api/categories"
      ],
      "cacheConfig": {
        "maxSize": 100,
        "maxAge": "1h",
        "timeout": "10s",
        "strategy": "freshness"
      }
    },
    {
      "name": "api-performance",
      "urls": [
        "/api/**"
      ],
      "cacheConfig": {
        "maxSize": 50,
        "maxAge": "5m",
        "strategy": "performance"
      }
    }
  ]
}
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 6.4.2 Web App Manifest
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/manifest.webmanifest

```json
{
  "name": "GestPharma - Sistema de GestiÃ³n FarmacÃ©utica",
  "short_name": "GestPharma",
  "description": "Sistema completo de gestiÃ³n para farmacias",
  "theme_color": "#3880ff",
  "background_color": "#ffffff",
  "display": "standalone",
  "orientation": "portrait",
  "scope": "/",
  "start_url": "/",
  "icons": [
    {
      "src": "assets/icons/icon-72x72.png",
      "sizes": "72x72",
      "type": "image/png",
      "purpose": "maskable any"
    },
    {
      "src": "assets/icons/icon-96x96.png",
      "sizes": "96x96",
      "type": "image/png",
      "purpose": "maskable any"
    },
    {
      "src": "assets/icons/icon-128x128.png",
      "sizes": "128x128",
      "type": "image/png",
      "purpose": "maskable any"
    },
    {
      "src": "assets/icons/icon-144x144.png",
      "sizes": "144x144",
      "type": "image/png",
      "purpose": "maskable any"
    },
    {
      "src": "assets/icons/icon-152x152.png",
      "sizes": "152x152",
      "type": "image/png",
      "purpose": "maskable any"
    },
    {
      "src": "assets/icons/icon-192x192.png",
      "sizes": "192x192",
      "type": "image/png",
      "purpose": "maskable any"
    },
    {
      "src": "assets/icons/icon-384x384.png",
      "sizes": "384x384",
      "type": "image/png",
      "purpose": "maskable any"
    },
    {
      "src": "assets/icons/icon-512x512.png",
      "sizes": "512x512",
      "type": "image/png",
      "purpose": "maskable any"
    }
  ],
  "shortcuts": [
    {
      "name": "Nueva Venta",
      "short_name": "Venta",
      "description": "Crear una nueva venta",
      "url": "/tabs/sales/new",
      "icons": [
        {
          "src": "assets/icons/sale-icon.png",
          "sizes": "192x192"
        }
      ]
    },
    {
      "name": "Productos",
      "short_name": "Productos",
      "description": "Ver productos",
      "url": "/tabs/products",
      "icons": [
        {
          "src": "assets/icons/product-icon.png",
          "sizes": "192x192"
        }
      ]
    },
    {
      "name": "Escanear",
      "short_name": "Escanear",
      "description": "Escanear cÃ³digo de barras",
      "url": "/scanner",
      "icons": [
        {
          "src": "assets/icons/scanner-icon.png",
          "sizes": "192x192"
        }
      ]
    }
  ],
  "categories": ["business", "productivity", "medical"],
  "screenshots": [
    {
      "src": "assets/screenshots/home.png",
      "sizes": "540x720",
      "type": "image/png"
    },
    {
      "src": "assets/screenshots/products.png",
      "sizes": "540x720",
      "type": "image/png"
    }
  ]
}
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 6.4.3 PWA Update Service
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/app/core/services/pwa-update.service.ts

```typescript
import { Injectable, ApplicationRef, inject } from '@angular/core';
import { SwUpdate, VersionReadyEvent } from '@angular/service-worker';
import { concat, interval } from 'rxjs';
import { first, filter } from 'rxjs/operators';
import { ToastService } from './toast.service';
import { LoggerService } from './logger.service';

@Injectable({
  providedIn: 'root'
})
export class PwaUpdateService {
  private readonly swUpdate = inject(SwUpdate);
  private readonly appRef = inject(ApplicationRef);
  private readonly toastService = inject(ToastService);
  private readonly logger = inject(LoggerService);
  
  constructor() {
    if (this.swUpdate.isEnabled) {
      this.checkForUpdates();
      this.handleUpdates();
    }
  }
  
  /**
   * Verificar actualizaciones periÃ³dicamente
   */
  private checkForUpdates(): void {
    // Esperar a que la app se estabilice antes de verificar
    const appIsStable$ = this.appRef.isStable.pipe(
      first(isStable => isStable === true)
    );
    
    // Verificar cada 6 horas
    const everySixHours$ = interval(6 * 60 * 60 * 1000);
    
    const everySixHoursOnceAppIsStable$ = concat(appIsStable$, everySixHours$);
    
    everySixHoursOnceAppIsStable$.subscribe(async () => {
      try {
        const updateFound = await this.swUpdate.checkForUpdate();
        if (updateFound) {
          this.logger.info('Update available');
        }
      } catch (err) {
        this.logger.error('Failed to check for updates', err);
      }
    });
  }
  
  /**
   * Manejar actualizaciones
   */
  private handleUpdates(): void {
    this.swUpdate.versionUpdates.pipe(
      filter((evt): evt is VersionReadyEvent => evt.type === 'VERSION_READY')
    ).subscribe(async (event) => {
      this.logger.info('New version available', {
        current: event.currentVersion,
        available: event.latestVersion
      });
      
      await this.promptUpdate();
    });
    
    // Manejar errores de actualizaciÃ³n
    this.swUpdate.unrecoverable.subscribe(event => {
      this.logger.error('Unrecoverable state', event);
      this.toastService.error(
        'La aplicaciÃ³n necesita recargarse. Por favor, cierra y abre la app nuevamente.'
      );
    });
  }
  
  /**
   * Mostrar prompt para actualizar
   */
  private async promptUpdate(): Promise<void> {
    const toast = await this.toastService.show({
      message: 'Â¡Nueva versiÃ³n disponible!',
      color: 'primary',
      duration: 0,
      position: 'top',
      buttons: [
        {
          text: 'Actualizar',
          handler: () => {
            this.activateUpdate();
          }
        },
        {
          text: 'DespuÃ©s',
          role: 'cancel'
        }
      ]
    });
  }
  
  /**
   * Activar actualizaciÃ³n
   */
  private async activateUpdate(): Promise<void> {
    try {
      await this.swUpdate.activateUpdate();
      this.logger.info('Update activated, reloading...');
      document.location.reload();
    } catch (err) {
      this.logger.error('Failed to activate update', err);
      this.toastService.error('Error al actualizar. Intenta recargar la pÃ¡gina.');
    }
  }
  
  /**
   * Forzar actualizaciÃ³n
   */
  public async forceUpdate(): Promise<void> {
    if (!this.swUpdate.isEnabled) {
      this.toastService.info('Las actualizaciones no estÃ¡n disponibles');
      return;
    }
    
    try {
      const updateFound = await this.swUpdate.checkForUpdate();
      
      if (updateFound) {
        await this.activateUpdate();
      } else {
        this.toastService.info('Ya estÃ¡s usando la Ãºltima versiÃ³n');
      }
    } catch (err) {
      this.logger.error('Failed to force update', err);
      this.toastService.error('Error al verificar actualizaciones');
    }
  }
}
```

INICIALIZAR EN APP COMPONENT:

```typescript
import { Component, inject } from '@angular/core';
import { PwaUpdateService } from '@core/services/pwa-update.service';

@Component({
  selector: 'app-root',
  template: '<ion-app><ion-router-outlet></ion-router-outlet></ion-app>'
})
export class AppComponent {
  private readonly pwaUpdate = inject(PwaUpdateService);
  
  // El servicio se inicializa automÃ¡ticamente por el inject
}
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 6.4.4 PWA Install Prompt
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/app/core/services/pwa-install.service.ts

```typescript
import { Injectable, signal } from '@angular/core';
import { Platform } from '@ionic/angular';

interface BeforeInstallPromptEvent extends Event {
  readonly platforms: string[];
  readonly userChoice: Promise<{
    outcome: 'accepted' | 'dismissed';
    platform: string;
  }>;
  prompt(): Promise<void>;
}

@Injectable({
  providedIn: 'root'
})
export class PwaInstallService {
  private deferredPrompt: BeforeInstallPromptEvent | null = null;
  public canInstall = signal(false);
  public isInstalled = signal(false);
  
  constructor(private platform: Platform) {
    this.initialize();
  }
  
  /**
   * Inicializar
   */
  private initialize(): void {
    // Escuchar evento beforeinstallprompt
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      this.deferredPrompt = e as BeforeInstallPromptEvent;
      this.canInstall.set(true);
    });
    
    // Detectar si ya estÃ¡ instalado
    if (window.matchMedia('(display-mode: standalone)').matches) {
      this.isInstalled.set(true);
    }
    
    // Escuchar cuando se instala
    window.addEventListener('appinstalled', () => {
      this.isInstalled.set(true);
      this.canInstall.set(false);
      this.deferredPrompt = null;
    });
  }
  
  /**
   * Mostrar prompt de instalaciÃ³n
   */
  public async promptInstall(): Promise<boolean> {
    if (!this.deferredPrompt) {
      return false;
    }
    
    try {
      await this.deferredPrompt.prompt();
      
      const { outcome } = await this.deferredPrompt.userChoice;
      
      this.deferredPrompt = null;
      this.canInstall.set(false);
      
      return outcome === 'accepted';
    } catch (error) {
      console.error('Error showing install prompt:', error);
      return false;
    }
  }
  
  /**
   * Verificar si es iOS
   */
  public isIOS(): boolean {
    return this.platform.is('ios') && !this.platform.is('mobileweb');
  }
  
  /**
   * Verificar si puede mostrar instrucciones de instalaciÃ³n en iOS
   */
  public canShowIOSInstructions(): boolean {
    return this.isIOS() && !this.isInstalled();
  }
}
```

COMPONENTE DE INSTALACIÃ“N:

```typescript
import { Component, inject, signal } from '@angular/core';
import { CommonModule } from '@angular/common';
import { IonicModule } from '@ionic/angular';
import { PwaInstallService } from '@core/services/pwa-install.service';

@Component({
  selector: 'app-pwa-install-banner',
  standalone: true,
  imports: [CommonModule, IonicModule],
  template: `
    <!-- Banner para Android/Desktop -->
    <ion-card *ngIf="pwaInstall.canInstall() && !dismissed()" class="install-banner">
      <ion-card-content>
        <div class="banner-content">
          <div class="banner-icon">
            <ion-icon name="download-outline"></ion-icon>
          </div>
          <div class="banner-text">
            <h3>Instalar GestPharma</h3>
            <p>Instala la app para acceso rÃ¡pido y uso offline</p>
          </div>
          <div class="banner-actions">
            <ion-button fill="clear" (click)="dismiss()">
              DespuÃ©s
            </ion-button>
            <ion-button (click)="install()">
              Instalar
            </ion-button>
          </div>
        </div>
      </ion-card-content>
    </ion-card>
    
    <!-- Instrucciones para iOS -->
    <ion-modal
      *ngIf="pwaInstall.canShowIOSInstructions()"
      [isOpen]="showIOSModal()"
      (didDismiss)="showIOSModal.set(false)"
    >
      <ng-template>
        <ion-header>
          <ion-toolbar>
            <ion-title>Instalar en iOS</ion-title>
            <ion-buttons slot="end">
              <ion-button (click)="showIOSModal.set(false)">
                <ion-icon name="close"></ion-icon>
              </ion-button>
            </ion-buttons>
          </ion-toolbar>
        </ion-header>
        <ion-content class="ion-padding">
          <div class="ios-instructions">
            <h2>Para instalar GestPharma en tu iPhone:</h2>
            <ol>
              <li>
                <ion-icon name="share-outline"></ion-icon>
                Toca el botÃ³n de compartir en Safari
              </li>
              <li>
                <ion-icon name="add-circle-outline"></ion-icon>
                Selecciona "AÃ±adir a la pantalla de inicio"
              </li>
              <li>
                <ion-icon name="checkmark-circle-outline"></ion-icon>
                Confirma tocando "AÃ±adir"
              </li>
            </ol>
          </div>
        </ion-content>
      </ng-template>
    </ion-modal>
  `,
  styles: [`
    .install-banner {
      margin: 16px;
      border-left: 4px solid var(--ion-color-primary);
    }
    
    .banner-content {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .banner-icon {
      ion-icon {
        font-size: 48px;
        color: var(--ion-color-primary);
      }
    }
    
    .banner-text {
      flex: 1;
      
      h3 {
        margin: 0 0 4px 0;
        font-size: 18px;
      }
      
      p {
        margin: 0;
        color: var(--ion-color-medium);
        font-size: 14px;
      }
    }
    
    .banner-actions {
      display: flex;
      gap: 8px;
    }
    
    .ios-instructions {
      ol {
        list-style: none;
        padding: 0;
        counter-reset: step;
        
        li {
          counter-increment: step;
          padding: 20px 0;
          border-bottom: 1px solid var(--ion-color-light);
          display: flex;
          align-items: center;
          gap: 16px;
          
          &:before {
            content: counter(step);
            background: var(--ion-color-primary);
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
          }
          
          ion-icon {
            font-size: 32px;
            color: var(--ion-color-primary);
          }
        }
      }
    }
  `]
})
export class PwaInstallBannerComponent {
  public readonly pwaInstall = inject(PwaInstallService);
  public dismissed = signal(false);
  public showIOSModal = signal(false);
  
  public async install(): Promise<void> {
    const installed = await this.pwaInstall.promptInstall();
    if (installed) {
      this.dismissed.set(true);
    }
  }
  
  public dismiss(): void {
    this.dismissed.set(true);
    // Guardar en localStorage para no mostrar por 7 dÃ­as
    localStorage.setItem('pwa_install_dismissed', Date.now().toString());
  }
}
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  6.5 OPTIMIZACIÃ“N DE RENDIMIENTO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 6.5.1 Lazy Loading de MÃ³dulos
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/app/app.routes.ts

```typescript
import { Routes } from '@angular/router';
import { AuthGuard } from '@core/guards/auth.guard';

export const routes: Routes = [
  {
    path: '',
    redirectTo: 'tabs',
    pathMatch: 'full'
  },
  {
    path: 'login',
    loadComponent: () => import('./pages/login/login.page').then(m => m.LoginPage)
  },
  {
    path: 'tabs',
    loadChildren: () => import('./pages/tabs/tabs.routes').then(m => m.routes),
    canActivate: [AuthGuard]
  },
  {
    path: 'products',
    loadChildren: () => import('./pages/products/products.routes').then(m => m.routes),
    canActivate: [AuthGuard]
  },
  {
    path: 'sales',
    loadChildren: () => import('./pages/sales/sales.routes').then(m => m.routes),
    canActivate: [AuthGuard]
  },
  {
    path: 'settings',
    loadComponent: () => import('./pages/settings/settings.page').then(m => m.SettingsPage),
    canActivate: [AuthGuard]
  },
  {
    path: '**',
    loadComponent: () => import('./pages/not-found/not-found.page').then(m => m.NotFoundPage)
  }
];
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 6.5.2 Preloading Strategy
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/app/core/strategies/custom-preload.strategy.ts

```typescript
import { Injectable } from '@angular/core';
import { PreloadingStrategy, Route } from '@angular/router';
import { Observable, of, timer } from 'rxjs';
import { mergeMap } from 'rxjs/operators';

@Injectable({
  providedIn: 'root'
})
export class CustomPreloadStrategy implements PreloadingStrategy {
  
  public preload(route: Route, load: () => Observable<any>): Observable<any> {
    // Si tiene data.preload = true, precargar
    if (route.data && route.data['preload']) {
      // Delay opcional para no bloquear la carga inicial
      const delay = route.data['delay'] || 0;
      
      return timer(delay).pipe(
        mergeMap(() => {
          console.log('Preloading:', route.path);
          return load();
        })
      );
    }
    
    return of(null);
  }
}
```

REGISTRAR EN APP.CONFIG.TS:

```typescript
import { ApplicationConfig, importProvidersFrom } from '@angular/core';
import { provideRouter, withPreloading } from '@angular/router';
import { routes } from './app.routes';
import { CustomPreloadStrategy } from '@core/strategies/custom-preload.strategy';

export const appConfig: ApplicationConfig = {
  providers: [
    provideRouter(
      routes, 
      withPreloading(CustomPreloadStrategy)
    )
  ]
};
```

USO EN RUTAS:

```typescript
{
  path: 'products',
  loadChildren: () => import('./pages/products/products.routes').then(m => m.routes),
  data: { preload: true, delay: 2000 } // Precargar despuÃ©s de 2s
}
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 6.5.3 Virtual Scrolling
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

EJEMPLO EN LISTA DE PRODUCTOS:

```typescript
import { Component, signal } from '@angular/core';
import { CommonModule } from '@angular/common';
import { IonicModule } from '@ionic/angular';

@Component({
  selector: 'app-product-list',
  standalone: true,
  imports: [CommonModule, IonicModule],
  template: `
    <ion-header>
      <ion-toolbar>
        <ion-title>Productos</ion-title>
      </ion-toolbar>
    </ion-header>
    
    <ion-content>
      <!-- Virtual Scroll para listas grandes -->
      <ion-list>
        <ion-virtual-scroll
          [items]="products()"
          [itemHeight]="80"
          [headerHeight]="40"
        >
          <ion-item-group>
            <!-- Header opcional -->
            <ion-item-divider *virtualHeader>
              <ion-label>{{ products().length }} productos</ion-label>
            </ion-item-divider>
            
            <!-- Items -->
            <ion-item *virtualItem="let product">
              <ion-thumbnail slot="start">
                <img [src]="product.imagen || 'assets/placeholder.png'" />
              </ion-thumbnail>
              <ion-label>
                <h2>{{ product.nombre }}</h2>
                <p>Stock: {{ product.stock }}</p>
              </ion-label>
              <ion-note slot="end">
                {{ product.precio | currency }}
              </ion-note>
            </ion-item>
          </ion-item-group>
        </ion-virtual-scroll>
      </ion-list>
    </ion-content>
  `
})
export class ProductListComponent {
  public products = signal<Product[]>([]);
}
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 6.5.4 Image Optimization
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

DIRECTIVA PARA LAZY LOADING DE IMÃGENES:

```typescript
import { Directive, ElementRef, Input, OnInit } from '@angular/core';

@Directive({
  selector: 'img[appLazyLoad]',
  standalone: true
})
export class LazyLoadImageDirective implements OnInit {
  @Input() appLazyLoad!: string;
  @Input() placeholder = 'assets/placeholder.png';
  
  private observer!: IntersectionObserver;
  
  constructor(private el: ElementRef<HTMLImageElement>) {}
  
  public ngOnInit(): void {
    // Establecer placeholder
    this.el.nativeElement.src = this.placeholder;
    
    // Crear IntersectionObserver
    this.observer = new IntersectionObserver(
      (entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            this.loadImage();
            this.observer.disconnect();
          }
        });
      },
      {
        rootMargin: '50px' // Cargar 50px antes de ser visible
      }
    );
    
    this.observer.observe(this.el.nativeElement);
  }
  
  private loadImage(): void {
    const img = new Image();
    
    img.onload = () => {
      this.el.nativeElement.src = this.appLazyLoad;
      this.el.nativeElement.classList.add('loaded');
    };
    
    img.onerror = () => {
      console.error('Error loading image:', this.appLazyLoad);
      this.el.nativeElement.src = this.placeholder;
    };
    
    img.src = this.appLazyLoad;
  }
  
  public ngOnDestroy(): void {
    if (this.observer) {
      this.observer.disconnect();
    }
  }
}
```

USO:

```html
<img 
  [appLazyLoad]="product.imagen"
  [placeholder]="'assets/placeholder.png'"
  [alt]="product.nombre"
/>
```

STYLES GLOBALES:

```css
img {
  opacity: 0;
  transition: opacity 0.3s ease-in;
  
  &.loaded {
    opacity: 1;
  }
}
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 6.5.5 Bundle Optimization
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ANGULAR.JSON - ConfiguraciÃ³n de Build:

```json
{
  "projects": {
    "app": {
      "architect": {
        "build": {
          "configurations": {
            "production": {
              "optimization": {
                "scripts": true,
                "styles": {
                  "minify": true,
                  "inlineCritical": true
                },
                "fonts": true
              },
              "outputHashing": "all",
              "sourceMap": false,
              "namedChunks": false,
              "aot": true,
              "extractLicenses": true,
              "vendorChunk": false,
              "buildOptimizer": true,
              "budgets": [
                {
                  "type": "initial",
                  "maximumWarning": "2mb",
                  "maximumError": "5mb"
                },
                {
                  "type": "anyComponentStyle",
                  "maximumWarning": "6kb",
                  "maximumError": "10kb"
                }
              ]
            }
          }
        }
      }
    }
  }
}
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 6.5.6 TrackBy Functions
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/app/shared/utils/track-by.utils.ts

```typescript
/**
 * TrackBy functions para optimizar ngFor
 */

export class TrackByUtils {
  /**
   * Track por ID
   */
  public static trackById<T extends { id: number | string }>(index: number, item: T): number | string {
    return item.id;
  }
  
  /**
   * Track por Ã­ndice
   */
  public static trackByIndex(index: number): number {
    return index;
  }
  
  /**
   * Track por propiedad personalizada
   */
  public static trackByProperty<T>(property: keyof T) {
    return (index: number, item: T): any => item[property];
  }
}
```

USO EN COMPONENTES:

```typescript
import { Component } from '@angular/core';
import { TrackByUtils } from '@shared/utils/track-by.utils';

@Component({
  template: `
    <ion-item *ngFor="let product of products; trackBy: trackById">
      {{ product.nombre }}
    </ion-item>
  `
})
export class ProductListComponent {
  public products: Product[] = [];
  public trackById = TrackByUtils.trackById;
}
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  6.6 DOCUMENTACIÃ“N
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 6.6.1 JSDoc Comments
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

EJEMPLO DE DOCUMENTACIÃ“N DE SERVICIO:

```typescript
/**
 * Servicio para gestiÃ³n de productos
 * 
 * @description
 * Este servicio maneja todas las operaciones CRUD relacionadas con productos,
 * incluyendo bÃºsqueda, filtrado y gestiÃ³n de inventario.
 * 
 * @example
 * ```typescript
 * constructor(private productService: ProductService) {}
 * 
 * loadProducts() {
 *   this.productService.getAll().subscribe(products => {
 *     console.log(products);
 *   });
 * }
 * ```
 */
@Injectable({
  providedIn: 'root'
})
export class ProductService {
  
  /**
   * Obtiene todos los productos
   * 
   * @returns Observable con array de productos
   * @throws {HttpErrorResponse} Si la peticiÃ³n falla
   * 
   * @example
   * ```typescript
   * this.productService.getAll().subscribe({
   *   next: (products) => console.log(products),
   *   error: (error) => console.error(error)
   * });
   * ```
   */
  public getAll(): Observable<Product[]> {
    return this.http.get<Product[]>(`${this.baseUrl}/products`);
  }
  
  /**
   * Crea un nuevo producto
   * 
   * @param product - Datos del producto a crear
   * @returns Observable con el producto creado
   * @throws {HttpErrorResponse} Si la validaciÃ³n falla o hay error del servidor
   * 
   * @example
   * ```typescript
   * const newProduct = {
   *   nombre: 'Aspirina',
   *   precio: 50,
   *   stock: 100
   * };
   * 
   * this.productService.create(newProduct).subscribe({
   *   next: (product) => console.log('Creado:', product),
   *   error: (error) => console.error('Error:', error)
   * });
   * ```
   */
  public create(product: Partial<Product>): Observable<Product> {
    return this.http.post<Product>(`${this.baseUrl}/products`, product);
  }
}
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 6.6.2 README Principal
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: README.md

```markdown
# GestPharma - Sistema de GestiÃ³n FarmacÃ©utica

[![Ionic](https://img.shields.io/badge/Ionic-7.0-3880FF?logo=ionic)](https://ionicframework.com/)
[![Angular](https://img.shields.io/badge/Angular-18.0-DD0031?logo=angular)](https://angular.io/)
[![TypeScript](https://img.shields.io/badge/TypeScript-5.4-3178C6?logo=typescript)](https://www.typescriptlang.org/)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)

Sistema completo de gestiÃ³n para farmacias desarrollado con Ionic 7 y Angular 18.

## ğŸ“‹ CaracterÃ­sticas

- âœ… **GestiÃ³n de Productos**: CRUD completo con bÃºsqueda y filtros
- âœ… **Ventas**: Sistema de punto de venta con carrito
- âœ… **Inventario**: Control de stock con alertas
- âœ… **Reportes**: Dashboard con mÃ©tricas y grÃ¡ficos
- âœ… **Offline**: Funcionamiento sin conexiÃ³n con sincronizaciÃ³n
- âœ… **EscÃ¡ner**: Lectura de cÃ³digos de barras
- âœ… **PWA**: Instalable como app nativa
- âœ… **AutenticaciÃ³n**: JWT con refresh tokens
- âœ… **BiometrÃ­a**: Login con huella/Face ID
- âœ… **Multi-idioma**: EspaÃ±ol e InglÃ©s
- âœ… **Modo Oscuro**: Tema claro/oscuro/automÃ¡tico
- âœ… **Accesibilidad**: WCAG 2.1 AAA

## ğŸš€ Inicio RÃ¡pido

### Prerrequisitos

- Node.js >= 18.0.0
- npm >= 9.0.0
- Ionic CLI >= 7.0.0

### InstalaciÃ³n

```bash
# Clonar repositorio
git clone https://github.com/tu-usuario/gestpharma.git
cd gestpharma

# Instalar dependencias
npm install

# Configurar variables de entorno
cp src/environments/environment.example.ts src/environments/environment.ts

# Ejecutar en navegador
ionic serve

# Ejecutar en Android
ionic cap run android

# Ejecutar en iOS
ionic cap run ios
```

## ğŸ“± CompilaciÃ³n

### Web

```bash
# Desarrollo
npm run build

# ProducciÃ³n
npm run build:prod
```

### MÃ³vil

```bash
# Android
npm run build:android

# iOS
npm run build:ios
```

## ğŸ§ª Testing

```bash
# Unit tests
npm run test

# E2E tests
npm run e2e

# Cobertura
npm run test:coverage
```

## ğŸ“š DocumentaciÃ³n

- [GuÃ­a de Desarrollo](docs/DEVELOPMENT.md)
- [API Reference](docs/API.md)
- [Arquitectura](docs/ARCHITECTURE.md)
- [Testing](docs/TESTING.md)

## ğŸ”§ TecnologÃ­as

- **Frontend**: Ionic 7, Angular 18
- **Estado**: RxJS, BehaviorSubject
- **Testing**: Jasmine, Karma, Cypress
- **Calidad**: ESLint, Prettier, SonarQube
- **CI/CD**: GitHub Actions

## ğŸ“„ Licencia

MIT License - ver [LICENSE](LICENSE) para mÃ¡s detalles.

## ğŸ‘¥ Contribuir

Ver [CONTRIBUTING.md](CONTRIBUTING.md) para guÃ­a de contribuciÃ³n.

## ğŸ“§ Contacto

- Email: contact@gestpharma.com
- Website: https://gestpharma.com
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 6.6.3 GuÃ­a de Desarrollo
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: docs/DEVELOPMENT.md

```markdown
# GuÃ­a de Desarrollo - GestPharma

## Estructura del Proyecto

```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ core/              # Servicios singleton, guards, interceptors
â”‚   â”‚   â”œâ”€â”€ guards/
â”‚   â”‚   â”œâ”€â”€ interceptors/
â”‚   â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â””â”€â”€ services/
â”‚   â”œâ”€â”€ shared/            # Componentes, directivas, pipes compartidos
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ directives/
â”‚   â”‚   â”œâ”€â”€ pipes/
â”‚   â”‚   â””â”€â”€ utils/
â”‚   â””â”€â”€ pages/             # PÃ¡ginas de la aplicaciÃ³n
â”‚       â”œâ”€â”€ login/
â”‚       â”œâ”€â”€ products/
â”‚       â”œâ”€â”€ sales/
â”‚       â””â”€â”€ tabs/
â”œâ”€â”€ assets/                # Recursos estÃ¡ticos
â”œâ”€â”€ environments/          # Configuraciones por ambiente
â””â”€â”€ theme/                 # Estilos globales y variables CSS
```

## Convenciones de CÃ³digo

### Componentes

```typescript
// âœ… CORRECTO
@Component({
  selector: 'app-product-card',
  standalone: true,
  imports: [CommonModule, IonicModule],
  changeDetection: ChangeDetectionStrategy.OnPush,
  template: `...`,
  styles: [`...`]
})
export class ProductCardComponent {
  // Signals para estado reactivo
  public readonly product = input.required<Product>();
  public readonly selected = output<Product>();
  
  // InyecciÃ³n con inject()
  private readonly productService = inject(ProductService);
}
```

### Servicios

```typescript
// âœ… CORRECTO
@Injectable({
  providedIn: 'root'
})
export class ProductService {
  private readonly http = inject(HttpClient);
  private readonly baseUrl = `${environment.apiUrl}/products`;
  
  public getAll(): Observable<Product[]> {
    return this.http.get<Product[]>(this.baseUrl);
  }
}
```

### Estado con Signals

```typescript
// âœ… CORRECTO - Usar signals
export class ProductListComponent {
  public products = signal<Product[]>([]);
  public loading = signal(false);
  public selectedProduct = signal<Product | null>(null);
  
  // Computed signals
  public productCount = computed(() => this.products().length);
  public hasProducts = computed(() => this.products().length > 0);
}
```

## Mejores PrÃ¡cticas

### 1. OnPush Change Detection

Usar siempre ChangeDetectionStrategy.OnPush para mejor rendimiento:

```typescript
@Component({
  changeDetection: ChangeDetectionStrategy.OnPush
})
```

### 2. TrackBy en ngFor

```typescript
<ion-item *ngFor="let item of items; trackBy: trackById">
```

### 3. Unsubscribe AutomÃ¡tico

Usar async pipe o signals en lugar de subscribe manual:

```typescript
// âœ… CORRECTO
public products$ = this.productService.getAll();

<ion-item *ngFor="let product of products$ | async">
```

### 4. Lazy Loading

Todas las rutas deben usar lazy loading:

```typescript
{
  path: 'products',
  loadComponent: () => import('./pages/products/products.page').then(m => m.ProductsPage)
}
```

### 5. Error Handling

```typescript
this.productService.getAll().subscribe({
  next: (products) => this.products.set(products),
  error: (error) => {
    this.logger.error('Error loading products', error);
    this.toastService.error('Error al cargar productos');
  }
});
```

## Testing

### Unit Tests

```typescript
describe('ProductService', () => {
  let service: ProductService;
  let httpMock: HttpTestingController;
  
  beforeEach(() => {
    TestBed.configureTestingModule({
      imports: [HttpClientTestingModule],
      providers: [ProductService]
    });
    
    service = TestBed.inject(ProductService);
    httpMock = TestBed.inject(HttpTestingController);
  });
  
  it('should get all products', () => {
    const mockProducts: Product[] = [{ id: 1, nombre: 'Test' }];
    
    service.getAll().subscribe(products => {
      expect(products).toEqual(mockProducts);
    });
    
    const req = httpMock.expectOne(`${environment.apiUrl}/products`);
    expect(req.request.method).toBe('GET');
    req.flush(mockProducts);
  });
});
```

## Git Workflow

### Branches

- `main`: ProducciÃ³n
- `develop`: Desarrollo
- `feature/*`: Nuevas caracterÃ­sticas
- `bugfix/*`: CorrecciÃ³n de bugs
- `hotfix/*`: Fixes urgentes en producciÃ³n

### Commits

Seguir Conventional Commits:

```
feat: agregar bÃºsqueda de productos
fix: corregir error en cÃ¡lculo de total
docs: actualizar README
style: formatear cÃ³digo con prettier
refactor: reorganizar estructura de carpetas
test: agregar tests para ProductService
chore: actualizar dependencias
```

## Scripts Ãštiles

```bash
# Desarrollo
npm start                  # ionic serve
npm run lint              # ESLint
npm run format            # Prettier
npm run test              # Unit tests
npm run e2e               # E2E tests

# Build
npm run build             # Build desarrollo
npm run build:prod        # Build producciÃ³n

# Calidad
npm run test:coverage     # Cobertura de tests
npm run analyze           # Analizar bundle size
```

## Recursos

- [Ionic Documentation](https://ionicframework.com/docs)
- [Angular Documentation](https://angular.io/docs)
- [TypeScript Handbook](https://www.typescriptlang.org/docs/)
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 6.6.4 Changelog
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: CHANGELOG.md

```markdown
# Changelog

Todos los cambios notables en este proyecto serÃ¡n documentados en este archivo.

El formato estÃ¡ basado en [Keep a Changelog](https://keepachangelog.com/es-ES/1.0.0/),
y este proyecto adhiere a [Semantic Versioning](https://semver.org/lang/es/).

## [1.0.0] - 2024-01-15

### Agregado
- Sistema completo de gestiÃ³n de productos (CRUD)
- MÃ³dulo de ventas con carrito de compras
- Dashboard con mÃ©tricas y reportes
- AutenticaciÃ³n con JWT y refresh tokens
- Login biomÃ©trico (huella/Face ID)
- EscÃ¡ner de cÃ³digos de barras
- Modo offline con sincronizaciÃ³n
- PWA con instalaciÃ³n nativa
- Multi-idioma (EspaÃ±ol/InglÃ©s)
- Tema oscuro/claro/automÃ¡tico
- Notificaciones push
- BÃºsqueda avanzada con filtros
- ExportaciÃ³n de reportes (CSV/PDF)
- GestiÃ³n de clientes y lealtad

### Cambiado
- MigraciÃ³n a Ionic 7
- ActualizaciÃ³n a Angular 18
- Uso de Standalone Components
- ImplementaciÃ³n de Signals

### Seguridad
- ImplementaciÃ³n de CSP
- EncriptaciÃ³n de datos sensibles
- ProtecciÃ³n contra XSS
- Manejo seguro de tokens

## [0.9.0] - 2023-12-01

### Agregado
- Sistema bÃ¡sico de productos
- MÃ³dulo de ventas
- AutenticaciÃ³n simple

### Corregido
- Bug en cÃ¡lculo de totales
- Error en validaciÃ³n de formularios

## [0.1.0] - 2023-11-01

### Agregado
- Estructura inicial del proyecto
- ConfiguraciÃ³n de Ionic y Angular
- Setup de testing
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  6.7 CI/CD Y DEPLOYMENT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 6.7.1 GitHub Actions - CI
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: .github/workflows/ci.yml

```yaml
name: CI

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  lint:
    name: Lint
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Run ESLint
        run: npm run lint
      
      - name: Check formatting
        run: npm run format:check

  test:
    name: Test
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Run tests
        run: npm run test:ci
      
      - name: Upload coverage
        uses: codecov/codecov-action@v3
        with:
          file: ./coverage/lcov.info

  build:
    name: Build
    runs-on: ubuntu-latest
    needs: [lint, test]
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Build application
        run: npm run build:prod
      
      - name: Upload artifacts
        uses: actions/upload-artifact@v3
        with:
          name: dist
          path: www/

  e2e:
    name: E2E Tests
    runs-on: ubuntu-latest
    needs: build
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Run E2E tests
        run: npm run e2e:ci
      
      - name: Upload screenshots
        if: failure()
        uses: actions/upload-artifact@v3
        with:
          name: cypress-screenshots
          path: cypress/screenshots/
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 6.7.2 GitHub Actions - Deploy
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: .github/workflows/deploy.yml

```yaml
name: Deploy

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    name: Deploy to Production
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Build for production
        run: npm run build:prod
        env:
          API_URL: ${{ secrets.API_URL }}
      
      - name: Deploy to Netlify
        uses: nwtgck/actions-netlify@v2
        with:
          publish-dir: './www'
          production-branch: main
          github-token: ${{ secrets.GITHUB_TOKEN }}
          deploy-message: "Deploy from GitHub Actions"
        env:
          NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
          NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID }}
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 6.7.3 Environment Variables
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: src/environments/environment.example.ts

```typescript
export const environment = {
  production: false,
  apiUrl: 'http://localhost:8080/api',
  encryptionKey: 'your-secret-key-change-in-production',
  googleAnalyticsId: '',
  sentryDsn: '',
  firebase: {
    apiKey: '',
    authDomain: '',
    projectId: '',
    storageBucket: '',
    messagingSenderId: '',
    appId: ''
  }
};
```

UBICACIÃ“N: src/environments/environment.prod.ts

```typescript
export const environment = {
  production: true,
  apiUrl: 'https://api.gestpharma.com/api',
  encryptionKey: '${ENCRYPTION_KEY}',
  googleAnalyticsId: '${GA_ID}',
  sentryDsn: '${SENTRY_DSN}',
  firebase: {
    apiKey: '${FIREBASE_API_KEY}',
    authDomain: '${FIREBASE_AUTH_DOMAIN}',
    projectId: '${FIREBASE_PROJECT_ID}',
    storageBucket: '${FIREBASE_STORAGE_BUCKET}',
    messagingSenderId: '${FIREBASE_MESSAGING_SENDER_ID}',
    appId: '${FIREBASE_APP_ID}'
  }
};
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â–¶ 6.7.4 Docker Configuration
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

UBICACIÃ“N: Dockerfile

```dockerfile
# Stage 1: Build
FROM node:18-alpine AS builder

WORKDIR /app

COPY package*.json ./
RUN npm ci

COPY . .
RUN npm run build:prod

# Stage 2: Production
FROM nginx:alpine

# Copiar build
COPY --from=builder /app/www /usr/share/nginx/html

# Copiar configuraciÃ³n de nginx
COPY nginx.conf /etc/nginx/nginx.conf

EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]
```

UBICACIÃ“N: nginx.conf

```nginx
events {
  worker_connections 1024;
}

http {
  include /etc/nginx/mime.types;
  default_type application/octet-stream;
  
  server {
    listen 80;
    server_name localhost;
    root /usr/share/nginx/html;
    index index.html;
    
    # Gzip compression
    gzip on;
    gzip_vary on;
    gzip_types text/plain text/css text/xml text/javascript application/x-javascript application/xml+rss application/json;
    
    # Security headers
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    
    # Cache static assets
    location ~* \.(jpg|jpeg|png|gif|ico|css|js|woff|woff2|ttf)$ {
      expires 1y;
      add_header Cache-Control "public, immutable";
    }
    
    # Single Page Application
    location / {
      try_files $uri $uri/ /index.html;
    }
  }
}
```

UBICACIÃ“N: docker-compose.yml

```yaml
version: '3.8'

services:
  app:
    build: .
    ports:
      - "80:80"
    environment:
      - API_URL=https://api.gestpharma.com
    restart: unless-stopped
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                    RESUMEN FINAL - FASE 6                                 â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… 6.1 SEGURIDAD
  â€¢ Content Security Policy
  â€¢ ProtecciÃ³n XSS con SanitizerService
  â€¢ JWT Token Management
  â€¢ Auth Interceptor con Refresh Token
  â€¢ EncriptaciÃ³n de datos sensibles

âœ… 6.2 MANEJO DE ERRORES
  â€¢ Global Error Handler
  â€¢ Error Interceptor con retry
  â€¢ Retry Strategy Service configurable

âœ… 6.3 LOGGING Y MONITOREO
  â€¢ Logger Service con niveles
  â€¢ Performance Monitoring
  â€¢ Analytics Tracking Service

âœ… 6.4 PWA
  â€¢ Service Worker configurado
  â€¢ Web App Manifest completo
  â€¢ PWA Update Service
  â€¢ Install Prompt con soporte iOS

âœ… 6.5 OPTIMIZACIÃ“N
  â€¢ Lazy Loading de mÃ³dulos
  â€¢ Preloading Strategy personalizada
  â€¢ Virtual Scrolling
  â€¢ Image Lazy Loading
  â€¢ Bundle Optimization
  â€¢ TrackBy Functions

âœ… 6.6 DOCUMENTACIÃ“N
  â€¢ JSDoc comments
  â€¢ README principal
  â€¢ GuÃ­a de desarrollo
  â€¢ Changelog

âœ… 6.7 CI/CD
  â€¢ GitHub Actions (CI/CD)
  â€¢ Environment variables
  â€¢ Docker configuration
  â€¢ Nginx para producciÃ³n

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  FIN DE LAS INSTRUCCIONES COMPLETAS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Este documento cubre todas las mejoras necesarias para GestPharma, desde UI/UX
hasta deployment, con cÃ³digo production-ready, testeable y mantenible siguiendo
las mejores prÃ¡cticas de Ionic 7 + Angular 18.

TOTAL DE FASES COMPLETADAS: 6/6 âœ…

- Fase 1: Mejoras UI/UX
- Fase 2: Arquitectura y Mejores PrÃ¡cticas
- Fase 3: Testing y Calidad
- Fase 4: Calidad de CÃ³digo y EstandarizaciÃ³n
- Fase 5: Mejoras Funcionales
- Fase 6: Requisitos No Funcionales

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
